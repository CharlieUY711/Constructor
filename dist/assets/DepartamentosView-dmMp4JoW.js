import{c as re,e as M,p as O,r as t,j as e}from"./index-azkS-jky.js";import{O as te}from"./OrangeHeader-DXf0Dzcs.js";import{F as ie}from"./folder-tree-C018hBG2.js";import{S as se}from"./shield-check-DUpYcOEe.js";import{T as G}from"./triangle-alert-h2js-0wt.js";import{P as K}from"./plus-DQBZQ3QI.js";import{D as ae}from"./download-EN34BNFH.js";import{R as le}from"./refresh-cw-BHwv1Lfu.js";import{L as W}from"./loader-circle-CxJlOYrT.js";import{X as U}from"./x-juMb23hc.js";import{C as P}from"./check-CQM8h6OC.js";import{C as q}from"./chevron-down-DnRT3h9E.js";import{C as H}from"./chevron-right-E4Gd6Viu.js";import{P as L}from"./pen-CYamsmFN.js";import{T as de}from"./trash-2-DR8C_KhM.js";import"./ConnectionStatusIcon-B0SH-dg6.js";import"./zap-D43v8-VJ.js";import"./lightbulb-BiOuno9l.js";import"./map-pin-BucniFEY.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m21.7 16.4-.9-.3",key:"12j9ji"}],["path",{d:"m15.2 13.9-.9-.3",key:"1fdjdi"}],["path",{d:"m16.6 18.7.3-.9",key:"heedtr"}],["path",{d:"m19.1 12.2.3-.9",key:"1af3ki"}],["path",{d:"m19.6 18.7-.4-1",key:"1x9vze"}],["path",{d:"m16.8 12.3-.4-1",key:"vqeiwj"}],["path",{d:"m14.3 16.6 1-.4",key:"1qlj63"}],["path",{d:"m20.7 13.8 1-.4",key:"1v5t8k"}]],pe=re("user-cog",ce),V=`${M}/departamentos`,_={"Content-Type":"application/json",Authorization:`Bearer ${O}`};async function xe(){const s=await(await fetch(`${V}`,{headers:_})).json();if(s.error)throw new Error(s.error);return s.data||[]}async function ge(o){const i=await(await fetch(`${V}`,{method:"POST",headers:_,body:JSON.stringify(o)})).json();if(i.error)throw new Error(i.error);return i.data}async function Y(o,s){const l=await(await fetch(`${V}/${o}`,{method:"PUT",headers:_,body:JSON.stringify(s)})).json();if(l.error)throw new Error(l.error);return l.data}const $=`${M}/categorias`,N={"Content-Type":"application/json",Authorization:`Bearer ${O}`};async function ue(o){const s=new URLSearchParams;o!=null&&o.departamento_id&&s.append("departamento_id",o.departamento_id),(o==null?void 0:o.activo)!==void 0&&s.append("activo",String(o.activo));const i=s.toString()?`${$}?${s}`:$,x=await(await fetch(i,{headers:N})).json();if(x.error)throw new Error(x.error);return x.data||[]}async function he(o){const i=await(await fetch(`${$}`,{method:"POST",headers:N,body:JSON.stringify(o)})).json();if(i.error)throw new Error(i.error);return i.data}async function me(o,s){const l=await(await fetch(`${$}/${o}`,{method:"PUT",headers:N,body:JSON.stringify(s)})).json();if(l.error)throw new Error(l.error);return l.data}async function ye(o){const i=await(await fetch(`${$}/${o}`,{method:"DELETE",headers:N})).json();if(i.error)throw new Error(i.error)}const X=`${M}/subcategorias`,Q={"Content-Type":"application/json",Authorization:`Bearer ${O}`};async function be(o){const i=await(await fetch(`${X}`,{method:"POST",headers:Q,body:JSON.stringify(o)})).json();if(i.error)throw new Error(i.error);return i.data}async function fe(o,s){const l=await(await fetch(`${X}/${o}`,{method:"PUT",headers:Q,body:JSON.stringify(s)})).json();if(l.error)throw new Error(l.error);return l.data}const y="#FF6835";function je({dept:o,onClose:s,onSave:i}){const[l,x]=t.useState((o==null?void 0:o.nombre)??""),[k,j]=t.useState((o==null?void 0:o.icono)??""),[C,F]=t.useState((o==null?void 0:o.color)??"#FF6835"),[b,h]=t.useState(String((o==null?void 0:o.orden)??"")),[c,S]=t.useState((o==null?void 0:o.activo)??!0),[d,f]=t.useState((o==null?void 0:o.moneda)??"UYU"),[z,v]=t.useState((o==null?void 0:o.edad_minima)??"Todas"),[p,I]=t.useState((o==null?void 0:o.alcance)??"Local"),[E,R]=t.useState(!1),B=async()=>{if(l.trim()){R(!0);try{await i({nombre:l.trim(),icono:k.trim()||void 0,color:C||void 0,orden:b?parseInt(b):void 0,activo:c,moneda:d,edad_minima:z,alcance:p}),s()}finally{R(!1)}}};return e.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.45)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("div",{style:{backgroundColor:"#FFF",borderRadius:"14px",padding:"28px",width:"420px",boxShadow:"0 20px 60px rgba(0,0,0,0.2)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsx("h3",{style:{margin:0,fontWeight:"800",color:"#111827"},children:o?"Editar Departamento":"Nuevo Departamento"}),e.jsx("button",{onClick:s,style:{background:"none",border:"none",cursor:"pointer",color:"#9CA3AF"},children:e.jsx(U,{size:18})})]}),[{label:"Nombre *",value:l,onChange:x,placeholder:"Ej: Tecnolog√≠a"},{label:"Icono (emoji)",value:k,onChange:j,placeholder:"Ej: üíª"},{label:"Orden",value:b,onChange:h,placeholder:"Ej: 3",type:"number"}].map(a=>e.jsxs("div",{style:{marginBottom:"14px"},children:[e.jsx("label",{style:{display:"block",fontSize:"0.78rem",fontWeight:"700",color:"#374151",marginBottom:"5px"},children:a.label}),e.jsx("input",{type:a.type??"text",value:a.value,onChange:A=>a.onChange(A.target.value),placeholder:a.placeholder,style:{width:"100%",padding:"9px 12px",border:"1px solid #E5E7EB",borderRadius:"8px",fontSize:"0.875rem",outline:"none",boxSizing:"border-box"}})]},a.label)),e.jsxs("div",{style:{marginBottom:"14px"},children:[e.jsx("label",{style:{display:"block",fontSize:"0.78rem",fontWeight:"700",color:"#374151",marginBottom:"5px"},children:"Color"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx("input",{type:"color",value:C,onChange:a=>F(a.target.value),style:{width:"48px",height:"36px",border:"1px solid #E5E7EB",borderRadius:"6px",cursor:"pointer",padding:"2px"}}),e.jsx("span",{style:{fontSize:"0.78rem",color:"#6B7280"},children:C})]})]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",marginBottom:"14px",fontSize:"0.875rem",color:"#374151"},children:[e.jsx("input",{type:"checkbox",checked:c,onChange:a=>S(a.target.checked),style:{accentColor:y}}),"Activo (visible en la tienda)"]}),e.jsxs("div",{style:{marginBottom:"14px"},children:[e.jsx("label",{style:{display:"block",fontSize:"0.78rem",fontWeight:"700",color:"#374151",marginBottom:"5px"},children:"Moneda"}),e.jsxs("select",{value:d,onChange:a=>f(a.target.value),style:{width:"100%",padding:"9px 12px",border:"1px solid #E5E7EB",borderRadius:"8px",fontSize:"0.875rem",outline:"none",boxSizing:"border-box"},children:[e.jsx("option",{value:"UYU",children:"UYU"}),e.jsx("option",{value:"USD",children:"USD"}),e.jsx("option",{value:"EUR",children:"EUR"})]})]}),e.jsxs("div",{style:{marginBottom:"14px"},children:[e.jsx("label",{style:{display:"block",fontSize:"0.78rem",fontWeight:"700",color:"#374151",marginBottom:"5px"},children:"Edad M√≠nima"}),e.jsxs("select",{value:z,onChange:a=>v(a.target.value),style:{width:"100%",padding:"9px 12px",border:"1px solid #E5E7EB",borderRadius:"8px",fontSize:"0.875rem",outline:"none",boxSizing:"border-box"},children:[e.jsx("option",{value:"Todas",children:"Todas"}),e.jsx("option",{value:"+18",children:"+18"})]})]}),e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsx("label",{style:{display:"block",fontSize:"0.78rem",fontWeight:"700",color:"#374151",marginBottom:"5px"},children:"Alcance"}),e.jsxs("select",{value:p,onChange:a=>I(a.target.value),style:{width:"100%",padding:"9px 12px",border:"1px solid #E5E7EB",borderRadius:"8px",fontSize:"0.875rem",outline:"none",boxSizing:"border-box"},children:[e.jsx("option",{value:"Local",children:"Local"}),e.jsx("option",{value:"Nacional",children:"Nacional"}),e.jsx("option",{value:"Internacional",children:"Internacional"})]})]}),e.jsxs("div",{style:{display:"flex",gap:"10px",justifyContent:"flex-end"},children:[e.jsx("button",{onClick:s,style:{padding:"9px 18px",border:"1px solid #E5E7EB",backgroundColor:"#FFF",borderRadius:"8px",cursor:"pointer",fontWeight:"600",fontSize:"0.875rem"},children:"Cancelar"}),e.jsxs("button",{onClick:B,disabled:E||!l.trim(),style:{padding:"9px 20px",backgroundColor:y,color:"#FFF",border:"none",borderRadius:"8px",fontWeight:"700",cursor:E?"not-allowed":"pointer",fontSize:"0.875rem",display:"flex",alignItems:"center",gap:"6px",opacity:E?.7:1},children:[E?e.jsx(W,{size:14,className:"animate-spin"}):e.jsx(P,{size:14}),o?"Guardar cambios":"Crear departamento"]})]})]})})}function Ce({categoria:o,departamentoId:s,onClose:i,onSave:l}){const[x,k]=t.useState((o==null?void 0:o.nombre)??""),[j,C]=t.useState((o==null?void 0:o.icono)??""),[F,b]=t.useState((o==null?void 0:o.color)??"#FF6835"),[h,c]=t.useState(String((o==null?void 0:o.orden)??"")),[S,d]=t.useState((o==null?void 0:o.activo)??!0),[f,z]=t.useState(!1),v=async()=>{if(x.trim()){z(!0);try{await l({departamento_id:s,nombre:x.trim(),icono:j.trim()||void 0,color:F||void 0,orden:h?parseInt(h):void 0,activo:S}),i()}finally{z(!1)}}};return e.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.45)",zIndex:1001,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("div",{style:{backgroundColor:"#FFF",borderRadius:"14px",padding:"28px",width:"420px",boxShadow:"0 20px 60px rgba(0,0,0,0.2)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsx("h3",{style:{margin:0,fontWeight:"800",color:"#111827"},children:o?"Editar Categor√≠a":"Nueva Categor√≠a"}),e.jsx("button",{onClick:i,style:{background:"none",border:"none",cursor:"pointer",color:"#9CA3AF"},children:e.jsx(U,{size:18})})]}),[{label:"Nombre *",value:x,onChange:k,placeholder:"Ej: Electr√≥nica"},{label:"Icono (emoji)",value:j,onChange:C,placeholder:"Ej: üì±"},{label:"Orden",value:h,onChange:c,placeholder:"Ej: 1",type:"number"}].map(p=>e.jsxs("div",{style:{marginBottom:"14px"},children:[e.jsx("label",{style:{display:"block",fontSize:"0.78rem",fontWeight:"700",color:"#374151",marginBottom:"5px"},children:p.label}),e.jsx("input",{type:p.type??"text",value:p.value,onChange:I=>p.onChange(I.target.value),placeholder:p.placeholder,style:{width:"100%",padding:"9px 12px",border:"1px solid #E5E7EB",borderRadius:"8px",fontSize:"0.875rem",outline:"none",boxSizing:"border-box"}})]},p.label)),e.jsxs("div",{style:{marginBottom:"14px"},children:[e.jsx("label",{style:{display:"block",fontSize:"0.78rem",fontWeight:"700",color:"#374151",marginBottom:"5px"},children:"Color"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx("input",{type:"color",value:F,onChange:p=>b(p.target.value),style:{width:"48px",height:"36px",border:"1px solid #E5E7EB",borderRadius:"6px",cursor:"pointer",padding:"2px"}}),e.jsx("span",{style:{fontSize:"0.78rem",color:"#6B7280"},children:F})]})]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",marginBottom:"20px",fontSize:"0.875rem",color:"#374151"},children:[e.jsx("input",{type:"checkbox",checked:S,onChange:p=>d(p.target.checked),style:{accentColor:y}}),"Activo"]}),e.jsxs("div",{style:{display:"flex",gap:"10px",justifyContent:"flex-end"},children:[e.jsx("button",{onClick:i,style:{padding:"9px 18px",border:"1px solid #E5E7EB",backgroundColor:"#FFF",borderRadius:"8px",cursor:"pointer",fontWeight:"600",fontSize:"0.875rem"},children:"Cancelar"}),e.jsxs("button",{onClick:v,disabled:f||!x.trim(),style:{padding:"9px 20px",backgroundColor:y,color:"#FFF",border:"none",borderRadius:"8px",fontWeight:"700",cursor:f?"not-allowed":"pointer",fontSize:"0.875rem",display:"flex",alignItems:"center",gap:"6px",opacity:f?.7:1},children:[f?e.jsx(W,{size:14,className:"animate-spin"}):e.jsx(P,{size:14}),o?"Guardar":"Crear"]})]})]})})}function Fe({subcategoria:o,categoriaId:s,onClose:i,onSave:l}){const[x,k]=t.useState((o==null?void 0:o.nombre)??""),[j,C]=t.useState(String((o==null?void 0:o.orden)??"")),[F,b]=t.useState((o==null?void 0:o.activo)??!0),[h,c]=t.useState(!1),S=async()=>{if(x.trim()){c(!0);try{await l({categoria_id:s,nombre:x.trim(),orden:j?parseInt(j):void 0,activo:F}),i()}finally{c(!1)}}};return e.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.45)",zIndex:1001,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("div",{style:{backgroundColor:"#FFF",borderRadius:"14px",padding:"28px",width:"420px",boxShadow:"0 20px 60px rgba(0,0,0,0.2)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsx("h3",{style:{margin:0,fontWeight:"800",color:"#111827"},children:o?"Editar Subcategor√≠a":"Nueva Subcategor√≠a"}),e.jsx("button",{onClick:i,style:{background:"none",border:"none",cursor:"pointer",color:"#9CA3AF"},children:e.jsx(U,{size:18})})]}),[{label:"Nombre *",value:x,onChange:k,placeholder:"Ej: Smartphones"},{label:"Orden",value:j,onChange:C,placeholder:"Ej: 1",type:"number"}].map(d=>e.jsxs("div",{style:{marginBottom:"14px"},children:[e.jsx("label",{style:{display:"block",fontSize:"0.78rem",fontWeight:"700",color:"#374151",marginBottom:"5px"},children:d.label}),e.jsx("input",{type:d.type??"text",value:d.value,onChange:f=>d.onChange(f.target.value),placeholder:d.placeholder,style:{width:"100%",padding:"9px 12px",border:"1px solid #E5E7EB",borderRadius:"8px",fontSize:"0.875rem",outline:"none",boxSizing:"border-box"}})]},d.label)),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",marginBottom:"20px",fontSize:"0.875rem",color:"#374151"},children:[e.jsx("input",{type:"checkbox",checked:F,onChange:d=>b(d.target.checked),style:{accentColor:y}}),"Activo"]}),e.jsxs("div",{style:{display:"flex",gap:"10px",justifyContent:"flex-end"},children:[e.jsx("button",{onClick:i,style:{padding:"9px 18px",border:"1px solid #E5E7EB",backgroundColor:"#FFF",borderRadius:"8px",cursor:"pointer",fontWeight:"600",fontSize:"0.875rem"},children:"Cancelar"}),e.jsxs("button",{onClick:S,disabled:h||!x.trim(),style:{padding:"9px 20px",backgroundColor:y,color:"#FFF",border:"none",borderRadius:"8px",fontWeight:"700",cursor:h?"not-allowed":"pointer",fontSize:"0.875rem",display:"flex",alignItems:"center",gap:"6px",opacity:h?.7:1},children:[h?e.jsx(W,{size:14,className:"animate-spin"}):e.jsx(P,{size:14}),o?"Guardar":"Crear"]})]})]})})}function Se({dept:o,index:s,isExpanded:i,viewMode:l,onToggleExpand:x,onEdit:k,onToggleActivo:j,onLoadCategorias:C,onSaveCategoria:F,onSaveSubcategoria:b,onDeleteCategoria:h}){const c=l==="admin",[S,d]=t.useState([]),[f,z]=t.useState(!1),[v,p]=t.useState(new Set),[I,E]=t.useState(!1),[R,B]=t.useState(!1),[a,A]=t.useState(null),[n,g]=t.useState(null),[u,m]=t.useState(""),[D,J]=t.useState(null);t.useEffect(()=>{i&&S.length===0&&T()},[i]);const T=async()=>{z(!0);try{const r=await C(o.id);d(r)}catch(r){console.error("Error cargando categor√≠as:",r)}finally{z(!1)}},Z=r=>{const w=new Set(v);w.has(r)?w.delete(r):w.add(r),p(w)},ee=async r=>{a?await me(a.id,r):await F(r),await T(),E(!1),A(null)},oe=async r=>{if(h&&confirm("¬øEst√°s seguro de que quer√©s eliminar esta categor√≠a? Esto tambi√©n eliminar√° todas sus subcategor√≠as.")){J(r);try{await h(r),await T()}catch(w){console.error("Error eliminando categor√≠a:",w),alert("Error al eliminar la categor√≠a")}finally{J(null)}}},ne=async r=>{n?await fe(n.id,r):await b(r),await T(),B(!1),g(null),m("")};return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"12px 16px",borderBottom:"1px solid #F3F4F6",backgroundColor:s%2===0?"#FFFFFF":"#FAFAFA",transition:"background-color 0.1s"},onMouseEnter:r=>r.currentTarget.style.backgroundColor="#FFF4EC",onMouseLeave:r=>r.currentTarget.style.backgroundColor=s%2===0?"#FFFFFF":"#FAFAFA",children:[e.jsx("button",{onClick:()=>x(o.id),style:{background:"none",border:"none",cursor:"pointer",color:"#9CA3AF",padding:"2px 6px",marginRight:"4px",flexShrink:0},children:i?e.jsx(q,{size:15}):e.jsx(H,{size:15})}),e.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"8px",backgroundColor:o.color?`${o.color}22`:"#F3F4F6",border:o.color?`1px solid ${o.color}44`:"none",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.2rem",flexShrink:0,marginRight:"12px"},children:o.icono||"üì¶"}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("span",{style:{fontWeight:"600",color:"#111827",fontSize:"0.875rem"},children:o.nombre}),!o.activo&&e.jsx("span",{style:{padding:"1px 7px",borderRadius:"12px",backgroundColor:"#F3F4F6",color:"#6B7280",fontSize:"0.65rem",fontWeight:"700"},children:"Inactivo"})]}),o.color&&e.jsxs("span",{style:{fontSize:"0.72rem",color:"#9CA3AF"},children:[o.color," ",o.orden!==void 0?`¬∑ orden ${o.orden}`:""]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"14px",flexShrink:0},children:[c&&e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"4px",cursor:"pointer",fontSize:"0.72rem",color:"#6B7280"},children:[e.jsx("input",{type:"checkbox",checked:o.activo,onChange:r=>j(o.id,r.target.checked),style:{accentColor:y}}),"Visible"]}),e.jsx("button",{onClick:()=>k(o),style:{background:"none",border:"none",cursor:"pointer",color:"#9CA3AF",padding:"3px"},children:e.jsx(L,{size:14})})]})]}),i&&e.jsxs("div",{style:{backgroundColor:"#F9FAFB",borderBottom:"1px solid #F3F4F6",padding:"12px 16px 12px 60px"},children:[I&&e.jsx(Ce,{categoria:a,departamentoId:o.id,onClose:()=>{E(!1),A(null)},onSave:ee}),R&&e.jsx(Fe,{subcategoria:n,categoriaId:u,onClose:()=>{B(!1),g(null),m("")},onSave:ne}),e.jsxs("div",{style:{marginBottom:"12px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("p",{style:{margin:0,fontSize:"0.72rem",fontWeight:"700",color:"#6B7280",textTransform:"uppercase",letterSpacing:"0.05em"},children:"Categor√≠as"}),c&&e.jsxs("button",{onClick:()=>{A(null),E(!0)},style:{padding:"4px 10px",backgroundColor:y,color:"#FFF",border:"none",borderRadius:"6px",fontWeight:"600",fontSize:"0.72rem",cursor:"pointer",display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(K,{size:12})," Agregar categor√≠a"]})]}),f?e.jsxs("div",{style:{padding:"20px",textAlign:"center",color:"#9CA3AF",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[e.jsx(W,{size:14,style:{animation:"spin 1s linear infinite"}}),e.jsx("span",{style:{fontSize:"0.75rem"},children:"Cargando categor√≠as..."})]}):S.length===0?e.jsxs("div",{style:{padding:"20px",textAlign:"center",color:"#9CA3AF",fontSize:"0.75rem"},children:["No hay categor√≠as. ",c&&"Agreg√° la primera."]}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:S.map(r=>e.jsxs("div",{style:{backgroundColor:"#FFFFFF",borderRadius:"8px",border:"1px solid #E5E7EB",overflow:"hidden"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"8px 12px",gap:"8px"},children:[e.jsx("button",{onClick:()=>Z(r.id),style:{background:"none",border:"none",cursor:"pointer",color:"#9CA3AF",padding:"2px",flexShrink:0},children:v.has(r.id)?e.jsx(q,{size:12}):e.jsx(H,{size:12})}),e.jsx("div",{style:{width:"24px",height:"24px",borderRadius:"6px",backgroundColor:r.color?`${r.color}22`:"#F3F4F6",border:r.color?`1px solid ${r.color}44`:"none",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.9rem",flexShrink:0},children:r.icono||"üìÅ"}),e.jsx("span",{style:{flex:1,fontWeight:"600",color:"#111827",fontSize:"0.8rem"},children:r.nombre}),!r.activo&&e.jsx("span",{style:{padding:"1px 6px",borderRadius:"10px",backgroundColor:"#F3F4F6",color:"#6B7280",fontSize:"0.65rem",fontWeight:"700"},children:"Inactivo"}),c&&e.jsxs("div",{style:{display:"flex",gap:"6px",alignItems:"center"},children:[e.jsx("button",{onClick:()=>{A(r),E(!0)},style:{background:"none",border:"none",cursor:"pointer",color:"#9CA3AF",padding:"2px"},children:e.jsx(L,{size:12})}),h&&e.jsx("button",{onClick:()=>oe(r.id),disabled:D===r.id,style:{background:"none",border:"none",cursor:D===r.id?"not-allowed":"pointer",color:D===r.id?"#D1D5DB":"#EF4444",padding:"2px",opacity:D===r.id?.5:1},children:D===r.id?e.jsx(W,{size:12,style:{animation:"spin 1s linear infinite"}}):e.jsx(de,{size:12})}),e.jsx("button",{onClick:()=>{m(r.id),g(null),B(!0)},style:{padding:"2px 6px",backgroundColor:"#F0F9FF",color:"#0284C7",border:"none",borderRadius:"4px",fontWeight:"600",fontSize:"0.65rem",cursor:"pointer"},children:"+ Sub"})]})]}),v.has(r.id)&&r.subcategorias&&r.subcategorias.length>0&&e.jsxs("div",{style:{padding:"8px 12px 8px 44px",backgroundColor:"#FAFAFA",borderTop:"1px solid #F3F4F6"},children:[e.jsx("p",{style:{margin:"0 0 6px",fontSize:"0.65rem",fontWeight:"700",color:"#9CA3AF",textTransform:"uppercase"},children:"Subcategor√≠as"}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:r.subcategorias.map(w=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"4px 8px",backgroundColor:"#FFFFFF",borderRadius:"4px",border:"1px solid #E5E7EB"},children:[e.jsx("span",{style:{flex:1,fontSize:"0.75rem",color:"#374151"},children:w.nombre}),!w.activo&&e.jsx("span",{style:{padding:"1px 5px",borderRadius:"8px",backgroundColor:"#F3F4F6",color:"#6B7280",fontSize:"0.6rem",fontWeight:"700"},children:"Inactivo"}),c&&e.jsx("button",{onClick:()=>{g(w),m(r.id),B(!0)},style:{background:"none",border:"none",cursor:"pointer",color:"#9CA3AF",padding:"2px"},children:e.jsx(L,{size:10})})]},w.id))})]})]},r.id))})]})]})}function Ve({onNavigate:o}){const[s,i]=t.useState([]),[l,x]=t.useState(!0),[k,j]=t.useState(null),[C,F]=t.useState(new Set),[b,h]=t.useState(""),[c,S]=t.useState("admin"),[d,f]=t.useState("new"),[z,v]=t.useState(!1),p=t.useCallback(async()=>{x(!0),j(null);try{const n=await xe();i(n)}catch(n){j(n.message??"Error cargando departamentos")}finally{x(!1)}},[]);t.useEffect(()=>{p()},[p]);const I=n=>{const g=new Set(C);g.has(n)?g.delete(n):g.add(n),F(g)},E=async(n,g)=>{i(u=>u.map(m=>m.id===n?{...m,activo:g}:m));try{await Y(n,{activo:g})}catch{i(u=>u.map(m=>m.id===n?{...m,activo:!g}:m))}},R=async n=>{d&&d!=="new"&&d.id?await Y(d.id,n):await ge({nombre:n.nombre,...n}),await p()},B=()=>{const n=JSON.stringify(s,null,2),g=new Blob([n],{type:"application/json"}),u=URL.createObjectURL(g),m=document.createElement("a");m.href=u,m.download="departamentos.json",m.click(),URL.revokeObjectURL(u)},a=c==="admin",A=s.filter(n=>n.nombre.toLowerCase().includes(b.toLowerCase()));return e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:[z&&e.jsx(je,{dept:d==="new"?null:d,onClose:()=>v(!1),onSave:R}),e.jsx(te,{icon:ie,title:"Departamentos y Categor√≠as",subtitle:"Gesti√≥n de departamentos, categor√≠as y subcategor√≠as",actions:[{label:"‚Üê Volver",onClick:()=>o("gestion")}]}),e.jsxs("div",{style:{backgroundColor:"#FFFFFF",borderBottom:"1px solid #E5E7EB",padding:"0 28px",display:"flex",alignItems:"center",flexShrink:0},children:[[{key:"admin",icon:se,label:"Vista Administrador",desc:"Acceso completo a todos los controles"},{key:"operador",icon:pe,label:"Vista Operador",desc:"Sin visibilidad, moneda ni edad"}].map(n=>e.jsxs("button",{onClick:()=>S(n.key),style:{display:"flex",alignItems:"center",gap:"8px",padding:"14px 20px",border:"none",borderBottom:c===n.key?`3px solid ${y}`:"3px solid transparent",backgroundColor:"transparent",cursor:"pointer",color:c===n.key?y:"#6B7280",fontWeight:c===n.key?"700":"500",fontSize:"0.85rem",transition:"all 0.15s",whiteSpace:"nowrap"},children:[e.jsx(n.icon,{size:15}),n.label,e.jsx("span",{style:{marginLeft:"4px",padding:"2px 8px",borderRadius:"20px",backgroundColor:c===n.key?"#FFF4EC":"#F3F4F6",color:c===n.key?y:"#9CA3AF",fontSize:"0.68rem",fontWeight:"600"},children:n.desc})]},n.key)),!a&&e.jsxs("div",{style:{marginLeft:"auto",display:"flex",alignItems:"center",gap:"6px",padding:"6px 14px",backgroundColor:"#FEF3C7",borderRadius:"20px",border:"1px solid #FDE68A"},children:[e.jsx(G,{size:13,color:"#D97706"}),e.jsx("span",{style:{fontSize:"0.72rem",fontWeight:"700",color:"#92400E"},children:"Visibilidad ¬∑ Moneda ¬∑ Alcance ¬∑ Edad ‚Äì deshabilitados"})]})]}),e.jsxs("div",{style:{backgroundColor:"#FFFFFF",borderBottom:"1px solid #E5E7EB",padding:"12px 28px",flexShrink:0},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"2px"},children:[e.jsx("span",{style:{fontSize:"1.1rem"},children:"üè¨"}),e.jsx("h2",{style:{margin:0,fontWeight:"800",color:"#111827",fontSize:"1rem"},children:a?"Gesti√≥n Completa de Departamentos":"Departamentos ‚Äì Vista Restringida"}),e.jsx("span",{style:{padding:"2px 10px",borderRadius:"20px",backgroundColor:a?"#F0FFF4":"#FEF3C7",color:a?"#16A34A":"#D97706",fontSize:"0.72rem",fontWeight:"700",border:`1px solid ${a?"#BBF7D0":"#FDE68A"}`},children:a?"‚ö° Modo API":"üîí Acceso Limitado"})]}),e.jsx("p",{style:{margin:0,color:"#6B7280",fontSize:"0.75rem"},children:a?"Datos en tiempo real desde Supabase ¬∑ Cambios se guardan autom√°ticamente":"Solo pod√©s editar sincronizaci√≥n ML ¬∑ Visibilidad, moneda, alcance y edad son de gesti√≥n exclusiva del Admin"})]}),e.jsx("div",{style:{flex:1,overflowY:"auto",backgroundColor:"#F8F9FA"},children:e.jsxs("div",{style:{padding:"20px 28px",maxWidth:"1200px"},children:[k&&e.jsxs("div",{style:{backgroundColor:"#FEF2F2",border:"1px solid #FECACA",borderRadius:"10px",padding:"12px 16px",marginBottom:"20px",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx(G,{size:16,color:"#DC2626"}),e.jsx("span",{style:{fontWeight:"600",color:"#DC2626",fontSize:"0.85rem"},children:k})]}),e.jsx("button",{onClick:p,style:{padding:"6px 14px",backgroundColor:"#DC2626",color:"#FFF",border:"none",borderRadius:"7px",fontWeight:"700",cursor:"pointer",fontSize:"0.78rem"},children:"Reintentar"})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"12px",marginBottom:"20px"},children:[{value:l?"‚Ä¶":s.length,label:"Departamentos",color:y},{value:l?"‚Ä¶":s.filter(n=>n.activo).length,label:"Activos",color:"#10B981"},{value:l?"‚Ä¶":s.filter(n=>!n.activo).length,label:"Inactivos",color:"#6B7280"}].map((n,g)=>e.jsxs("div",{style:{backgroundColor:"#FFFFFF",borderRadius:"8px",border:`1px solid ${n.color}22`,padding:"12px 16px"},children:[e.jsx("p",{style:{margin:0,fontSize:"1.5rem",fontWeight:"900",color:n.color},children:n.value}),e.jsx("p",{style:{margin:"2px 0 0",fontSize:"0.72rem",color:"#6B7280"},children:n.label})]},g))}),e.jsxs("div",{style:{display:"flex",gap:"10px",marginBottom:"16px",alignItems:"center"},children:[e.jsx("div",{style:{position:"relative",flex:1,maxWidth:"320px"},children:e.jsx("input",{type:"text",placeholder:"Buscar departamento...",value:b,onChange:n=>h(n.target.value),style:{width:"100%",padding:"9px 12px",border:"1px solid #E5E7EB",borderRadius:"8px",fontSize:"0.875rem",outline:"none",boxSizing:"border-box"}})}),e.jsx("div",{style:{flex:1}}),a&&e.jsxs("button",{onClick:()=>{f("new"),v(!0)},style:{padding:"9px 16px",backgroundColor:y,color:"#FFF",border:"none",borderRadius:"8px",fontWeight:"700",fontSize:"0.82rem",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(K,{size:14})," Nuevo"]}),e.jsxs("button",{onClick:B,style:{padding:"9px 16px",backgroundColor:"#3B82F6",color:"#FFF",border:"none",borderRadius:"8px",fontWeight:"700",fontSize:"0.82rem",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(ae,{size:14})," Exportar"]}),e.jsxs("button",{onClick:p,style:{padding:"9px 16px",border:"1px solid #E5E7EB",backgroundColor:"#FFF",color:"#374151",borderRadius:"8px",fontWeight:"600",fontSize:"0.82rem",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(le,{size:14})," Recargar"]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"6px 16px 6px 64px",marginBottom:"4px",gap:"14px"},children:[e.jsx("span",{style:{flex:1,fontSize:"0.68rem",fontWeight:"700",color:"#9CA3AF",textTransform:"uppercase",letterSpacing:"0.05em"},children:"Departamento"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"14px",flexShrink:0,fontSize:"0.68rem",fontWeight:"700",color:"#9CA3AF",textTransform:"uppercase",letterSpacing:"0.05em"},children:[a&&e.jsx("span",{style:{minWidth:"48px",textAlign:"center"},children:"Visible"}),e.jsx("span",{style:{minWidth:"24px"}})]})]}),e.jsx("div",{style:{backgroundColor:"#FFFFFF",borderRadius:"12px",border:"1px solid #E5E7EB",overflow:"hidden"},children:l?e.jsxs("div",{style:{padding:"40px",textAlign:"center",color:"#9CA3AF",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px"},children:[e.jsx(W,{size:18,style:{animation:"spin 1s linear infinite"}}),e.jsx("span",{children:"Cargando departamentos..."})]}):A.length===0?e.jsx("div",{style:{padding:"40px",textAlign:"center",color:"#9CA3AF"},children:b?`No se encontraron departamentos para "${b}"`:"No hay departamentos. Cre√° el primero."}):A.map((n,g)=>e.jsx(Se,{dept:n,index:g,isExpanded:C.has(n.id),viewMode:c,onToggleExpand:I,onEdit:u=>{f(u),v(!0)},onToggleActivo:E,onLoadCategorias:async u=>await ue({departamento_id:u}),onSaveCategoria:async u=>{await he(u)},onSaveSubcategoria:async u=>{await be(u)},onDeleteCategoria:a?async u=>{await ye(u)}:void 0},n.id))}),a&&!l&&e.jsx("button",{onClick:()=>{f("new"),v(!0)},style:{marginTop:"14px",padding:"12px 20px",border:`2px dashed ${y}`,borderRadius:"10px",backgroundColor:"#FFF4EC",color:y,fontWeight:"700",cursor:"pointer",fontSize:"0.875rem",display:"flex",alignItems:"center",gap:"8px"},children:"üè¨ + Nuevo Departamento"})]})})]})}export{Ve as DepartamentosView};
