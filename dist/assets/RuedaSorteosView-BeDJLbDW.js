import{r as s,j as e}from"./index-azkS-jky.js";import{O as I}from"./OrangeHeader-DXf0Dzcs.js";import{b as z,l as M,m as P}from"./marketingApi-ByrGcGgg.js";import{R as $}from"./refresh-cw-BHwv1Lfu.js";import{L as _}from"./loader-circle-CxJlOYrT.js";import{S as O}from"./save-Blm5MNBU.js";import{P as N}from"./plus-DQBZQ3QI.js";import{T}from"./trash-2-DR8C_KhM.js";import{S as G}from"./settings-CKuECJHP.js";import"./ConnectionStatusIcon-B0SH-dg6.js";import"./zap-D43v8-VJ.js";import"./lightbulb-BiOuno9l.js";import"./map-pin-BucniFEY.js";const y="#FF6835",f=["#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEAA7","#DDA0DD","#98D8C8","#F7DC6F"];function L({prizes:b,spinning:F,onSpinEnd:R}){const[o,S]=s.useState(0),x=s.useRef(),j=s.useRef(0),u=s.useRef(0);s.useEffect(()=>{if(F){const l=Math.floor(Math.random()*b.length),i=5+Math.random()*3,a=360/b.length,c=l*a+a/2,h=o+360*i+(360-c);j.current=performance.now(),u.current=o;const C=3e3,k=g=>{const w=g-j.current,A=Math.min(w/C,1),t=1-Math.pow(1-A,3),r=u.current+(h-u.current)*t;S(r),A<1?x.current=requestAnimationFrame(k):(S(h),R(b[l]))};return x.current=requestAnimationFrame(k),()=>{x.current&&cancelAnimationFrame(x.current)}}},[F]);const m=150,d=150,p=140,E=b.length,B=l=>{const i=360/E,a=(l*i-90)*(Math.PI/180),c=((l+1)*i-90)*(Math.PI/180),h=m+p*Math.cos(a),C=d+p*Math.sin(a),k=m+p*Math.cos(c),g=d+p*Math.sin(c),w=i>180?1:0;return`M ${m},${d} L ${h},${C} A ${p},${p} 0 ${w},1 ${k},${g} Z`},W=l=>{const i=360/E*l+360/E/2-90,a=i*(Math.PI/180),c=m+p*.6*Math.cos(a),h=d+p*.6*Math.sin(a);return{x:c,y:h,angle:i}};return E===0?e.jsx("div",{style:{position:"relative",width:"300px",height:"300px",display:"flex",alignItems:"center",justifyContent:"center",color:"#9CA3AF"},children:e.jsx("p",{children:"No hay premios configurados"})}):e.jsxs("div",{style:{position:"relative",width:"300px",height:"300px"},children:[e.jsx("div",{style:{position:"absolute",top:"-8px",left:"50%",transform:"translateX(-50%)",zIndex:10},children:e.jsx("div",{style:{width:0,height:0,borderLeft:"10px solid transparent",borderRight:"10px solid transparent",borderTop:"20px solid #333",margin:"0 auto"}})}),e.jsxs("svg",{width:"300",height:"300",style:{transform:`rotate(${o}deg)`,transformOrigin:"50% 50%",transition:"none"},children:[b.map((l,i)=>{const{x:a,y:c,angle:h}=W(i);return e.jsxs("g",{children:[e.jsx("path",{d:B(i),fill:l.color,stroke:"#FFFFFF",strokeWidth:"2"}),e.jsx("text",{x:a,y:c,textAnchor:"middle",dominantBaseline:"middle",transform:`rotate(${h}, ${a}, ${c})`,fill:"#FFFFFF",fontSize:"11",fontWeight:"700",style:{textShadow:"0 1px 2px rgba(0,0,0,0.3)",pointerEvents:"none"},children:l.label})]},l.id)}),e.jsx("circle",{cx:m,cy:d,r:"20",fill:"#FFFFFF",stroke:"#E5E7EB",strokeWidth:"2"}),e.jsx("circle",{cx:m,cy:d,r:"8",fill:y})]})]})}function re({onNavigate:b}){const[F,R]=s.useState([]),[o,S]=s.useState(null),[x,j]=s.useState([]),[u,m]=s.useState(!1),[d,p]=s.useState(null),[E,B]=s.useState(!0),[W,l]=s.useState(null),[i,a]=s.useState({name:"Nueva Rueda",spinDuration:3e3,showConfetti:!0,requireEmail:!0,requireLogin:!1,notifyEmail:!0,notifyWhatsapp:!1,shareOnSocial:!0,activeOnSite:!1,maxSpinsUser:"",maxSpinsDay:""});s.useEffect(()=>{c()},[]);const c=async()=>{B(!0),l(null);try{const t=await z();R(t),t.length>0&&!o&&S(t[0])}catch(t){l(t instanceof Error?t.message:"Error cargando sorteos"),console.error("Error loading sorteos:",t)}finally{B(!1)}},h=async()=>{const t=prompt("Nombre del sorteo:");if(!t)return;const r=prompt("Premio:")||null;try{const n=await M({nombre:t,premio:r,estado:"borrador"});n&&(R([...F,n]),S(n))}catch(n){alert("Error creando sorteo: "+(n instanceof Error?n.message:String(n)))}},C=async()=>{if(!(!o||u)){if(o.estado!=="activo"){alert("El sorteo debe estar activo para girar");return}p(null),m(!0)}},k=async t=>{if(m(!1),p(t),o)try{const r=await P(o.id);r&&(await c(),alert(`Â¡Ganador: ${r.ganador.email}!`))}catch(r){alert("Error girando sorteo: "+(r instanceof Error?r.message:String(r)))}},g=(t,r,n)=>{j(v=>v.map(D=>D.id===t?{...D,[r]:n}:D))},w=()=>{const t={id:Date.now().toString(),label:"Nuevo Premio",type:"discount_pct",value:10,probability:10,color:f[x.length%f.length],email:!0,whatsapp:!1,checkStock:!1,discountStock:!1};j(r=>[...r,t])},A=x.reduce((t,r)=>t+r.probability,0);return s.useEffect(()=>{!o&&x.length===0&&j([{id:"1",label:"10% OFF",type:"discount_pct",value:10,probability:30,color:f[0],email:!0,whatsapp:!0,checkStock:!0,discountStock:!1},{id:"2",label:"20% OFF",type:"discount_pct",value:20,probability:20,color:f[1],email:!0,whatsapp:!0,checkStock:!0,discountStock:!1},{id:"3",label:"EnvÃ­o Gratis",type:"free_shipping",value:0,probability:25,color:f[2],email:!0,whatsapp:!1,checkStock:!1,discountStock:!1},{id:"4",label:"5% OFF",type:"discount_pct",value:5,probability:15,color:f[3],email:!1,whatsapp:!1,checkStock:!1,discountStock:!1},{id:"5",label:"Premio Sorpresa",type:"gift",value:0,probability:5,color:f[4],email:!0,whatsapp:!0,checkStock:!1,discountStock:!1},{id:"6",label:"30% OFF",type:"discount_pct",value:30,probability:5,color:f[5],email:!0,whatsapp:!0,checkStock:!0,discountStock:!0}])},[o]),e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsx(I,{icon:$,title:"Rueda de Sorteos Integrada",subtitle:"Sorteos interactivos para campaÃ±as y eventos",actions:[{label:"Volver",onClick:()=>b("marketing")},{label:"+ Nueva Rueda",primary:!0,onClick:h},{label:"ðŸ“Š EstadÃ­sticas"}]}),e.jsx("div",{style:{flex:1,overflowY:"auto",backgroundColor:"#F8F9FA"},children:E?e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:e.jsxs("div",{style:{textAlign:"center",color:"#6B7280"},children:[e.jsx(_,{size:32,className:"animate-spin",style:{margin:"0 auto 12px",display:"block"}}),e.jsx("p",{children:"Cargando sorteos..."})]})}):W?e.jsx("div",{style:{padding:"24px 28px"},children:e.jsx("div",{style:{backgroundColor:"#FEF2F2",borderRadius:"10px",border:"1px solid #FECACA",padding:"14px 18px",color:"#991B1B"},children:e.jsxs("p",{style:{margin:0,fontWeight:"700"},children:["âš ï¸ Error: ",W]})})}):e.jsxs("div",{style:{display:"flex",height:"100%"},children:[e.jsxs("div",{style:{flex:1,padding:"24px 28px",display:"flex",flexDirection:"column",alignItems:"flex-start"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%",marginBottom:"16px"},children:[e.jsxs("div",{children:[e.jsx("h3",{style:{margin:0,fontWeight:"800",color:"#111827",fontSize:"0.95rem"},children:(o==null?void 0:o.nombre)||i.name}),e.jsxs("p",{style:{margin:"3px 0 0",color:(o==null?void 0:o.estado)==="activo"?"#16A34A":"#9CA3AF",fontSize:"0.78rem",display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx("span",{style:{width:"7px",height:"7px",borderRadius:"50%",backgroundColor:(o==null?void 0:o.estado)==="activo"?"#16A34A":"#9CA3AF",display:"inline-block"}}),(o==null?void 0:o.estado)==="activo"?"Activo":(o==null?void 0:o.estado)==="finalizado"?"Finalizado":"Borrador"]})]}),e.jsxs("button",{onClick:()=>{},style:{padding:"8px 16px",border:"1px solid #E5E7EB",borderRadius:"8px",backgroundColor:"#FFF",color:"#374151",fontSize:"0.82rem",fontWeight:"600",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(O,{size:14})," Guardar"]})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"20px",width:"100%"},children:[e.jsx(L,{prizes:x,spinning:u,onSpinEnd:k}),e.jsx("button",{onClick:C,disabled:u||!o||o.estado!=="activo",style:{padding:"12px 32px",backgroundColor:y,color:"#FFF",border:"none",borderRadius:"10px",fontWeight:"800",fontSize:"1rem",cursor:u||!o||o.estado!=="activo"?"not-allowed":"pointer",opacity:u||!o||o.estado!=="activo"?.7:1,transition:"all 0.2s"},children:u?"Girandoâ€¦":"ðŸŽ° Â¡Girar!"}),d&&e.jsxs("div",{style:{padding:"14px 22px",backgroundColor:d.color+"20",border:`2px solid ${d.color}`,borderRadius:"12px",textAlign:"center",animation:"fadeIn 0.4s ease"},children:[e.jsx("p",{style:{margin:"0 0 4px",fontWeight:"800",color:"#111827",fontSize:"1rem"},children:"ðŸŽ‰ Â¡Ganaste!"}),e.jsx("p",{style:{margin:0,color:d.color,fontWeight:"700",fontSize:"1.2rem"},children:d.label})]}),o&&e.jsxs("div",{style:{width:"100%",backgroundColor:"#FFFFFF",borderRadius:"12px",border:"1px solid #E5E7EB",padding:"16px",marginTop:"20px"},children:[e.jsx("h4",{style:{margin:"0 0 12px",fontSize:"0.9rem",fontWeight:"700",color:"#111827"},children:"InformaciÃ³n del Sorteo"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px",fontSize:"0.82rem"},children:[e.jsxs("div",{children:[e.jsx("p",{style:{margin:"0 0 4px",color:"#6B7280"},children:"Participantes"}),e.jsx("p",{style:{margin:0,fontWeight:"700",color:"#111827"},children:o.total_participantes})]}),e.jsxs("div",{children:[e.jsx("p",{style:{margin:"0 0 4px",color:"#6B7280"},children:"Premio"}),e.jsx("p",{style:{margin:0,fontWeight:"700",color:"#111827"},children:o.premio||"â€”"})]})]})]})]})]}),e.jsxs("div",{style:{width:"360px",borderLeft:"1px solid #E5E7EB",backgroundColor:"#FFFFFF",overflowY:"auto",padding:"20px",flexShrink:0},children:[e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsx("h4",{style:{margin:"0 0 10px",fontSize:"0.85rem",fontWeight:"700",color:"#111827"},children:"Sorteos Guardados"}),F.length===0?e.jsx("div",{style:{padding:"20px",backgroundColor:"#F9FAFB",borderRadius:"8px",textAlign:"center",color:"#9CA3AF",fontSize:"0.78rem"},children:"No hay sorteos guardados"}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:F.map(t=>e.jsxs("div",{onClick:()=>S(t),style:{padding:"12px",backgroundColor:(o==null?void 0:o.id)===t.id?"#FFF4EC":"#F9FAFB",border:`1px solid ${(o==null?void 0:o.id)===t.id?y:"#E5E7EB"}`,borderRadius:"8px",cursor:"pointer"},children:[e.jsx("p",{style:{margin:"0 0 4px",fontWeight:"700",color:"#111827",fontSize:"0.82rem"},children:t.nombre}),e.jsxs("p",{style:{margin:0,fontSize:"0.72rem",color:"#6B7280"},children:[t.estado," Â· ",t.total_participantes," participantes"]})]},t.id))})]}),e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:[e.jsxs("div",{children:[e.jsx("h4",{style:{margin:0,fontSize:"0.85rem",fontWeight:"700",color:"#111827"},children:"Editar Premios"}),e.jsxs("p",{style:{margin:"2px 0 0",fontSize:"0.72rem",color:A===100?"#16A34A":"#EF4444"},children:["Total probabilidad: ",A,"%"]})]}),e.jsx("button",{onClick:w,style:{width:"26px",height:"26px",borderRadius:"50%",backgroundColor:y,color:"#FFF",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(N,{size:14})})]}),e.jsx("div",{style:{maxHeight:"320px",overflowY:"auto",display:"flex",flexDirection:"column",gap:"10px"},children:x.map(t=>e.jsxs("div",{style:{border:"1px solid #E5E7EB",borderRadius:"8px",padding:"10px",borderLeft:`4px solid ${t.color}`},children:[e.jsxs("div",{style:{display:"flex",gap:"6px",marginBottom:"8px"},children:[e.jsx("input",{value:t.label,onChange:r=>g(t.id,"label",r.target.value),style:{flex:1,padding:"6px 8px",border:"1px solid #E5E7EB",borderRadius:"6px",fontSize:"0.8rem",outline:"none"}}),e.jsx("input",{type:"color",value:t.color,onChange:r=>g(t.id,"color",r.target.value),style:{width:"32px",height:"32px",border:"none",borderRadius:"4px",cursor:"pointer",padding:0}}),e.jsx("button",{onClick:()=>j(r=>r.filter(n=>n.id!==t.id)),style:{background:"none",border:"none",cursor:"pointer",color:"#EF4444",padding:"4px"},children:e.jsx(T,{size:13})})]}),e.jsxs("div",{style:{display:"flex",gap:"6px",marginBottom:"8px"},children:[e.jsxs("select",{value:t.type,onChange:r=>g(t.id,"type",r.target.value),style:{flex:1,padding:"5px 8px",border:"1px solid #E5E7EB",borderRadius:"6px",fontSize:"0.75rem",outline:"none"},children:[e.jsx("option",{value:"discount_pct",children:"Descuento %"}),e.jsx("option",{value:"discount_fixed",children:"Descuento $"}),e.jsx("option",{value:"free_shipping",children:"EnvÃ­o Gratis"}),e.jsx("option",{value:"gift",children:"Regalo"}),e.jsx("option",{value:"no_prize",children:"Sin premio"})]}),(t.type==="discount_pct"||t.type==="discount_fixed")&&e.jsx("input",{type:"number",value:t.value,onChange:r=>g(t.id,"value",+r.target.value),style:{width:"54px",padding:"5px 8px",border:"1px solid #E5E7EB",borderRadius:"6px",fontSize:"0.75rem",outline:"none"}})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("span",{style:{fontSize:"0.72rem",color:"#6B7280"},children:["Prob: ",t.probability,"%"]}),e.jsx("input",{type:"range",min:1,max:100,value:t.probability,onChange:r=>g(t.id,"probability",+r.target.value),style:{flex:1,margin:"0 8px",accentColor:y}})]}),e.jsx("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap",marginTop:"6px"},children:[{key:"email",label:"âœ‰ï¸ Email"},{key:"whatsapp",label:"ðŸ’¬ WhatsApp"},{key:"checkStock",label:"ðŸ“¦ Verificar stock"},{key:"discountStock",label:"âž– Descontar stock"}].map(({key:r,label:n})=>e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"4px",fontSize:"0.7rem",color:"#374151",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:t[r],onChange:v=>g(t.id,r,v.target.checked),style:{accentColor:y}}),n]},r))})]},t.id))})]}),e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",marginBottom:"12px"},children:[e.jsx(G,{size:14,color:"#6B7280"}),e.jsx("h4",{style:{margin:0,fontSize:"0.85rem",fontWeight:"700",color:"#111827"},children:"ConfiguraciÃ³n"})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"0.75rem",color:"#374151",fontWeight:"600",marginBottom:"4px"},children:"Nombre de la Rueda"}),e.jsx("input",{value:i.name,onChange:t=>a(r=>({...r,name:t.target.value})),style:{width:"100%",padding:"8px 10px",border:"1px solid #E5E7EB",borderRadius:"6px",fontSize:"0.8rem",outline:"none",boxSizing:"border-box"}})]}),e.jsxs("div",{children:[e.jsxs("label",{style:{display:"block",fontSize:"0.75rem",color:"#374151",fontWeight:"600",marginBottom:"4px"},children:["DuraciÃ³n del giro (ms): ",i.spinDuration]}),e.jsx("input",{type:"range",min:1e3,max:6e3,step:500,value:i.spinDuration,onChange:t=>a(r=>({...r,spinDuration:+t.target.value})),style:{width:"100%",accentColor:y}})]}),[{key:"showConfetti",label:"ðŸŽ‰ Mostrar confetti"},{key:"requireEmail",label:"ðŸ“§ Requerir email"},{key:"requireLogin",label:"ðŸ” Requerir login"},{key:"notifyEmail",label:"âœ‰ï¸ Notificaciones por email"},{key:"notifyWhatsapp",label:"ðŸ’¬ Notificaciones por WhatsApp"},{key:"shareOnSocial",label:"ðŸ“² Compartir en redes sociales"},{key:"activeOnSite",label:"ðŸŒ Activar en el sitio web"}].map(({key:t,label:r})=>e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",fontSize:"0.78rem",color:"#374151",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:i[t],onChange:n=>a(v=>({...v,[t]:n.target.checked})),style:{accentColor:y}}),r]},t)),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px"},children:[{key:"maxSpinsUser",label:"MÃ¡x giros/usuario"},{key:"maxSpinsDay",label:"MÃ¡x giros/dÃ­a"}].map(({key:t,label:r})=>e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"0.72rem",color:"#374151",fontWeight:"600",marginBottom:"3px"},children:r}),e.jsx("input",{type:"text",placeholder:"Sin lÃ­mite",value:i[t],onChange:n=>a(v=>({...v,[t]:n.target.value})),style:{width:"100%",padding:"7px 8px",border:"1px solid #E5E7EB",borderRadius:"6px",fontSize:"0.75rem",outline:"none",boxSizing:"border-box"}})]},t))})]})]})]})]})})]})}export{re as RuedaSorteosView};
