import{r as n,t as s,P as G,H,j as e,T as f,h as O}from"./index-uhFGGnVP.js";import{O as L}from"./OrangeHeader-CqvKi3aq.js";import{g as Z,u as S,c as X,d as q}from"./metodosEnvioApi-BAPcUf0v.js";import{D as U}from"./dollar-sign-B-cXlmBZ.js";import{G as V}from"./globe-SRntvrmU.js";import{C as Y}from"./circle-x-C9wk-lAr.js";import{R as J}from"./refresh-cw-mGsUkaVi.js";import{M as K}from"./map-pin-DbWFQf1N.js";import{C as Q}from"./clock-khjkBRH1.js";import{P as ee}from"./pen-DXnFydc1.js";import{T as z}from"./trash-2-C5oMK7gx.js";import{X as oe}from"./x-Bj3MJ53y.js";import{S as te}from"./save-BDA2gAzf.js";import"./ConnectionStatusIcon-OHswN8K_.js";import"./zap-AC53IqjL.js";import"./lightbulb-ahu2D9ei.js";const j="#FF6835",v=[{value:"flat_rate",label:"Tarifa fija",icon:U,color:"#2563EB"},{value:"gratis",label:"Envío gratis",icon:G,color:"#059669"},{value:"calculado",label:"Calculado",icon:V,color:"#7C3AED"},{value:"retiro_local",label:"Retiro en local",icon:H,color:j}],k=()=>({nombre:"",tipo:"flat_rate",precio:0,zona:"",tiempo_estimado:"",descripcion:"",activo:!0,orden:0});function Se({onNavigate:se}){const[d,A]=n.useState([]),[I,b]=n.useState(!0),[M,c]=n.useState(!1),[x,E]=n.useState(null),[t,l]=n.useState(k()),[y,C]=n.useState(!1),[m,u]=n.useState(null),h=n.useCallback(async()=>{b(!0);try{const o=await Z();A(o)}catch(o){console.error("Error cargando métodos de envío:",o),s.error("Error al cargar métodos de envío")}finally{b(!1)}},[]);n.useEffect(()=>{h()},[h]);const R=()=>{E(null),l(k()),c(!0)},D=o=>{E(o.id),l({nombre:o.nombre,tipo:o.tipo,precio:o.precio,zona:o.zona??"",tiempo_estimado:o.tiempo_estimado??"",descripcion:o.descripcion??"",activo:o.activo,orden:o.orden}),c(!0)},T=async()=>{if(!t.nombre){s.error("El nombre es requerido");return}C(!0);try{const o={...t,zona:t.zona||null,tiempo_estimado:t.tiempo_estimado||null,descripcion:t.descripcion||null};if(x){if(!await S(x,o))throw new Error("No se pudo actualizar el método")}else if(!await X(o))throw new Error("No se pudo crear el método");s.success(x?"Método actualizado":"Método creado"),c(!1),h()}catch(o){console.error("Error guardando método:",o),s.error(`Error: ${o instanceof Error?o.message:o}`)}finally{C(!1)}},W=async o=>{try{if(!await S(o.id,{activo:!o.activo}))throw new Error("No se pudo actualizar");s.success(o.activo?"Método desactivado":"Método activado"),h()}catch{s.error("Error al actualizar")}},N=async o=>{try{if(!await q(o.id))throw new Error("No se pudo eliminar");s.success("Método eliminado"),u(null),h()}catch{s.error("Error al eliminar")}},_=d.filter(o=>o.activo).length,P=d.filter(o=>!o.activo).length;return v.find(o=>o.value===t.tipo),e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100vh",overflow:"hidden"},children:[e.jsx(L,{icon:f,title:"Métodos de Envío",subtitle:"Zonas, tarifas y opciones de entrega disponibles",actions:[{label:"+ Nuevo Método",primary:!0,onClick:R}]}),e.jsx("div",{style:{padding:"14px 28px",backgroundColor:"#fff",borderBottom:"1px solid #E5E7EB",display:"flex",gap:12},children:[{label:"Total métodos",value:d.length,icon:f,color:j},{label:"Activos",value:_,icon:O,color:"#059669"},{label:"Inactivos",value:P,icon:Y,color:"#EF4444"}].map(o=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,padding:"8px 14px",backgroundColor:"#F9FAFB",borderRadius:10,border:"1px solid #E5E7EB"},children:[e.jsx("div",{style:{width:34,height:34,borderRadius:8,backgroundColor:o.color+"18",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(o.icon,{size:16,color:o.color})}),e.jsxs("div",{children:[e.jsx("p",{style:{margin:0,fontSize:"1.1rem",fontWeight:800,color:"#111827",lineHeight:1},children:o.value}),e.jsx("p",{style:{margin:0,fontSize:"0.7rem",color:"#6B7280"},children:o.label})]})]},o.label))}),e.jsx("div",{style:{flex:1,overflow:"auto",padding:"20px 28px"},children:I?e.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:200,color:"#9CA3AF"},children:[e.jsx(J,{size:18,style:{animation:"spin 1s linear infinite",marginRight:8}})," Cargando…"]}):d.length===0?e.jsxs("div",{style:{textAlign:"center",padding:"60px 0",color:"#9CA3AF"},children:[e.jsx(f,{size:44,style:{marginBottom:12,opacity:.25}}),e.jsx("p",{style:{fontSize:"1rem",fontWeight:600,margin:0},children:"No hay métodos de envío"}),e.jsx("p",{style:{fontSize:"0.875rem",marginTop:6},children:'Agregá el primero con "+ Nuevo Método"'})]}):e.jsx("div",{style:{backgroundColor:"#fff",borderRadius:12,border:"1px solid #E5E7EB",overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"0.875rem"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{backgroundColor:"#F9FAFB",borderBottom:"1px solid #E5E7EB"},children:["Método","Tipo","Precio","Zona","Tiempo estimado","Estado","Acciones"].map(o=>e.jsx("th",{style:{padding:"11px 16px",textAlign:"left",fontWeight:600,color:"#374151",whiteSpace:"nowrap",fontSize:"0.8rem"},children:o},o))})}),e.jsx("tbody",{children:d.map((o,r)=>{const i=v.find(g=>g.value===o.tipo),$=(i==null?void 0:i.icon)??f;return e.jsxs("tr",{style:{borderBottom:r<d.length-1?"1px solid #F3F4F6":"none",opacity:o.activo?1:.55},onMouseEnter:g=>g.currentTarget.style.backgroundColor="#FAFAFA",onMouseLeave:g=>g.currentTarget.style.backgroundColor="",children:[e.jsx("td",{style:{padding:"12px 16px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[e.jsx("div",{style:{width:34,height:34,borderRadius:8,backgroundColor:((i==null?void 0:i.color)??"#6B7280")+"18",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:e.jsx($,{size:16,color:(i==null?void 0:i.color)??"#6B7280"})}),e.jsxs("div",{children:[e.jsx("p",{style:{margin:0,fontWeight:600,color:"#111827",fontSize:"0.875rem"},children:o.nombre}),o.descripcion&&e.jsx("p",{style:{margin:0,fontSize:"0.72rem",color:"#9CA3AF"},children:o.descripcion})]})]})}),e.jsx("td",{style:{padding:"12px 16px"},children:e.jsx("span",{style:{fontSize:"0.76rem",fontWeight:600,backgroundColor:((i==null?void 0:i.color)??"#6B7280")+"18",color:(i==null?void 0:i.color)??"#6B7280",padding:"3px 9px",borderRadius:20},children:(i==null?void 0:i.label)??o.tipo})}),e.jsx("td",{style:{padding:"12px 16px",fontWeight:700,color:o.tipo==="gratis"?"#059669":"#111827"},children:o.tipo==="gratis"?"Gratis":`$${(o.precio??0).toLocaleString("es-UY")}`}),e.jsx("td",{style:{padding:"12px 16px",color:"#6B7280",fontSize:"0.8rem"},children:o.zona?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(K,{size:12})," ",o.zona]}):e.jsx("span",{style:{color:"#D1D5DB"},children:"—"})}),e.jsx("td",{style:{padding:"12px 16px",color:"#6B7280",fontSize:"0.8rem"},children:o.tiempo_estimado?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(Q,{size:12})," ",o.tiempo_estimado]}):e.jsx("span",{style:{color:"#D1D5DB"},children:"—"})}),e.jsx("td",{style:{padding:"12px 16px"},children:e.jsx("button",{onClick:()=>W(o),style:{padding:"3px 10px",borderRadius:20,border:"none",cursor:"pointer",fontSize:"0.76rem",fontWeight:700,backgroundColor:o.activo?"#D1FAE5":"#FEE2E2",color:o.activo?"#059669":"#DC2626"},children:o.activo?"● Activo":"● Inactivo"})}),e.jsx("td",{style:{padding:"12px 16px"},children:e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx("button",{onClick:()=>D(o),style:{width:30,height:30,borderRadius:6,border:"1.5px solid #E5E7EB",background:"#F9FAFB",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(ee,{size:13,color:"#374151"})}),e.jsx("button",{onClick:()=>u(o),style:{width:30,height:30,borderRadius:6,border:"1.5px solid #FEE2E2",background:"#FFF5F5",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(z,{size:13,color:"#DC2626"})})]})})]},o.id)})})]})})}),M&&e.jsx("div",{style:F,onClick:()=>c(!1),children:e.jsxs("div",{style:B,onClick:o=>o.stopPropagation(),children:[e.jsxs("div",{style:re,children:[e.jsx("h2",{style:{margin:0,fontSize:"1.05rem",fontWeight:700,color:"#111827"},children:x?"Editar método de envío":"Nuevo método de envío"}),e.jsx("button",{onClick:()=>c(!1),style:le,children:e.jsx(oe,{size:18})})]}),e.jsxs("div",{style:{padding:"20px 24px",display:"flex",flexDirection:"column",gap:14},children:[e.jsxs("div",{children:[e.jsx("label",{style:a,children:"Nombre *"}),e.jsx("input",{value:t.nombre,onChange:o=>l(r=>({...r,nombre:o.target.value})),style:p,placeholder:"Ej: Envío estándar, Retiro en local…"})]}),e.jsxs("div",{children:[e.jsx("label",{style:a,children:"Tipo *"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:v.map(o=>e.jsxs("button",{onClick:()=>l(r=>({...r,tipo:o.value})),style:{display:"flex",alignItems:"center",gap:8,padding:"10px 14px",borderRadius:8,border:`1.5px solid ${t.tipo===o.value?o.color:"#E5E7EB"}`,backgroundColor:t.tipo===o.value?o.color+"12":"#F9FAFB",cursor:"pointer",color:t.tipo===o.value?o.color:"#374151",fontWeight:t.tipo===o.value?700:500,fontSize:"0.84rem"},children:[e.jsx(o.icon,{size:15,color:t.tipo===o.value?o.color:"#9CA3AF"}),o.label]},o.value))})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[e.jsxs("div",{children:[e.jsxs("label",{style:a,children:["Precio ($) ",t.tipo==="gratis"&&e.jsx("span",{style:{color:"#059669",fontWeight:400},children:"— automático $0"})]}),e.jsx("input",{type:"number",value:t.tipo==="gratis"?0:t.precio,onChange:o=>l(r=>({...r,precio:parseFloat(o.target.value)||0})),style:{...p,backgroundColor:t.tipo==="gratis"?"#F3F4F6":"#fff"},min:0,disabled:t.tipo==="gratis"})]}),e.jsxs("div",{children:[e.jsx("label",{style:a,children:"Tiempo estimado"}),e.jsx("input",{value:t.tiempo_estimado,onChange:o=>l(r=>({...r,tiempo_estimado:o.target.value})),style:p,placeholder:"Ej: 2-3 días hábiles"})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:a,children:"Zona de cobertura"}),e.jsx("input",{value:t.zona,onChange:o=>l(r=>({...r,zona:o.target.value})),style:p,placeholder:"Ej: Todo el país, Montevideo, Interior…"})]}),e.jsxs("div",{children:[e.jsx("label",{style:a,children:"Descripción"}),e.jsx("input",{value:t.descripcion,onChange:o=>l(r=>({...r,descripcion:o.target.value})),style:p,placeholder:"Info adicional para el cliente"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[e.jsxs("div",{children:[e.jsx("label",{style:a,children:"Orden"}),e.jsx("input",{type:"number",value:t.orden,onChange:o=>l(r=>({...r,orden:parseInt(o.target.value)||0})),style:p,min:0})]}),e.jsx("div",{style:{display:"flex",alignItems:"flex-end",paddingBottom:2},children:e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,cursor:"pointer",fontSize:"0.875rem",color:"#374151"},children:[e.jsx("input",{type:"checkbox",checked:t.activo,onChange:o=>l(r=>({...r,activo:o.target.checked})),style:{width:16,height:16,accentColor:j}}),"Método activo"]})})]})]}),e.jsxs("div",{style:ie,children:[e.jsx("button",{onClick:()=>c(!1),style:w,children:"Cancelar"}),e.jsxs("button",{onClick:T,disabled:y,style:{...ne,opacity:y?.7:1},children:[e.jsx(te,{size:14})," ",y?"Guardando…":x?"Actualizar":"Crear método"]})]})]})}),m&&e.jsx("div",{style:F,onClick:()=>u(null),children:e.jsx("div",{style:{...B,maxWidth:420},onClick:o=>o.stopPropagation(),children:e.jsxs("div",{style:{padding:28,textAlign:"center",display:"flex",flexDirection:"column",gap:14,alignItems:"center"},children:[e.jsx("div",{style:{width:52,height:52,borderRadius:"50%",backgroundColor:"#FEE2E2",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(z,{size:24,color:"#DC2626"})}),e.jsxs("div",{children:[e.jsx("h3",{style:{margin:0,fontSize:"1rem",fontWeight:700,color:"#111827"},children:"¿Eliminar método?"}),e.jsxs("p",{style:{margin:"6px 0 0",fontSize:"0.875rem",color:"#6B7280"},children:["Se eliminará ",e.jsx("strong",{children:m.nombre}),". Esta acción no se puede deshacer."]})]}),e.jsxs("div",{style:{display:"flex",gap:10,width:"100%"},children:[e.jsx("button",{onClick:()=>u(null),style:{...w,flex:1},children:"Cancelar"}),e.jsx("button",{onClick:()=>N(m),style:{flex:1,padding:"9px 0",borderRadius:8,border:"none",backgroundColor:"#DC2626",color:"#fff",cursor:"pointer",fontWeight:700,fontSize:"0.875rem"},children:"Eliminar"})]})]})})}),e.jsx("style",{children:"@keyframes spin { from{transform:rotate(0deg)} to{transform:rotate(360deg)} }"})]})}const F={position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center",padding:20},B={backgroundColor:"#fff",borderRadius:16,width:"100%",maxWidth:520,boxShadow:"0 20px 60px rgba(0,0,0,0.25)"},re={padding:"18px 24px",borderBottom:"1px solid #E5E7EB",display:"flex",alignItems:"center",justifyContent:"space-between"},ie={padding:"14px 24px",borderTop:"1px solid #E5E7EB",display:"flex",justifyContent:"flex-end",gap:10},le={background:"none",border:"none",cursor:"pointer",color:"#9CA3AF"},a={display:"block",fontSize:"0.8rem",fontWeight:600,color:"#374151",marginBottom:5},p={width:"100%",height:36,border:"1.5px solid #E5E7EB",borderRadius:8,padding:"0 10px",fontSize:"0.84rem",color:"#111827",outline:"none",boxSizing:"border-box"},w={padding:"9px 20px",borderRadius:8,border:"1.5px solid #E5E7EB",background:"#fff",cursor:"pointer",fontSize:"0.875rem",fontWeight:600,color:"#374151"},ne={padding:"9px 22px",borderRadius:8,border:"none",backgroundColor:"#FF6835",color:"#fff",cursor:"pointer",fontSize:"0.875rem",fontWeight:700,display:"flex",alignItems:"center",gap:6};export{Se as MetodosEnvioView};
