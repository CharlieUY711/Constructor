import{r as t,t as n,j as e,f as Y,g as V}from"./index-GcXU8KZM.js";import{O as K}from"./OrangeHeader-BXNkIUYd.js";import{g as Q,d as Z,u as ee,c as oe}from"./personasApi-C00xqcOT.js";import{G as ie,g as re}from"./GoogleAddressAutocomplete-CY-XTXZZ.js";import{U as E}from"./user-DagipgGg.js";import{R as T}from"./refresh-cw-D9Z_FLBe.js";import{B as ae}from"./building-2-BaKjrYqu.js";import{M as te}from"./mail-d7GDwKdt.js";import{P as ne}from"./phone-C5GQ0q_q.js";import{C as le}from"./circle-x-34EbMXM1.js";import{P as se}from"./pen-C7oQN5Cd.js";import{T as de}from"./trash-2-KbkyaqF4.js";import{X as ce}from"./x-CYFVs6hq.js";import{S as pe}from"./save-CWCm66v0.js";import"./ConnectionStatusIcon-DZBi63hh.js";import"./zap-D_gPOXY2.js";import"./lightbulb-Dxm6Crt8.js";import"./map-pin-0rV7dCYq.js";import"./loader-CAj64nxW.js";import"./loader-circle-tpvDBmik.js";const x="#FF6835",ue=["CI","RUT","Pasaporte","DNI","Otro"],D={tipo:"natural",nombre:"",apellido:"",email:"",telefono:"",documento_tipo:"CI",documento_numero:"",fecha_nacimiento:"",genero:"",nacionalidad:"",direccion:{calle:"",ciudad:"",pais:""},activo:!0};function Ie({onNavigate:xe}){var B,k,w,_;const[j,W]=t.useState([]),[M,C]=t.useState(!0),[v,G]=t.useState(""),[b,O]=t.useState(""),[m,U]=t.useState(""),[$,h]=t.useState(!1),[f,S]=t.useState(null),[r,a]=t.useState({...D}),[y,F]=t.useState(!1),[J,z]=t.useState(null),g=t.useCallback(async()=>{C(!0);try{const o=await Q({tipo:b||void 0,activo:m!==""?m==="true":void 0,search:v||void 0});W(o)}catch(o){console.error("Error cargando personas:",o),n.error("Error al cargar personas")}finally{C(!1)}},[v,b,m]);t.useEffect(()=>{g()},[g]);const L=()=>{S(null),a({...D}),h(!0)},q=o=>{var i;S(o),a({tipo:o.tipo,nombre:o.nombre,apellido:o.apellido??"",email:o.email??"",telefono:o.telefono??"",documento_tipo:o.documento_tipo??"CI",documento_numero:o.documento_numero??"",fecha_nacimiento:((i=o.fecha_nacimiento)==null?void 0:i.split("T")[0])??"",genero:o.genero??"",nacionalidad:o.nacionalidad??"",direccion:o.direccion??{calle:"",ciudad:"",pais:""},activo:o.activo}),h(!0)},H=async()=>{if(!r.nombre.trim()){n.error("El nombre es requerido");return}F(!0);try{const o={...r};if((!o.fecha_nacimiento||o.fecha_nacimiento==="")&&delete o.fecha_nacimiento,f){if(!await ee(f.id,o))throw new Error("No se pudo actualizar la persona");n.success("Persona actualizada")}else{if(!await oe(o))throw new Error("No se pudo crear la persona");n.success("Persona creada")}h(!1),g()}catch(o){console.error("Error guardando persona:",o),n.error(`Error al guardar: ${o instanceof Error?o.message:String(o)}`)}finally{F(!1)}},X=async o=>{if(confirm("Â¿Eliminar esta persona? Esta acciÃ³n no se puede deshacer.")){z(o);try{if(!await Z(o))throw new Error("No se pudo eliminar la persona");n.success("Persona eliminada"),g()}catch(i){console.error("Error eliminando persona:",i),n.error("Error al eliminar")}finally{z(null)}}},p=(o,i)=>a(d=>({...d,direccion:{...d.direccion??{},[o]:i}}));return e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100vh",overflow:"hidden"},children:[e.jsx(K,{icon:E,title:"Base de Personas",subtitle:"Personas naturales y jurÃ­dicas del sistema",actions:[{label:"+ Nueva Persona",primary:!0,onClick:L}]}),e.jsxs("div",{style:{padding:"16px 28px",backgroundColor:"#fff",borderBottom:"1px solid #E5E7EB",display:"flex",gap:"12px",flexWrap:"wrap",alignItems:"center"},children:[e.jsxs("div",{style:{position:"relative",flex:1,minWidth:"200px"},children:[e.jsx(Y,{size:15,style:{position:"absolute",left:10,top:"50%",transform:"translateY(-50%)",color:"#9CA3AF"}}),e.jsx("input",{value:v,onChange:o=>G(o.target.value),placeholder:"Buscar por nombre, apellido o email...",style:{width:"100%",paddingLeft:32,paddingRight:12,height:36,border:"1.5px solid #E5E7EB",borderRadius:8,fontSize:"0.875rem",outline:"none",boxSizing:"border-box"}})]}),e.jsxs("select",{value:b,onChange:o=>O(o.target.value),style:{height:36,border:"1.5px solid #E5E7EB",borderRadius:8,padding:"0 10px",fontSize:"0.875rem",color:"#374151",cursor:"pointer"},children:[e.jsx("option",{value:"",children:"Todos los tipos"}),e.jsx("option",{value:"natural",children:"Natural"}),e.jsx("option",{value:"juridica",children:"JurÃ­dica"})]}),e.jsxs("select",{value:m,onChange:o=>U(o.target.value),style:{height:36,border:"1.5px solid #E5E7EB",borderRadius:8,padding:"0 10px",fontSize:"0.875rem",color:"#374151",cursor:"pointer"},children:[e.jsx("option",{value:"",children:"Todos"}),e.jsx("option",{value:"true",children:"Activos"}),e.jsx("option",{value:"false",children:"Inactivos"})]}),e.jsx("button",{onClick:g,style:{height:36,width:36,border:"1.5px solid #E5E7EB",borderRadius:8,background:"#fff",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(T,{size:15,color:"#6B7280"})})]}),e.jsx("div",{style:{flex:1,overflow:"auto",padding:"20px 28px"},children:M?e.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:200,color:"#9CA3AF"},children:[e.jsx(T,{size:20,style:{animation:"spin 1s linear infinite",marginRight:8}})," Cargando personas..."]}):j.length===0?e.jsxs("div",{style:{textAlign:"center",padding:"60px 0",color:"#9CA3AF"},children:[e.jsx(E,{size:48,style:{marginBottom:12,opacity:.3}}),e.jsx("p",{style:{fontSize:"1rem",fontWeight:600},children:"No hay personas registradas"}),e.jsx("p",{style:{fontSize:"0.875rem",marginTop:4},children:'CreÃ¡ la primera usando el botÃ³n "+ Nueva Persona"'})]}):e.jsx("div",{style:{backgroundColor:"#fff",borderRadius:12,border:"1px solid #E5E7EB",overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"0.875rem"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{backgroundColor:"#F9FAFB",borderBottom:"1px solid #E5E7EB"},children:["Persona","Tipo","Documento","Contacto","Estado","Acciones"].map(o=>e.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontWeight:600,color:"#374151",whiteSpace:"nowrap"},children:o},o))})}),e.jsx("tbody",{children:j.map((o,i)=>e.jsxs("tr",{style:{borderBottom:i<j.length-1?"1px solid #F3F4F6":"none",transition:"background 0.1s"},onMouseEnter:d=>d.currentTarget.style.backgroundColor="#FAFAFA",onMouseLeave:d=>d.currentTarget.style.backgroundColor="",children:[e.jsx("td",{style:{padding:"12px 16px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[e.jsx("div",{style:{width:36,height:36,borderRadius:"50%",backgroundColor:o.tipo==="natural"?"#EFF6FF":"#FFF7ED",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:o.tipo==="natural"?e.jsx(E,{size:16,color:"#3B82F6"}):e.jsx(ae,{size:16,color:x})}),e.jsxs("div",{children:[e.jsxs("p",{style:{margin:0,fontWeight:600,color:"#111827"},children:[o.nombre," ",o.apellido??""]}),o.email&&e.jsx("p",{style:{margin:0,fontSize:"0.78rem",color:"#6B7280"},children:o.email})]})]})}),e.jsx("td",{style:{padding:"12px 16px"},children:e.jsx("span",{style:{padding:"3px 10px",borderRadius:20,fontSize:"0.78rem",fontWeight:600,backgroundColor:o.tipo==="natural"?"#EFF6FF":"#FFF7ED",color:o.tipo==="natural"?"#3B82F6":x},children:o.tipo==="natural"?"Natural":"JurÃ­dica"})}),e.jsx("td",{style:{padding:"12px 16px",color:"#374151"},children:o.documento_tipo&&o.documento_numero?`${o.documento_tipo}: ${o.documento_numero}`:e.jsx("span",{style:{color:"#D1D5DB"},children:"â€”"})}),e.jsx("td",{style:{padding:"12px 16px"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:2},children:[o.email&&e.jsxs("span",{style:{color:"#6B7280",fontSize:"0.8rem"},children:[e.jsx(te,{size:11,style:{marginRight:4,verticalAlign:"middle"}}),o.email]}),o.telefono&&e.jsxs("span",{style:{color:"#6B7280",fontSize:"0.8rem"},children:[e.jsx(ne,{size:11,style:{marginRight:4,verticalAlign:"middle"}}),o.telefono]})]})}),e.jsx("td",{style:{padding:"12px 16px"},children:o.activo?e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:4,color:"#10B981",fontSize:"0.8rem",fontWeight:600},children:[e.jsx(V,{size:14}),"Activo"]}):e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:4,color:"#EF4444",fontSize:"0.8rem",fontWeight:600},children:[e.jsx(le,{size:14}),"Inactivo"]})}),e.jsx("td",{style:{padding:"12px 16px"},children:e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsxs("button",{onClick:()=>q(o),style:{padding:"6px 10px",borderRadius:6,border:"1.5px solid #E5E7EB",background:"#fff",cursor:"pointer",display:"flex",alignItems:"center",gap:4,fontSize:"0.78rem",color:"#374151"},children:[e.jsx(se,{size:13})," Editar"]}),e.jsx("button",{onClick:()=>X(o.id),disabled:J===o.id,style:{padding:"6px 10px",borderRadius:6,border:"1.5px solid #FEE2E2",background:"#FFF5F5",cursor:"pointer",display:"flex",alignItems:"center",gap:4,fontSize:"0.78rem",color:"#EF4444"},children:e.jsx(de,{size:13})})]})})]},o.id))})]})})}),$&&e.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center",padding:20},children:e.jsxs("div",{style:{backgroundColor:"#fff",borderRadius:16,width:"100%",maxWidth:620,maxHeight:"90vh",overflow:"auto",boxShadow:"0 20px 60px rgba(0,0,0,0.25)"},children:[e.jsxs("div",{style:{padding:"20px 24px",borderBottom:"1px solid #E5E7EB",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("h2",{style:{margin:0,fontSize:"1.1rem",fontWeight:700,color:"#111827"},children:f?"Editar Persona":"Nueva Persona"}),e.jsx("button",{onClick:()=>h(!1),style:{background:"none",border:"none",cursor:"pointer",color:"#9CA3AF"},children:e.jsx(ce,{size:20})})]}),e.jsxs("div",{style:{padding:"20px 24px",display:"flex",flexDirection:"column",gap:16},children:[e.jsxs("div",{children:[e.jsx("label",{style:l,children:"Tipo *"}),e.jsx("div",{style:{display:"flex",gap:10},children:["natural","juridica"].map(o=>e.jsx("button",{onClick:()=>a(i=>({...i,tipo:o})),style:{flex:1,padding:"10px",borderRadius:8,border:`2px solid ${r.tipo===o?x:"#E5E7EB"}`,background:r.tipo===o?"#FFF7ED":"#fff",cursor:"pointer",fontWeight:600,color:r.tipo===o?x:"#6B7280",fontSize:"0.875rem"},children:o==="natural"?"ðŸ‘¤ Persona Natural":"ðŸ¢ Persona JurÃ­dica"},o))})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[e.jsxs("div",{children:[e.jsx("label",{style:l,children:r.tipo==="natural"?"Nombre *":"RazÃ³n Social *"}),e.jsx("input",{value:r.nombre,onChange:o=>a(i=>({...i,nombre:o.target.value})),style:s,placeholder:r.tipo==="natural"?"Ej: MarÃ­a":"Ej: TechSur SA"})]}),r.tipo==="natural"&&e.jsxs("div",{children:[e.jsx("label",{style:l,children:"Apellido"}),e.jsx("input",{value:r.apellido??"",onChange:o=>a(i=>({...i,apellido:o.target.value})),style:s,placeholder:"Ej: GarcÃ­a"})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[e.jsxs("div",{children:[e.jsx("label",{style:l,children:"Email"}),e.jsx("input",{type:"email",value:r.email??"",onChange:o=>a(i=>({...i,email:o.target.value})),style:s,placeholder:"correo@ejemplo.com"})]}),e.jsxs("div",{children:[e.jsx("label",{style:l,children:"TelÃ©fono"}),e.jsx("input",{value:r.telefono??"",onChange:o=>a(i=>({...i,telefono:o.target.value})),style:s,placeholder:"+598 99 123 456"})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"120px 1fr",gap:12},children:[e.jsxs("div",{children:[e.jsx("label",{style:l,children:"Tipo Doc."}),e.jsx("select",{value:r.documento_tipo??"CI",onChange:o=>a(i=>({...i,documento_tipo:o.target.value})),style:N,children:ue.map(o=>e.jsx("option",{value:o,children:o},o))})]}),e.jsxs("div",{children:[e.jsx("label",{style:l,children:"Nro. Documento"}),e.jsx("input",{value:r.documento_numero??"",onChange:o=>a(i=>({...i,documento_numero:o.target.value})),style:s,placeholder:"Ej: 1.234.567-8"})]})]}),r.tipo==="natural"&&e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[e.jsxs("div",{children:[e.jsx("label",{style:l,children:"Fecha de Nacimiento"}),e.jsx("input",{type:"date",value:r.fecha_nacimiento??"",onChange:o=>a(i=>({...i,fecha_nacimiento:o.target.value})),style:s})]}),e.jsxs("div",{children:[e.jsx("label",{style:l,children:"GÃ©nero"}),e.jsxs("select",{value:r.genero??"",onChange:o=>a(i=>({...i,genero:o.target.value})),style:N,children:[e.jsx("option",{value:"",children:"Sin especificar"}),e.jsx("option",{value:"masculino",children:"Masculino"}),e.jsx("option",{value:"femenino",children:"Femenino"}),e.jsx("option",{value:"otro",children:"Otro"}),e.jsx("option",{value:"prefiero no decir",children:"Prefiero no decir"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:l,children:"Nacionalidad"}),e.jsx("input",{value:r.nacionalidad??"",onChange:o=>a(i=>({...i,nacionalidad:o.target.value})),style:s,placeholder:"Ej: Uruguaya"})]}),e.jsxs("div",{children:[e.jsx("label",{style:{...l,marginBottom:8,display:"block"},children:"DirecciÃ³n"}),e.jsx("div",{style:{marginBottom:10},children:e.jsx(ie,{value:((B=r.direccion)==null?void 0:B.calle)??"",onChange:o=>p("calle",o),onSelect:async o=>{try{if(o.place_id){const i=await re(o.place_id);if(i){let d="",P="",A="";i.address_components.forEach(c=>{const u=c.types;(u.includes("locality")||u.includes("administrative_area_level_2"))&&(d=c.long_name),u.includes("country")&&(P=c.long_name),u.includes("postal_code")&&(A=c.long_name)}),a(c=>{var u,R,I;return{...c,direccion:{calle:o.address,ciudad:d||((u=c.direccion)==null?void 0:u.ciudad)||"",pais:P||((R=c.direccion)==null?void 0:R.pais)||"",cp:A||((I=c.direccion)==null?void 0:I.cp)||""}}}),n.success("DirecciÃ³n geocodificada y completada automÃ¡ticamente")}else p("calle",o.address),n.success("DirecciÃ³n guardada")}else p("calle",o.address),n.success("DirecciÃ³n guardada")}catch(i){console.error("Error obteniendo detalles de la direcciÃ³n:",i),p("calle",o.address),n.success("DirecciÃ³n guardada (algunos campos pueden requerir completarse manualmente)")}},placeholder:"Buscar direcciÃ³n (con autocompletado de Google Maps)",className:"w-full"})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsx("input",{value:((k=r.direccion)==null?void 0:k.ciudad)??"",onChange:o=>p("ciudad",o.target.value),style:s,placeholder:"Ciudad"}),e.jsx("input",{value:((w=r.direccion)==null?void 0:w.pais)??"",onChange:o=>p("pais",o.target.value),style:s,placeholder:"PaÃ­s"}),e.jsx("input",{value:((_=r.direccion)==null?void 0:_.cp)??"",onChange:o=>p("cp",o.target.value),style:s,placeholder:"CÃ³digo postal"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[e.jsx("input",{type:"checkbox",id:"activo",checked:r.activo,onChange:o=>a(i=>({...i,activo:o.target.checked})),style:{width:16,height:16,cursor:"pointer",accentColor:x}}),e.jsx("label",{htmlFor:"activo",style:{fontSize:"0.875rem",color:"#374151",cursor:"pointer"},children:"Persona activa en el sistema"})]})]}),e.jsxs("div",{style:{padding:"16px 24px",borderTop:"1px solid #E5E7EB",display:"flex",justifyContent:"flex-end",gap:10},children:[e.jsx("button",{onClick:()=>h(!1),style:{padding:"9px 20px",borderRadius:8,border:"1.5px solid #E5E7EB",background:"#fff",cursor:"pointer",fontSize:"0.875rem",fontWeight:600,color:"#374151"},children:"Cancelar"}),e.jsxs("button",{onClick:H,disabled:y,style:{padding:"9px 24px",borderRadius:8,border:"none",backgroundColor:x,color:"#fff",cursor:y?"not-allowed":"pointer",fontSize:"0.875rem",fontWeight:700,display:"flex",alignItems:"center",gap:6,opacity:y?.7:1},children:[e.jsx(pe,{size:15})," ",y?"Guardando...":f?"Guardar cambios":"Crear persona"]})]})]})}),e.jsx("style",{children:"@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }"})]})}const l={display:"block",fontSize:"0.8rem",fontWeight:600,color:"#374151",marginBottom:5},s={width:"100%",height:38,border:"1.5px solid #E5E7EB",borderRadius:8,padding:"0 12px",fontSize:"0.875rem",color:"#111827",outline:"none",boxSizing:"border-box"},N={width:"100%",height:38,border:"1.5px solid #E5E7EB",borderRadius:8,padding:"0 10px",fontSize:"0.875rem",color:"#374151",cursor:"pointer",outline:"none"};export{Ie as PersonasView};
