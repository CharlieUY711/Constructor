import{r as p,D as b,y as z,h as S,j as e,C}from"./index-BAEcngEd.js";import{O as R}from"./OrangeHeader-gxlfaJ16.js";import{S as I}from"./shield-BBgOF4s_.js";import{S as T}from"./server-DPYNpvSB.js";import{C as M}from"./cpu-COaXPXq6.js";import{G as l}from"./globe-pNbuuB7a.js";import{A}from"./activity-DqG-x4g7.js";import{C as F}from"./circle-check-BwHQyP3f.js";import{C as j}from"./circle-x-D90tcqfs.js";import{C as h}from"./clock-2XVZ7vzu.js";import{R as v}from"./refresh-cw-C_s3_zhv.js";import"./ConnectionStatusIcon-BV696ofl.js";import"./zap-CUmp22lF.js";import"./lightbulb-CSLEf0yN.js";import"./map-pin-yF4nYocl.js";const P=[{id:"supabase-db",name:"Supabase Database",description:"PostgreSQL",category:"Backend",icon:b,color:"#059669",status:"checking"},{id:"supabase-auth",name:"Supabase Auth",description:"Autenticación y sesiones",category:"Backend",icon:I,color:"#059669",status:"checking"},{id:"supabase-edge",name:"Edge Functions (Hono)",description:"Servidor /api",category:"Backend",icon:T,color:"#059669",status:"checking"},{id:"kv-store",name:"KV Store",description:"Tabla clave-valor persistente",category:"Backend",icon:M,color:"#059669",status:"checking"},{id:"storage",name:"Supabase Storage",description:"Supabase Storage Buckets",category:"Backend",icon:b,color:"#059669",status:"checking"},{id:"plexo",name:"Plexo UV",description:"API de pagos Uruguay",category:"Pagos",icon:l,color:"#6B7280",status:"pending"},{id:"mercadopago",name:"MercadoPago",description:"Pasarela Latam",category:"Pagos",icon:l,color:"#6B7280",status:"pending"},{id:"twilio",name:"Twilio",description:"SMS / WhatsApp",category:"Comms",icon:l,color:"#6B7280",status:"pending"},{id:"resend",name:"Resend",description:"Email transaccional",category:"Comms",icon:l,color:"#6B7280",status:"pending"},{id:"meta",name:"Meta Business",description:"Instagram / Facebook / WhatsApp API",category:"RRSS",icon:l,color:"#6B7280",status:"pending"},{id:"mercadolibre",name:"MercadoLibre",description:"API de marketplace",category:"Tiendas",icon:l,color:"#6B7280",status:"pending"},{id:"google-maps",name:"Google Maps",description:"Geocodificación y rutas",category:"Mapas",icon:l,color:"#6B7280",status:"pending"}],O={ok:{label:"Operativo",color:"#059669",bg:"#F0FDF8",icon:F},error:{label:"Error",color:"#EF4444",bg:"#FEF2F2",icon:j},checking:{label:"Verificando...",color:"#3B82F6",bg:"#EFF6FF",icon:v},unknown:{label:"Desconocido",color:"#F59E0B",bg:"#FFFBEB",icon:C},pending:{label:"Sin configurar",color:"#9CA3AF",bg:"#F9FAFB",icon:h}},L={Backend:"#059669",Pagos:"#FF6835",Comms:"#8B5CF6",RRSS:"#EC4899",Tiendas:"#3B82F6",Mapas:"#6366F1"};function ee({onNavigate:f}){const[d,x]=p.useState(P),[B,w]=p.useState(new Date),[y,k]=p.useState(!1),s=z||null,u=p.useCallback(async()=>{k(!0);const i=Date.now();x(a=>a.map(t=>["supabase-db","supabase-auth","supabase-edge","kv-store","storage"].includes(t.id)?{...t,status:"checking"}:t));let n=!1,r=0;if(s)try{const a=Date.now(),t=await fetch(`${s}/roadmap/modules`,{headers:{Authorization:`Bearer ${S}`},signal:AbortSignal.timeout(5e3)});r=Date.now()-a,n=t.ok}catch{n=!1}let o=!1,c=0;if(s&&n)try{const a=Date.now(),t=await fetch(`${s}/roadmap/modules`,{headers:{Authorization:`Bearer ${S}`},signal:AbortSignal.timeout(5e3)});c=Date.now()-a;const D=await t.json();o=Array.isArray(D.modules)}catch{o=!1}const m=Date.now()-i;x(a=>a.map(t=>t.id==="supabase-edge"?{...t,status:n?"ok":s?"error":"unknown",latency:r,checkedAt:new Date,message:n?"Respondió correctamente":s?"No respondió":"Sin configurar"}:t.id==="supabase-db"?{...t,status:n?"ok":s?"error":"unknown",latency:r>0?Math.round(r*.3):0,checkedAt:new Date,message:n?"Conexión activa":"Sin conexión"}:t.id==="supabase-auth"?{...t,status:n?"ok":"unknown",latency:r>0?Math.round(r*.2):0,checkedAt:new Date,message:"Supabase Auth activo"}:t.id==="kv-store"?{...t,status:o?"ok":n?"error":"unknown",latency:c,checkedAt:new Date,message:o?"kv_store OK":"No se pudo verificar"}:t.id==="storage"?{...t,status:n?"ok":"unknown",latency:Math.round(m*.1),checkedAt:new Date,message:n?"Buckets accesibles":"Sin verificar"}:t)),w(new Date),k(!1)},[s]);p.useEffect(()=>{u()},[u]);const g={ok:d.filter(i=>i.status==="ok").length,error:d.filter(i=>i.status==="error").length,pending:d.filter(i=>i.status==="pending").length},E=[...new Set(d.map(i=>i.category))];return e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsx(R,{icon:A,title:"Health Monitor",subtitle:"Estado en tiempo real de todos los servicios del sistema",actions:[{label:"← Auditoría",onClick:()=>f("auditoria")},{label:y?"Verificando...":"↻ Verificar ahora",onClick:u,primary:!0}]}),e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"24px 32px",backgroundColor:"#F8F9FA"},children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:12,marginBottom:24},children:[{label:"Operativos",value:g.ok,color:"#059669",icon:F},{label:"Con error",value:g.error,color:"#EF4444",icon:j},{label:"Sin configurar",value:g.pending,color:"#9CA3AF",icon:h},{label:"Total checks",value:d.length,color:"#FF6835",icon:A}].map(({label:i,value:n,color:r,icon:o})=>e.jsxs("div",{style:{backgroundColor:"#fff",borderRadius:12,padding:"16px 20px",border:"1px solid #E5E7EB",display:"flex",alignItems:"center",gap:12},children:[e.jsx("div",{style:{width:38,height:38,borderRadius:10,backgroundColor:`${r}15`,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(o,{size:16,color:r})}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"800",color:"#111827",lineHeight:1},children:n}),e.jsx("div",{style:{fontSize:"0.68rem",color:"#9CA3AF",marginTop:2},children:i})]})]},i))}),e.jsxs("div",{style:{marginBottom:20,display:"flex",alignItems:"center",gap:8},children:[e.jsx(h,{size:12,color:"#9CA3AF"}),e.jsxs("span",{style:{fontSize:"0.72rem",color:"#9CA3AF"},children:["Última verificación: ",B.toLocaleTimeString("es-UY",{hour:"2-digit",minute:"2-digit",second:"2-digit"})]}),y&&e.jsxs("span",{style:{fontSize:"0.72rem",color:"#3B82F6",display:"flex",alignItems:"center",gap:4},children:[e.jsx(v,{size:10,style:{animation:"spin 1s linear infinite"}})," Verificando..."]})]}),E.map(i=>{const n=d.filter(o=>o.category===i),r=L[i]??"#9CA3AF";return e.jsxs("div",{style:{marginBottom:20},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:10},children:[e.jsx("span",{style:{fontSize:"0.68rem",fontWeight:"800",color:r,textTransform:"uppercase",letterSpacing:"0.08em"},children:i}),e.jsx("div",{style:{flex:1,height:1,backgroundColor:"#E5E7EB"}}),e.jsxs("span",{style:{fontSize:"0.65rem",color:"#9CA3AF"},children:[n.filter(o=>o.status==="ok").length,"/",n.length," OK"]})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:6},children:n.map(o=>{const c=O[o.status],m=o.icon,a=c.icon;return e.jsxs("div",{style:{backgroundColor:"#fff",borderRadius:10,border:"1px solid #E5E7EB",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx("div",{style:{width:36,height:36,borderRadius:9,backgroundColor:`${o.color}12`,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:e.jsx(m,{size:16,color:o.color})}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontWeight:"700",fontSize:"0.85rem",color:"#111827",marginBottom:2},children:o.name}),e.jsx("div",{style:{fontSize:"0.7rem",color:"#9CA3AF"},children:o.description})]}),o.latency!=null&&o.latency>0&&e.jsxs("div",{style:{textAlign:"right",flexShrink:0},children:[e.jsxs("div",{style:{fontSize:"0.78rem",fontWeight:"700",color:o.latency<100?"#059669":o.latency<500?"#F59E0B":"#EF4444"},children:[o.latency,"ms"]}),e.jsx("div",{style:{fontSize:"0.6rem",color:"#9CA3AF"},children:"latencia"})]}),o.message&&e.jsx("div",{style:{fontSize:"0.7rem",color:"#9CA3AF",maxWidth:180,textAlign:"right",flexShrink:0},children:o.message}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5,padding:"5px 10px",borderRadius:20,backgroundColor:c.bg,flexShrink:0},children:[e.jsx(a,{size:12,color:c.color,style:{animation:o.status==="checking"?"spin 1s linear infinite":"none"}}),e.jsx("span",{style:{fontSize:"0.7rem",fontWeight:"700",color:c.color},children:c.label})]})]},o.id)})})]},i)}),g.pending>0&&e.jsx("div",{style:{marginTop:20,padding:"14px 18px",backgroundColor:"#FFFBEB",border:"1px solid #FDE68A",borderRadius:10},children:e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:8},children:[e.jsx(C,{size:14,color:"#D97706",style:{marginTop:2,flexShrink:0}}),e.jsxs("p",{style:{margin:0,fontSize:"0.76rem",color:"#92400E",lineHeight:1.6},children:[e.jsxs("strong",{children:[g.pending," servicios"]}),' están marcados como "Sin configurar" porque sus secrets/credenciales aún no fueron cargados en Supabase. Para activarlos, configurá las variables de entorno en ',e.jsx("strong",{children:"Supabase → Settings → Edge Functions → Secrets"}),". Consultá el ",e.jsx("button",{onClick:()=>f("integraciones-apis"),style:{background:"none",border:"none",color:"#D97706",textDecoration:"underline",cursor:"pointer",padding:0,fontWeight:"700",fontSize:"0.76rem"},children:"Repositorio de APIs"})," para ver qué variable requiere cada servicio."]})]})})]}),e.jsx("style",{children:"@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }"})]})}export{ee as HealthMonitorView};
