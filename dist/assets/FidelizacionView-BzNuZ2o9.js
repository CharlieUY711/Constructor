import{r as t,j as e,i as C,G as N}from"./index-p8CpflSp.js";import{O as T}from"./OrangeHeader-KMzy6893.js";import{a as L,i as _,j as $,k as S}from"./marketingApi-F1BPgkiI.js";import{L as E}from"./loader-circle-DeJ4ZewE.js";import{U as O}from"./users-B6FSTPk8.js";import{D as G}from"./dollar-sign-B-Qszkyk.js";import{T as U}from"./trending-up-CEQfdwCu.js";import{S as V}from"./save-TFVLWchx.js";import{P as Y}from"./pen-DiyA5RM9.js";import{R as H,C as K,X,Y as q,T as J,B as Q}from"./generateCategoricalChart-BcmBR8tF.js";import{B as Z}from"./BarChart-WI0xdKhy.js";import{P as ee}from"./plus-_4-Ek5H0.js";import"./zap-CDZemBr7.js";import"./lightbulb-ByLI0Oc8.js";import"./map-pin-B_1AdB97.js";import"./value-BTdN53H7.js";const n="#FF6835";function fe({onNavigate:B}){const[l,u]=t.useState({pointsPerDollar:10,dollarPerPoints:100}),[p,z]=t.useState(!1),[a,A]=t.useState("overview"),[s,P]=t.useState([]),[x,k]=t.useState([]),[i,h]=t.useState(null),[f,y]=t.useState(!0),[m,j]=t.useState(null);t.useEffect(()=>{b()},[]);const b=async()=>{y(!0),j(null);try{const[o,r]=await Promise.all([L(),_()]);P(o),k(r)}catch(o){j(o instanceof Error?o.message:"Error cargando datos"),console.error("Error loading fidelizacion data:",o)}finally{y(!1)}},w=async o=>{try{const r=await S(o);h(r)}catch{alert("Error cargando detalle del miembro")}},W=async o=>{const r=prompt("Puntos a agregar (negativo para restar):");if(!r)return;const d=prompt("Descripci√≥n:")||"Ajuste manual";try{if(await $(o,parseInt(r,10),d)&&(await b(),i&&i.id===o)){const g=await S(o);h(g)}}catch{alert("Error actualizando puntos")}},F=x.map(o=>({nivel:o.nombre,count:s.filter(r=>r.nivel_id===o.id).length})),R=s.length,D=s.reduce((o,r)=>o+(r.puntos_historicos-r.puntos_actuales),0),I=s.reduce((o,r)=>o+r.puntos_actuales,0),M={Platino:"#7C3AED",Oro:"#F59E0B",Plata:"#9CA3AF",Bronce:"#D97706"},v=x.length>0?x.map(o=>({name:o.nombre,from:o.puntos_minimos,gradient:`linear-gradient(135deg, ${o.color}, ${o.color}88)`,features:o.beneficios})):[];return e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsx(T,{icon:C,title:"Programa de Fidelizaci√≥n",subtitle:"Recompensa a tus clientes m√°s leales",actions:[{label:"Volver",onClick:()=>B("marketing")},{label:"Configurar",primary:!0}]}),e.jsx("div",{style:{backgroundColor:"#FFFFFF",borderBottom:"1px solid #E5E7EB",flexShrink:0},children:e.jsx("div",{style:{display:"flex",padding:"0 28px"},children:[{id:"overview",label:"Resumen"},{id:"members",label:"Miembros"},{id:"rewards",label:"Recompensas"}].map(o=>e.jsx("button",{onClick:()=>A(o.id),style:{padding:"14px 18px",border:"none",backgroundColor:"transparent",cursor:"pointer",color:a===o.id?n:"#6B7280",fontWeight:a===o.id?"700":"500",fontSize:"0.875rem",borderBottom:a===o.id?`2px solid ${n}`:"2px solid transparent"},children:o.label},o.id))})}),e.jsx("div",{style:{flex:1,overflowY:"auto",backgroundColor:"#F8F9FA"},children:e.jsxs("div",{style:{padding:"24px 28px",maxWidth:"1200px"},children:[a==="overview"&&e.jsx(e.Fragment,{children:f?e.jsxs("div",{style:{textAlign:"center",padding:"40px",color:"#6B7280"},children:[e.jsx(E,{size:32,className:"animate-spin",style:{margin:"0 auto 12px",display:"block"}}),e.jsx("p",{children:"Cargando datos..."})]}):m?e.jsx("div",{style:{backgroundColor:"#FEF2F2",borderRadius:"10px",border:"1px solid #FECACA",padding:"14px 18px",color:"#991B1B",marginBottom:"24px"},children:e.jsxs("p",{style:{margin:0,fontWeight:"700"},children:["‚ö†Ô∏è Error: ",m]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"16px",marginBottom:"24px"},children:[e.jsxs("div",{style:{background:"linear-gradient(135deg, #EC4899, #8B5CF6)",borderRadius:"12px",padding:"20px",color:"#FFF"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px"},children:[e.jsx(O,{size:18,color:"rgba(255,255,255,0.85)"}),e.jsx("span",{style:{fontSize:"0.78rem",opacity:.85},children:"Miembros activos"})]}),e.jsx("p",{style:{margin:0,fontSize:"2rem",fontWeight:"900"},children:R.toLocaleString()})]}),[{label:"Puntos canjeados",value:D.toLocaleString(),Icon:N,color:"#F59E0B"},{label:"Puntos activos",value:I.toLocaleString(),Icon:G,color:"#10B981"},{label:"Niveles configurados",value:x.length.toString(),Icon:U,color:"#7C3AED"}].map((o,r)=>e.jsxs("div",{style:{backgroundColor:"#FFFFFF",border:"1px solid #E5E7EB",borderRadius:"12px",padding:"20px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px"},children:[e.jsx(o.Icon,{size:18,color:o.color}),e.jsx("span",{style:{fontSize:"0.78rem",color:"#6B7280"},children:o.label})]}),e.jsx("p",{style:{margin:0,fontSize:"1.7rem",fontWeight:"900",color:"#111827"},children:o.value})]},r))]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"20px",marginBottom:"24px"},children:[e.jsxs("div",{style:{backgroundColor:"#FFFFFF",border:"1px solid #E5E7EB",borderRadius:"12px",padding:"24px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[e.jsx("h3",{style:{margin:0,fontWeight:"700",color:"#111827",fontSize:"0.95rem"},children:"Configuraci√≥n de Puntos"}),e.jsx("button",{onClick:()=>z(!p),style:{background:"none",border:"none",cursor:"pointer",color:p?n:"#6B7280",display:"flex",alignItems:"center",gap:"4px",fontSize:"0.78rem",fontWeight:"600"},children:p?e.jsxs(e.Fragment,{children:[e.jsx(V,{size:13})," Guardar"]}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{size:13})," Editar"]})})]}),e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"6px"},children:[e.jsx("label",{style:{fontSize:"0.82rem",color:"#374151",fontWeight:"600"},children:"Puntos por d√≥lar gastado:"}),e.jsx("span",{style:{fontSize:"0.82rem",fontWeight:"700",color:"#111827"},children:l.pointsPerDollar})]}),e.jsx("input",{type:"range",min:1,max:50,value:l.pointsPerDollar,disabled:!p,onChange:o=>u(r=>({...r,pointsPerDollar:+o.target.value})),style:{width:"100%",accentColor:n}})]}),e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"6px"},children:[e.jsx("label",{style:{fontSize:"0.82rem",color:"#374151",fontWeight:"600"},children:"Puntos por $1 de descuento:"}),e.jsx("span",{style:{fontSize:"0.82rem",fontWeight:"700",color:"#111827"},children:l.dollarPerPoints})]}),e.jsx("input",{type:"range",min:10,max:500,step:10,value:l.dollarPerPoints,disabled:!p,onChange:o=>u(r=>({...r,dollarPerPoints:+o.target.value})),style:{width:"100%",accentColor:n}})]}),e.jsx("div",{style:{padding:"12px 16px",backgroundColor:"#F0F9FF",borderRadius:"8px",border:"1px solid #BAE6FD"},children:e.jsxs("p",{style:{margin:0,fontSize:"0.78rem",color:"#0369A1"},children:["üí° ",e.jsx("strong",{children:"Ejemplo:"})," Un cliente que compra por $100 recibe ",l.pointsPerDollar*100," puntos. Al juntar ",l.dollarPerPoints," puntos podr√° canjearlos por $1 de descuento."]})})]}),e.jsxs("div",{style:{backgroundColor:"#FFFFFF",border:"1px solid #E5E7EB",borderRadius:"12px",padding:"24px"},children:[e.jsx("h3",{style:{margin:"0 0 20px",fontWeight:"700",color:"#111827",fontSize:"0.95rem"},children:"Distribuci√≥n por Niveles"}),F.length>0?e.jsx(H,{width:"100%",height:180,children:e.jsxs(Z,{data:F,margin:{top:5,right:10,left:-20,bottom:5},children:[e.jsx(K,{strokeDasharray:"3 3",stroke:"#F3F4F6"}),e.jsx(X,{dataKey:"nivel",tick:{fontSize:11,fill:"#9CA3AF"}}),e.jsx(q,{tick:{fontSize:11,fill:"#9CA3AF"}}),e.jsx(J,{contentStyle:{borderRadius:"8px",border:"1px solid #E5E7EB",fontSize:"0.78rem"}}),e.jsx(Q,{dataKey:"count",radius:[4,4,0,0],fill:"#8B5CF6",label:{position:"top",fontSize:10,fill:"#6B7280"}})]})}):e.jsx("p",{style:{textAlign:"center",color:"#9CA3AF",fontSize:"0.8rem"},children:"No hay datos"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{style:{margin:"0 0 16px",fontWeight:"800",color:"#111827",fontSize:"0.95rem"},children:"Niveles de Membres√≠a"}),v.length>0?e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"16px"},children:v.map(o=>e.jsxs("div",{style:{background:o.gradient,borderRadius:"14px",padding:"20px",color:"#FFF",position:"relative",overflow:"hidden"},children:[e.jsx("div",{style:{position:"absolute",top:"12px",right:"12px"},children:e.jsx(C,{size:16,fill:"rgba(255,255,255,0.4)",stroke:"rgba(255,255,255,0.6)"})}),e.jsx("h4",{style:{margin:"0 0 4px",fontWeight:"900",fontSize:"1.05rem"},children:o.name}),e.jsxs("p",{style:{margin:"0 0 14px",fontSize:"0.75rem",opacity:.85},children:["Desde ",o.from===0?"0 puntos":`${o.from.toLocaleString()} puntos`]}),e.jsx("ul",{style:{margin:0,padding:0,listStyle:"none"},children:o.features.map((r,d)=>e.jsxs("li",{style:{fontSize:"0.78rem",opacity:.9,marginBottom:"4px",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx("span",{style:{opacity:.7},children:"‚Ä¢"})," ",r]},d))})]},o.name))}):e.jsx("p",{style:{textAlign:"center",color:"#9CA3AF",fontSize:"0.8rem"},children:"No hay niveles configurados"})]})]})}),a==="members"&&e.jsx(e.Fragment,{children:f?e.jsxs("div",{style:{textAlign:"center",padding:"40px",color:"#6B7280"},children:[e.jsx(E,{size:32,className:"animate-spin",style:{margin:"0 auto 12px",display:"block"}}),e.jsx("p",{children:"Cargando miembros..."})]}):m?e.jsx("div",{style:{backgroundColor:"#FEF2F2",borderRadius:"10px",border:"1px solid #FECACA",padding:"14px 18px",color:"#991B1B",marginBottom:"20px"},children:e.jsxs("p",{style:{margin:0,fontWeight:"700"},children:["‚ö†Ô∏è Error: ",m]})}):e.jsx(e.Fragment,{children:i?e.jsxs("div",{style:{backgroundColor:"#FFFFFF",border:"1px solid #E5E7EB",borderRadius:"12px",padding:"24px",marginBottom:"20px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsx("h3",{style:{margin:0,fontSize:"1rem",fontWeight:"800",color:"#111827"},children:i.nombre||i.email}),e.jsx("button",{onClick:()=>h(null),style:{padding:"8px 16px",border:"1px solid #E5E7EB",borderRadius:"8px",backgroundColor:"#FFF",color:"#374151",fontSize:"0.82rem",cursor:"pointer"},children:"‚Üê Volver"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px",marginBottom:"20px"},children:[e.jsxs("div",{children:[e.jsx("p",{style:{margin:"0 0 4px",fontSize:"0.78rem",color:"#6B7280"},children:"Email"}),e.jsx("p",{style:{margin:0,fontWeight:"600",color:"#111827"},children:i.email})]}),e.jsxs("div",{children:[e.jsx("p",{style:{margin:"0 0 4px",fontSize:"0.78rem",color:"#6B7280"},children:"Puntos actuales"}),e.jsx("p",{style:{margin:0,fontWeight:"800",color:n,fontSize:"1.2rem"},children:i.puntos_actuales.toLocaleString()})]})]}),e.jsxs("button",{onClick:()=>W(i.id),style:{padding:"10px 20px",backgroundColor:n,color:"#FFF",border:"none",borderRadius:"8px",fontWeight:"700",cursor:"pointer",fontSize:"0.875rem",marginBottom:"20px"},children:[e.jsx(ee,{size:14,style:{display:"inline",marginRight:"6px"}})," Ajustar Puntos"]}),e.jsx("h4",{style:{margin:"0 0 12px",fontSize:"0.9rem",fontWeight:"700",color:"#111827"},children:"Historial de Movimientos"}),e.jsx("div",{style:{maxHeight:"300px",overflowY:"auto"},children:i.movimientos&&i.movimientos.length>0?i.movimientos.map(o=>e.jsxs("div",{style:{padding:"12px",borderBottom:"1px solid #F3F4F6",display:"flex",justifyContent:"space-between"},children:[e.jsxs("div",{children:[e.jsx("p",{style:{margin:0,fontWeight:"600",color:"#111827",fontSize:"0.875rem"},children:o.descripcion||"Movimiento"}),e.jsx("p",{style:{margin:"2px 0 0",fontSize:"0.72rem",color:"#6B7280"},children:new Date(o.created_at).toLocaleString("es-ES")})]}),e.jsxs("span",{style:{fontWeight:"700",color:o.tipo==="suma"?"#16A34A":"#EF4444",fontSize:"0.875rem"},children:[o.tipo==="suma"?"+":"-",o.puntos]})]},o.id)):e.jsx("p",{style:{textAlign:"center",color:"#9CA3AF",fontSize:"0.8rem",padding:"20px"},children:"No hay movimientos"})})]}):e.jsxs("div",{style:{backgroundColor:"#FFFFFF",border:"1px solid #E5E7EB",borderRadius:"12px",overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"16px 20px",borderBottom:"1px solid #E5E7EB",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h3",{style:{margin:0,fontSize:"0.95rem",fontWeight:"700",color:"#111827"},children:"Miembros del Programa"}),e.jsxs("span",{style:{fontSize:"0.8rem",color:"#6B7280"},children:[s.length," miembros"]})]}),s.length===0?e.jsx("div",{style:{padding:"40px",textAlign:"center",color:"#9CA3AF"},children:e.jsx("p",{style:{margin:0},children:"No hay miembros a√∫n"})}):e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{backgroundColor:"#F9FAFB"},children:["Miembro","Email","Nivel","Puntos","Acciones"].map(o=>e.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"0.72rem",fontWeight:"700",color:"#374151",textTransform:"uppercase",letterSpacing:"0.04em"},children:o},o))})}),e.jsx("tbody",{children:s.map((o,r)=>{var g;const d=((g=o.nivel)==null?void 0:g.nombre)||"Sin nivel",c=M[d]||"#6B7280";return e.jsxs("tr",{style:{borderTop:"1px solid #F3F4F6",backgroundColor:r%2===0?"#FFF":"#FAFAFA"},children:[e.jsx("td",{style:{padding:"12px 16px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx("div",{style:{width:"32px",height:"32px",borderRadius:"50%",background:`linear-gradient(135deg, ${c}, ${c}88)`,display:"flex",alignItems:"center",justifyContent:"center",color:"#FFF",fontWeight:"700",fontSize:"0.8rem"},children:(o.nombre||o.email).charAt(0).toUpperCase()}),e.jsx("span",{style:{fontWeight:"600",color:"#111827",fontSize:"0.875rem"},children:o.nombre||o.email})]})}),e.jsx("td",{style:{padding:"12px 16px",color:"#6B7280",fontSize:"0.8rem"},children:o.email}),e.jsx("td",{style:{padding:"12px 16px"},children:e.jsxs("span",{style:{padding:"3px 10px",borderRadius:"20px",backgroundColor:c+"20",color:c,fontSize:"0.75rem",fontWeight:"700"},children:["‚≠ê ",d]})}),e.jsxs("td",{style:{padding:"12px 16px",fontWeight:"700",color:n,fontSize:"0.875rem"},children:[o.puntos_actuales.toLocaleString()," pts"]}),e.jsx("td",{style:{padding:"12px 16px"},children:e.jsx("button",{onClick:()=>w(o.id),style:{padding:"6px 12px",backgroundColor:n,color:"#FFF",border:"none",borderRadius:"6px",fontSize:"0.75rem",fontWeight:"600",cursor:"pointer"},children:"Ver"})})]},o.id)})})]})]})})}),a==="rewards"&&e.jsx("div",{children:e.jsx("p",{style:{textAlign:"center",color:"#9CA3AF",fontSize:"0.8rem",padding:"40px"},children:"Las recompensas se configuran desde el sistema de puntos. Pr√≥ximamente: cat√°logo de recompensas."})})]})})]})}export{fe as FidelizacionView};
