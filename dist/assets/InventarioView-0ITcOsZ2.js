import{e as O,p as z,R as r,j as e,t as d}from"./index-v6XgiFCH.js";import{O as $}from"./OrangeHeader-B6pOaz2T.js";import{g as P}from"./depositosApi-DJpm-EXL.js";import{T as F}from"./triangle-alert-BTRRvcf7.js";import{L as K}from"./loader-circle-DwKQh3Lv.js";import{A as M}from"./arrow-up-DjTRyZWJ.js";import{P as L}from"./pen-CvNSN_GQ.js";import{T as q}from"./trash-2-D9Ho1ju3.js";import"./ConnectionStatusIcon-CQDd4n9w.js";import"./zap-CZ5J69Ph.js";import"./lightbulb-CD-WF-T3.js";import"./map-pin-HqaKhnQx.js";const H=`${O}/inventario`,G="oddy",J={"Content-Type":"application/json",Authorization:`Bearer ${z}`,apikey:z,"x-tenant-id":G};async function g(o,n){const a=await(await fetch(`${H}${o}`,{headers:J,...n})).json();if(a.error)throw new Error(a.error);return a}async function V(o){const n=new URLSearchParams;return o!=null&&o.deposito_id&&n.set("deposito_id",o.deposito_id),o!=null&&o.categoria&&n.set("categoria",o.categoria),o!=null&&o.search&&n.set("search",o.search),g(n.toString()?`?${n}`:"")}async function Y(o){return(await g("",{method:"POST",body:JSON.stringify(o)})).data||null}async function Q(o,n){return(await g(`/${o}`,{method:"PUT",body:JSON.stringify(n)})).data||null}async function X(o,n){return g(`/${o}/movimiento`,{method:"POST",body:JSON.stringify(n)})}async function Z(o){try{return await g(`/${o}`,{method:"DELETE"}),!0}catch{return!1}}const y="#FF6835";function xe({onNavigate:o}){const[n,m]=r.useState([]),[a,R]=r.useState([]),[A,C]=r.useState(!0),[D,W]=r.useState(""),[j,N]=r.useState(""),[E,T]=r.useState(0),[_,h]=r.useState(!1),[c,v]=r.useState(null),[S,w]=r.useState(null),[s,p]=r.useState({}),[x,B]=r.useState({tipo:"entrada",cantidad:0,notas:""}),[b,f]=r.useState(!1),u=async()=>{C(!0);try{const[t,i]=await Promise.all([V({deposito_id:j||void 0,search:D||void 0}),P()]);m(t.data),T(t.alertas_count),R(i)}catch{d.error("Error")}finally{C(!1)}};r.useEffect(()=>{u()},[j]);const I=async()=>{if(!s.sku||!s.nombre||!s.deposito_id)return d.error("SKU, nombre y deposito requeridos");f(!0);try{S?(await Q(S,s),d.success("Actualizado")):(await Y(s),d.success("Creado")),h(!1),u()}catch{d.error("Error")}finally{f(!1)}},U=async()=>{if(!c||!x.cantidad)return d.error("Cantidad requerida");f(!0);try{const t=await X(c.id,x);d.success("Stock: "+t.cantidad_anterior+" a "+t.cantidad_nueva),v(null),u()}catch(t){d.error(t.message||"Error")}finally{f(!1)}};return e.jsxs("div",{style:{minHeight:"100vh",background:"#F8FAFC"},children:[e.jsx($,{title:"Inventario",subtitle:"Stock por deposito",onBack:()=>o("logistica")}),e.jsxs("div",{style:{maxWidth:1200,margin:"0 auto",padding:"24px 16px"},children:[E>0&&e.jsxs("div",{style:{background:"#FEF3C7",border:"1px solid #F59E0B",borderRadius:10,padding:"12px 16px",marginBottom:20,display:"flex",alignItems:"center",gap:10},children:[e.jsx(F,{size:18,style:{color:"#F59E0B"}}),e.jsxs("strong",{children:[E," item(s) bajo stock minimo"]})]}),e.jsxs("div",{style:{display:"flex",gap:10,marginBottom:20,flexWrap:"wrap"},children:[e.jsx("input",{value:D,onChange:t=>W(t.target.value),onKeyDown:t=>{t.key==="Enter"&&u()},placeholder:"Buscar SKU o nombre (Enter)...",style:{flex:1,minWidth:200,padding:"9px 12px",border:"1px solid #E5E7EB",borderRadius:8,fontSize:14}}),e.jsxs("select",{value:j,onChange:t=>N(t.target.value),style:{border:"1px solid #E5E7EB",borderRadius:8,padding:"9px 12px",fontSize:14},children:[e.jsx("option",{value:"",children:"Todos los depositos"}),a.map(t=>e.jsx("option",{value:t.id,children:t.nombre},t.id))]}),e.jsx("button",{onClick:()=>{p({}),w(null),h(!0)},style:{background:y,color:"#fff",border:"none",borderRadius:8,padding:"9px 16px",fontWeight:600,cursor:"pointer"},children:"+ Nuevo"})]}),A?e.jsx("div",{style:{textAlign:"center",padding:60},children:e.jsx(K,{size:32,style:{color:y}})}):e.jsx("div",{style:{background:"#fff",border:"1px solid #E5E7EB",borderRadius:12,overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"#F9FAFB"},children:["SKU","Nombre","Deposito","Stock","Min",""].map(t=>e.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:12,fontWeight:600,color:"#6B7280"},children:t},t))})}),e.jsx("tbody",{children:n.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,style:{textAlign:"center",padding:40,color:"#9CA3AF"},children:"No hay items"})}):n.map(t=>{var l;const i=t.cantidad<=t.cantidad_minima;return e.jsxs("tr",{style:{borderBottom:"1px solid #F3F4F6",background:i?"#FFFBEB":"#fff"},children:[e.jsx("td",{style:{padding:"12px 16px",fontFamily:"monospace",fontWeight:600},children:t.sku}),e.jsxs("td",{style:{padding:"12px 16px"},children:[i&&e.jsx(F,{size:13,style:{color:"#F59E0B",marginRight:4,verticalAlign:"middle"}}),t.nombre]}),e.jsx("td",{style:{padding:"12px 16px",color:"#6B7280",fontSize:13},children:((l=t.depositos)==null?void 0:l.nombre)||"-"}),e.jsx("td",{style:{padding:"12px 16px",fontWeight:700,color:i?"#D97706":"#111"},children:t.cantidad}),e.jsx("td",{style:{padding:"12px 16px",color:"#9CA3AF",fontSize:13},children:t.cantidad_minima}),e.jsxs("td",{style:{padding:"12px 16px"},children:[e.jsx("button",{onClick:()=>v(t),style:{background:"#F0FDF4",border:"none",borderRadius:6,padding:"5px 8px",cursor:"pointer",color:"#059669",marginRight:4},children:e.jsx(M,{size:13})}),e.jsx("button",{onClick:()=>{p(t),w(t.id),h(!0)},style:{background:"none",border:"none",cursor:"pointer",color:"#6B7280",marginRight:4},children:e.jsx(L,{size:13})}),e.jsx("button",{onClick:async()=>{confirm("Eliminar?")&&(await Z(t.id),u())},style:{background:"none",border:"none",cursor:"pointer",color:"#EF4444"},children:e.jsx(q,{size:13})})]})]},t.id)})})]})}),_&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{style:{background:"#fff",borderRadius:14,padding:28,width:"100%",maxWidth:480,maxHeight:"90vh",overflowY:"auto"},children:[e.jsxs("h3",{style:{margin:"0 0 20px"},children:[S?"Editar":"Nuevo"," item"]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("label",{style:{fontSize:13,fontWeight:600,display:"block",marginBottom:4},children:"Deposito *"}),e.jsxs("select",{value:s.deposito_id||"",onChange:t=>p(i=>({...i,deposito_id:t.target.value})),style:{width:"100%",border:"1px solid #D1D5DB",borderRadius:8,padding:"9px 12px",fontSize:14},children:[e.jsx("option",{value:"",children:"Seleccionar..."}),a.map(t=>e.jsx("option",{value:t.id,children:t.nombre},t.id))]})]}),[["sku","SKU *"],["nombre","Nombre *"],["categoria","Categoria"],["ubicacion","Ubicacion"]].map(([t,i])=>e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("label",{style:{fontSize:13,fontWeight:600,display:"block",marginBottom:4},children:i}),e.jsx("input",{value:s[t]||"",onChange:l=>p(k=>({...k,[t]:l.target.value})),style:{width:"100%",border:"1px solid #D1D5DB",borderRadius:8,padding:"9px 12px",fontSize:14,boxSizing:"border-box"}})]},t)),[["cantidad","Stock inicial"],["cantidad_minima","Stock minimo"],["costo_unitario","Costo unitario"]].map(([t,i])=>e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("label",{style:{fontSize:13,fontWeight:600,display:"block",marginBottom:4},children:i}),e.jsx("input",{type:"number",value:s[t]??"",onChange:l=>p(k=>({...k,[t]:Number(l.target.value)})),style:{width:"100%",border:"1px solid #D1D5DB",borderRadius:8,padding:"9px 12px",fontSize:14,boxSizing:"border-box"}})]},t)),e.jsxs("div",{style:{display:"flex",gap:10,justifyContent:"flex-end",marginTop:20},children:[e.jsx("button",{onClick:()=>h(!1),style:{padding:"9px 18px",border:"1px solid #D1D5DB",borderRadius:8,cursor:"pointer"},children:"Cancelar"}),e.jsx("button",{onClick:I,disabled:b,style:{padding:"9px 18px",background:y,color:"#fff",border:"none",borderRadius:8,fontWeight:600,cursor:"pointer"},children:b?"Guardando...":"Guardar"})]})]})}),c&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{style:{background:"#fff",borderRadius:14,padding:28,width:"100%",maxWidth:400},children:[e.jsx("h3",{style:{margin:"0 0 6px"},children:"Movimiento de stock"}),e.jsxs("p",{style:{margin:"0 0 20px",color:"#6B7280",fontSize:14},children:[c.nombre," â€” Stock actual: ",e.jsx("strong",{children:c.cantidad})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("label",{style:{fontSize:13,fontWeight:600,display:"block",marginBottom:4},children:"Tipo"}),e.jsxs("select",{value:x.tipo,onChange:t=>B(i=>({...i,tipo:t.target.value})),style:{width:"100%",border:"1px solid #D1D5DB",borderRadius:8,padding:"9px 12px",fontSize:14},children:[e.jsx("option",{value:"entrada",children:"Entrada"}),e.jsx("option",{value:"salida",children:"Salida"}),e.jsx("option",{value:"ajuste",children:"Ajuste (cantidad exacta)"})]})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("label",{style:{fontSize:13,fontWeight:600,display:"block",marginBottom:4},children:"Cantidad"}),e.jsx("input",{type:"number",value:x.cantidad,onChange:t=>B(i=>({...i,cantidad:Number(t.target.value)})),style:{width:"100%",border:"1px solid #D1D5DB",borderRadius:8,padding:"9px 12px",fontSize:14,boxSizing:"border-box"}})]}),e.jsxs("div",{style:{marginBottom:20},children:[e.jsx("label",{style:{fontSize:13,fontWeight:600,display:"block",marginBottom:4},children:"Notas"}),e.jsx("input",{value:x.notas,onChange:t=>B(i=>({...i,notas:t.target.value})),style:{width:"100%",border:"1px solid #D1D5DB",borderRadius:8,padding:"9px 12px",fontSize:14,boxSizing:"border-box"}})]}),e.jsxs("div",{style:{display:"flex",gap:10,justifyContent:"flex-end"},children:[e.jsx("button",{onClick:()=>v(null),style:{padding:"9px 18px",border:"1px solid #D1D5DB",borderRadius:8,cursor:"pointer"},children:"Cancelar"}),e.jsx("button",{onClick:U,disabled:b,style:{padding:"9px 18px",background:y,color:"#fff",border:"none",borderRadius:8,fontWeight:600,cursor:"pointer"},children:b?"Registrando...":"Registrar"})]})]})})]})]})}export{xe as InventarioView};
