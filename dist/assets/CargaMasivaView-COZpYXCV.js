import{c as O,r as l,j as r,g as L,C as U,p as N,h as q}from"./index-DpZjhHPo.js";import{U as y}from"./upload-B4yVmRFo.js";import{R as j}from"./refresh-cw-DotlCOZk.js";import{X as H}from"./x-BXKScanV.js";import{H as X}from"./hard-drive-Dz2sDI6Z.js";import{F as _}from"./folder-open-EAtSezzS.js";import{D as P}from"./download-CkvM2USS.js";import{T as V}from"./trash-2-BFUyNW5P.js";import{I as K}from"./image-BpAvI4ag.js";import{F as Q}from"./file-text-QgKX0lfh.js";import{F as Y}from"./file-CtfKErjf.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]],J=O("file-spreadsheet",G),t="#FF6835",b=`https://${N}.supabase.co/functions/v1/api/carga-masiva`,v={Authorization:`Bearer ${q}`};function w(n){return n<1024?`${n} B`:n<1024*1024?`${(n/1024).toFixed(1)} KB`:`${(n/(1024*1024)).toFixed(2)} MB`}function B(n){return n.startsWith("image/")?r.jsx(K,{size:16,color:"#8B5CF6"}):n.includes("spreadsheet")||n.includes("csv")?r.jsx(J,{size:16,color:"#22C55E"}):n.includes("pdf")?r.jsx(Q,{size:16,color:"#EF4444"}):r.jsx(Y,{size:16,color:"#6B7280"})}function ce({onNavigate:n}){const[i,d]=l.useState([]),[f,C]=l.useState([]),[c,g]=l.useState(!1),[D,z]=l.useState(!1),[p,S]=l.useState("upload"),k=l.useRef(null),A=e=>{if(!e)return;const o=Array.from(e).map(s=>({id:`${Date.now()}_${Math.random()}`,file:s,status:"pending",progress:0}));d(s=>[...s,...o])},R=l.useCallback(e=>{e.preventDefault(),g(!1),A(e.dataTransfer.files)},[]),E=async e=>{d(o=>o.map(s=>s.id===e.id?{...s,status:"uploading",progress:10}:s));try{const o=new FormData;o.append("file",e.file);const s=await fetch(`${b}/upload`,{method:"POST",headers:v,body:o}),a=await s.json();if(!s.ok)throw new Error(a.error||"Error al subir");d(T=>T.map(m=>m.id===e.id?{...m,status:"done",progress:100,signedUrl:a.signedUrl}:m))}catch(o){d(s=>s.map(a=>a.id===e.id?{...a,status:"error",progress:0,errorMsg:o.message}:a))}},I=async()=>{const e=i.filter(o=>o.status==="pending");for(const o of e)await E(o);h()},h=async()=>{z(!0);try{const o=await(await fetch(`${b}/files`,{headers:v})).json();o.files&&C(o.files)}catch(e){console.log("Error cargando archivos remotos:",e)}finally{z(!1),S("files")}},$=async e=>{try{(await fetch(`${b}/file`,{method:"DELETE",headers:{...v,"Content-Type":"application/json"},body:JSON.stringify({path:e})})).ok&&C(s=>s.filter(a=>a.path!==e))}catch(o){console.log("Error eliminando:",o)}},W=e=>d(o=>o.filter(s=>s.id!==e)),M=()=>d(e=>e.filter(o=>o.status!=="done")),x=i.filter(e=>e.status==="pending").length,u=i.filter(e=>e.status==="done").length,F=i.filter(e=>e.status==="error").length;return r.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100vh",overflow:"hidden",backgroundColor:"#F8F9FA"},children:[r.jsxs("div",{style:{height:"56px",flexShrink:0,backgroundColor:"#fff",borderBottom:"1px solid #E5E7EB",display:"flex",alignItems:"center",padding:"0 28px",gap:"14px"},children:[r.jsx(y,{size:20,color:t}),r.jsx("h1",{style:{margin:0,fontSize:"1.05rem",fontWeight:"700",color:"#111"},children:"Carga Masiva de Archivos"}),r.jsx("div",{style:{flex:1}}),["upload","files"].map(e=>r.jsx("button",{onClick:()=>{e==="files"?h():S("upload")},style:{padding:"6px 16px",borderRadius:"8px",border:"none",cursor:"pointer",fontSize:"0.82rem",fontWeight:"600",backgroundColor:p===e?t:"transparent",color:p===e?"#fff":"#6B7280"},children:e==="upload"?"â¬† Subir archivos":"ðŸ“ Mis archivos"},e))]}),p==="upload"&&r.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"28px"},children:[r.jsxs("div",{onDragOver:e=>{e.preventDefault(),g(!0)},onDragLeave:()=>g(!1),onDrop:R,onClick:()=>{var e;return(e=k.current)==null?void 0:e.click()},style:{border:`2px dashed ${c?t:"#D1D5DB"}`,borderRadius:"16px",backgroundColor:c?`${t}08`:"#fff",padding:"48px 24px",textAlign:"center",cursor:"pointer",transition:"all 0.15s",marginBottom:"24px"},children:[r.jsx("div",{style:{width:"56px",height:"56px",borderRadius:"14px",backgroundColor:c?`${t}20`:"#F3F4F6",display:"inline-flex",alignItems:"center",justifyContent:"center",marginBottom:"16px"},children:r.jsx(y,{size:24,color:c?t:"#9CA3AF"})}),r.jsx("p",{style:{margin:"0 0 6px",fontSize:"1rem",fontWeight:"700",color:"#111"},children:c?"SoltÃ¡ los archivos aquÃ­":"ArrastrÃ¡ archivos o hacÃ© clic para seleccionar"}),r.jsx("p",{style:{margin:0,fontSize:"0.8rem",color:"#9CA3AF"},children:"ImÃ¡genes, PDF, CSV, XLSX, DOCX Â· Sin lÃ­mite de cantidad"}),r.jsx("input",{ref:k,type:"file",multiple:!0,hidden:!0,onChange:e=>A(e.target.files)})]}),i.length>0&&r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px",marginBottom:"16px",padding:"12px 16px",backgroundColor:"#fff",borderRadius:"10px",border:"1px solid #E5E7EB"},children:[r.jsxs("span",{style:{fontSize:"0.82rem",color:"#6B7280"},children:[r.jsx("b",{style:{color:"#111"},children:i.length})," archivo",i.length!==1?"s":""," en cola"]}),x>0&&r.jsxs("span",{style:{fontSize:"0.75rem",color:"#F59E0B",fontWeight:"600"},children:["Â· ",x," pendientes"]}),u>0&&r.jsxs("span",{style:{fontSize:"0.75rem",color:"#22C55E",fontWeight:"600"},children:["Â· ",u," subidos"]}),F>0&&r.jsxs("span",{style:{fontSize:"0.75rem",color:"#EF4444",fontWeight:"600"},children:["Â· ",F," con error"]}),r.jsx("div",{style:{flex:1}}),u>0&&r.jsx("button",{onClick:M,style:{fontSize:"0.75rem",color:"#9CA3AF",background:"none",border:"none",cursor:"pointer"},children:"Limpiar completados"}),x>0&&r.jsxs("button",{onClick:I,style:{padding:"7px 18px",borderRadius:"8px",border:"none",cursor:"pointer",backgroundColor:t,color:"#fff",fontSize:"0.82rem",fontWeight:"700",display:"flex",alignItems:"center",gap:"6px"},children:[r.jsx(y,{size:14})," Subir todo (",x,")"]})]}),i.length>0&&r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:i.map(e=>r.jsxs("div",{style:{backgroundColor:"#fff",borderRadius:"10px",padding:"12px 14px",border:`1.5px solid ${e.status==="done"?"#86EFAC":e.status==="error"?"#FCA5A5":e.status==="uploading"?`${t}50`:"#E5E7EB"}`,display:"flex",alignItems:"center",gap:"12px"},children:[B(e.file.type),r.jsxs("div",{style:{flex:1,minWidth:0},children:[r.jsx("p",{style:{margin:0,fontSize:"0.82rem",fontWeight:"600",color:"#111",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:e.file.name}),r.jsxs("p",{style:{margin:"2px 0 0",fontSize:"0.7rem",color:"#9CA3AF"},children:[w(e.file.size)," Â· ",e.file.type||"desconocido"]}),e.status==="uploading"&&r.jsx("div",{style:{marginTop:"6px",height:"4px",backgroundColor:"#E5E7EB",borderRadius:"2px"},children:r.jsx("div",{style:{height:"100%",width:"60%",backgroundColor:t,borderRadius:"2px",transition:"width 0.3s"}})}),e.status==="error"&&r.jsx("p",{style:{margin:"2px 0 0",fontSize:"0.7rem",color:"#EF4444"},children:e.errorMsg})]}),e.status==="done"&&r.jsx(L,{size:18,color:"#22C55E"}),e.status==="error"&&r.jsx(U,{size:18,color:"#EF4444"}),e.status==="uploading"&&r.jsx(j,{size:16,color:t,style:{animation:"spin 1s linear infinite"}}),e.status==="pending"&&r.jsx("button",{onClick:()=>E(e),style:{padding:"5px 12px",borderRadius:"6px",border:"none",cursor:"pointer",backgroundColor:`${t}15`,color:t,fontSize:"0.75rem",fontWeight:"700"},children:"Subir"}),r.jsx("button",{onClick:()=>W(e.id),style:{background:"none",border:"none",cursor:"pointer",padding:"2px"},children:r.jsx(H,{size:15,color:"#9CA3AF"})})]},e.id))}),i.length===0&&r.jsxs("div",{style:{textAlign:"center",padding:"40px",color:"#9CA3AF"},children:[r.jsx(X,{size:36,style:{marginBottom:"12px",opacity:.3}}),r.jsx("p",{style:{margin:0,fontSize:"0.85rem"},children:"La cola estÃ¡ vacÃ­a. ArrastrÃ¡ archivos para comenzar."})]})]}),p==="files"&&r.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"28px"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"18px",gap:"12px"},children:[r.jsxs("p",{style:{margin:0,fontSize:"0.85rem",color:"#6B7280"},children:[r.jsx("b",{style:{color:"#111"},children:f.length})," archivos almacenados en Supabase Storage"]}),r.jsx("div",{style:{flex:1}}),r.jsxs("button",{onClick:h,style:{display:"flex",alignItems:"center",gap:"6px",padding:"7px 14px",borderRadius:"8px",border:"1.5px solid #E5E7EB",backgroundColor:"#fff",fontSize:"0.78rem",fontWeight:"600",color:"#374151",cursor:"pointer"},children:[r.jsx(j,{size:13})," Actualizar"]})]}),D?r.jsxs("div",{style:{textAlign:"center",padding:"60px",color:"#9CA3AF"},children:[r.jsx(j,{size:28,style:{animation:"spin 1s linear infinite",marginBottom:"12px"}}),r.jsx("p",{style:{margin:0},children:"Cargando archivos..."})]}):f.length===0?r.jsxs("div",{style:{textAlign:"center",padding:"60px",color:"#9CA3AF"},children:[r.jsx(_,{size:36,style:{marginBottom:"12px",opacity:.3}}),r.jsx("p",{style:{margin:0,fontSize:"0.85rem"},children:"No hay archivos subidos aÃºn."})]}):r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:f.map(e=>r.jsxs("div",{style:{backgroundColor:"#fff",borderRadius:"10px",padding:"12px 16px",border:"1px solid #E5E7EB",display:"flex",alignItems:"center",gap:"12px"},children:[B(e.mimeType),r.jsxs("div",{style:{flex:1,minWidth:0},children:[r.jsx("p",{style:{margin:0,fontSize:"0.82rem",fontWeight:"600",color:"#111",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:e.name}),r.jsxs("p",{style:{margin:"2px 0 0",fontSize:"0.7rem",color:"#9CA3AF"},children:[w(e.size)," Â· ",new Date(e.createdAt).toLocaleDateString("es-AR")]})]}),e.signedUrl&&r.jsx("a",{href:e.signedUrl,download:!0,target:"_blank",rel:"noreferrer",style:{color:"#6B7280",display:"flex"},children:r.jsx(P,{size:15})}),r.jsx("button",{onClick:()=>$(e.path),style:{background:"none",border:"none",cursor:"pointer",padding:"2px"},children:r.jsx(V,{size:15,color:"#EF4444"})})]},e.id))})]}),r.jsx("style",{children:"@keyframes spin { from{transform:rotate(0deg)} to{transform:rotate(360deg)} }"})]})}export{ce as CargaMasivaView};
