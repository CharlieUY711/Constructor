import{K as Jo,q as Ws,R as Ys,r as I,j as y,p as Xs,h as Gs,N as qs,t as Jt}from"./index-N4sibPIm.js";import{a as Me,c as Kn,b as Zn,d as Us,i as en}from"./value-BTdN53H7.js";import{p as Ks}from"./roadmapApi-CUPgOBDM.js";import{O as Zs}from"./OrangeHeader-CGBfg0T6.js";import{R as Qs}from"./refresh-cw-2mEfMqcv.js";import{L as Nn}from"./lightbulb-2Ixlvf2A.js";import{L as Qn}from"./layers-Cgl2SEQr.js";import{C as er}from"./chevron-down-o3b_Qg9W.js";import{P as Js}from"./plus-BQVW67V-.js";import{P as tr}from"./pen-line-C2RWFPzo.js";import{T as ea}from"./trash-2-BDJ290By.js";import{S as ta}from"./save-BAH4JgG_.js";import{C as na}from"./chevron-right-DFbw-Peu.js";import{C as oa}from"./check-c5lgkgx8.js";import{A as ra}from"./arrow-up-9ITp5I_f.js";import{X as ia}from"./x-JrjeCf37.js";import"./ConnectionStatusIcon-vc_QUw-u.js";import"./zap-BsT0UEq-.js";import"./map-pin-biO6EB7A.js";var Jn=180/Math.PI,hn={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function nr(e,t,n,o,r,i){var s,a,c;return(s=Math.sqrt(e*e+t*t))&&(e/=s,t/=s),(c=e*n+t*o)&&(n-=e*c,o-=t*c),(a=Math.sqrt(n*n+o*o))&&(n/=a,o/=a,c/=a),e*o<t*n&&(e=-e,t=-t,c=-c,s=-s),{translateX:r,translateY:i,rotate:Math.atan2(t,e)*Jn,skewX:Math.atan(c)*Jn,scaleX:s,scaleY:a}}var xt;function sa(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?hn:nr(t.a,t.b,t.c,t.d,t.e,t.f)}function aa(e){return e==null||(xt||(xt=document.createElementNS("http://www.w3.org/2000/svg","g")),xt.setAttribute("transform",e),!(e=xt.transform.baseVal.consolidate()))?hn:(e=e.matrix,nr(e.a,e.b,e.c,e.d,e.e,e.f))}function or(e,t,n,o){function r(u){return u.length?u.pop()+" ":""}function i(u,f,l,d,p,g){if(u!==l||f!==d){var x=p.push("translate(",null,t,null,n);g.push({i:x-4,x:Me(u,l)},{i:x-2,x:Me(f,d)})}else(l||d)&&p.push("translate("+l+t+d+n)}function s(u,f,l,d){u!==f?(u-f>180?f+=360:f-u>180&&(u+=360),d.push({i:l.push(r(l)+"rotate(",null,o)-2,x:Me(u,f)})):f&&l.push(r(l)+"rotate("+f+o)}function a(u,f,l,d){u!==f?d.push({i:l.push(r(l)+"skewX(",null,o)-2,x:Me(u,f)}):f&&l.push(r(l)+"skewX("+f+o)}function c(u,f,l,d,p,g){if(u!==l||f!==d){var x=p.push(r(p)+"scale(",null,",",null,")");g.push({i:x-4,x:Me(u,l)},{i:x-2,x:Me(f,d)})}else(l!==1||d!==1)&&p.push(r(p)+"scale("+l+","+d+")")}return function(u,f){var l=[],d=[];return u=e(u),f=e(f),i(u.translateX,u.translateY,f.translateX,f.translateY,l,d),s(u.rotate,f.rotate,l,d),a(u.skewX,f.skewX,l,d),c(u.scaleX,u.scaleY,f.scaleX,f.scaleY,l,d),u=f=null,function(p){for(var g=-1,x=d.length,v;++g<x;)l[(v=d[g]).i]=v.x(p);return l.join("")}}}var ca=or(sa,"px, ","px)","deg)"),la=or(aa,", ",")",")"),ua=1e-12;function eo(e){return((e=Math.exp(e))+1/e)/2}function da(e){return((e=Math.exp(e))-1/e)/2}function fa(e){return((e=Math.exp(2*e))-1)/(e+1)}const Ct=(function e(t,n,o){function r(i,s){var a=i[0],c=i[1],u=i[2],f=s[0],l=s[1],d=s[2],p=f-a,g=l-c,x=p*p+g*g,v,m;if(x<ua)m=Math.log(d/u)/t,v=function(N){return[a+N*p,c+N*g,u*Math.exp(t*N*m)]};else{var b=Math.sqrt(x),h=(d*d-u*u+o*x)/(2*u*n*b),w=(d*d-u*u-o*x)/(2*d*n*b),_=Math.log(Math.sqrt(h*h+1)-h),S=Math.log(Math.sqrt(w*w+1)-w);m=(S-_)/t,v=function(N){var F=N*m,T=eo(_),H=u/(n*b)*(T*fa(t*F+_)-da(_));return[a+H*p,c+H*g,u*T/eo(t*F+_)]}}return v.duration=m*1e3*t/Math.SQRT2,v}return r.rho=function(i){var s=Math.max(.001,+i),a=s*s,c=a*a;return e(s,a,c)},r})(Math.SQRT2,2,4);function se(e){if(typeof e=="string"||typeof e=="number")return""+e;let t="";if(Array.isArray(e))for(let n=0,o;n<e.length;n++)(o=se(e[n]))!==""&&(t+=(t&&" ")+o);else for(let n in e)e[n]&&(t+=(t&&" ")+n);return t}var ha={value:()=>{}};function Rt(){for(var e=0,t=arguments.length,n={},o;e<t;++e){if(!(o=arguments[e]+"")||o in n||/[\s.]/.test(o))throw new Error("illegal type: "+o);n[o]=[]}return new Nt(n)}function Nt(e){this._=e}function ga(e,t){return e.trim().split(/^|\s+/).map(function(n){var o="",r=n.indexOf(".");if(r>=0&&(o=n.slice(r+1),n=n.slice(0,r)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:o}})}Nt.prototype=Rt.prototype={constructor:Nt,on:function(e,t){var n=this._,o=ga(e+"",n),r,i=-1,s=o.length;if(arguments.length<2){for(;++i<s;)if((r=(e=o[i]).type)&&(r=pa(n[r],e.name)))return r;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++i<s;)if(r=(e=o[i]).type)n[r]=to(n[r],e.name,t);else if(t==null)for(r in n)n[r]=to(n[r],e.name,null);return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new Nt(e)},call:function(e,t){if((r=arguments.length-2)>0)for(var n=new Array(r),o=0,r,i;o<r;++o)n[o]=arguments[o+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(i=this._[e],o=0,r=i.length;o<r;++o)i[o].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var o=this._[e],r=0,i=o.length;r<i;++r)o[r].value.apply(t,n)}};function pa(e,t){for(var n=0,o=e.length,r;n<o;++n)if((r=e[n]).name===t)return r.value}function to(e,t,n){for(var o=0,r=e.length;o<r;++o)if(e[o].name===t){e[o]=ha,e=e.slice(0,o).concat(e.slice(o+1));break}return n!=null&&e.push({name:t,value:n}),e}var gn="http://www.w3.org/1999/xhtml";const no={svg:"http://www.w3.org/2000/svg",xhtml:gn,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Lt(e){var t=e+="",n=t.indexOf(":");return n>=0&&(t=e.slice(0,n))!=="xmlns"&&(e=e.slice(n+1)),no.hasOwnProperty(t)?{space:no[t],local:e}:e}function ma(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===gn&&t.documentElement.namespaceURI===gn?t.createElement(e):t.createElementNS(n,e)}}function ya(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function rr(e){var t=Lt(e);return(t.local?ya:ma)(t)}function xa(){}function kn(e){return e==null?xa:function(){return this.querySelector(e)}}function wa(e){typeof e!="function"&&(e=kn(e));for(var t=this._groups,n=t.length,o=new Array(n),r=0;r<n;++r)for(var i=t[r],s=i.length,a=o[r]=new Array(s),c,u,f=0;f<s;++f)(c=i[f])&&(u=e.call(c,c.__data__,f,i))&&("__data__"in c&&(u.__data__=c.__data__),a[f]=u);return new le(o,this._parents)}function va(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function ba(){return[]}function ir(e){return e==null?ba:function(){return this.querySelectorAll(e)}}function Ea(e){return function(){return va(e.apply(this,arguments))}}function Sa(e){typeof e=="function"?e=Ea(e):e=ir(e);for(var t=this._groups,n=t.length,o=[],r=[],i=0;i<n;++i)for(var s=t[i],a=s.length,c,u=0;u<a;++u)(c=s[u])&&(o.push(e.call(c,c.__data__,u,s)),r.push(c));return new le(o,r)}function sr(e){return function(){return this.matches(e)}}function ar(e){return function(t){return t.matches(e)}}var _a=Array.prototype.find;function Ca(e){return function(){return _a.call(this.children,e)}}function Na(){return this.firstElementChild}function ka(e){return this.select(e==null?Na:Ca(typeof e=="function"?e:ar(e)))}var Ma=Array.prototype.filter;function Ia(){return Array.from(this.children)}function Aa(e){return function(){return Ma.call(this.children,e)}}function za(e){return this.selectAll(e==null?Ia:Aa(typeof e=="function"?e:ar(e)))}function Pa(e){typeof e!="function"&&(e=sr(e));for(var t=this._groups,n=t.length,o=new Array(n),r=0;r<n;++r)for(var i=t[r],s=i.length,a=o[r]=[],c,u=0;u<s;++u)(c=i[u])&&e.call(c,c.__data__,u,i)&&a.push(c);return new le(o,this._parents)}function cr(e){return new Array(e.length)}function ja(){return new le(this._enter||this._groups.map(cr),this._parents)}function At(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}At.prototype={constructor:At,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function Fa(e){return function(){return e}}function Ta(e,t,n,o,r,i){for(var s=0,a,c=t.length,u=i.length;s<u;++s)(a=t[s])?(a.__data__=i[s],o[s]=a):n[s]=new At(e,i[s]);for(;s<c;++s)(a=t[s])&&(r[s]=a)}function $a(e,t,n,o,r,i,s){var a,c,u=new Map,f=t.length,l=i.length,d=new Array(f),p;for(a=0;a<f;++a)(c=t[a])&&(d[a]=p=s.call(c,c.__data__,a,t)+"",u.has(p)?r[a]=c:u.set(p,c));for(a=0;a<l;++a)p=s.call(e,i[a],a,i)+"",(c=u.get(p))?(o[a]=c,c.__data__=i[a],u.delete(p)):n[a]=new At(e,i[a]);for(a=0;a<f;++a)(c=t[a])&&u.get(d[a])===c&&(r[a]=c)}function Da(e){return e.__data__}function Ra(e,t){if(!arguments.length)return Array.from(this,Da);var n=t?$a:Ta,o=this._parents,r=this._groups;typeof e!="function"&&(e=Fa(e));for(var i=r.length,s=new Array(i),a=new Array(i),c=new Array(i),u=0;u<i;++u){var f=o[u],l=r[u],d=l.length,p=La(e.call(f,f&&f.__data__,u,o)),g=p.length,x=a[u]=new Array(g),v=s[u]=new Array(g),m=c[u]=new Array(d);n(f,l,x,v,m,p,t);for(var b=0,h=0,w,_;b<g;++b)if(w=x[b]){for(b>=h&&(h=b+1);!(_=v[h])&&++h<g;);w._next=_||null}}return s=new le(s,o),s._enter=a,s._exit=c,s}function La(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function Ba(){return new le(this._exit||this._groups.map(cr),this._parents)}function Ha(e,t,n){var o=this.enter(),r=this,i=this.exit();return typeof e=="function"?(o=e(o),o&&(o=o.selection())):o=o.append(e+""),t!=null&&(r=t(r),r&&(r=r.selection())),n==null?i.remove():n(i),o&&r?o.merge(r).order():r}function Va(e){for(var t=e.selection?e.selection():e,n=this._groups,o=t._groups,r=n.length,i=o.length,s=Math.min(r,i),a=new Array(r),c=0;c<s;++c)for(var u=n[c],f=o[c],l=u.length,d=a[c]=new Array(l),p,g=0;g<l;++g)(p=u[g]||f[g])&&(d[g]=p);for(;c<r;++c)a[c]=n[c];return new le(a,this._parents)}function Oa(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var o=e[t],r=o.length-1,i=o[r],s;--r>=0;)(s=o[r])&&(i&&s.compareDocumentPosition(i)^4&&i.parentNode.insertBefore(s,i),i=s);return this}function Wa(e){e||(e=Ya);function t(l,d){return l&&d?e(l.__data__,d.__data__):!l-!d}for(var n=this._groups,o=n.length,r=new Array(o),i=0;i<o;++i){for(var s=n[i],a=s.length,c=r[i]=new Array(a),u,f=0;f<a;++f)(u=s[f])&&(c[f]=u);c.sort(t)}return new le(r,this._parents).order()}function Ya(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function Xa(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function Ga(){return Array.from(this)}function qa(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var o=e[t],r=0,i=o.length;r<i;++r){var s=o[r];if(s)return s}return null}function Ua(){let e=0;for(const t of this)++e;return e}function Ka(){return!this.node()}function Za(e){for(var t=this._groups,n=0,o=t.length;n<o;++n)for(var r=t[n],i=0,s=r.length,a;i<s;++i)(a=r[i])&&e.call(a,a.__data__,i,r);return this}function Qa(e){return function(){this.removeAttribute(e)}}function Ja(e){return function(){this.removeAttributeNS(e.space,e.local)}}function ec(e,t){return function(){this.setAttribute(e,t)}}function tc(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function nc(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttribute(e):this.setAttribute(e,n)}}function oc(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function rc(e,t){var n=Lt(e);if(arguments.length<2){var o=this.node();return n.local?o.getAttributeNS(n.space,n.local):o.getAttribute(n)}return this.each((t==null?n.local?Ja:Qa:typeof t=="function"?n.local?oc:nc:n.local?tc:ec)(n,t))}function lr(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function ic(e){return function(){this.style.removeProperty(e)}}function sc(e,t,n){return function(){this.style.setProperty(e,t,n)}}function ac(e,t,n){return function(){var o=t.apply(this,arguments);o==null?this.style.removeProperty(e):this.style.setProperty(e,o,n)}}function cc(e,t,n){return arguments.length>1?this.each((t==null?ic:typeof t=="function"?ac:sc)(e,t,n??"")):He(this.node(),e)}function He(e,t){return e.style.getPropertyValue(t)||lr(e).getComputedStyle(e,null).getPropertyValue(t)}function lc(e){return function(){delete this[e]}}function uc(e,t){return function(){this[e]=t}}function dc(e,t){return function(){var n=t.apply(this,arguments);n==null?delete this[e]:this[e]=n}}function fc(e,t){return arguments.length>1?this.each((t==null?lc:typeof t=="function"?dc:uc)(e,t)):this.node()[e]}function ur(e){return e.trim().split(/^|\s+/)}function Mn(e){return e.classList||new dr(e)}function dr(e){this._node=e,this._names=ur(e.getAttribute("class")||"")}dr.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function fr(e,t){for(var n=Mn(e),o=-1,r=t.length;++o<r;)n.add(t[o])}function hr(e,t){for(var n=Mn(e),o=-1,r=t.length;++o<r;)n.remove(t[o])}function hc(e){return function(){fr(this,e)}}function gc(e){return function(){hr(this,e)}}function pc(e,t){return function(){(t.apply(this,arguments)?fr:hr)(this,e)}}function mc(e,t){var n=ur(e+"");if(arguments.length<2){for(var o=Mn(this.node()),r=-1,i=n.length;++r<i;)if(!o.contains(n[r]))return!1;return!0}return this.each((typeof t=="function"?pc:t?hc:gc)(n,t))}function yc(){this.textContent=""}function xc(e){return function(){this.textContent=e}}function wc(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function vc(e){return arguments.length?this.each(e==null?yc:(typeof e=="function"?wc:xc)(e)):this.node().textContent}function bc(){this.innerHTML=""}function Ec(e){return function(){this.innerHTML=e}}function Sc(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function _c(e){return arguments.length?this.each(e==null?bc:(typeof e=="function"?Sc:Ec)(e)):this.node().innerHTML}function Cc(){this.nextSibling&&this.parentNode.appendChild(this)}function Nc(){return this.each(Cc)}function kc(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Mc(){return this.each(kc)}function Ic(e){var t=typeof e=="function"?e:rr(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function Ac(){return null}function zc(e,t){var n=typeof e=="function"?e:rr(e),o=t==null?Ac:typeof t=="function"?t:kn(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),o.apply(this,arguments)||null)})}function Pc(){var e=this.parentNode;e&&e.removeChild(this)}function jc(){return this.each(Pc)}function Fc(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Tc(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function $c(e){return this.select(e?Tc:Fc)}function Dc(e){return arguments.length?this.property("__data__",e):this.node().__data__}function Rc(e){return function(t){e.call(this,t,this.__data__)}}function Lc(e){return e.trim().split(/^|\s+/).map(function(t){var n="",o=t.indexOf(".");return o>=0&&(n=t.slice(o+1),t=t.slice(0,o)),{type:t,name:n}})}function Bc(e){return function(){var t=this.__on;if(t){for(var n=0,o=-1,r=t.length,i;n<r;++n)i=t[n],(!e.type||i.type===e.type)&&i.name===e.name?this.removeEventListener(i.type,i.listener,i.options):t[++o]=i;++o?t.length=o:delete this.__on}}}function Hc(e,t,n){return function(){var o=this.__on,r,i=Rc(t);if(o){for(var s=0,a=o.length;s<a;++s)if((r=o[s]).type===e.type&&r.name===e.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=i,r.options=n),r.value=t;return}}this.addEventListener(e.type,i,n),r={type:e.type,name:e.name,value:t,listener:i,options:n},o?o.push(r):this.__on=[r]}}function Vc(e,t,n){var o=Lc(e+""),r,i=o.length,s;if(arguments.length<2){var a=this.node().__on;if(a){for(var c=0,u=a.length,f;c<u;++c)for(r=0,f=a[c];r<i;++r)if((s=o[r]).type===f.type&&s.name===f.name)return f.value}return}for(a=t?Hc:Bc,r=0;r<i;++r)this.each(a(o[r],t,n));return this}function gr(e,t,n){var o=lr(e),r=o.CustomEvent;typeof r=="function"?r=new r(t,n):(r=o.document.createEvent("Event"),n?(r.initEvent(t,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(t,!1,!1)),e.dispatchEvent(r)}function Oc(e,t){return function(){return gr(this,e,t)}}function Wc(e,t){return function(){return gr(this,e,t.apply(this,arguments))}}function Yc(e,t){return this.each((typeof t=="function"?Wc:Oc)(e,t))}function*Xc(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var o=e[t],r=0,i=o.length,s;r<i;++r)(s=o[r])&&(yield s)}var pr=[null];function le(e,t){this._groups=e,this._parents=t}function dt(){return new le([[document.documentElement]],pr)}function Gc(){return this}le.prototype=dt.prototype={constructor:le,select:wa,selectAll:Sa,selectChild:ka,selectChildren:za,filter:Pa,data:Ra,enter:ja,exit:Ba,join:Ha,merge:Va,selection:Gc,order:Oa,sort:Wa,call:Xa,nodes:Ga,node:qa,size:Ua,empty:Ka,each:Za,attr:rc,style:cc,property:fc,classed:mc,text:vc,html:_c,raise:Nc,lower:Mc,append:Ic,insert:zc,remove:jc,clone:$c,datum:Dc,on:Vc,dispatch:Yc,[Symbol.iterator]:Xc};function ce(e){return typeof e=="string"?new le([[document.querySelector(e)]],[document.documentElement]):new le([[e]],pr)}function qc(e){let t;for(;t=e.sourceEvent;)e=t;return e}function ue(e,t){if(e=qc(e),t===void 0&&(t=e.currentTarget),t){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var o=n.createSVGPoint();return o.x=e.clientX,o.y=e.clientY,o=o.matrixTransform(t.getScreenCTM().inverse()),[o.x,o.y]}if(t.getBoundingClientRect){var r=t.getBoundingClientRect();return[e.clientX-r.left-t.clientLeft,e.clientY-r.top-t.clientTop]}}return[e.pageX,e.pageY]}const Uc={passive:!1},rt={capture:!0,passive:!1};function tn(e){e.stopImmediatePropagation()}function Be(e){e.preventDefault(),e.stopImmediatePropagation()}function mr(e){var t=e.document.documentElement,n=ce(e).on("dragstart.drag",Be,rt);"onselectstart"in t?n.on("selectstart.drag",Be,rt):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function yr(e,t){var n=e.document.documentElement,o=ce(e).on("dragstart.drag",null);t&&(o.on("click.drag",Be,rt),setTimeout(function(){o.on("click.drag",null)},0)),"onselectstart"in n?o.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const wt=e=>()=>e;function pn(e,{sourceEvent:t,subject:n,target:o,identifier:r,active:i,x:s,y:a,dx:c,dy:u,dispatch:f}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:o,enumerable:!0,configurable:!0},identifier:{value:r,enumerable:!0,configurable:!0},active:{value:i,enumerable:!0,configurable:!0},x:{value:s,enumerable:!0,configurable:!0},y:{value:a,enumerable:!0,configurable:!0},dx:{value:c,enumerable:!0,configurable:!0},dy:{value:u,enumerable:!0,configurable:!0},_:{value:f}})}pn.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};function Kc(e){return!e.ctrlKey&&!e.button}function Zc(){return this.parentNode}function Qc(e,t){return t??{x:e.x,y:e.y}}function Jc(){return navigator.maxTouchPoints||"ontouchstart"in this}function xr(){var e=Kc,t=Zc,n=Qc,o=Jc,r={},i=Rt("start","drag","end"),s=0,a,c,u,f,l=0;function d(w){w.on("mousedown.drag",p).filter(o).on("touchstart.drag",v).on("touchmove.drag",m,Uc).on("touchend.drag touchcancel.drag",b).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function p(w,_){if(!(f||!e.call(this,w,_))){var S=h(this,t.call(this,w,_),w,_,"mouse");S&&(ce(w.view).on("mousemove.drag",g,rt).on("mouseup.drag",x,rt),mr(w.view),tn(w),u=!1,a=w.clientX,c=w.clientY,S("start",w))}}function g(w){if(Be(w),!u){var _=w.clientX-a,S=w.clientY-c;u=_*_+S*S>l}r.mouse("drag",w)}function x(w){ce(w.view).on("mousemove.drag mouseup.drag",null),yr(w.view,u),Be(w),r.mouse("end",w)}function v(w,_){if(e.call(this,w,_)){var S=w.changedTouches,N=t.call(this,w,_),F=S.length,T,H;for(T=0;T<F;++T)(H=h(this,N,w,_,S[T].identifier,S[T]))&&(tn(w),H("start",w,S[T]))}}function m(w){var _=w.changedTouches,S=_.length,N,F;for(N=0;N<S;++N)(F=r[_[N].identifier])&&(Be(w),F("drag",w,_[N]))}function b(w){var _=w.changedTouches,S=_.length,N,F;for(f&&clearTimeout(f),f=setTimeout(function(){f=null},500),N=0;N<S;++N)(F=r[_[N].identifier])&&(tn(w),F("end",w,_[N]))}function h(w,_,S,N,F,T){var H=i.copy(),A=ue(T||S,_),j,B,E;if((E=n.call(w,new pn("beforestart",{sourceEvent:S,target:d,identifier:F,active:s,x:A[0],y:A[1],dx:0,dy:0,dispatch:H}),N))!=null)return j=E.x-A[0]||0,B=E.y-A[1]||0,function z(C,P,M){var k=A,D;switch(C){case"start":r[F]=z,D=s++;break;case"end":delete r[F],--s;case"drag":A=ue(M||P,_),D=s;break}H.call(C,w,new pn(C,{sourceEvent:P,subject:E,target:d,identifier:F,active:D,x:A[0]+j,y:A[1]+B,dx:A[0]-k[0],dy:A[1]-k[1],dispatch:H}),N)}}return d.filter=function(w){return arguments.length?(e=typeof w=="function"?w:wt(!!w),d):e},d.container=function(w){return arguments.length?(t=typeof w=="function"?w:wt(w),d):t},d.subject=function(w){return arguments.length?(n=typeof w=="function"?w:wt(w),d):n},d.touchable=function(w){return arguments.length?(o=typeof w=="function"?w:wt(!!w),d):o},d.on=function(){var w=i.on.apply(i,arguments);return w===i?d:w},d.clickDistance=function(w){return arguments.length?(l=(w=+w)*w,d):Math.sqrt(l)},d}var Ve=0,tt=0,Je=0,wr=1e3,zt,nt,Pt=0,ze=0,Bt=0,it=typeof performance=="object"&&performance.now?performance:Date,vr=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function In(){return ze||(vr(el),ze=it.now()+Bt)}function el(){ze=0}function jt(){this._call=this._time=this._next=null}jt.prototype=br.prototype={constructor:jt,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?In():+n)+(t==null?0:+t),!this._next&&nt!==this&&(nt?nt._next=this:zt=this,nt=this),this._call=e,this._time=n,mn()},stop:function(){this._call&&(this._call=null,this._time=1/0,mn())}};function br(e,t,n){var o=new jt;return o.restart(e,t,n),o}function tl(){In(),++Ve;for(var e=zt,t;e;)(t=ze-e._time)>=0&&e._call.call(void 0,t),e=e._next;--Ve}function oo(){ze=(Pt=it.now())+Bt,Ve=tt=0;try{tl()}finally{Ve=0,ol(),ze=0}}function nl(){var e=it.now(),t=e-Pt;t>wr&&(Bt-=t,Pt=e)}function ol(){for(var e,t=zt,n,o=1/0;t;)t._call?(o>t._time&&(o=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:zt=n);nt=e,mn(o)}function mn(e){if(!Ve){tt&&(tt=clearTimeout(tt));var t=e-ze;t>24?(e<1/0&&(tt=setTimeout(oo,e-it.now()-Bt)),Je&&(Je=clearInterval(Je))):(Je||(Pt=it.now(),Je=setInterval(nl,wr)),Ve=1,vr(oo))}}function ro(e,t,n){var o=new jt;return t=t==null?0:+t,o.restart(r=>{o.stop(),e(r+t)},t,n),o}var rl=Rt("start","end","cancel","interrupt"),il=[],Er=0,io=1,yn=2,kt=3,so=4,xn=5,Mt=6;function Ht(e,t,n,o,r,i){var s=e.__transition;if(!s)e.__transition={};else if(n in s)return;sl(e,n,{name:t,index:o,group:r,on:rl,tween:il,time:i.time,delay:i.delay,duration:i.duration,ease:i.ease,timer:null,state:Er})}function An(e,t){var n=he(e,t);if(n.state>Er)throw new Error("too late; already scheduled");return n}function me(e,t){var n=he(e,t);if(n.state>kt)throw new Error("too late; already running");return n}function he(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function sl(e,t,n){var o=e.__transition,r;o[t]=n,n.timer=br(i,0,n.time);function i(u){n.state=io,n.timer.restart(s,n.delay,n.time),n.delay<=u&&s(u-n.delay)}function s(u){var f,l,d,p;if(n.state!==io)return c();for(f in o)if(p=o[f],p.name===n.name){if(p.state===kt)return ro(s);p.state===so?(p.state=Mt,p.timer.stop(),p.on.call("interrupt",e,e.__data__,p.index,p.group),delete o[f]):+f<t&&(p.state=Mt,p.timer.stop(),p.on.call("cancel",e,e.__data__,p.index,p.group),delete o[f])}if(ro(function(){n.state===kt&&(n.state=so,n.timer.restart(a,n.delay,n.time),a(u))}),n.state=yn,n.on.call("start",e,e.__data__,n.index,n.group),n.state===yn){for(n.state=kt,r=new Array(d=n.tween.length),f=0,l=-1;f<d;++f)(p=n.tween[f].value.call(e,e.__data__,n.index,n.group))&&(r[++l]=p);r.length=l+1}}function a(u){for(var f=u<n.duration?n.ease.call(null,u/n.duration):(n.timer.restart(c),n.state=xn,1),l=-1,d=r.length;++l<d;)r[l].call(e,f);n.state===xn&&(n.on.call("end",e,e.__data__,n.index,n.group),c())}function c(){n.state=Mt,n.timer.stop(),delete o[t];for(var u in o)return;delete e.__transition}}function It(e,t){var n=e.__transition,o,r,i=!0,s;if(n){t=t==null?null:t+"";for(s in n){if((o=n[s]).name!==t){i=!1;continue}r=o.state>yn&&o.state<xn,o.state=Mt,o.timer.stop(),o.on.call(r?"interrupt":"cancel",e,e.__data__,o.index,o.group),delete n[s]}i&&delete e.__transition}}function al(e){return this.each(function(){It(this,e)})}function cl(e,t){var n,o;return function(){var r=me(this,e),i=r.tween;if(i!==n){o=n=i;for(var s=0,a=o.length;s<a;++s)if(o[s].name===t){o=o.slice(),o.splice(s,1);break}}r.tween=o}}function ll(e,t,n){var o,r;if(typeof n!="function")throw new Error;return function(){var i=me(this,e),s=i.tween;if(s!==o){r=(o=s).slice();for(var a={name:t,value:n},c=0,u=r.length;c<u;++c)if(r[c].name===t){r[c]=a;break}c===u&&r.push(a)}i.tween=r}}function ul(e,t){var n=this._id;if(e+="",arguments.length<2){for(var o=he(this.node(),n).tween,r=0,i=o.length,s;r<i;++r)if((s=o[r]).name===e)return s.value;return null}return this.each((t==null?cl:ll)(n,e,t))}function zn(e,t,n){var o=e._id;return e.each(function(){var r=me(this,o);(r.value||(r.value={}))[t]=n.apply(this,arguments)}),function(r){return he(r,o).value[t]}}function Sr(e,t){var n;return(typeof t=="number"?Me:t instanceof Kn?Zn:(n=Kn(t))?(t=n,Zn):Us)(e,t)}function dl(e){return function(){this.removeAttribute(e)}}function fl(e){return function(){this.removeAttributeNS(e.space,e.local)}}function hl(e,t,n){var o,r=n+"",i;return function(){var s=this.getAttribute(e);return s===r?null:s===o?i:i=t(o=s,n)}}function gl(e,t,n){var o,r=n+"",i;return function(){var s=this.getAttributeNS(e.space,e.local);return s===r?null:s===o?i:i=t(o=s,n)}}function pl(e,t,n){var o,r,i;return function(){var s,a=n(this),c;return a==null?void this.removeAttribute(e):(s=this.getAttribute(e),c=a+"",s===c?null:s===o&&c===r?i:(r=c,i=t(o=s,a)))}}function ml(e,t,n){var o,r,i;return function(){var s,a=n(this),c;return a==null?void this.removeAttributeNS(e.space,e.local):(s=this.getAttributeNS(e.space,e.local),c=a+"",s===c?null:s===o&&c===r?i:(r=c,i=t(o=s,a)))}}function yl(e,t){var n=Lt(e),o=n==="transform"?la:Sr;return this.attrTween(e,typeof t=="function"?(n.local?ml:pl)(n,o,zn(this,"attr."+e,t)):t==null?(n.local?fl:dl)(n):(n.local?gl:hl)(n,o,t))}function xl(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}function wl(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}function vl(e,t){var n,o;function r(){var i=t.apply(this,arguments);return i!==o&&(n=(o=i)&&wl(e,i)),n}return r._value=t,r}function bl(e,t){var n,o;function r(){var i=t.apply(this,arguments);return i!==o&&(n=(o=i)&&xl(e,i)),n}return r._value=t,r}function El(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;var o=Lt(e);return this.tween(n,(o.local?vl:bl)(o,t))}function Sl(e,t){return function(){An(this,e).delay=+t.apply(this,arguments)}}function _l(e,t){return t=+t,function(){An(this,e).delay=t}}function Cl(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?Sl:_l)(t,e)):he(this.node(),t).delay}function Nl(e,t){return function(){me(this,e).duration=+t.apply(this,arguments)}}function kl(e,t){return t=+t,function(){me(this,e).duration=t}}function Ml(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?Nl:kl)(t,e)):he(this.node(),t).duration}function Il(e,t){if(typeof t!="function")throw new Error;return function(){me(this,e).ease=t}}function Al(e){var t=this._id;return arguments.length?this.each(Il(t,e)):he(this.node(),t).ease}function zl(e,t){return function(){var n=t.apply(this,arguments);if(typeof n!="function")throw new Error;me(this,e).ease=n}}function Pl(e){if(typeof e!="function")throw new Error;return this.each(zl(this._id,e))}function jl(e){typeof e!="function"&&(e=sr(e));for(var t=this._groups,n=t.length,o=new Array(n),r=0;r<n;++r)for(var i=t[r],s=i.length,a=o[r]=[],c,u=0;u<s;++u)(c=i[u])&&e.call(c,c.__data__,u,i)&&a.push(c);return new be(o,this._parents,this._name,this._id)}function Fl(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,o=t.length,r=n.length,i=Math.min(o,r),s=new Array(o),a=0;a<i;++a)for(var c=t[a],u=n[a],f=c.length,l=s[a]=new Array(f),d,p=0;p<f;++p)(d=c[p]||u[p])&&(l[p]=d);for(;a<o;++a)s[a]=t[a];return new be(s,this._parents,this._name,this._id)}function Tl(e){return(e+"").trim().split(/^|\s+/).every(function(t){var n=t.indexOf(".");return n>=0&&(t=t.slice(0,n)),!t||t==="start"})}function $l(e,t,n){var o,r,i=Tl(t)?An:me;return function(){var s=i(this,e),a=s.on;a!==o&&(r=(o=a).copy()).on(t,n),s.on=r}}function Dl(e,t){var n=this._id;return arguments.length<2?he(this.node(),n).on.on(e):this.each($l(n,e,t))}function Rl(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}function Ll(){return this.on("end.remove",Rl(this._id))}function Bl(e){var t=this._name,n=this._id;typeof e!="function"&&(e=kn(e));for(var o=this._groups,r=o.length,i=new Array(r),s=0;s<r;++s)for(var a=o[s],c=a.length,u=i[s]=new Array(c),f,l,d=0;d<c;++d)(f=a[d])&&(l=e.call(f,f.__data__,d,a))&&("__data__"in f&&(l.__data__=f.__data__),u[d]=l,Ht(u[d],t,n,d,u,he(f,n)));return new be(i,this._parents,t,n)}function Hl(e){var t=this._name,n=this._id;typeof e!="function"&&(e=ir(e));for(var o=this._groups,r=o.length,i=[],s=[],a=0;a<r;++a)for(var c=o[a],u=c.length,f,l=0;l<u;++l)if(f=c[l]){for(var d=e.call(f,f.__data__,l,c),p,g=he(f,n),x=0,v=d.length;x<v;++x)(p=d[x])&&Ht(p,t,n,x,d,g);i.push(d),s.push(f)}return new be(i,s,t,n)}var Vl=dt.prototype.constructor;function Ol(){return new Vl(this._groups,this._parents)}function Wl(e,t){var n,o,r;return function(){var i=He(this,e),s=(this.style.removeProperty(e),He(this,e));return i===s?null:i===n&&s===o?r:r=t(n=i,o=s)}}function _r(e){return function(){this.style.removeProperty(e)}}function Yl(e,t,n){var o,r=n+"",i;return function(){var s=He(this,e);return s===r?null:s===o?i:i=t(o=s,n)}}function Xl(e,t,n){var o,r,i;return function(){var s=He(this,e),a=n(this),c=a+"";return a==null&&(c=a=(this.style.removeProperty(e),He(this,e))),s===c?null:s===o&&c===r?i:(r=c,i=t(o=s,a))}}function Gl(e,t){var n,o,r,i="style."+t,s="end."+i,a;return function(){var c=me(this,e),u=c.on,f=c.value[i]==null?a||(a=_r(t)):void 0;(u!==n||r!==f)&&(o=(n=u).copy()).on(s,r=f),c.on=o}}function ql(e,t,n){var o=(e+="")=="transform"?ca:Sr;return t==null?this.styleTween(e,Wl(e,o)).on("end.style."+e,_r(e)):typeof t=="function"?this.styleTween(e,Xl(e,o,zn(this,"style."+e,t))).each(Gl(this._id,e)):this.styleTween(e,Yl(e,o,t),n).on("end.style."+e,null)}function Ul(e,t,n){return function(o){this.style.setProperty(e,t.call(this,o),n)}}function Kl(e,t,n){var o,r;function i(){var s=t.apply(this,arguments);return s!==r&&(o=(r=s)&&Ul(e,s,n)),o}return i._value=t,i}function Zl(e,t,n){var o="style."+(e+="");if(arguments.length<2)return(o=this.tween(o))&&o._value;if(t==null)return this.tween(o,null);if(typeof t!="function")throw new Error;return this.tween(o,Kl(e,t,n??""))}function Ql(e){return function(){this.textContent=e}}function Jl(e){return function(){var t=e(this);this.textContent=t??""}}function eu(e){return this.tween("text",typeof e=="function"?Jl(zn(this,"text",e)):Ql(e==null?"":e+""))}function tu(e){return function(t){this.textContent=e.call(this,t)}}function nu(e){var t,n;function o(){var r=e.apply(this,arguments);return r!==n&&(t=(n=r)&&tu(r)),t}return o._value=e,o}function ou(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,nu(e))}function ru(){for(var e=this._name,t=this._id,n=Cr(),o=this._groups,r=o.length,i=0;i<r;++i)for(var s=o[i],a=s.length,c,u=0;u<a;++u)if(c=s[u]){var f=he(c,t);Ht(c,e,n,u,s,{time:f.time+f.delay+f.duration,delay:0,duration:f.duration,ease:f.ease})}return new be(o,this._parents,e,n)}function iu(){var e,t,n=this,o=n._id,r=n.size();return new Promise(function(i,s){var a={value:s},c={value:function(){--r===0&&i()}};n.each(function(){var u=me(this,o),f=u.on;f!==e&&(t=(e=f).copy(),t._.cancel.push(a),t._.interrupt.push(a),t._.end.push(c)),u.on=t}),r===0&&i()})}var su=0;function be(e,t,n,o){this._groups=e,this._parents=t,this._name=n,this._id=o}function Cr(){return++su}var xe=dt.prototype;be.prototype={constructor:be,select:Bl,selectAll:Hl,selectChild:xe.selectChild,selectChildren:xe.selectChildren,filter:jl,merge:Fl,selection:Ol,transition:ru,call:xe.call,nodes:xe.nodes,node:xe.node,size:xe.size,empty:xe.empty,each:xe.each,on:Dl,attr:yl,attrTween:El,style:ql,styleTween:Zl,text:eu,textTween:ou,remove:Ll,tween:ul,delay:Cl,duration:Ml,ease:Al,easeVarying:Pl,end:iu,[Symbol.iterator]:xe[Symbol.iterator]};function au(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var cu={time:null,delay:0,duration:250,ease:au};function lu(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}function uu(e){var t,n;e instanceof be?(t=e._id,e=e._name):(t=Cr(),(n=cu).time=In(),e=e==null?null:e+"");for(var o=this._groups,r=o.length,i=0;i<r;++i)for(var s=o[i],a=s.length,c,u=0;u<a;++u)(c=s[u])&&Ht(c,e,t,u,s,n||lu(c,t));return new be(o,this._parents,e,t)}dt.prototype.interrupt=al;dt.prototype.transition=uu;const vt=e=>()=>e;function du(e,{sourceEvent:t,target:n,transform:o,dispatch:r}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:o,enumerable:!0,configurable:!0},_:{value:r}})}function we(e,t,n){this.k=e,this.x=t,this.y=n}we.prototype={constructor:we,scale:function(e){return e===1?this:new we(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new we(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Vt=new we(1,0,0);Nr.prototype=we.prototype;function Nr(e){for(;!e.__zoom;)if(!(e=e.parentNode))return Vt;return e.__zoom}function nn(e){e.stopImmediatePropagation()}function et(e){e.preventDefault(),e.stopImmediatePropagation()}function fu(e){return(!e.ctrlKey||e.type==="wheel")&&!e.button}function hu(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function ao(){return this.__zoom||Vt}function gu(e){return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function pu(){return navigator.maxTouchPoints||"ontouchstart"in this}function mu(e,t,n){var o=e.invertX(t[0][0])-n[0][0],r=e.invertX(t[1][0])-n[1][0],i=e.invertY(t[0][1])-n[0][1],s=e.invertY(t[1][1])-n[1][1];return e.translate(r>o?(o+r)/2:Math.min(0,o)||Math.max(0,r),s>i?(i+s)/2:Math.min(0,i)||Math.max(0,s))}function kr(){var e=fu,t=hu,n=mu,o=gu,r=pu,i=[0,1/0],s=[[-1/0,-1/0],[1/0,1/0]],a=250,c=Ct,u=Rt("start","zoom","end"),f,l,d,p=500,g=150,x=0,v=10;function m(E){E.property("__zoom",ao).on("wheel.zoom",F,{passive:!1}).on("mousedown.zoom",T).on("dblclick.zoom",H).filter(r).on("touchstart.zoom",A).on("touchmove.zoom",j).on("touchend.zoom touchcancel.zoom",B).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}m.transform=function(E,z,C,P){var M=E.selection?E.selection():E;M.property("__zoom",ao),E!==M?_(E,z,C,P):M.interrupt().each(function(){S(this,arguments).event(P).start().zoom(null,typeof z=="function"?z.apply(this,arguments):z).end()})},m.scaleBy=function(E,z,C,P){m.scaleTo(E,function(){var M=this.__zoom.k,k=typeof z=="function"?z.apply(this,arguments):z;return M*k},C,P)},m.scaleTo=function(E,z,C,P){m.transform(E,function(){var M=t.apply(this,arguments),k=this.__zoom,D=C==null?w(M):typeof C=="function"?C.apply(this,arguments):C,L=k.invert(D),R=typeof z=="function"?z.apply(this,arguments):z;return n(h(b(k,R),D,L),M,s)},C,P)},m.translateBy=function(E,z,C,P){m.transform(E,function(){return n(this.__zoom.translate(typeof z=="function"?z.apply(this,arguments):z,typeof C=="function"?C.apply(this,arguments):C),t.apply(this,arguments),s)},null,P)},m.translateTo=function(E,z,C,P,M){m.transform(E,function(){var k=t.apply(this,arguments),D=this.__zoom,L=P==null?w(k):typeof P=="function"?P.apply(this,arguments):P;return n(Vt.translate(L[0],L[1]).scale(D.k).translate(typeof z=="function"?-z.apply(this,arguments):-z,typeof C=="function"?-C.apply(this,arguments):-C),k,s)},P,M)};function b(E,z){return z=Math.max(i[0],Math.min(i[1],z)),z===E.k?E:new we(z,E.x,E.y)}function h(E,z,C){var P=z[0]-C[0]*E.k,M=z[1]-C[1]*E.k;return P===E.x&&M===E.y?E:new we(E.k,P,M)}function w(E){return[(+E[0][0]+ +E[1][0])/2,(+E[0][1]+ +E[1][1])/2]}function _(E,z,C,P){E.on("start.zoom",function(){S(this,arguments).event(P).start()}).on("interrupt.zoom end.zoom",function(){S(this,arguments).event(P).end()}).tween("zoom",function(){var M=this,k=arguments,D=S(M,k).event(P),L=t.apply(M,k),R=C==null?w(L):typeof C=="function"?C.apply(M,k):C,W=Math.max(L[1][0]-L[0][0],L[1][1]-L[0][1]),X=M.__zoom,$=typeof z=="function"?z.apply(M,k):z,O=c(X.invert(R).concat(W/X.k),$.invert(R).concat(W/$.k));return function(Y){if(Y===1)Y=$;else{var V=O(Y),G=W/V[2];Y=new we(G,R[0]-V[0]*G,R[1]-V[1]*G)}D.zoom(null,Y)}})}function S(E,z,C){return!C&&E.__zooming||new N(E,z)}function N(E,z){this.that=E,this.args=z,this.active=0,this.sourceEvent=null,this.extent=t.apply(E,z),this.taps=0}N.prototype={event:function(E){return E&&(this.sourceEvent=E),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(E,z){return this.mouse&&E!=="mouse"&&(this.mouse[1]=z.invert(this.mouse[0])),this.touch0&&E!=="touch"&&(this.touch0[1]=z.invert(this.touch0[0])),this.touch1&&E!=="touch"&&(this.touch1[1]=z.invert(this.touch1[0])),this.that.__zoom=z,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(E){var z=ce(this.that).datum();u.call(E,this.that,new du(E,{sourceEvent:this.sourceEvent,target:m,transform:this.that.__zoom,dispatch:u}),z)}};function F(E,...z){if(!e.apply(this,arguments))return;var C=S(this,z).event(E),P=this.__zoom,M=Math.max(i[0],Math.min(i[1],P.k*Math.pow(2,o.apply(this,arguments)))),k=ue(E);if(C.wheel)(C.mouse[0][0]!==k[0]||C.mouse[0][1]!==k[1])&&(C.mouse[1]=P.invert(C.mouse[0]=k)),clearTimeout(C.wheel);else{if(P.k===M)return;C.mouse=[k,P.invert(k)],It(this),C.start()}et(E),C.wheel=setTimeout(D,g),C.zoom("mouse",n(h(b(P,M),C.mouse[0],C.mouse[1]),C.extent,s));function D(){C.wheel=null,C.end()}}function T(E,...z){if(d||!e.apply(this,arguments))return;var C=E.currentTarget,P=S(this,z,!0).event(E),M=ce(E.view).on("mousemove.zoom",R,!0).on("mouseup.zoom",W,!0),k=ue(E,C),D=E.clientX,L=E.clientY;mr(E.view),nn(E),P.mouse=[k,this.__zoom.invert(k)],It(this),P.start();function R(X){if(et(X),!P.moved){var $=X.clientX-D,O=X.clientY-L;P.moved=$*$+O*O>x}P.event(X).zoom("mouse",n(h(P.that.__zoom,P.mouse[0]=ue(X,C),P.mouse[1]),P.extent,s))}function W(X){M.on("mousemove.zoom mouseup.zoom",null),yr(X.view,P.moved),et(X),P.event(X).end()}}function H(E,...z){if(e.apply(this,arguments)){var C=this.__zoom,P=ue(E.changedTouches?E.changedTouches[0]:E,this),M=C.invert(P),k=C.k*(E.shiftKey?.5:2),D=n(h(b(C,k),P,M),t.apply(this,z),s);et(E),a>0?ce(this).transition().duration(a).call(_,D,P,E):ce(this).call(m.transform,D,P,E)}}function A(E,...z){if(e.apply(this,arguments)){var C=E.touches,P=C.length,M=S(this,z,E.changedTouches.length===P).event(E),k,D,L,R;for(nn(E),D=0;D<P;++D)L=C[D],R=ue(L,this),R=[R,this.__zoom.invert(R),L.identifier],M.touch0?!M.touch1&&M.touch0[2]!==R[2]&&(M.touch1=R,M.taps=0):(M.touch0=R,k=!0,M.taps=1+!!f);f&&(f=clearTimeout(f)),k&&(M.taps<2&&(l=R[0],f=setTimeout(function(){f=null},p)),It(this),M.start())}}function j(E,...z){if(this.__zooming){var C=S(this,z).event(E),P=E.changedTouches,M=P.length,k,D,L,R;for(et(E),k=0;k<M;++k)D=P[k],L=ue(D,this),C.touch0&&C.touch0[2]===D.identifier?C.touch0[0]=L:C.touch1&&C.touch1[2]===D.identifier&&(C.touch1[0]=L);if(D=C.that.__zoom,C.touch1){var W=C.touch0[0],X=C.touch0[1],$=C.touch1[0],O=C.touch1[1],Y=(Y=$[0]-W[0])*Y+(Y=$[1]-W[1])*Y,V=(V=O[0]-X[0])*V+(V=O[1]-X[1])*V;D=b(D,Math.sqrt(Y/V)),L=[(W[0]+$[0])/2,(W[1]+$[1])/2],R=[(X[0]+O[0])/2,(X[1]+O[1])/2]}else if(C.touch0)L=C.touch0[0],R=C.touch0[1];else return;C.zoom("touch",n(h(D,L,R),C.extent,s))}}function B(E,...z){if(this.__zooming){var C=S(this,z).event(E),P=E.changedTouches,M=P.length,k,D;for(nn(E),d&&clearTimeout(d),d=setTimeout(function(){d=null},p),k=0;k<M;++k)D=P[k],C.touch0&&C.touch0[2]===D.identifier?delete C.touch0:C.touch1&&C.touch1[2]===D.identifier&&delete C.touch1;if(C.touch1&&!C.touch0&&(C.touch0=C.touch1,delete C.touch1),C.touch0)C.touch0[1]=this.__zoom.invert(C.touch0[0]);else if(C.end(),C.taps===2&&(D=ue(D,this),Math.hypot(l[0]-D[0],l[1]-D[1])<v)){var L=ce(this).on("dblclick.zoom");L&&L.apply(this,arguments)}}}return m.wheelDelta=function(E){return arguments.length?(o=typeof E=="function"?E:vt(+E),m):o},m.filter=function(E){return arguments.length?(e=typeof E=="function"?E:vt(!!E),m):e},m.touchable=function(E){return arguments.length?(r=typeof E=="function"?E:vt(!!E),m):r},m.extent=function(E){return arguments.length?(t=typeof E=="function"?E:vt([[+E[0][0],+E[0][1]],[+E[1][0],+E[1][1]]]),m):t},m.scaleExtent=function(E){return arguments.length?(i[0]=+E[0],i[1]=+E[1],m):[i[0],i[1]]},m.translateExtent=function(E){return arguments.length?(s[0][0]=+E[0][0],s[1][0]=+E[1][0],s[0][1]=+E[0][1],s[1][1]=+E[1][1],m):[[s[0][0],s[0][1]],[s[1][0],s[1][1]]]},m.constrain=function(E){return arguments.length?(n=E,m):n},m.duration=function(E){return arguments.length?(a=+E,m):a},m.interpolate=function(E){return arguments.length?(c=E,m):c},m.on=function(){var E=u.on.apply(u,arguments);return E===u?m:E},m.clickDistance=function(E){return arguments.length?(x=(E=+E)*E,m):Math.sqrt(x)},m.tapDistance=function(E){return arguments.length?(v=+E,m):v},m}const pe={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:e=>`Node type "${e}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:e=>`The old edge with id=${e} does not exist.`,error009:e=>`Marker type "${e}" doesn't exist.`,error008:(e,{id:t,sourceHandle:n,targetHandle:o})=>`Couldn't create edge for ${e} handle id: "${e==="source"?n:o}", edge id: ${t}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:e=>`Edge type "${e}" not found. Using fallback type "default".`,error012:e=>`Node with id "${e}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`,error013:(e="react")=>`It seems that you haven't loaded the styles. Please import '@xyflow/${e}/dist/style.css' or base.css to make sure everything is working properly.`,error014:()=>"useNodeConnections: No node ID found. Call useNodeConnections inside a custom Node or provide a node ID.",error015:()=>"It seems that you are trying to drag a node that is not initialized. Please use onNodesChange as explained in the docs."},st=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],Mr=["Enter"," ","Escape"],Ir={"node.a11yDescription.default":"Press enter or space to select a node. Press delete to remove it and escape to cancel.","node.a11yDescription.keyboardDisabled":"Press enter or space to select a node. You can then use the arrow keys to move the node around. Press delete to remove it and escape to cancel.","node.a11yDescription.ariaLiveMessage":({direction:e,x:t,y:n})=>`Moved selected node ${e}. New position, x: ${t}, y: ${n}`,"edge.a11yDescription.default":"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel.","controls.ariaLabel":"Control Panel","controls.zoomIn.ariaLabel":"Zoom In","controls.zoomOut.ariaLabel":"Zoom Out","controls.fitView.ariaLabel":"Fit View","controls.interactive.ariaLabel":"Toggle Interactivity","minimap.ariaLabel":"Mini Map","handle.ariaLabel":"Handle"};var Oe;(function(e){e.Strict="strict",e.Loose="loose"})(Oe||(Oe={}));var Ae;(function(e){e.Free="free",e.Vertical="vertical",e.Horizontal="horizontal"})(Ae||(Ae={}));var at;(function(e){e.Partial="partial",e.Full="full"})(at||(at={}));const Ar={inProgress:!1,isValid:null,from:null,fromHandle:null,fromPosition:null,fromNode:null,to:null,toHandle:null,toPosition:null,toNode:null,pointer:null};var Ne;(function(e){e.Bezier="default",e.Straight="straight",e.Step="step",e.SmoothStep="smoothstep",e.SimpleBezier="simplebezier"})(Ne||(Ne={}));var Ft;(function(e){e.Arrow="arrow",e.ArrowClosed="arrowclosed"})(Ft||(Ft={}));var q;(function(e){e.Left="left",e.Top="top",e.Right="right",e.Bottom="bottom"})(q||(q={}));const co={[q.Left]:q.Right,[q.Right]:q.Left,[q.Top]:q.Bottom,[q.Bottom]:q.Top};function zr(e){return e===null?null:e?"valid":"invalid"}const Pr=e=>"id"in e&&"source"in e&&"target"in e,yu=e=>"id"in e&&"position"in e&&!("source"in e)&&!("target"in e),Pn=e=>"id"in e&&"internals"in e&&!("source"in e)&&!("target"in e),ft=(e,t=[0,0])=>{const{width:n,height:o}=Ee(e),r=e.origin??t,i=n*r[0],s=o*r[1];return{x:e.position.x-i,y:e.position.y-s}},xu=(e,t={nodeOrigin:[0,0]})=>{if(e.length===0)return{x:0,y:0,width:0,height:0};const n=e.reduce((o,r)=>{const i=typeof r=="string";let s=!t.nodeLookup&&!i?r:void 0;t.nodeLookup&&(s=i?t.nodeLookup.get(r):Pn(r)?r:t.nodeLookup.get(r.id));const a=s?Tt(s,t.nodeOrigin):{x:0,y:0,x2:0,y2:0};return Ot(o,a)},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return Wt(n)},ht=(e,t={})=>{let n={x:1/0,y:1/0,x2:-1/0,y2:-1/0},o=!1;return e.forEach(r=>{(t.filter===void 0||t.filter(r))&&(n=Ot(n,Tt(r)),o=!0)}),o?Wt(n):{x:0,y:0,width:0,height:0}},jn=(e,t,[n,o,r]=[0,0,1],i=!1,s=!1)=>{const a={...pt(t,[n,o,r]),width:t.width/r,height:t.height/r},c=[];for(const u of e.values()){const{measured:f,selectable:l=!0,hidden:d=!1}=u;if(s&&!l||d)continue;const p=f.width??u.width??u.initialWidth??null,g=f.height??u.height??u.initialHeight??null,x=ct(a,Ye(u)),v=(p??0)*(g??0),m=i&&x>0;(!u.internals.handleBounds||m||x>=v||u.dragging)&&c.push(u)}return c},wu=(e,t)=>{const n=new Set;return e.forEach(o=>{n.add(o.id)}),t.filter(o=>n.has(o.source)||n.has(o.target))};function vu(e,t){const n=new Map,o=t!=null&&t.nodes?new Set(t.nodes.map(r=>r.id)):null;return e.forEach(r=>{r.measured.width&&r.measured.height&&((t==null?void 0:t.includeHiddenNodes)||!r.hidden)&&(!o||o.has(r.id))&&n.set(r.id,r)}),n}async function bu({nodes:e,width:t,height:n,panZoom:o,minZoom:r,maxZoom:i},s){if(e.size===0)return Promise.resolve(!0);const a=vu(e,s),c=ht(a),u=Fn(c,t,n,(s==null?void 0:s.minZoom)??r,(s==null?void 0:s.maxZoom)??i,(s==null?void 0:s.padding)??.1);return await o.setViewport(u,{duration:s==null?void 0:s.duration,ease:s==null?void 0:s.ease,interpolate:s==null?void 0:s.interpolate}),Promise.resolve(!0)}function jr({nodeId:e,nextPosition:t,nodeLookup:n,nodeOrigin:o=[0,0],nodeExtent:r,onError:i}){const s=n.get(e),a=s.parentId?n.get(s.parentId):void 0,{x:c,y:u}=a?a.internals.positionAbsolute:{x:0,y:0},f=s.origin??o;let l=s.extent||r;if(s.extent==="parent"&&!s.expandParent)if(!a)i==null||i("005",pe.error005());else{const p=a.measured.width,g=a.measured.height;p&&g&&(l=[[c,u],[c+p,u+g]])}else a&&Xe(s.extent)&&(l=[[s.extent[0][0]+c,s.extent[0][1]+u],[s.extent[1][0]+c,s.extent[1][1]+u]]);const d=Xe(l)?Pe(t,l,s.measured):t;return(s.measured.width===void 0||s.measured.height===void 0)&&(i==null||i("015",pe.error015())),{position:{x:d.x-c+(s.measured.width??0)*f[0],y:d.y-u+(s.measured.height??0)*f[1]},positionAbsolute:d}}async function Eu({nodesToRemove:e=[],edgesToRemove:t=[],nodes:n,edges:o,onBeforeDelete:r}){const i=new Set(e.map(d=>d.id)),s=[];for(const d of n){if(d.deletable===!1)continue;const p=i.has(d.id),g=!p&&d.parentId&&s.find(x=>x.id===d.parentId);(p||g)&&s.push(d)}const a=new Set(t.map(d=>d.id)),c=o.filter(d=>d.deletable!==!1),f=wu(s,c);for(const d of c)a.has(d.id)&&!f.find(g=>g.id===d.id)&&f.push(d);if(!r)return{edges:f,nodes:s};const l=await r({nodes:s,edges:f});return typeof l=="boolean"?l?{edges:f,nodes:s}:{edges:[],nodes:[]}:l}const We=(e,t=0,n=1)=>Math.min(Math.max(e,t),n),Pe=(e={x:0,y:0},t,n)=>({x:We(e.x,t[0][0],t[1][0]-((n==null?void 0:n.width)??0)),y:We(e.y,t[0][1],t[1][1]-((n==null?void 0:n.height)??0))});function Fr(e,t,n){const{width:o,height:r}=Ee(n),{x:i,y:s}=n.internals.positionAbsolute;return Pe(e,[[i,s],[i+o,s+r]],t)}const lo=(e,t,n)=>e<t?We(Math.abs(e-t),1,t)/t:e>n?-We(Math.abs(e-n),1,t)/t:0,Tr=(e,t,n=15,o=40)=>{const r=lo(e.x,o,t.width-o)*n,i=lo(e.y,o,t.height-o)*n;return[r,i]},Ot=(e,t)=>({x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),x2:Math.max(e.x2,t.x2),y2:Math.max(e.y2,t.y2)}),wn=({x:e,y:t,width:n,height:o})=>({x:e,y:t,x2:e+n,y2:t+o}),Wt=({x:e,y:t,x2:n,y2:o})=>({x:e,y:t,width:n-e,height:o-t}),Ye=(e,t=[0,0])=>{var r,i;const{x:n,y:o}=Pn(e)?e.internals.positionAbsolute:ft(e,t);return{x:n,y:o,width:((r=e.measured)==null?void 0:r.width)??e.width??e.initialWidth??0,height:((i=e.measured)==null?void 0:i.height)??e.height??e.initialHeight??0}},Tt=(e,t=[0,0])=>{var r,i;const{x:n,y:o}=Pn(e)?e.internals.positionAbsolute:ft(e,t);return{x:n,y:o,x2:n+(((r=e.measured)==null?void 0:r.width)??e.width??e.initialWidth??0),y2:o+(((i=e.measured)==null?void 0:i.height)??e.height??e.initialHeight??0)}},$r=(e,t)=>Wt(Ot(wn(e),wn(t))),ct=(e,t)=>{const n=Math.max(0,Math.min(e.x+e.width,t.x+t.width)-Math.max(e.x,t.x)),o=Math.max(0,Math.min(e.y+e.height,t.y+t.height)-Math.max(e.y,t.y));return Math.ceil(n*o)},uo=e=>de(e.width)&&de(e.height)&&de(e.x)&&de(e.y),de=e=>!isNaN(e)&&isFinite(e),Su=(e,t)=>{},gt=(e,t=[1,1])=>({x:t[0]*Math.round(e.x/t[0]),y:t[1]*Math.round(e.y/t[1])}),pt=({x:e,y:t},[n,o,r],i=!1,s=[1,1])=>{const a={x:(e-n)/r,y:(t-o)/r};return i?gt(a,s):a},$t=({x:e,y:t},[n,o,r])=>({x:e*r+n,y:t*r+o});function Te(e,t){if(typeof e=="number")return Math.floor((t-t/(1+e))*.5);if(typeof e=="string"&&e.endsWith("px")){const n=parseFloat(e);if(!Number.isNaN(n))return Math.floor(n)}if(typeof e=="string"&&e.endsWith("%")){const n=parseFloat(e);if(!Number.isNaN(n))return Math.floor(t*n*.01)}return console.error(`[React Flow] The padding value "${e}" is invalid. Please provide a number or a string with a valid unit (px or %).`),0}function _u(e,t,n){if(typeof e=="string"||typeof e=="number"){const o=Te(e,n),r=Te(e,t);return{top:o,right:r,bottom:o,left:r,x:r*2,y:o*2}}if(typeof e=="object"){const o=Te(e.top??e.y??0,n),r=Te(e.bottom??e.y??0,n),i=Te(e.left??e.x??0,t),s=Te(e.right??e.x??0,t);return{top:o,right:s,bottom:r,left:i,x:i+s,y:o+r}}return{top:0,right:0,bottom:0,left:0,x:0,y:0}}function Cu(e,t,n,o,r,i){const{x:s,y:a}=$t(e,[t,n,o]),{x:c,y:u}=$t({x:e.x+e.width,y:e.y+e.height},[t,n,o]),f=r-c,l=i-u;return{left:Math.floor(s),top:Math.floor(a),right:Math.floor(f),bottom:Math.floor(l)}}const Fn=(e,t,n,o,r,i)=>{const s=_u(i,t,n),a=(t-s.x)/e.width,c=(n-s.y)/e.height,u=Math.min(a,c),f=We(u,o,r),l=e.x+e.width/2,d=e.y+e.height/2,p=t/2-l*f,g=n/2-d*f,x=Cu(e,p,g,f,t,n),v={left:Math.min(x.left-s.left,0),top:Math.min(x.top-s.top,0),right:Math.min(x.right-s.right,0),bottom:Math.min(x.bottom-s.bottom,0)};return{x:p-v.left+v.right,y:g-v.top+v.bottom,zoom:f}},lt=()=>{var e;return typeof navigator<"u"&&((e=navigator==null?void 0:navigator.userAgent)==null?void 0:e.indexOf("Mac"))>=0};function Xe(e){return e!=null&&e!=="parent"}function Ee(e){var t,n;return{width:((t=e.measured)==null?void 0:t.width)??e.width??e.initialWidth??0,height:((n=e.measured)==null?void 0:n.height)??e.height??e.initialHeight??0}}function Dr(e){var t,n;return(((t=e.measured)==null?void 0:t.width)??e.width??e.initialWidth)!==void 0&&(((n=e.measured)==null?void 0:n.height)??e.height??e.initialHeight)!==void 0}function Rr(e,t={width:0,height:0},n,o,r){const i={...e},s=o.get(n);if(s){const a=s.origin||r;i.x+=s.internals.positionAbsolute.x-(t.width??0)*a[0],i.y+=s.internals.positionAbsolute.y-(t.height??0)*a[1]}return i}function fo(e,t){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}function Nu(){let e,t;return{promise:new Promise((o,r)=>{e=o,t=r}),resolve:e,reject:t}}function ku(e){return{...Ir,...e||{}}}function ot(e,{snapGrid:t=[0,0],snapToGrid:n=!1,transform:o,containerBounds:r}){const{x:i,y:s}=fe(e),a=pt({x:i-((r==null?void 0:r.left)??0),y:s-((r==null?void 0:r.top)??0)},o),{x:c,y:u}=n?gt(a,t):a;return{xSnapped:c,ySnapped:u,...a}}const Tn=e=>({width:e.offsetWidth,height:e.offsetHeight}),Lr=e=>{var t;return((t=e==null?void 0:e.getRootNode)==null?void 0:t.call(e))||(window==null?void 0:window.document)},Mu=["INPUT","SELECT","TEXTAREA"];function Br(e){var o,r;const t=((r=(o=e.composedPath)==null?void 0:o.call(e))==null?void 0:r[0])||e.target;return(t==null?void 0:t.nodeType)!==1?!1:Mu.includes(t.nodeName)||t.hasAttribute("contenteditable")||!!t.closest(".nokey")}const Hr=e=>"clientX"in e,fe=(e,t)=>{var i,s;const n=Hr(e),o=n?e.clientX:(i=e.touches)==null?void 0:i[0].clientX,r=n?e.clientY:(s=e.touches)==null?void 0:s[0].clientY;return{x:o-((t==null?void 0:t.left)??0),y:r-((t==null?void 0:t.top)??0)}},ho=(e,t,n,o,r)=>{const i=t.querySelectorAll(`.${e}`);return!i||!i.length?null:Array.from(i).map(s=>{const a=s.getBoundingClientRect();return{id:s.getAttribute("data-handleid"),type:e,nodeId:r,position:s.getAttribute("data-handlepos"),x:(a.left-n.left)/o,y:(a.top-n.top)/o,...Tn(s)}})};function Vr({sourceX:e,sourceY:t,targetX:n,targetY:o,sourceControlX:r,sourceControlY:i,targetControlX:s,targetControlY:a}){const c=e*.125+r*.375+s*.375+n*.125,u=t*.125+i*.375+a*.375+o*.125,f=Math.abs(c-e),l=Math.abs(u-t);return[c,u,f,l]}function bt(e,t){return e>=0?.5*e:t*25*Math.sqrt(-e)}function go({pos:e,x1:t,y1:n,x2:o,y2:r,c:i}){switch(e){case q.Left:return[t-bt(t-o,i),n];case q.Right:return[t+bt(o-t,i),n];case q.Top:return[t,n-bt(n-r,i)];case q.Bottom:return[t,n+bt(r-n,i)]}}function Or({sourceX:e,sourceY:t,sourcePosition:n=q.Bottom,targetX:o,targetY:r,targetPosition:i=q.Top,curvature:s=.25}){const[a,c]=go({pos:n,x1:e,y1:t,x2:o,y2:r,c:s}),[u,f]=go({pos:i,x1:o,y1:r,x2:e,y2:t,c:s}),[l,d,p,g]=Vr({sourceX:e,sourceY:t,targetX:o,targetY:r,sourceControlX:a,sourceControlY:c,targetControlX:u,targetControlY:f});return[`M${e},${t} C${a},${c} ${u},${f} ${o},${r}`,l,d,p,g]}function Wr({sourceX:e,sourceY:t,targetX:n,targetY:o}){const r=Math.abs(n-e)/2,i=n<e?n+r:n-r,s=Math.abs(o-t)/2,a=o<t?o+s:o-s;return[i,a,r,s]}function Iu({sourceNode:e,targetNode:t,selected:n=!1,zIndex:o=0,elevateOnSelect:r=!1,zIndexMode:i="basic"}){if(i==="manual")return o;const s=r&&n?o+1e3:o,a=Math.max(e.parentId||r&&e.selected?e.internals.z:0,t.parentId||r&&t.selected?t.internals.z:0);return s+a}function Au({sourceNode:e,targetNode:t,width:n,height:o,transform:r}){const i=Ot(Tt(e),Tt(t));i.x===i.x2&&(i.x2+=1),i.y===i.y2&&(i.y2+=1);const s={x:-r[0]/r[2],y:-r[1]/r[2],width:n/r[2],height:o/r[2]};return ct(s,Wt(i))>0}const zu=({source:e,sourceHandle:t,target:n,targetHandle:o})=>`xy-edge__${e}${t||""}-${n}${o||""}`,Pu=(e,t)=>t.some(n=>n.source===e.source&&n.target===e.target&&(n.sourceHandle===e.sourceHandle||!n.sourceHandle&&!e.sourceHandle)&&(n.targetHandle===e.targetHandle||!n.targetHandle&&!e.targetHandle)),Yr=(e,t,n={})=>{if(!e.source||!e.target)return t;const o=n.getEdgeId||zu;let r;return Pr(e)?r={...e}:r={...e,id:o(e)},Pu(r,t)?t:(r.sourceHandle===null&&delete r.sourceHandle,r.targetHandle===null&&delete r.targetHandle,t.concat(r))};function Xr({sourceX:e,sourceY:t,targetX:n,targetY:o}){const[r,i,s,a]=Wr({sourceX:e,sourceY:t,targetX:n,targetY:o});return[`M ${e},${t}L ${n},${o}`,r,i,s,a]}const po={[q.Left]:{x:-1,y:0},[q.Right]:{x:1,y:0},[q.Top]:{x:0,y:-1},[q.Bottom]:{x:0,y:1}},ju=({source:e,sourcePosition:t=q.Bottom,target:n})=>t===q.Left||t===q.Right?e.x<n.x?{x:1,y:0}:{x:-1,y:0}:e.y<n.y?{x:0,y:1}:{x:0,y:-1},mo=(e,t)=>Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2));function Fu({source:e,sourcePosition:t=q.Bottom,target:n,targetPosition:o=q.Top,center:r,offset:i,stepPosition:s}){const a=po[t],c=po[o],u={x:e.x+a.x*i,y:e.y+a.y*i},f={x:n.x+c.x*i,y:n.y+c.y*i},l=ju({source:u,sourcePosition:t,target:f}),d=l.x!==0?"x":"y",p=l[d];let g=[],x,v;const m={x:0,y:0},b={x:0,y:0},[,,h,w]=Wr({sourceX:e.x,sourceY:e.y,targetX:n.x,targetY:n.y});if(a[d]*c[d]===-1){d==="x"?(x=r.x??u.x+(f.x-u.x)*s,v=r.y??(u.y+f.y)/2):(x=r.x??(u.x+f.x)/2,v=r.y??u.y+(f.y-u.y)*s);const S=[{x,y:u.y},{x,y:f.y}],N=[{x:u.x,y:v},{x:f.x,y:v}];a[d]===p?g=d==="x"?S:N:g=d==="x"?N:S}else{const S=[{x:u.x,y:f.y}],N=[{x:f.x,y:u.y}];if(d==="x"?g=a.x===p?N:S:g=a.y===p?S:N,t===o){const j=Math.abs(e[d]-n[d]);if(j<=i){const B=Math.min(i-1,i-j);a[d]===p?m[d]=(u[d]>e[d]?-1:1)*B:b[d]=(f[d]>n[d]?-1:1)*B}}if(t!==o){const j=d==="x"?"y":"x",B=a[d]===c[j],E=u[j]>f[j],z=u[j]<f[j];(a[d]===1&&(!B&&E||B&&z)||a[d]!==1&&(!B&&z||B&&E))&&(g=d==="x"?S:N)}const F={x:u.x+m.x,y:u.y+m.y},T={x:f.x+b.x,y:f.y+b.y},H=Math.max(Math.abs(F.x-g[0].x),Math.abs(T.x-g[0].x)),A=Math.max(Math.abs(F.y-g[0].y),Math.abs(T.y-g[0].y));H>=A?(x=(F.x+T.x)/2,v=g[0].y):(x=g[0].x,v=(F.y+T.y)/2)}return[[e,{x:u.x+m.x,y:u.y+m.y},...g,{x:f.x+b.x,y:f.y+b.y},n],x,v,h,w]}function Tu(e,t,n,o){const r=Math.min(mo(e,t)/2,mo(t,n)/2,o),{x:i,y:s}=t;if(e.x===i&&i===n.x||e.y===s&&s===n.y)return`L${i} ${s}`;if(e.y===s){const u=e.x<n.x?-1:1,f=e.y<n.y?1:-1;return`L ${i+r*u},${s}Q ${i},${s} ${i},${s+r*f}`}const a=e.x<n.x?1:-1,c=e.y<n.y?-1:1;return`L ${i},${s+r*c}Q ${i},${s} ${i+r*a},${s}`}function vn({sourceX:e,sourceY:t,sourcePosition:n=q.Bottom,targetX:o,targetY:r,targetPosition:i=q.Top,borderRadius:s=5,centerX:a,centerY:c,offset:u=20,stepPosition:f=.5}){const[l,d,p,g,x]=Fu({source:{x:e,y:t},sourcePosition:n,target:{x:o,y:r},targetPosition:i,center:{x:a,y:c},offset:u,stepPosition:f});return[l.reduce((m,b,h)=>{let w="";return h>0&&h<l.length-1?w=Tu(l[h-1],b,l[h+1],s):w=`${h===0?"M":"L"}${b.x} ${b.y}`,m+=w,m},""),d,p,g,x]}function yo(e){var t;return e&&!!(e.internals.handleBounds||(t=e.handles)!=null&&t.length)&&!!(e.measured.width||e.width||e.initialWidth)}function $u(e){var l;const{sourceNode:t,targetNode:n}=e;if(!yo(t)||!yo(n))return null;const o=t.internals.handleBounds||xo(t.handles),r=n.internals.handleBounds||xo(n.handles),i=wo((o==null?void 0:o.source)??[],e.sourceHandle),s=wo(e.connectionMode===Oe.Strict?(r==null?void 0:r.target)??[]:((r==null?void 0:r.target)??[]).concat((r==null?void 0:r.source)??[]),e.targetHandle);if(!i||!s)return(l=e.onError)==null||l.call(e,"008",pe.error008(i?"target":"source",{id:e.id,sourceHandle:e.sourceHandle,targetHandle:e.targetHandle})),null;const a=(i==null?void 0:i.position)||q.Bottom,c=(s==null?void 0:s.position)||q.Top,u=je(t,i,a),f=je(n,s,c);return{sourceX:u.x,sourceY:u.y,targetX:f.x,targetY:f.y,sourcePosition:a,targetPosition:c}}function xo(e){if(!e)return null;const t=[],n=[];for(const o of e)o.width=o.width??1,o.height=o.height??1,o.type==="source"?t.push(o):o.type==="target"&&n.push(o);return{source:t,target:n}}function je(e,t,n=q.Left,o=!1){const r=((t==null?void 0:t.x)??0)+e.internals.positionAbsolute.x,i=((t==null?void 0:t.y)??0)+e.internals.positionAbsolute.y,{width:s,height:a}=t??Ee(e);if(o)return{x:r+s/2,y:i+a/2};switch((t==null?void 0:t.position)??n){case q.Top:return{x:r+s/2,y:i};case q.Right:return{x:r+s,y:i+a/2};case q.Bottom:return{x:r+s/2,y:i+a};case q.Left:return{x:r,y:i+a/2}}}function wo(e,t){return e&&(t?e.find(n=>n.id===t):e[0])||null}function bn(e,t){return e?typeof e=="string"?e:`${t?`${t}__`:""}${Object.keys(e).sort().map(o=>`${o}=${e[o]}`).join("&")}`:""}function Du(e,{id:t,defaultColor:n,defaultMarkerStart:o,defaultMarkerEnd:r}){const i=new Set;return e.reduce((s,a)=>([a.markerStart||o,a.markerEnd||r].forEach(c=>{if(c&&typeof c=="object"){const u=bn(c,t);i.has(u)||(s.push({id:u,color:c.color||n,...c}),i.add(u))}}),s),[]).sort((s,a)=>s.id.localeCompare(a.id))}const Gr=1e3,Ru=10,$n={nodeOrigin:[0,0],nodeExtent:st,elevateNodesOnSelect:!0,zIndexMode:"basic",defaults:{}},Lu={...$n,checkEquality:!0};function Dn(e,t){const n={...e};for(const o in t)t[o]!==void 0&&(n[o]=t[o]);return n}function Bu(e,t,n){const o=Dn($n,n);for(const r of e.values())if(r.parentId)Ln(r,e,t,o);else{const i=ft(r,o.nodeOrigin),s=Xe(r.extent)?r.extent:o.nodeExtent,a=Pe(i,s,Ee(r));r.internals.positionAbsolute=a}}function Hu(e,t){if(!e.handles)return e.measured?t==null?void 0:t.internals.handleBounds:void 0;const n=[],o=[];for(const r of e.handles){const i={id:r.id,width:r.width??1,height:r.height??1,nodeId:e.id,x:r.x,y:r.y,position:r.position,type:r.type};r.type==="source"?n.push(i):r.type==="target"&&o.push(i)}return{source:n,target:o}}function Rn(e){return e==="manual"}function En(e,t,n,o={}){var u,f;const r=Dn(Lu,o),i={i:0},s=new Map(t),a=r!=null&&r.elevateNodesOnSelect&&!Rn(r.zIndexMode)?Gr:0;let c=e.length>0;t.clear(),n.clear();for(const l of e){let d=s.get(l.id);if(r.checkEquality&&l===(d==null?void 0:d.internals.userNode))t.set(l.id,d);else{const p=ft(l,r.nodeOrigin),g=Xe(l.extent)?l.extent:r.nodeExtent,x=Pe(p,g,Ee(l));d={...r.defaults,...l,measured:{width:(u=l.measured)==null?void 0:u.width,height:(f=l.measured)==null?void 0:f.height},internals:{positionAbsolute:x,handleBounds:Hu(l,d),z:qr(l,a,r.zIndexMode),userNode:l}},t.set(l.id,d)}(d.measured===void 0||d.measured.width===void 0||d.measured.height===void 0)&&!d.hidden&&(c=!1),l.parentId&&Ln(d,t,n,o,i)}return c}function Vu(e,t){if(!e.parentId)return;const n=t.get(e.parentId);n?n.set(e.id,e):t.set(e.parentId,new Map([[e.id,e]]))}function Ln(e,t,n,o,r){const{elevateNodesOnSelect:i,nodeOrigin:s,nodeExtent:a,zIndexMode:c}=Dn($n,o),u=e.parentId,f=t.get(u);if(!f){console.warn(`Parent node ${u} not found. Please make sure that parent nodes are in front of their child nodes in the nodes array.`);return}Vu(e,n),r&&!f.parentId&&f.internals.rootParentIndex===void 0&&c==="auto"&&(f.internals.rootParentIndex=++r.i,f.internals.z=f.internals.z+r.i*Ru),r&&f.internals.rootParentIndex!==void 0&&(r.i=f.internals.rootParentIndex);const l=i&&!Rn(c)?Gr:0,{x:d,y:p,z:g}=Ou(e,f,s,a,l,c),{positionAbsolute:x}=e.internals,v=d!==x.x||p!==x.y;(v||g!==e.internals.z)&&t.set(e.id,{...e,internals:{...e.internals,positionAbsolute:v?{x:d,y:p}:x,z:g}})}function qr(e,t,n){const o=de(e.zIndex)?e.zIndex:0;return Rn(n)?o:o+(e.selected?t:0)}function Ou(e,t,n,o,r,i){const{x:s,y:a}=t.internals.positionAbsolute,c=Ee(e),u=ft(e,n),f=Xe(e.extent)?Pe(u,e.extent,c):u;let l=Pe({x:s+f.x,y:a+f.y},o,c);e.extent==="parent"&&(l=Fr(l,c,t));const d=qr(e,r,i),p=t.internals.z??0;return{x:l.x,y:l.y,z:p>=d?p+1:d}}function Bn(e,t,n,o=[0,0]){var s;const r=[],i=new Map;for(const a of e){const c=t.get(a.parentId);if(!c)continue;const u=((s=i.get(a.parentId))==null?void 0:s.expandedRect)??Ye(c),f=$r(u,a.rect);i.set(a.parentId,{expandedRect:f,parent:c})}return i.size>0&&i.forEach(({expandedRect:a,parent:c},u)=>{var h;const f=c.internals.positionAbsolute,l=Ee(c),d=c.origin??o,p=a.x<f.x?Math.round(Math.abs(f.x-a.x)):0,g=a.y<f.y?Math.round(Math.abs(f.y-a.y)):0,x=Math.max(l.width,Math.round(a.width)),v=Math.max(l.height,Math.round(a.height)),m=(x-l.width)*d[0],b=(v-l.height)*d[1];(p>0||g>0||m||b)&&(r.push({id:u,type:"position",position:{x:c.position.x-p+m,y:c.position.y-g+b}}),(h=n.get(u))==null||h.forEach(w=>{e.some(_=>_.id===w.id)||r.push({id:w.id,type:"position",position:{x:w.position.x+p,y:w.position.y+g}})})),(l.width<a.width||l.height<a.height||p||g)&&r.push({id:u,type:"dimensions",setAttributes:!0,dimensions:{width:x+(p?d[0]*p-m:0),height:v+(g?d[1]*g-b:0)}})}),r}function Wu(e,t,n,o,r,i,s){const a=o==null?void 0:o.querySelector(".xyflow__viewport");let c=!1;if(!a)return{changes:[],updatedInternals:c};const u=[],f=window.getComputedStyle(a),{m22:l}=new window.DOMMatrixReadOnly(f.transform),d=[];for(const p of e.values()){const g=t.get(p.id);if(!g)continue;if(g.hidden){t.set(g.id,{...g,internals:{...g.internals,handleBounds:void 0}}),c=!0;continue}const x=Tn(p.nodeElement),v=g.measured.width!==x.width||g.measured.height!==x.height;if(!!(x.width&&x.height&&(v||!g.internals.handleBounds||p.force))){const b=p.nodeElement.getBoundingClientRect(),h=Xe(g.extent)?g.extent:i;let{positionAbsolute:w}=g.internals;g.parentId&&g.extent==="parent"?w=Fr(w,x,t.get(g.parentId)):h&&(w=Pe(w,h,x));const _={...g,measured:x,internals:{...g.internals,positionAbsolute:w,handleBounds:{source:ho("source",p.nodeElement,b,l,g.id),target:ho("target",p.nodeElement,b,l,g.id)}}};t.set(g.id,_),g.parentId&&Ln(_,t,n,{nodeOrigin:r,zIndexMode:s}),c=!0,v&&(u.push({id:g.id,type:"dimensions",dimensions:x}),g.expandParent&&g.parentId&&d.push({id:g.id,parentId:g.parentId,rect:Ye(_,r)}))}}if(d.length>0){const p=Bn(d,t,n,r);u.push(...p)}return{changes:u,updatedInternals:c}}async function Yu({delta:e,panZoom:t,transform:n,translateExtent:o,width:r,height:i}){if(!t||!e.x&&!e.y)return Promise.resolve(!1);const s=await t.setViewportConstrained({x:n[0]+e.x,y:n[1]+e.y,zoom:n[2]},[[0,0],[r,i]],o),a=!!s&&(s.x!==n[0]||s.y!==n[1]||s.k!==n[2]);return Promise.resolve(a)}function vo(e,t,n,o,r,i){let s=r;const a=o.get(s)||new Map;o.set(s,a.set(n,t)),s=`${r}-${e}`;const c=o.get(s)||new Map;if(o.set(s,c.set(n,t)),i){s=`${r}-${e}-${i}`;const u=o.get(s)||new Map;o.set(s,u.set(n,t))}}function Ur(e,t,n){e.clear(),t.clear();for(const o of n){const{source:r,target:i,sourceHandle:s=null,targetHandle:a=null}=o,c={edgeId:o.id,source:r,target:i,sourceHandle:s,targetHandle:a},u=`${r}-${s}--${i}-${a}`,f=`${i}-${a}--${r}-${s}`;vo("source",c,f,e,r,s),vo("target",c,u,e,i,a),t.set(o.id,o)}}function Kr(e,t){if(!e.parentId)return!1;const n=t.get(e.parentId);return n?n.selected?!0:Kr(n,t):!1}function bo(e,t,n){var r;let o=e;do{if((r=o==null?void 0:o.matches)!=null&&r.call(o,t))return!0;if(o===n)return!1;o=o==null?void 0:o.parentElement}while(o);return!1}function Xu(e,t,n,o){const r=new Map;for(const[i,s]of e)if((s.selected||s.id===o)&&(!s.parentId||!Kr(s,e))&&(s.draggable||t&&typeof s.draggable>"u")){const a=e.get(i);a&&r.set(i,{id:i,position:a.position||{x:0,y:0},distance:{x:n.x-a.internals.positionAbsolute.x,y:n.y-a.internals.positionAbsolute.y},extent:a.extent,parentId:a.parentId,origin:a.origin,expandParent:a.expandParent,internals:{positionAbsolute:a.internals.positionAbsolute||{x:0,y:0}},measured:{width:a.measured.width??0,height:a.measured.height??0}})}return r}function on({nodeId:e,dragItems:t,nodeLookup:n,dragging:o=!0}){var s,a,c;const r=[];for(const[u,f]of t){const l=(s=n.get(u))==null?void 0:s.internals.userNode;l&&r.push({...l,position:f.position,dragging:o})}if(!e)return[r[0],r];const i=(a=n.get(e))==null?void 0:a.internals.userNode;return[i?{...i,position:((c=t.get(e))==null?void 0:c.position)||i.position,dragging:o}:r[0],r]}function Gu({dragItems:e,snapGrid:t,x:n,y:o}){const r=e.values().next().value;if(!r)return null;const i={x:n-r.distance.x,y:o-r.distance.y},s=gt(i,t);return{x:s.x-i.x,y:s.y-i.y}}function qu({onNodeMouseDown:e,getStoreItems:t,onDragStart:n,onDrag:o,onDragStop:r}){let i={x:null,y:null},s=0,a=new Map,c=!1,u={x:0,y:0},f=null,l=!1,d=null,p=!1,g=!1,x=null;function v({noDragClassName:b,handleSelector:h,domNode:w,isSelectable:_,nodeId:S,nodeClickDistance:N=0}){d=ce(w);function F({x:j,y:B}){const{nodeLookup:E,nodeExtent:z,snapGrid:C,snapToGrid:P,nodeOrigin:M,onNodeDrag:k,onSelectionDrag:D,onError:L,updateNodePositions:R}=t();i={x:j,y:B};let W=!1;const X=a.size>1,$=X&&z?wn(ht(a)):null,O=X&&P?Gu({dragItems:a,snapGrid:C,x:j,y:B}):null;for(const[Y,V]of a){if(!E.has(Y))continue;let G={x:j-V.distance.x,y:B-V.distance.y};P&&(G=O?{x:Math.round(G.x+O.x),y:Math.round(G.y+O.y)}:gt(G,C));let Q=null;if(X&&z&&!V.extent&&$){const{positionAbsolute:U}=V.internals,ne=U.x-$.x+z[0][0],oe=U.x+V.measured.width-$.x2+z[1][0],te=U.y-$.y+z[0][1],ae=U.y+V.measured.height-$.y2+z[1][1];Q=[[ne,te],[oe,ae]]}const{position:Z,positionAbsolute:K}=jr({nodeId:Y,nextPosition:G,nodeLookup:E,nodeExtent:Q||z,nodeOrigin:M,onError:L});W=W||V.position.x!==Z.x||V.position.y!==Z.y,V.position=Z,V.internals.positionAbsolute=K}if(g=g||W,!!W&&(R(a,!0),x&&(o||k||!S&&D))){const[Y,V]=on({nodeId:S,dragItems:a,nodeLookup:E});o==null||o(x,a,Y,V),k==null||k(x,Y,V),S||D==null||D(x,V)}}async function T(){if(!f)return;const{transform:j,panBy:B,autoPanSpeed:E,autoPanOnNodeDrag:z}=t();if(!z){c=!1,cancelAnimationFrame(s);return}const[C,P]=Tr(u,f,E);(C!==0||P!==0)&&(i.x=(i.x??0)-C/j[2],i.y=(i.y??0)-P/j[2],await B({x:C,y:P})&&F(i)),s=requestAnimationFrame(T)}function H(j){var X;const{nodeLookup:B,multiSelectionActive:E,nodesDraggable:z,transform:C,snapGrid:P,snapToGrid:M,selectNodesOnDrag:k,onNodeDragStart:D,onSelectionDragStart:L,unselectNodesAndEdges:R}=t();l=!0,(!k||!_)&&!E&&S&&((X=B.get(S))!=null&&X.selected||R()),_&&k&&S&&(e==null||e(S));const W=ot(j.sourceEvent,{transform:C,snapGrid:P,snapToGrid:M,containerBounds:f});if(i=W,a=Xu(B,z,W,S),a.size>0&&(n||D||!S&&L)){const[$,O]=on({nodeId:S,dragItems:a,nodeLookup:B});n==null||n(j.sourceEvent,a,$,O),D==null||D(j.sourceEvent,$,O),S||L==null||L(j.sourceEvent,O)}}const A=xr().clickDistance(N).on("start",j=>{const{domNode:B,nodeDragThreshold:E,transform:z,snapGrid:C,snapToGrid:P}=t();f=(B==null?void 0:B.getBoundingClientRect())||null,p=!1,g=!1,x=j.sourceEvent,E===0&&H(j),i=ot(j.sourceEvent,{transform:z,snapGrid:C,snapToGrid:P,containerBounds:f}),u=fe(j.sourceEvent,f)}).on("drag",j=>{const{autoPanOnNodeDrag:B,transform:E,snapGrid:z,snapToGrid:C,nodeDragThreshold:P,nodeLookup:M}=t(),k=ot(j.sourceEvent,{transform:E,snapGrid:z,snapToGrid:C,containerBounds:f});if(x=j.sourceEvent,(j.sourceEvent.type==="touchmove"&&j.sourceEvent.touches.length>1||S&&!M.has(S))&&(p=!0),!p){if(!c&&B&&l&&(c=!0,T()),!l){const D=fe(j.sourceEvent,f),L=D.x-u.x,R=D.y-u.y;Math.sqrt(L*L+R*R)>P&&H(j)}(i.x!==k.xSnapped||i.y!==k.ySnapped)&&a&&l&&(u=fe(j.sourceEvent,f),F(k))}}).on("end",j=>{if(!(!l||p)&&(c=!1,l=!1,cancelAnimationFrame(s),a.size>0)){const{nodeLookup:B,updateNodePositions:E,onNodeDragStop:z,onSelectionDragStop:C}=t();if(g&&(E(a,!1),g=!1),r||z||!S&&C){const[P,M]=on({nodeId:S,dragItems:a,nodeLookup:B,dragging:!1});r==null||r(j.sourceEvent,a,P,M),z==null||z(j.sourceEvent,P,M),S||C==null||C(j.sourceEvent,M)}}}).filter(j=>{const B=j.target;return!j.button&&(!b||!bo(B,`.${b}`,w))&&(!h||bo(B,h,w))});d.call(A)}function m(){d==null||d.on(".drag",null)}return{update:v,destroy:m}}function Uu(e,t,n){const o=[],r={x:e.x-n,y:e.y-n,width:n*2,height:n*2};for(const i of t.values())ct(r,Ye(i))>0&&o.push(i);return o}const Ku=250;function Zu(e,t,n,o){var a,c;let r=[],i=1/0;const s=Uu(e,n,t+Ku);for(const u of s){const f=[...((a=u.internals.handleBounds)==null?void 0:a.source)??[],...((c=u.internals.handleBounds)==null?void 0:c.target)??[]];for(const l of f){if(o.nodeId===l.nodeId&&o.type===l.type&&o.id===l.id)continue;const{x:d,y:p}=je(u,l,l.position,!0),g=Math.sqrt(Math.pow(d-e.x,2)+Math.pow(p-e.y,2));g>t||(g<i?(r=[{...l,x:d,y:p}],i=g):g===i&&r.push({...l,x:d,y:p}))}}if(!r.length)return null;if(r.length>1){const u=o.type==="source"?"target":"source";return r.find(f=>f.type===u)??r[0]}return r[0]}function Zr(e,t,n,o,r,i=!1){var u,f,l;const s=o.get(e);if(!s)return null;const a=r==="strict"?(u=s.internals.handleBounds)==null?void 0:u[t]:[...((f=s.internals.handleBounds)==null?void 0:f.source)??[],...((l=s.internals.handleBounds)==null?void 0:l.target)??[]],c=(n?a==null?void 0:a.find(d=>d.id===n):a==null?void 0:a[0])??null;return c&&i?{...c,...je(s,c,c.position,!0)}:c}function Qr(e,t){return e||(t!=null&&t.classList.contains("target")?"target":t!=null&&t.classList.contains("source")?"source":null)}function Qu(e,t){let n=null;return t?n=!0:e&&!t&&(n=!1),n}const Jr=()=>!0;function Ju(e,{connectionMode:t,connectionRadius:n,handleId:o,nodeId:r,edgeUpdaterType:i,isTarget:s,domNode:a,nodeLookup:c,lib:u,autoPanOnConnect:f,flowId:l,panBy:d,cancelConnection:p,onConnectStart:g,onConnect:x,onConnectEnd:v,isValidConnection:m=Jr,onReconnectEnd:b,updateConnection:h,getTransform:w,getFromHandle:_,autoPanSpeed:S,dragThreshold:N=1,handleDomNode:F}){const T=Lr(e.target);let H=0,A;const{x:j,y:B}=fe(e),E=Qr(i,F),z=a==null?void 0:a.getBoundingClientRect();let C=!1;if(!z||!E)return;const P=Zr(r,E,o,c,t);if(!P)return;let M=fe(e,z),k=!1,D=null,L=!1,R=null;function W(){if(!f||!z)return;const[Z,K]=Tr(M,z,S);d({x:Z,y:K}),H=requestAnimationFrame(W)}const X={...P,nodeId:r,type:E,position:P.position},$=c.get(r);let Y={inProgress:!0,isValid:null,from:je($,X,q.Left,!0),fromHandle:X,fromPosition:X.position,fromNode:$,to:M,toHandle:null,toPosition:co[X.position],toNode:null,pointer:M};function V(){C=!0,h(Y),g==null||g(e,{nodeId:r,handleId:o,handleType:E})}N===0&&V();function G(Z){if(!C){const{x:ae,y:Se}=fe(Z),ye=ae-j,ke=Se-B;if(!(ye*ye+ke*ke>N*N))return;V()}if(!_()||!X){Q(Z);return}const K=w();M=fe(Z,z),A=Zu(pt(M,K,!1,[1,1]),n,c,X),k||(W(),k=!0);const U=ei(Z,{handle:A,connectionMode:t,fromNodeId:r,fromHandleId:o,fromType:s?"target":"source",isValidConnection:m,doc:T,lib:u,flowId:l,nodeLookup:c});R=U.handleDomNode,D=U.connection,L=Qu(!!A,U.isValid);const ne=c.get(r),oe=ne?je(ne,X,q.Left,!0):Y.from,te={...Y,from:oe,isValid:L,to:U.toHandle&&L?$t({x:U.toHandle.x,y:U.toHandle.y},K):M,toHandle:U.toHandle,toPosition:L&&U.toHandle?U.toHandle.position:co[X.position],toNode:U.toHandle?c.get(U.toHandle.nodeId):null,pointer:M};h(te),Y=te}function Q(Z){if(!("touches"in Z&&Z.touches.length>0)){if(C){(A||R)&&D&&L&&(x==null||x(D));const{inProgress:K,...U}=Y,ne={...U,toPosition:Y.toHandle?Y.toPosition:null};v==null||v(Z,ne),i&&(b==null||b(Z,ne))}p(),cancelAnimationFrame(H),k=!1,L=!1,D=null,R=null,T.removeEventListener("mousemove",G),T.removeEventListener("mouseup",Q),T.removeEventListener("touchmove",G),T.removeEventListener("touchend",Q)}}T.addEventListener("mousemove",G),T.addEventListener("mouseup",Q),T.addEventListener("touchmove",G),T.addEventListener("touchend",Q)}function ei(e,{handle:t,connectionMode:n,fromNodeId:o,fromHandleId:r,fromType:i,doc:s,lib:a,flowId:c,isValidConnection:u=Jr,nodeLookup:f}){const l=i==="target",d=t?s.querySelector(`.${a}-flow__handle[data-id="${c}-${t==null?void 0:t.nodeId}-${t==null?void 0:t.id}-${t==null?void 0:t.type}"]`):null,{x:p,y:g}=fe(e),x=s.elementFromPoint(p,g),v=x!=null&&x.classList.contains(`${a}-flow__handle`)?x:d,m={handleDomNode:v,isValid:!1,connection:null,toHandle:null};if(v){const b=Qr(void 0,v),h=v.getAttribute("data-nodeid"),w=v.getAttribute("data-handleid"),_=v.classList.contains("connectable"),S=v.classList.contains("connectableend");if(!h||!b)return m;const N={source:l?h:o,sourceHandle:l?w:r,target:l?o:h,targetHandle:l?r:w};m.connection=N;const T=_&&S&&(n===Oe.Strict?l&&b==="source"||!l&&b==="target":h!==o||w!==r);m.isValid=T&&u(N),m.toHandle=Zr(h,b,w,f,n,!0)}return m}const Sn={onPointerDown:Ju,isValid:ei};function ed({domNode:e,panZoom:t,getTransform:n,getViewScale:o}){const r=ce(e);function i({translateExtent:a,width:c,height:u,zoomStep:f=1,pannable:l=!0,zoomable:d=!0,inversePan:p=!1}){const g=h=>{if(h.sourceEvent.type!=="wheel"||!t)return;const w=n(),_=h.sourceEvent.ctrlKey&&lt()?10:1,S=-h.sourceEvent.deltaY*(h.sourceEvent.deltaMode===1?.05:h.sourceEvent.deltaMode?1:.002)*f,N=w[2]*Math.pow(2,S*_);t.scaleTo(N)};let x=[0,0];const v=h=>{(h.sourceEvent.type==="mousedown"||h.sourceEvent.type==="touchstart")&&(x=[h.sourceEvent.clientX??h.sourceEvent.touches[0].clientX,h.sourceEvent.clientY??h.sourceEvent.touches[0].clientY])},m=h=>{const w=n();if(h.sourceEvent.type!=="mousemove"&&h.sourceEvent.type!=="touchmove"||!t)return;const _=[h.sourceEvent.clientX??h.sourceEvent.touches[0].clientX,h.sourceEvent.clientY??h.sourceEvent.touches[0].clientY],S=[_[0]-x[0],_[1]-x[1]];x=_;const N=o()*Math.max(w[2],Math.log(w[2]))*(p?-1:1),F={x:w[0]-S[0]*N,y:w[1]-S[1]*N},T=[[0,0],[c,u]];t.setViewportConstrained({x:F.x,y:F.y,zoom:w[2]},T,a)},b=kr().on("start",v).on("zoom",l?m:null).on("zoom.wheel",d?g:null);r.call(b,{})}function s(){r.on("zoom",null)}return{update:i,destroy:s,pointer:ue}}const Yt=e=>({x:e.x,y:e.y,zoom:e.k}),rn=({x:e,y:t,zoom:n})=>Vt.translate(e,t).scale(n),Re=(e,t)=>e.target.closest(`.${t}`),ti=(e,t)=>t===2&&Array.isArray(e)&&e.includes(2),td=e=>((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2,sn=(e,t=0,n=td,o=()=>{})=>{const r=typeof t=="number"&&t>0;return r||o(),r?e.transition().duration(t).ease(n).on("end",o):e},ni=e=>{const t=e.ctrlKey&&lt()?10:1;return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*t};function nd({zoomPanValues:e,noWheelClassName:t,d3Selection:n,d3Zoom:o,panOnScrollMode:r,panOnScrollSpeed:i,zoomOnPinch:s,onPanZoomStart:a,onPanZoom:c,onPanZoomEnd:u}){return f=>{if(Re(f,t))return f.ctrlKey&&f.preventDefault(),!1;f.preventDefault(),f.stopImmediatePropagation();const l=n.property("__zoom").k||1;if(f.ctrlKey&&s){const v=ue(f),m=ni(f),b=l*Math.pow(2,m);o.scaleTo(n,b,v,f);return}const d=f.deltaMode===1?20:1;let p=r===Ae.Vertical?0:f.deltaX*d,g=r===Ae.Horizontal?0:f.deltaY*d;!lt()&&f.shiftKey&&r!==Ae.Vertical&&(p=f.deltaY*d,g=0),o.translateBy(n,-(p/l)*i,-(g/l)*i,{internal:!0});const x=Yt(n.property("__zoom"));clearTimeout(e.panScrollTimeout),e.isPanScrolling?(c==null||c(f,x),e.panScrollTimeout=setTimeout(()=>{u==null||u(f,x),e.isPanScrolling=!1},150)):(e.isPanScrolling=!0,a==null||a(f,x))}}function od({noWheelClassName:e,preventScrolling:t,d3ZoomHandler:n}){return function(o,r){const i=o.type==="wheel",s=!t&&i&&!o.ctrlKey,a=Re(o,e);if(o.ctrlKey&&i&&a&&o.preventDefault(),s||a)return null;o.preventDefault(),n.call(this,o,r)}}function rd({zoomPanValues:e,onDraggingChange:t,onPanZoomStart:n}){return o=>{var i,s,a;if((i=o.sourceEvent)!=null&&i.internal)return;const r=Yt(o.transform);e.mouseButton=((s=o.sourceEvent)==null?void 0:s.button)||0,e.isZoomingOrPanning=!0,e.prevViewport=r,((a=o.sourceEvent)==null?void 0:a.type)==="mousedown"&&t(!0),n&&(n==null||n(o.sourceEvent,r))}}function id({zoomPanValues:e,panOnDrag:t,onPaneContextMenu:n,onTransformChange:o,onPanZoom:r}){return i=>{var s,a;e.usedRightMouseButton=!!(n&&ti(t,e.mouseButton??0)),(s=i.sourceEvent)!=null&&s.sync||o([i.transform.x,i.transform.y,i.transform.k]),r&&!((a=i.sourceEvent)!=null&&a.internal)&&(r==null||r(i.sourceEvent,Yt(i.transform)))}}function sd({zoomPanValues:e,panOnDrag:t,panOnScroll:n,onDraggingChange:o,onPanZoomEnd:r,onPaneContextMenu:i}){return s=>{var a;if(!((a=s.sourceEvent)!=null&&a.internal)&&(e.isZoomingOrPanning=!1,i&&ti(t,e.mouseButton??0)&&!e.usedRightMouseButton&&s.sourceEvent&&i(s.sourceEvent),e.usedRightMouseButton=!1,o(!1),r)){const c=Yt(s.transform);e.prevViewport=c,clearTimeout(e.timerId),e.timerId=setTimeout(()=>{r==null||r(s.sourceEvent,c)},n?150:0)}}}function ad({zoomActivationKeyPressed:e,zoomOnScroll:t,zoomOnPinch:n,panOnDrag:o,panOnScroll:r,zoomOnDoubleClick:i,userSelectionActive:s,noWheelClassName:a,noPanClassName:c,lib:u,connectionInProgress:f}){return l=>{var v;const d=e||t,p=n&&l.ctrlKey,g=l.type==="wheel";if(l.button===1&&l.type==="mousedown"&&(Re(l,`${u}-flow__node`)||Re(l,`${u}-flow__edge`)))return!0;if(!o&&!d&&!r&&!i&&!n||s||f&&!g||Re(l,a)&&g||Re(l,c)&&(!g||r&&g&&!e)||!n&&l.ctrlKey&&g)return!1;if(!n&&l.type==="touchstart"&&((v=l.touches)==null?void 0:v.length)>1)return l.preventDefault(),!1;if(!d&&!r&&!p&&g||!o&&(l.type==="mousedown"||l.type==="touchstart")||Array.isArray(o)&&!o.includes(l.button)&&l.type==="mousedown")return!1;const x=Array.isArray(o)&&o.includes(l.button)||!l.button||l.button<=1;return(!l.ctrlKey||g)&&x}}function cd({domNode:e,minZoom:t,maxZoom:n,translateExtent:o,viewport:r,onPanZoom:i,onPanZoomStart:s,onPanZoomEnd:a,onDraggingChange:c}){const u={isZoomingOrPanning:!1,usedRightMouseButton:!1,prevViewport:{},mouseButton:0,timerId:void 0,panScrollTimeout:void 0,isPanScrolling:!1},f=e.getBoundingClientRect(),l=kr().scaleExtent([t,n]).translateExtent(o),d=ce(e).call(l);b({x:r.x,y:r.y,zoom:We(r.zoom,t,n)},[[0,0],[f.width,f.height]],o);const p=d.on("wheel.zoom"),g=d.on("dblclick.zoom");l.wheelDelta(ni);function x(A,j){return d?new Promise(B=>{l==null||l.interpolate((j==null?void 0:j.interpolate)==="linear"?en:Ct).transform(sn(d,j==null?void 0:j.duration,j==null?void 0:j.ease,()=>B(!0)),A)}):Promise.resolve(!1)}function v({noWheelClassName:A,noPanClassName:j,onPaneContextMenu:B,userSelectionActive:E,panOnScroll:z,panOnDrag:C,panOnScrollMode:P,panOnScrollSpeed:M,preventScrolling:k,zoomOnPinch:D,zoomOnScroll:L,zoomOnDoubleClick:R,zoomActivationKeyPressed:W,lib:X,onTransformChange:$,connectionInProgress:O,paneClickDistance:Y,selectionOnDrag:V}){E&&!u.isZoomingOrPanning&&m();const G=z&&!W&&!E;l.clickDistance(V?1/0:!de(Y)||Y<0?0:Y);const Q=G?nd({zoomPanValues:u,noWheelClassName:A,d3Selection:d,d3Zoom:l,panOnScrollMode:P,panOnScrollSpeed:M,zoomOnPinch:D,onPanZoomStart:s,onPanZoom:i,onPanZoomEnd:a}):od({noWheelClassName:A,preventScrolling:k,d3ZoomHandler:p});if(d.on("wheel.zoom",Q,{passive:!1}),!E){const K=rd({zoomPanValues:u,onDraggingChange:c,onPanZoomStart:s});l.on("start",K);const U=id({zoomPanValues:u,panOnDrag:C,onPaneContextMenu:!!B,onPanZoom:i,onTransformChange:$});l.on("zoom",U);const ne=sd({zoomPanValues:u,panOnDrag:C,panOnScroll:z,onPaneContextMenu:B,onPanZoomEnd:a,onDraggingChange:c});l.on("end",ne)}const Z=ad({zoomActivationKeyPressed:W,panOnDrag:C,zoomOnScroll:L,panOnScroll:z,zoomOnDoubleClick:R,zoomOnPinch:D,userSelectionActive:E,noPanClassName:j,noWheelClassName:A,lib:X,connectionInProgress:O});l.filter(Z),R?d.on("dblclick.zoom",g):d.on("dblclick.zoom",null)}function m(){l.on("zoom",null)}async function b(A,j,B){const E=rn(A),z=l==null?void 0:l.constrain()(E,j,B);return z&&await x(z),new Promise(C=>C(z))}async function h(A,j){const B=rn(A);return await x(B,j),new Promise(E=>E(B))}function w(A){if(d){const j=rn(A),B=d.property("__zoom");(B.k!==A.zoom||B.x!==A.x||B.y!==A.y)&&(l==null||l.transform(d,j,null,{sync:!0}))}}function _(){const A=d?Nr(d.node()):{x:0,y:0,k:1};return{x:A.x,y:A.y,zoom:A.k}}function S(A,j){return d?new Promise(B=>{l==null||l.interpolate((j==null?void 0:j.interpolate)==="linear"?en:Ct).scaleTo(sn(d,j==null?void 0:j.duration,j==null?void 0:j.ease,()=>B(!0)),A)}):Promise.resolve(!1)}function N(A,j){return d?new Promise(B=>{l==null||l.interpolate((j==null?void 0:j.interpolate)==="linear"?en:Ct).scaleBy(sn(d,j==null?void 0:j.duration,j==null?void 0:j.ease,()=>B(!0)),A)}):Promise.resolve(!1)}function F(A){l==null||l.scaleExtent(A)}function T(A){l==null||l.translateExtent(A)}function H(A){const j=!de(A)||A<0?0:A;l==null||l.clickDistance(j)}return{update:v,destroy:m,setViewport:h,setViewportConstrained:b,getViewport:_,scaleTo:S,scaleBy:N,setScaleExtent:F,setTranslateExtent:T,syncViewport:w,setClickDistance:H}}var Ge;(function(e){e.Line="line",e.Handle="handle"})(Ge||(Ge={}));function ld({width:e,prevWidth:t,height:n,prevHeight:o,affectsX:r,affectsY:i}){const s=e-t,a=n-o,c=[s>0?1:s<0?-1:0,a>0?1:a<0?-1:0];return s&&r&&(c[0]=c[0]*-1),a&&i&&(c[1]=c[1]*-1),c}function Eo(e){const t=e.includes("right")||e.includes("left"),n=e.includes("bottom")||e.includes("top"),o=e.includes("left"),r=e.includes("top");return{isHorizontal:t,isVertical:n,affectsX:o,affectsY:r}}function _e(e,t){return Math.max(0,t-e)}function Ce(e,t){return Math.max(0,e-t)}function Et(e,t,n){return Math.max(0,t-e,e-n)}function So(e,t){return e?!t:t}function ud(e,t,n,o,r,i,s,a){let{affectsX:c,affectsY:u}=t;const{isHorizontal:f,isVertical:l}=t,d=f&&l,{xSnapped:p,ySnapped:g}=n,{minWidth:x,maxWidth:v,minHeight:m,maxHeight:b}=o,{x:h,y:w,width:_,height:S,aspectRatio:N}=e;let F=Math.floor(f?p-e.pointerX:0),T=Math.floor(l?g-e.pointerY:0);const H=_+(c?-F:F),A=S+(u?-T:T),j=-i[0]*_,B=-i[1]*S;let E=Et(H,x,v),z=Et(A,m,b);if(s){let M=0,k=0;c&&F<0?M=_e(h+F+j,s[0][0]):!c&&F>0&&(M=Ce(h+H+j,s[1][0])),u&&T<0?k=_e(w+T+B,s[0][1]):!u&&T>0&&(k=Ce(w+A+B,s[1][1])),E=Math.max(E,M),z=Math.max(z,k)}if(a){let M=0,k=0;c&&F>0?M=Ce(h+F,a[0][0]):!c&&F<0&&(M=_e(h+H,a[1][0])),u&&T>0?k=Ce(w+T,a[0][1]):!u&&T<0&&(k=_e(w+A,a[1][1])),E=Math.max(E,M),z=Math.max(z,k)}if(r){if(f){const M=Et(H/N,m,b)*N;if(E=Math.max(E,M),s){let k=0;!c&&!u||c&&!u&&d?k=Ce(w+B+H/N,s[1][1])*N:k=_e(w+B+(c?F:-F)/N,s[0][1])*N,E=Math.max(E,k)}if(a){let k=0;!c&&!u||c&&!u&&d?k=_e(w+H/N,a[1][1])*N:k=Ce(w+(c?F:-F)/N,a[0][1])*N,E=Math.max(E,k)}}if(l){const M=Et(A*N,x,v)/N;if(z=Math.max(z,M),s){let k=0;!c&&!u||u&&!c&&d?k=Ce(h+A*N+j,s[1][0])/N:k=_e(h+(u?T:-T)*N+j,s[0][0])/N,z=Math.max(z,k)}if(a){let k=0;!c&&!u||u&&!c&&d?k=_e(h+A*N,a[1][0])/N:k=Ce(h+(u?T:-T)*N,a[0][0])/N,z=Math.max(z,k)}}}T=T+(T<0?z:-z),F=F+(F<0?E:-E),r&&(d?H>A*N?T=(So(c,u)?-F:F)/N:F=(So(c,u)?-T:T)*N:f?(T=F/N,u=c):(F=T*N,c=u));const C=c?h+F:h,P=u?w+T:w;return{width:_+(c?-F:F),height:S+(u?-T:T),x:i[0]*F*(c?-1:1)+C,y:i[1]*T*(u?-1:1)+P}}const oi={width:0,height:0,x:0,y:0},dd={...oi,pointerX:0,pointerY:0,aspectRatio:1};function fd(e){return[[0,0],[e.measured.width,e.measured.height]]}function hd(e,t,n){const o=t.position.x+e.position.x,r=t.position.y+e.position.y,i=e.measured.width??0,s=e.measured.height??0,a=n[0]*i,c=n[1]*s;return[[o-a,r-c],[o+i-a,r+s-c]]}function gd({domNode:e,nodeId:t,getStoreItems:n,onChange:o,onEnd:r}){const i=ce(e);let s={controlDirection:Eo("bottom-right"),boundaries:{minWidth:0,minHeight:0,maxWidth:Number.MAX_VALUE,maxHeight:Number.MAX_VALUE},resizeDirection:void 0,keepAspectRatio:!1};function a({controlPosition:u,boundaries:f,keepAspectRatio:l,resizeDirection:d,onResizeStart:p,onResize:g,onResizeEnd:x,shouldResize:v}){let m={...oi},b={...dd};s={boundaries:f,resizeDirection:d,keepAspectRatio:l,controlDirection:Eo(u)};let h,w=null,_=[],S,N,F,T=!1;const H=xr().on("start",A=>{const{nodeLookup:j,transform:B,snapGrid:E,snapToGrid:z,nodeOrigin:C,paneDomNode:P}=n();if(h=j.get(t),!h)return;w=(P==null?void 0:P.getBoundingClientRect())??null;const{xSnapped:M,ySnapped:k}=ot(A.sourceEvent,{transform:B,snapGrid:E,snapToGrid:z,containerBounds:w});m={width:h.measured.width??0,height:h.measured.height??0,x:h.position.x??0,y:h.position.y??0},b={...m,pointerX:M,pointerY:k,aspectRatio:m.width/m.height},S=void 0,h.parentId&&(h.extent==="parent"||h.expandParent)&&(S=j.get(h.parentId),N=S&&h.extent==="parent"?fd(S):void 0),_=[],F=void 0;for(const[D,L]of j)if(L.parentId===t&&(_.push({id:D,position:{...L.position},extent:L.extent}),L.extent==="parent"||L.expandParent)){const R=hd(L,h,L.origin??C);F?F=[[Math.min(R[0][0],F[0][0]),Math.min(R[0][1],F[0][1])],[Math.max(R[1][0],F[1][0]),Math.max(R[1][1],F[1][1])]]:F=R}p==null||p(A,{...m})}).on("drag",A=>{const{transform:j,snapGrid:B,snapToGrid:E,nodeOrigin:z}=n(),C=ot(A.sourceEvent,{transform:j,snapGrid:B,snapToGrid:E,containerBounds:w}),P=[];if(!h)return;const{x:M,y:k,width:D,height:L}=m,R={},W=h.origin??z,{width:X,height:$,x:O,y:Y}=ud(b,s.controlDirection,C,s.boundaries,s.keepAspectRatio,W,N,F),V=X!==D,G=$!==L,Q=O!==M&&V,Z=Y!==k&&G;if(!Q&&!Z&&!V&&!G)return;if((Q||Z||W[0]===1||W[1]===1)&&(R.x=Q?O:m.x,R.y=Z?Y:m.y,m.x=R.x,m.y=R.y,_.length>0)){const oe=O-M,te=Y-k;for(const ae of _)ae.position={x:ae.position.x-oe+W[0]*(X-D),y:ae.position.y-te+W[1]*($-L)},P.push(ae)}if((V||G)&&(R.width=V&&(!s.resizeDirection||s.resizeDirection==="horizontal")?X:m.width,R.height=G&&(!s.resizeDirection||s.resizeDirection==="vertical")?$:m.height,m.width=R.width,m.height=R.height),S&&h.expandParent){const oe=W[0]*(R.width??0);R.x&&R.x<oe&&(m.x=oe,b.x=b.x-(R.x-oe));const te=W[1]*(R.height??0);R.y&&R.y<te&&(m.y=te,b.y=b.y-(R.y-te))}const K=ld({width:m.width,prevWidth:D,height:m.height,prevHeight:L,affectsX:s.controlDirection.affectsX,affectsY:s.controlDirection.affectsY}),U={...m,direction:K};(v==null?void 0:v(A,U))!==!1&&(T=!0,g==null||g(A,U),o(R,P))}).on("end",A=>{T&&(x==null||x(A,{...m}),r==null||r({...m}),T=!1)});i.call(H)}function c(){i.on(".drag",null)}return{update:a,destroy:c}}var an={exports:{}},cn={},ln={exports:{}},un={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _o;function pd(){if(_o)return un;_o=1;var e=Jo();function t(l,d){return l===d&&(l!==0||1/l===1/d)||l!==l&&d!==d}var n=typeof Object.is=="function"?Object.is:t,o=e.useState,r=e.useEffect,i=e.useLayoutEffect,s=e.useDebugValue;function a(l,d){var p=d(),g=o({inst:{value:p,getSnapshot:d}}),x=g[0].inst,v=g[1];return i(function(){x.value=p,x.getSnapshot=d,c(x)&&v({inst:x})},[l,p,d]),r(function(){return c(x)&&v({inst:x}),l(function(){c(x)&&v({inst:x})})},[l]),s(p),p}function c(l){var d=l.getSnapshot;l=l.value;try{var p=d();return!n(l,p)}catch{return!0}}function u(l,d){return d()}var f=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?u:a;return un.useSyncExternalStore=e.useSyncExternalStore!==void 0?e.useSyncExternalStore:f,un}var Co;function md(){return Co||(Co=1,ln.exports=pd()),ln.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var No;function yd(){if(No)return cn;No=1;var e=Jo(),t=md();function n(u,f){return u===f&&(u!==0||1/u===1/f)||u!==u&&f!==f}var o=typeof Object.is=="function"?Object.is:n,r=t.useSyncExternalStore,i=e.useRef,s=e.useEffect,a=e.useMemo,c=e.useDebugValue;return cn.useSyncExternalStoreWithSelector=function(u,f,l,d,p){var g=i(null);if(g.current===null){var x={hasValue:!1,value:null};g.current=x}else x=g.current;g=a(function(){function m(S){if(!b){if(b=!0,h=S,S=d(S),p!==void 0&&x.hasValue){var N=x.value;if(p(N,S))return w=N}return w=S}if(N=w,o(h,S))return N;var F=d(S);return p!==void 0&&p(N,F)?(h=S,N):(h=S,w=F)}var b=!1,h,w,_=l===void 0?null:l;return[function(){return m(f())},_===null?void 0:function(){return m(_())}]},[f,l,d,p]);var v=r(u,g[0],g[1]);return s(function(){x.hasValue=!0,x.value=v},[v]),c(v),v},cn}var ko;function xd(){return ko||(ko=1,an.exports=yd()),an.exports}var wd=xd();const vd=Ws(wd),bd={},Mo=e=>{let t;const n=new Set,o=(f,l)=>{const d=typeof f=="function"?f(t):f;if(!Object.is(d,t)){const p=t;t=l??(typeof d!="object"||d===null)?d:Object.assign({},t,d),n.forEach(g=>g(t,p))}},r=()=>t,c={setState:o,getState:r,getInitialState:()=>u,subscribe:f=>(n.add(f),()=>n.delete(f)),destroy:()=>{(bd?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}},u=t=e(o,r,c);return c},Ed=e=>e?Mo(e):Mo,{useDebugValue:Sd}=Ys,{useSyncExternalStoreWithSelector:_d}=vd,Cd=e=>e;function ri(e,t=Cd,n){const o=_d(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,n);return Sd(o),o}const Io=(e,t)=>{const n=Ed(e),o=(r,i=t)=>ri(n,r,i);return Object.assign(o,n),o},Nd=(e,t)=>e?Io(e,t):Io;function re(e,t){if(Object.is(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(const[o,r]of e)if(!Object.is(r,t.get(o)))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(const o of e)if(!t.has(o))return!1;return!0}const n=Object.keys(e);if(n.length!==Object.keys(t).length)return!1;for(const o of n)if(!Object.prototype.hasOwnProperty.call(t,o)||!Object.is(e[o],t[o]))return!1;return!0}const Xt=I.createContext(null),kd=Xt.Provider,ii=pe.error001();function ee(e,t){const n=I.useContext(Xt);if(n===null)throw new Error(ii);return ri(n,e,t)}function ie(){const e=I.useContext(Xt);if(e===null)throw new Error(ii);return I.useMemo(()=>({getState:e.getState,setState:e.setState,subscribe:e.subscribe}),[e])}const Ao={display:"none"},Md={position:"absolute",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"},si="react-flow__node-desc",ai="react-flow__edge-desc",Id="react-flow__aria-live",Ad=e=>e.ariaLiveMessage,zd=e=>e.ariaLabelConfig;function Pd({rfId:e}){const t=ee(Ad);return y.jsx("div",{id:`${Id}-${e}`,"aria-live":"assertive","aria-atomic":"true",style:Md,children:t})}function jd({rfId:e,disableKeyboardA11y:t}){const n=ee(zd);return y.jsxs(y.Fragment,{children:[y.jsx("div",{id:`${si}-${e}`,style:Ao,children:t?n["node.a11yDescription.default"]:n["node.a11yDescription.keyboardDisabled"]}),y.jsx("div",{id:`${ai}-${e}`,style:Ao,children:n["edge.a11yDescription.default"]}),!t&&y.jsx(Pd,{rfId:e})]})}const qe=I.forwardRef(({position:e="top-left",children:t,className:n,style:o,...r},i)=>{const s=`${e}`.split("-");return y.jsx("div",{className:se(["react-flow__panel",n,...s]),style:o,ref:i,...r,children:t})});qe.displayName="Panel";function Fd({proOptions:e,position:t="bottom-right"}){return e!=null&&e.hideAttribution?null:y.jsx(qe,{position:t,className:"react-flow__attribution","data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://pro.reactflow.dev",children:y.jsx("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer","aria-label":"React Flow attribution",children:"React Flow"})})}const Td=e=>{const t=[],n=[];for(const[,o]of e.nodeLookup)o.selected&&t.push(o.internals.userNode);for(const[,o]of e.edgeLookup)o.selected&&n.push(o);return{selectedNodes:t,selectedEdges:n}},St=e=>e.id;function $d(e,t){return re(e.selectedNodes.map(St),t.selectedNodes.map(St))&&re(e.selectedEdges.map(St),t.selectedEdges.map(St))}function Dd({onSelectionChange:e}){const t=ie(),{selectedNodes:n,selectedEdges:o}=ee(Td,$d);return I.useEffect(()=>{const r={nodes:n,edges:o};e==null||e(r),t.getState().onSelectionChangeHandlers.forEach(i=>i(r))},[n,o,e]),null}const Rd=e=>!!e.onSelectionChangeHandlers;function Ld({onSelectionChange:e}){const t=ee(Rd);return e||t?y.jsx(Dd,{onSelectionChange:e}):null}const ci=[0,0],Bd={x:0,y:0,zoom:1},Hd=["nodes","edges","defaultNodes","defaultEdges","onConnect","onConnectStart","onConnectEnd","onClickConnectStart","onClickConnectEnd","nodesDraggable","autoPanOnNodeFocus","nodesConnectable","nodesFocusable","edgesFocusable","edgesReconnectable","elevateNodesOnSelect","elevateEdgesOnSelect","minZoom","maxZoom","nodeExtent","onNodesChange","onEdgesChange","elementsSelectable","connectionMode","snapGrid","snapToGrid","translateExtent","connectOnClick","defaultEdgeOptions","fitView","fitViewOptions","onNodesDelete","onEdgesDelete","onDelete","onNodeDrag","onNodeDragStart","onNodeDragStop","onSelectionDrag","onSelectionDragStart","onSelectionDragStop","onMoveStart","onMove","onMoveEnd","noPanClassName","nodeOrigin","autoPanOnConnect","autoPanOnNodeDrag","onError","connectionRadius","isValidConnection","selectNodesOnDrag","nodeDragThreshold","connectionDragThreshold","onBeforeDelete","debug","autoPanSpeed","ariaLabelConfig","zIndexMode"],zo=[...Hd,"rfId"],Vd=e=>({setNodes:e.setNodes,setEdges:e.setEdges,setMinZoom:e.setMinZoom,setMaxZoom:e.setMaxZoom,setTranslateExtent:e.setTranslateExtent,setNodeExtent:e.setNodeExtent,reset:e.reset,setDefaultNodesAndEdges:e.setDefaultNodesAndEdges}),Po={translateExtent:st,nodeOrigin:ci,minZoom:.5,maxZoom:2,elementsSelectable:!0,noPanClassName:"nopan",rfId:"1"};function Od(e){const{setNodes:t,setEdges:n,setMinZoom:o,setMaxZoom:r,setTranslateExtent:i,setNodeExtent:s,reset:a,setDefaultNodesAndEdges:c}=ee(Vd,re),u=ie();I.useEffect(()=>(c(e.defaultNodes,e.defaultEdges),()=>{f.current=Po,a()}),[]);const f=I.useRef(Po);return I.useEffect(()=>{for(const l of zo){const d=e[l],p=f.current[l];d!==p&&(typeof e[l]>"u"||(l==="nodes"?t(d):l==="edges"?n(d):l==="minZoom"?o(d):l==="maxZoom"?r(d):l==="translateExtent"?i(d):l==="nodeExtent"?s(d):l==="ariaLabelConfig"?u.setState({ariaLabelConfig:ku(d)}):l==="fitView"?u.setState({fitViewQueued:d}):l==="fitViewOptions"?u.setState({fitViewOptions:d}):u.setState({[l]:d})))}f.current=e},zo.map(l=>e[l])),null}function jo(){return typeof window>"u"||!window.matchMedia?null:window.matchMedia("(prefers-color-scheme: dark)")}function Wd(e){var o;const[t,n]=I.useState(e==="system"?null:e);return I.useEffect(()=>{if(e!=="system"){n(e);return}const r=jo(),i=()=>n(r!=null&&r.matches?"dark":"light");return i(),r==null||r.addEventListener("change",i),()=>{r==null||r.removeEventListener("change",i)}},[e]),t!==null?t:(o=jo())!=null&&o.matches?"dark":"light"}const Fo=typeof document<"u"?document:null;function ut(e=null,t={target:Fo,actInsideInputWithModifier:!0}){const[n,o]=I.useState(!1),r=I.useRef(!1),i=I.useRef(new Set([])),[s,a]=I.useMemo(()=>{if(e!==null){const u=(Array.isArray(e)?e:[e]).filter(l=>typeof l=="string").map(l=>l.replace("+",`
`).replace(`

`,`
+`).split(`
`)),f=u.reduce((l,d)=>l.concat(...d),[]);return[u,f]}return[[],[]]},[e]);return I.useEffect(()=>{const c=(t==null?void 0:t.target)??Fo,u=(t==null?void 0:t.actInsideInputWithModifier)??!0;if(e!==null){const f=p=>{var v,m;if(r.current=p.ctrlKey||p.metaKey||p.shiftKey||p.altKey,(!r.current||r.current&&!u)&&Br(p))return!1;const x=$o(p.code,a);if(i.current.add(p[x]),To(s,i.current,!1)){const b=((m=(v=p.composedPath)==null?void 0:v.call(p))==null?void 0:m[0])||p.target,h=(b==null?void 0:b.nodeName)==="BUTTON"||(b==null?void 0:b.nodeName)==="A";t.preventDefault!==!1&&(r.current||!h)&&p.preventDefault(),o(!0)}},l=p=>{const g=$o(p.code,a);To(s,i.current,!0)?(o(!1),i.current.clear()):i.current.delete(p[g]),p.key==="Meta"&&i.current.clear(),r.current=!1},d=()=>{i.current.clear(),o(!1)};return c==null||c.addEventListener("keydown",f),c==null||c.addEventListener("keyup",l),window.addEventListener("blur",d),window.addEventListener("contextmenu",d),()=>{c==null||c.removeEventListener("keydown",f),c==null||c.removeEventListener("keyup",l),window.removeEventListener("blur",d),window.removeEventListener("contextmenu",d)}}},[e,o]),n}function To(e,t,n){return e.filter(o=>n||o.length===t.size).some(o=>o.every(r=>t.has(r)))}function $o(e,t){return t.includes(e)?"code":"key"}const Yd=()=>{const e=ie();return I.useMemo(()=>({zoomIn:t=>{const{panZoom:n}=e.getState();return n?n.scaleBy(1.2,{duration:t==null?void 0:t.duration}):Promise.resolve(!1)},zoomOut:t=>{const{panZoom:n}=e.getState();return n?n.scaleBy(1/1.2,{duration:t==null?void 0:t.duration}):Promise.resolve(!1)},zoomTo:(t,n)=>{const{panZoom:o}=e.getState();return o?o.scaleTo(t,{duration:n==null?void 0:n.duration}):Promise.resolve(!1)},getZoom:()=>e.getState().transform[2],setViewport:async(t,n)=>{const{transform:[o,r,i],panZoom:s}=e.getState();return s?(await s.setViewport({x:t.x??o,y:t.y??r,zoom:t.zoom??i},n),Promise.resolve(!0)):Promise.resolve(!1)},getViewport:()=>{const[t,n,o]=e.getState().transform;return{x:t,y:n,zoom:o}},setCenter:async(t,n,o)=>e.getState().setCenter(t,n,o),fitBounds:async(t,n)=>{const{width:o,height:r,minZoom:i,maxZoom:s,panZoom:a}=e.getState(),c=Fn(t,o,r,i,s,(n==null?void 0:n.padding)??.1);return a?(await a.setViewport(c,{duration:n==null?void 0:n.duration,ease:n==null?void 0:n.ease,interpolate:n==null?void 0:n.interpolate}),Promise.resolve(!0)):Promise.resolve(!1)},screenToFlowPosition:(t,n={})=>{const{transform:o,snapGrid:r,snapToGrid:i,domNode:s}=e.getState();if(!s)return t;const{x:a,y:c}=s.getBoundingClientRect(),u={x:t.x-a,y:t.y-c},f=n.snapGrid??r,l=n.snapToGrid??i;return pt(u,o,l,f)},flowToScreenPosition:t=>{const{transform:n,domNode:o}=e.getState();if(!o)return t;const{x:r,y:i}=o.getBoundingClientRect(),s=$t(t,n);return{x:s.x+r,y:s.y+i}}}),[])};function li(e,t){const n=[],o=new Map,r=[];for(const i of e)if(i.type==="add"){r.push(i);continue}else if(i.type==="remove"||i.type==="replace")o.set(i.id,[i]);else{const s=o.get(i.id);s?s.push(i):o.set(i.id,[i])}for(const i of t){const s=o.get(i.id);if(!s){n.push(i);continue}if(s[0].type==="remove")continue;if(s[0].type==="replace"){n.push({...s[0].item});continue}const a={...i};for(const c of s)Xd(c,a);n.push(a)}return r.length&&r.forEach(i=>{i.index!==void 0?n.splice(i.index,0,{...i.item}):n.push({...i.item})}),n}function Xd(e,t){switch(e.type){case"select":{t.selected=e.selected;break}case"position":{typeof e.position<"u"&&(t.position=e.position),typeof e.dragging<"u"&&(t.dragging=e.dragging);break}case"dimensions":{typeof e.dimensions<"u"&&(t.measured={...e.dimensions},e.setAttributes&&((e.setAttributes===!0||e.setAttributes==="width")&&(t.width=e.dimensions.width),(e.setAttributes===!0||e.setAttributes==="height")&&(t.height=e.dimensions.height))),typeof e.resizing=="boolean"&&(t.resizing=e.resizing);break}}}function ui(e,t){return li(e,t)}function di(e,t){return li(e,t)}function Ie(e,t){return{id:e,type:"select",selected:t}}function Le(e,t=new Set,n=!1){const o=[];for(const[r,i]of e){const s=t.has(r);!(i.selected===void 0&&!s)&&i.selected!==s&&(n&&(i.selected=s),o.push(Ie(i.id,s)))}return o}function Do({items:e=[],lookup:t}){var r;const n=[],o=new Map(e.map(i=>[i.id,i]));for(const[i,s]of e.entries()){const a=t.get(s.id),c=((r=a==null?void 0:a.internals)==null?void 0:r.userNode)??a;c!==void 0&&c!==s&&n.push({id:s.id,item:s,type:"replace"}),c===void 0&&n.push({item:s,type:"add",index:i})}for(const[i]of t)o.get(i)===void 0&&n.push({id:i,type:"remove"});return n}function Ro(e){return{id:e.id,type:"remove"}}const Lo=e=>yu(e),Gd=e=>Pr(e);function fi(e){return I.forwardRef(e)}const qd=typeof window<"u"?I.useLayoutEffect:I.useEffect;function Bo(e){const[t,n]=I.useState(BigInt(0)),[o]=I.useState(()=>Ud(()=>n(r=>r+BigInt(1))));return qd(()=>{const r=o.get();r.length&&(e(r),o.reset())},[t]),o}function Ud(e){let t=[];return{get:()=>t,reset:()=>{t=[]},push:n=>{t.push(n),e()}}}const hi=I.createContext(null);function Kd({children:e}){const t=ie(),n=I.useCallback(a=>{const{nodes:c=[],setNodes:u,hasDefaultNodes:f,onNodesChange:l,nodeLookup:d,fitViewQueued:p,onNodesChangeMiddlewareMap:g}=t.getState();let x=c;for(const m of a)x=typeof m=="function"?m(x):m;let v=Do({items:x,lookup:d});for(const m of g.values())v=m(v);f&&u(x),v.length>0?l==null||l(v):p&&window.requestAnimationFrame(()=>{const{fitViewQueued:m,nodes:b,setNodes:h}=t.getState();m&&h(b)})},[]),o=Bo(n),r=I.useCallback(a=>{const{edges:c=[],setEdges:u,hasDefaultEdges:f,onEdgesChange:l,edgeLookup:d}=t.getState();let p=c;for(const g of a)p=typeof g=="function"?g(p):g;f?u(p):l&&l(Do({items:p,lookup:d}))},[]),i=Bo(r),s=I.useMemo(()=>({nodeQueue:o,edgeQueue:i}),[]);return y.jsx(hi.Provider,{value:s,children:e})}function Zd(){const e=I.useContext(hi);if(!e)throw new Error("useBatchContext must be used within a BatchProvider");return e}const Qd=e=>!!e.panZoom;function Gt(){const e=Yd(),t=ie(),n=Zd(),o=ee(Qd),r=I.useMemo(()=>{const i=l=>t.getState().nodeLookup.get(l),s=l=>{n.nodeQueue.push(l)},a=l=>{n.edgeQueue.push(l)},c=l=>{var m,b;const{nodeLookup:d,nodeOrigin:p}=t.getState(),g=Lo(l)?l:d.get(l.id),x=g.parentId?Rr(g.position,g.measured,g.parentId,d,p):g.position,v={...g,position:x,width:((m=g.measured)==null?void 0:m.width)??g.width,height:((b=g.measured)==null?void 0:b.height)??g.height};return Ye(v)},u=(l,d,p={replace:!1})=>{s(g=>g.map(x=>{if(x.id===l){const v=typeof d=="function"?d(x):d;return p.replace&&Lo(v)?v:{...x,...v}}return x}))},f=(l,d,p={replace:!1})=>{a(g=>g.map(x=>{if(x.id===l){const v=typeof d=="function"?d(x):d;return p.replace&&Gd(v)?v:{...x,...v}}return x}))};return{getNodes:()=>t.getState().nodes.map(l=>({...l})),getNode:l=>{var d;return(d=i(l))==null?void 0:d.internals.userNode},getInternalNode:i,getEdges:()=>{const{edges:l=[]}=t.getState();return l.map(d=>({...d}))},getEdge:l=>t.getState().edgeLookup.get(l),setNodes:s,setEdges:a,addNodes:l=>{const d=Array.isArray(l)?l:[l];n.nodeQueue.push(p=>[...p,...d])},addEdges:l=>{const d=Array.isArray(l)?l:[l];n.edgeQueue.push(p=>[...p,...d])},toObject:()=>{const{nodes:l=[],edges:d=[],transform:p}=t.getState(),[g,x,v]=p;return{nodes:l.map(m=>({...m})),edges:d.map(m=>({...m})),viewport:{x:g,y:x,zoom:v}}},deleteElements:async({nodes:l=[],edges:d=[]})=>{const{nodes:p,edges:g,onNodesDelete:x,onEdgesDelete:v,triggerNodeChanges:m,triggerEdgeChanges:b,onDelete:h,onBeforeDelete:w}=t.getState(),{nodes:_,edges:S}=await Eu({nodesToRemove:l,edgesToRemove:d,nodes:p,edges:g,onBeforeDelete:w}),N=S.length>0,F=_.length>0;if(N){const T=S.map(Ro);v==null||v(S),b(T)}if(F){const T=_.map(Ro);x==null||x(_),m(T)}return(F||N)&&(h==null||h({nodes:_,edges:S})),{deletedNodes:_,deletedEdges:S}},getIntersectingNodes:(l,d=!0,p)=>{const g=uo(l),x=g?l:c(l),v=p!==void 0;return x?(p||t.getState().nodes).filter(m=>{const b=t.getState().nodeLookup.get(m.id);if(b&&!g&&(m.id===l.id||!b.internals.positionAbsolute))return!1;const h=Ye(v?m:b),w=ct(h,x);return d&&w>0||w>=h.width*h.height||w>=x.width*x.height}):[]},isNodeIntersecting:(l,d,p=!0)=>{const x=uo(l)?l:c(l);if(!x)return!1;const v=ct(x,d);return p&&v>0||v>=d.width*d.height||v>=x.width*x.height},updateNode:u,updateNodeData:(l,d,p={replace:!1})=>{u(l,g=>{const x=typeof d=="function"?d(g):d;return p.replace?{...g,data:x}:{...g,data:{...g.data,...x}}},p)},updateEdge:f,updateEdgeData:(l,d,p={replace:!1})=>{f(l,g=>{const x=typeof d=="function"?d(g):d;return p.replace?{...g,data:x}:{...g,data:{...g.data,...x}}},p)},getNodesBounds:l=>{const{nodeLookup:d,nodeOrigin:p}=t.getState();return xu(l,{nodeLookup:d,nodeOrigin:p})},getHandleConnections:({type:l,id:d,nodeId:p})=>{var g;return Array.from(((g=t.getState().connectionLookup.get(`${p}-${l}${d?`-${d}`:""}`))==null?void 0:g.values())??[])},getNodeConnections:({type:l,handleId:d,nodeId:p})=>{var g;return Array.from(((g=t.getState().connectionLookup.get(`${p}${l?d?`-${l}-${d}`:`-${l}`:""}`))==null?void 0:g.values())??[])},fitView:async l=>{const d=t.getState().fitViewResolver??Nu();return t.setState({fitViewQueued:!0,fitViewOptions:l,fitViewResolver:d}),n.nodeQueue.push(p=>[...p]),d.promise}}},[]);return I.useMemo(()=>({...r,...e,viewportInitialized:o}),[o])}const Ho=e=>e.selected,Jd=typeof window<"u"?window:void 0;function ef({deleteKeyCode:e,multiSelectionKeyCode:t}){const n=ie(),{deleteElements:o}=Gt(),r=ut(e,{actInsideInputWithModifier:!1}),i=ut(t,{target:Jd});I.useEffect(()=>{if(r){const{edges:s,nodes:a}=n.getState();o({nodes:a.filter(Ho),edges:s.filter(Ho)}),n.setState({nodesSelectionActive:!1})}},[r]),I.useEffect(()=>{n.setState({multiSelectionActive:i})},[i])}function tf(e){const t=ie();I.useEffect(()=>{const n=()=>{var r,i,s,a;if(!e.current||!(((i=(r=e.current).checkVisibility)==null?void 0:i.call(r))??!0))return!1;const o=Tn(e.current);(o.height===0||o.width===0)&&((a=(s=t.getState()).onError)==null||a.call(s,"004",pe.error004())),t.setState({width:o.width||500,height:o.height||500})};if(e.current){n(),window.addEventListener("resize",n);const o=new ResizeObserver(()=>n());return o.observe(e.current),()=>{window.removeEventListener("resize",n),o&&e.current&&o.unobserve(e.current)}}},[])}const qt={position:"absolute",width:"100%",height:"100%",top:0,left:0},nf=e=>({userSelectionActive:e.userSelectionActive,lib:e.lib,connectionInProgress:e.connection.inProgress});function of({onPaneContextMenu:e,zoomOnScroll:t=!0,zoomOnPinch:n=!0,panOnScroll:o=!1,panOnScrollSpeed:r=.5,panOnScrollMode:i=Ae.Free,zoomOnDoubleClick:s=!0,panOnDrag:a=!0,defaultViewport:c,translateExtent:u,minZoom:f,maxZoom:l,zoomActivationKeyCode:d,preventScrolling:p=!0,children:g,noWheelClassName:x,noPanClassName:v,onViewportChange:m,isControlledViewport:b,paneClickDistance:h,selectionOnDrag:w}){const _=ie(),S=I.useRef(null),{userSelectionActive:N,lib:F,connectionInProgress:T}=ee(nf,re),H=ut(d),A=I.useRef();tf(S);const j=I.useCallback(B=>{m==null||m({x:B[0],y:B[1],zoom:B[2]}),b||_.setState({transform:B})},[m,b]);return I.useEffect(()=>{if(S.current){A.current=cd({domNode:S.current,minZoom:f,maxZoom:l,translateExtent:u,viewport:c,onDraggingChange:C=>_.setState(P=>P.paneDragging===C?P:{paneDragging:C}),onPanZoomStart:(C,P)=>{const{onViewportChangeStart:M,onMoveStart:k}=_.getState();k==null||k(C,P),M==null||M(P)},onPanZoom:(C,P)=>{const{onViewportChange:M,onMove:k}=_.getState();k==null||k(C,P),M==null||M(P)},onPanZoomEnd:(C,P)=>{const{onViewportChangeEnd:M,onMoveEnd:k}=_.getState();k==null||k(C,P),M==null||M(P)}});const{x:B,y:E,zoom:z}=A.current.getViewport();return _.setState({panZoom:A.current,transform:[B,E,z],domNode:S.current.closest(".react-flow")}),()=>{var C;(C=A.current)==null||C.destroy()}}},[]),I.useEffect(()=>{var B;(B=A.current)==null||B.update({onPaneContextMenu:e,zoomOnScroll:t,zoomOnPinch:n,panOnScroll:o,panOnScrollSpeed:r,panOnScrollMode:i,zoomOnDoubleClick:s,panOnDrag:a,zoomActivationKeyPressed:H,preventScrolling:p,noPanClassName:v,userSelectionActive:N,noWheelClassName:x,lib:F,onTransformChange:j,connectionInProgress:T,selectionOnDrag:w,paneClickDistance:h})},[e,t,n,o,r,i,s,a,H,p,v,N,x,F,j,T,w,h]),y.jsx("div",{className:"react-flow__renderer",ref:S,style:qt,children:g})}const rf=e=>({userSelectionActive:e.userSelectionActive,userSelectionRect:e.userSelectionRect});function sf(){const{userSelectionActive:e,userSelectionRect:t}=ee(rf,re);return e&&t?y.jsx("div",{className:"react-flow__selection react-flow__container",style:{width:t.width,height:t.height,transform:`translate(${t.x}px, ${t.y}px)`}}):null}const dn=(e,t)=>n=>{n.target===t.current&&(e==null||e(n))},af=e=>({userSelectionActive:e.userSelectionActive,elementsSelectable:e.elementsSelectable,connectionInProgress:e.connection.inProgress,dragging:e.paneDragging});function cf({isSelecting:e,selectionKeyPressed:t,selectionMode:n=at.Full,panOnDrag:o,paneClickDistance:r,selectionOnDrag:i,onSelectionStart:s,onSelectionEnd:a,onPaneClick:c,onPaneContextMenu:u,onPaneScroll:f,onPaneMouseEnter:l,onPaneMouseMove:d,onPaneMouseLeave:p,children:g}){const x=ie(),{userSelectionActive:v,elementsSelectable:m,dragging:b,connectionInProgress:h}=ee(af,re),w=m&&(e||v),_=I.useRef(null),S=I.useRef(),N=I.useRef(new Set),F=I.useRef(new Set),T=I.useRef(!1),H=M=>{if(T.current||h){T.current=!1;return}c==null||c(M),x.getState().resetSelectedElements(),x.setState({nodesSelectionActive:!1})},A=M=>{if(Array.isArray(o)&&(o!=null&&o.includes(2))){M.preventDefault();return}u==null||u(M)},j=f?M=>f(M):void 0,B=M=>{T.current&&(M.stopPropagation(),T.current=!1)},E=M=>{var $,O;const{domNode:k}=x.getState();if(S.current=k==null?void 0:k.getBoundingClientRect(),!S.current)return;const D=M.target===_.current;if(!D&&!!M.target.closest(".nokey")||!e||!(i&&D||t)||M.button!==0||!M.isPrimary)return;(O=($=M.target)==null?void 0:$.setPointerCapture)==null||O.call($,M.pointerId),T.current=!1;const{x:W,y:X}=fe(M.nativeEvent,S.current);x.setState({userSelectionRect:{width:0,height:0,startX:W,startY:X,x:W,y:X}}),D||(M.stopPropagation(),M.preventDefault())},z=M=>{const{userSelectionRect:k,transform:D,nodeLookup:L,edgeLookup:R,connectionLookup:W,triggerNodeChanges:X,triggerEdgeChanges:$,defaultEdgeOptions:O,resetSelectedElements:Y}=x.getState();if(!S.current||!k)return;const{x:V,y:G}=fe(M.nativeEvent,S.current),{startX:Q,startY:Z}=k;if(!T.current){const te=t?0:r;if(Math.hypot(V-Q,G-Z)<=te)return;Y(),s==null||s(M)}T.current=!0;const K={startX:Q,startY:Z,x:V<Q?V:Q,y:G<Z?G:Z,width:Math.abs(V-Q),height:Math.abs(G-Z)},U=N.current,ne=F.current;N.current=new Set(jn(L,K,D,n===at.Partial,!0).map(te=>te.id)),F.current=new Set;const oe=(O==null?void 0:O.selectable)??!0;for(const te of N.current){const ae=W.get(te);if(ae)for(const{edgeId:Se}of ae.values()){const ye=R.get(Se);ye&&(ye.selectable??oe)&&F.current.add(Se)}}if(!fo(U,N.current)){const te=Le(L,N.current,!0);X(te)}if(!fo(ne,F.current)){const te=Le(R,F.current);$(te)}x.setState({userSelectionRect:K,userSelectionActive:!0,nodesSelectionActive:!1})},C=M=>{var k,D;M.button===0&&((D=(k=M.target)==null?void 0:k.releasePointerCapture)==null||D.call(k,M.pointerId),!v&&M.target===_.current&&x.getState().userSelectionRect&&(H==null||H(M)),x.setState({userSelectionActive:!1,userSelectionRect:null}),T.current&&(a==null||a(M),x.setState({nodesSelectionActive:N.current.size>0})))},P=o===!0||Array.isArray(o)&&o.includes(0);return y.jsxs("div",{className:se(["react-flow__pane",{draggable:P,dragging:b,selection:e}]),onClick:w?void 0:dn(H,_),onContextMenu:dn(A,_),onWheel:dn(j,_),onPointerEnter:w?void 0:l,onPointerMove:w?z:d,onPointerUp:w?C:void 0,onPointerDownCapture:w?E:void 0,onClickCapture:w?B:void 0,onPointerLeave:p,ref:_,style:qt,children:[g,y.jsx(sf,{})]})}function _n({id:e,store:t,unselect:n=!1,nodeRef:o}){const{addSelectedNodes:r,unselectNodesAndEdges:i,multiSelectionActive:s,nodeLookup:a,onError:c}=t.getState(),u=a.get(e);if(!u){c==null||c("012",pe.error012(e));return}t.setState({nodesSelectionActive:!1}),u.selected?(n||u.selected&&s)&&(i({nodes:[u],edges:[]}),requestAnimationFrame(()=>{var f;return(f=o==null?void 0:o.current)==null?void 0:f.blur()})):r([e])}function gi({nodeRef:e,disabled:t=!1,noDragClassName:n,handleSelector:o,nodeId:r,isSelectable:i,nodeClickDistance:s}){const a=ie(),[c,u]=I.useState(!1),f=I.useRef();return I.useEffect(()=>{f.current=qu({getStoreItems:()=>a.getState(),onNodeMouseDown:l=>{_n({id:l,store:a,nodeRef:e})},onDragStart:()=>{u(!0)},onDragStop:()=>{u(!1)}})},[]),I.useEffect(()=>{if(!(t||!e.current||!f.current))return f.current.update({noDragClassName:n,handleSelector:o,domNode:e.current,isSelectable:i,nodeId:r,nodeClickDistance:s}),()=>{var l;(l=f.current)==null||l.destroy()}},[n,o,t,i,e,r,s]),c}const lf=e=>t=>t.selected&&(t.draggable||e&&typeof t.draggable>"u");function pi(){const e=ie();return I.useCallback(n=>{const{nodeExtent:o,snapToGrid:r,snapGrid:i,nodesDraggable:s,onError:a,updateNodePositions:c,nodeLookup:u,nodeOrigin:f}=e.getState(),l=new Map,d=lf(s),p=r?i[0]:5,g=r?i[1]:5,x=n.direction.x*p*n.factor,v=n.direction.y*g*n.factor;for(const[,m]of u){if(!d(m))continue;let b={x:m.internals.positionAbsolute.x+x,y:m.internals.positionAbsolute.y+v};r&&(b=gt(b,i));const{position:h,positionAbsolute:w}=jr({nodeId:m.id,nextPosition:b,nodeLookup:u,nodeExtent:o,nodeOrigin:f,onError:a});m.position=h,m.internals.positionAbsolute=w,l.set(m.id,m)}c(l)},[])}const Hn=I.createContext(null),uf=Hn.Provider;Hn.Consumer;const mi=()=>I.useContext(Hn),df=e=>({connectOnClick:e.connectOnClick,noPanClassName:e.noPanClassName,rfId:e.rfId}),ff=(e,t,n)=>o=>{const{connectionClickStartHandle:r,connectionMode:i,connection:s}=o,{fromHandle:a,toHandle:c,isValid:u}=s,f=(c==null?void 0:c.nodeId)===e&&(c==null?void 0:c.id)===t&&(c==null?void 0:c.type)===n;return{connectingFrom:(a==null?void 0:a.nodeId)===e&&(a==null?void 0:a.id)===t&&(a==null?void 0:a.type)===n,connectingTo:f,clickConnecting:(r==null?void 0:r.nodeId)===e&&(r==null?void 0:r.id)===t&&(r==null?void 0:r.type)===n,isPossibleEndHandle:i===Oe.Strict?(a==null?void 0:a.type)!==n:e!==(a==null?void 0:a.nodeId)||t!==(a==null?void 0:a.id),connectionInProcess:!!a,clickConnectionInProcess:!!r,valid:f&&u}};function hf({type:e="source",position:t=q.Top,isValidConnection:n,isConnectable:o=!0,isConnectableStart:r=!0,isConnectableEnd:i=!0,id:s,onConnect:a,children:c,className:u,onMouseDown:f,onTouchStart:l,...d},p){var z,C;const g=s||null,x=e==="target",v=ie(),m=mi(),{connectOnClick:b,noPanClassName:h,rfId:w}=ee(df,re),{connectingFrom:_,connectingTo:S,clickConnecting:N,isPossibleEndHandle:F,connectionInProcess:T,clickConnectionInProcess:H,valid:A}=ee(ff(m,g,e),re);m||(C=(z=v.getState()).onError)==null||C.call(z,"010",pe.error010());const j=P=>{const{defaultEdgeOptions:M,onConnect:k,hasDefaultEdges:D}=v.getState(),L={...M,...P};if(D){const{edges:R,setEdges:W}=v.getState();W(Yr(L,R))}k==null||k(L),a==null||a(L)},B=P=>{if(!m)return;const M=Hr(P.nativeEvent);if(r&&(M&&P.button===0||!M)){const k=v.getState();Sn.onPointerDown(P.nativeEvent,{handleDomNode:P.currentTarget,autoPanOnConnect:k.autoPanOnConnect,connectionMode:k.connectionMode,connectionRadius:k.connectionRadius,domNode:k.domNode,nodeLookup:k.nodeLookup,lib:k.lib,isTarget:x,handleId:g,nodeId:m,flowId:k.rfId,panBy:k.panBy,cancelConnection:k.cancelConnection,onConnectStart:k.onConnectStart,onConnectEnd:(...D)=>{var L,R;return(R=(L=v.getState()).onConnectEnd)==null?void 0:R.call(L,...D)},updateConnection:k.updateConnection,onConnect:j,isValidConnection:n||((...D)=>{var L,R;return((R=(L=v.getState()).isValidConnection)==null?void 0:R.call(L,...D))??!0}),getTransform:()=>v.getState().transform,getFromHandle:()=>v.getState().connection.fromHandle,autoPanSpeed:k.autoPanSpeed,dragThreshold:k.connectionDragThreshold})}M?f==null||f(P):l==null||l(P)},E=P=>{const{onClickConnectStart:M,onClickConnectEnd:k,connectionClickStartHandle:D,connectionMode:L,isValidConnection:R,lib:W,rfId:X,nodeLookup:$,connection:O}=v.getState();if(!m||!D&&!r)return;if(!D){M==null||M(P.nativeEvent,{nodeId:m,handleId:g,handleType:e}),v.setState({connectionClickStartHandle:{nodeId:m,type:e,id:g}});return}const Y=Lr(P.target),V=n||R,{connection:G,isValid:Q}=Sn.isValid(P.nativeEvent,{handle:{nodeId:m,id:g,type:e},connectionMode:L,fromNodeId:D.nodeId,fromHandleId:D.id||null,fromType:D.type,isValidConnection:V,flowId:X,doc:Y,lib:W,nodeLookup:$});Q&&G&&j(G);const Z=structuredClone(O);delete Z.inProgress,Z.toPosition=Z.toHandle?Z.toHandle.position:null,k==null||k(P,Z),v.setState({connectionClickStartHandle:null})};return y.jsx("div",{"data-handleid":g,"data-nodeid":m,"data-handlepos":t,"data-id":`${w}-${m}-${g}-${e}`,className:se(["react-flow__handle",`react-flow__handle-${t}`,"nodrag",h,u,{source:!x,target:x,connectable:o,connectablestart:r,connectableend:i,clickconnecting:N,connectingfrom:_,connectingto:S,valid:A,connectionindicator:o&&(!T||F)&&(T||H?i:r)}]),onMouseDown:B,onTouchStart:B,onClick:b?E:void 0,ref:p,...d,children:c})}const ge=I.memo(fi(hf));function gf({data:e,isConnectable:t,sourcePosition:n=q.Bottom}){return y.jsxs(y.Fragment,{children:[e==null?void 0:e.label,y.jsx(ge,{type:"source",position:n,isConnectable:t})]})}function pf({data:e,isConnectable:t,targetPosition:n=q.Top,sourcePosition:o=q.Bottom}){return y.jsxs(y.Fragment,{children:[y.jsx(ge,{type:"target",position:n,isConnectable:t}),e==null?void 0:e.label,y.jsx(ge,{type:"source",position:o,isConnectable:t})]})}function mf(){return null}function yf({data:e,isConnectable:t,targetPosition:n=q.Top}){return y.jsxs(y.Fragment,{children:[y.jsx(ge,{type:"target",position:n,isConnectable:t}),e==null?void 0:e.label]})}const Dt={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}},Vo={input:gf,default:pf,output:yf,group:mf};function xf(e){var t,n,o,r;return e.internals.handleBounds===void 0?{width:e.width??e.initialWidth??((t=e.style)==null?void 0:t.width),height:e.height??e.initialHeight??((n=e.style)==null?void 0:n.height)}:{width:e.width??((o=e.style)==null?void 0:o.width),height:e.height??((r=e.style)==null?void 0:r.height)}}const wf=e=>{const{width:t,height:n,x:o,y:r}=ht(e.nodeLookup,{filter:i=>!!i.selected});return{width:de(t)?t:null,height:de(n)?n:null,userSelectionActive:e.userSelectionActive,transformString:`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]}) translate(${o}px,${r}px)`}};function vf({onSelectionContextMenu:e,noPanClassName:t,disableKeyboardA11y:n}){const o=ie(),{width:r,height:i,transformString:s,userSelectionActive:a}=ee(wf,re),c=pi(),u=I.useRef(null);I.useEffect(()=>{var p;n||(p=u.current)==null||p.focus({preventScroll:!0})},[n]);const f=!a&&r!==null&&i!==null;if(gi({nodeRef:u,disabled:!f}),!f)return null;const l=e?p=>{const g=o.getState().nodes.filter(x=>x.selected);e(p,g)}:void 0,d=p=>{Object.prototype.hasOwnProperty.call(Dt,p.key)&&(p.preventDefault(),c({direction:Dt[p.key],factor:p.shiftKey?4:1}))};return y.jsx("div",{className:se(["react-flow__nodesselection","react-flow__container",t]),style:{transform:s},children:y.jsx("div",{ref:u,className:"react-flow__nodesselection-rect",onContextMenu:l,tabIndex:n?void 0:-1,onKeyDown:n?void 0:d,style:{width:r,height:i}})})}const Oo=typeof window<"u"?window:void 0,bf=e=>({nodesSelectionActive:e.nodesSelectionActive,userSelectionActive:e.userSelectionActive});function yi({children:e,onPaneClick:t,onPaneMouseEnter:n,onPaneMouseMove:o,onPaneMouseLeave:r,onPaneContextMenu:i,onPaneScroll:s,paneClickDistance:a,deleteKeyCode:c,selectionKeyCode:u,selectionOnDrag:f,selectionMode:l,onSelectionStart:d,onSelectionEnd:p,multiSelectionKeyCode:g,panActivationKeyCode:x,zoomActivationKeyCode:v,elementsSelectable:m,zoomOnScroll:b,zoomOnPinch:h,panOnScroll:w,panOnScrollSpeed:_,panOnScrollMode:S,zoomOnDoubleClick:N,panOnDrag:F,defaultViewport:T,translateExtent:H,minZoom:A,maxZoom:j,preventScrolling:B,onSelectionContextMenu:E,noWheelClassName:z,noPanClassName:C,disableKeyboardA11y:P,onViewportChange:M,isControlledViewport:k}){const{nodesSelectionActive:D,userSelectionActive:L}=ee(bf,re),R=ut(u,{target:Oo}),W=ut(x,{target:Oo}),X=W||F,$=W||w,O=f&&X!==!0,Y=R||L||O;return ef({deleteKeyCode:c,multiSelectionKeyCode:g}),y.jsx(of,{onPaneContextMenu:i,elementsSelectable:m,zoomOnScroll:b,zoomOnPinch:h,panOnScroll:$,panOnScrollSpeed:_,panOnScrollMode:S,zoomOnDoubleClick:N,panOnDrag:!R&&X,defaultViewport:T,translateExtent:H,minZoom:A,maxZoom:j,zoomActivationKeyCode:v,preventScrolling:B,noWheelClassName:z,noPanClassName:C,onViewportChange:M,isControlledViewport:k,paneClickDistance:a,selectionOnDrag:O,children:y.jsxs(cf,{onSelectionStart:d,onSelectionEnd:p,onPaneClick:t,onPaneMouseEnter:n,onPaneMouseMove:o,onPaneMouseLeave:r,onPaneContextMenu:i,onPaneScroll:s,panOnDrag:X,isSelecting:!!Y,selectionMode:l,selectionKeyPressed:R,paneClickDistance:a,selectionOnDrag:O,children:[e,D&&y.jsx(vf,{onSelectionContextMenu:E,noPanClassName:C,disableKeyboardA11y:P})]})})}yi.displayName="FlowRenderer";const Ef=I.memo(yi),Sf=e=>t=>e?jn(t.nodeLookup,{x:0,y:0,width:t.width,height:t.height},t.transform,!0).map(n=>n.id):Array.from(t.nodeLookup.keys());function _f(e){return ee(I.useCallback(Sf(e),[e]),re)}const Cf=e=>e.updateNodeInternals;function Nf(){const e=ee(Cf),[t]=I.useState(()=>typeof ResizeObserver>"u"?null:new ResizeObserver(n=>{const o=new Map;n.forEach(r=>{const i=r.target.getAttribute("data-id");o.set(i,{id:i,nodeElement:r.target,force:!0})}),e(o)}));return I.useEffect(()=>()=>{t==null||t.disconnect()},[t]),t}function kf({node:e,nodeType:t,hasDimensions:n,resizeObserver:o}){const r=ie(),i=I.useRef(null),s=I.useRef(null),a=I.useRef(e.sourcePosition),c=I.useRef(e.targetPosition),u=I.useRef(t),f=n&&!!e.internals.handleBounds;return I.useEffect(()=>{i.current&&!e.hidden&&(!f||s.current!==i.current)&&(s.current&&(o==null||o.unobserve(s.current)),o==null||o.observe(i.current),s.current=i.current)},[f,e.hidden]),I.useEffect(()=>()=>{s.current&&(o==null||o.unobserve(s.current),s.current=null)},[]),I.useEffect(()=>{if(i.current){const l=u.current!==t,d=a.current!==e.sourcePosition,p=c.current!==e.targetPosition;(l||d||p)&&(u.current=t,a.current=e.sourcePosition,c.current=e.targetPosition,r.getState().updateNodeInternals(new Map([[e.id,{id:e.id,nodeElement:i.current,force:!0}]])))}},[e.id,t,e.sourcePosition,e.targetPosition]),i}function Mf({id:e,onClick:t,onMouseEnter:n,onMouseMove:o,onMouseLeave:r,onContextMenu:i,onDoubleClick:s,nodesDraggable:a,elementsSelectable:c,nodesConnectable:u,nodesFocusable:f,resizeObserver:l,noDragClassName:d,noPanClassName:p,disableKeyboardA11y:g,rfId:x,nodeTypes:v,nodeClickDistance:m,onError:b}){const{node:h,internals:w,isParent:_}=ee(V=>{const G=V.nodeLookup.get(e),Q=V.parentLookup.has(e);return{node:G,internals:G.internals,isParent:Q}},re);let S=h.type||"default",N=(v==null?void 0:v[S])||Vo[S];N===void 0&&(b==null||b("003",pe.error003(S)),S="default",N=(v==null?void 0:v.default)||Vo.default);const F=!!(h.draggable||a&&typeof h.draggable>"u"),T=!!(h.selectable||c&&typeof h.selectable>"u"),H=!!(h.connectable||u&&typeof h.connectable>"u"),A=!!(h.focusable||f&&typeof h.focusable>"u"),j=ie(),B=Dr(h),E=kf({node:h,nodeType:S,hasDimensions:B,resizeObserver:l}),z=gi({nodeRef:E,disabled:h.hidden||!F,noDragClassName:d,handleSelector:h.dragHandle,nodeId:e,isSelectable:T,nodeClickDistance:m}),C=pi();if(h.hidden)return null;const P=Ee(h),M=xf(h),k=T||F||t||n||o||r,D=n?V=>n(V,{...w.userNode}):void 0,L=o?V=>o(V,{...w.userNode}):void 0,R=r?V=>r(V,{...w.userNode}):void 0,W=i?V=>i(V,{...w.userNode}):void 0,X=s?V=>s(V,{...w.userNode}):void 0,$=V=>{const{selectNodesOnDrag:G,nodeDragThreshold:Q}=j.getState();T&&(!G||!F||Q>0)&&_n({id:e,store:j,nodeRef:E}),t&&t(V,{...w.userNode})},O=V=>{if(!(Br(V.nativeEvent)||g)){if(Mr.includes(V.key)&&T){const G=V.key==="Escape";_n({id:e,store:j,unselect:G,nodeRef:E})}else if(F&&h.selected&&Object.prototype.hasOwnProperty.call(Dt,V.key)){V.preventDefault();const{ariaLabelConfig:G}=j.getState();j.setState({ariaLiveMessage:G["node.a11yDescription.ariaLiveMessage"]({direction:V.key.replace("Arrow","").toLowerCase(),x:~~w.positionAbsolute.x,y:~~w.positionAbsolute.y})}),C({direction:Dt[V.key],factor:V.shiftKey?4:1})}}},Y=()=>{var ne;if(g||!((ne=E.current)!=null&&ne.matches(":focus-visible")))return;const{transform:V,width:G,height:Q,autoPanOnNodeFocus:Z,setCenter:K}=j.getState();if(!Z)return;jn(new Map([[e,h]]),{x:0,y:0,width:G,height:Q},V,!0).length>0||K(h.position.x+P.width/2,h.position.y+P.height/2,{zoom:V[2]})};return y.jsx("div",{className:se(["react-flow__node",`react-flow__node-${S}`,{[p]:F},h.className,{selected:h.selected,selectable:T,parent:_,draggable:F,dragging:z}]),ref:E,style:{zIndex:w.z,transform:`translate(${w.positionAbsolute.x}px,${w.positionAbsolute.y}px)`,pointerEvents:k?"all":"none",visibility:B?"visible":"hidden",...h.style,...M},"data-id":e,"data-testid":`rf__node-${e}`,onMouseEnter:D,onMouseMove:L,onMouseLeave:R,onContextMenu:W,onClick:$,onDoubleClick:X,onKeyDown:A?O:void 0,tabIndex:A?0:void 0,onFocus:A?Y:void 0,role:h.ariaRole??(A?"group":void 0),"aria-roledescription":"node","aria-describedby":g?void 0:`${si}-${x}`,"aria-label":h.ariaLabel,...h.domAttributes,children:y.jsx(uf,{value:e,children:y.jsx(N,{id:e,data:h.data,type:S,positionAbsoluteX:w.positionAbsolute.x,positionAbsoluteY:w.positionAbsolute.y,selected:h.selected??!1,selectable:T,draggable:F,deletable:h.deletable??!0,isConnectable:H,sourcePosition:h.sourcePosition,targetPosition:h.targetPosition,dragging:z,dragHandle:h.dragHandle,zIndex:w.z,parentId:h.parentId,...P})})})}var If=I.memo(Mf);const Af=e=>({nodesDraggable:e.nodesDraggable,nodesConnectable:e.nodesConnectable,nodesFocusable:e.nodesFocusable,elementsSelectable:e.elementsSelectable,onError:e.onError});function xi(e){const{nodesDraggable:t,nodesConnectable:n,nodesFocusable:o,elementsSelectable:r,onError:i}=ee(Af,re),s=_f(e.onlyRenderVisibleElements),a=Nf();return y.jsx("div",{className:"react-flow__nodes",style:qt,children:s.map(c=>y.jsx(If,{id:c,nodeTypes:e.nodeTypes,nodeExtent:e.nodeExtent,onClick:e.onNodeClick,onMouseEnter:e.onNodeMouseEnter,onMouseMove:e.onNodeMouseMove,onMouseLeave:e.onNodeMouseLeave,onContextMenu:e.onNodeContextMenu,onDoubleClick:e.onNodeDoubleClick,noDragClassName:e.noDragClassName,noPanClassName:e.noPanClassName,rfId:e.rfId,disableKeyboardA11y:e.disableKeyboardA11y,resizeObserver:a,nodesDraggable:t,nodesConnectable:n,nodesFocusable:o,elementsSelectable:r,nodeClickDistance:e.nodeClickDistance,onError:i},c))})}xi.displayName="NodeRenderer";const zf=I.memo(xi);function Pf(e){return ee(I.useCallback(n=>{if(!e)return n.edges.map(r=>r.id);const o=[];if(n.width&&n.height)for(const r of n.edges){const i=n.nodeLookup.get(r.source),s=n.nodeLookup.get(r.target);i&&s&&Au({sourceNode:i,targetNode:s,width:n.width,height:n.height,transform:n.transform})&&o.push(r.id)}return o},[e]),re)}const jf=({color:e="none",strokeWidth:t=1})=>{const n={strokeWidth:t,...e&&{stroke:e}};return y.jsx("polyline",{className:"arrow",style:n,strokeLinecap:"round",fill:"none",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4"})},Ff=({color:e="none",strokeWidth:t=1})=>{const n={strokeWidth:t,...e&&{stroke:e,fill:e}};return y.jsx("polyline",{className:"arrowclosed",style:n,strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"})},Wo={[Ft.Arrow]:jf,[Ft.ArrowClosed]:Ff};function Tf(e){const t=ie();return I.useMemo(()=>{var r,i;return Object.prototype.hasOwnProperty.call(Wo,e)?Wo[e]:((i=(r=t.getState()).onError)==null||i.call(r,"009",pe.error009(e)),null)},[e])}const $f=({id:e,type:t,color:n,width:o=12.5,height:r=12.5,markerUnits:i="strokeWidth",strokeWidth:s,orient:a="auto-start-reverse"})=>{const c=Tf(t);return c?y.jsx("marker",{className:"react-flow__arrowhead",id:e,markerWidth:`${o}`,markerHeight:`${r}`,viewBox:"-10 -10 20 20",markerUnits:i,orient:a,refX:"0",refY:"0",children:y.jsx(c,{color:n,strokeWidth:s})}):null},wi=({defaultColor:e,rfId:t})=>{const n=ee(i=>i.edges),o=ee(i=>i.defaultEdgeOptions),r=I.useMemo(()=>Du(n,{id:t,defaultColor:e,defaultMarkerStart:o==null?void 0:o.markerStart,defaultMarkerEnd:o==null?void 0:o.markerEnd}),[n,o,t,e]);return r.length?y.jsx("svg",{className:"react-flow__marker","aria-hidden":"true",children:y.jsx("defs",{children:r.map(i=>y.jsx($f,{id:i.id,type:i.type,color:i.color,width:i.width,height:i.height,markerUnits:i.markerUnits,strokeWidth:i.strokeWidth,orient:i.orient},i.id))})}):null};wi.displayName="MarkerDefinitions";var Df=I.memo(wi);function vi({x:e,y:t,label:n,labelStyle:o,labelShowBg:r=!0,labelBgStyle:i,labelBgPadding:s=[2,4],labelBgBorderRadius:a=2,children:c,className:u,...f}){const[l,d]=I.useState({x:1,y:0,width:0,height:0}),p=se(["react-flow__edge-textwrapper",u]),g=I.useRef(null);return I.useEffect(()=>{if(g.current){const x=g.current.getBBox();d({x:x.x,y:x.y,width:x.width,height:x.height})}},[n]),n?y.jsxs("g",{transform:`translate(${e-l.width/2} ${t-l.height/2})`,className:p,visibility:l.width?"visible":"hidden",...f,children:[r&&y.jsx("rect",{width:l.width+2*s[0],x:-s[0],y:-s[1],height:l.height+2*s[1],className:"react-flow__edge-textbg",style:i,rx:a,ry:a}),y.jsx("text",{className:"react-flow__edge-text",y:l.height/2,dy:"0.3em",ref:g,style:o,children:n}),c]}):null}vi.displayName="EdgeText";const Rf=I.memo(vi);function Ut({path:e,labelX:t,labelY:n,label:o,labelStyle:r,labelShowBg:i,labelBgStyle:s,labelBgPadding:a,labelBgBorderRadius:c,interactionWidth:u=20,...f}){return y.jsxs(y.Fragment,{children:[y.jsx("path",{...f,d:e,fill:"none",className:se(["react-flow__edge-path",f.className])}),u?y.jsx("path",{d:e,fill:"none",strokeOpacity:0,strokeWidth:u,className:"react-flow__edge-interaction"}):null,o&&de(t)&&de(n)?y.jsx(Rf,{x:t,y:n,label:o,labelStyle:r,labelShowBg:i,labelBgStyle:s,labelBgPadding:a,labelBgBorderRadius:c}):null]})}function Yo({pos:e,x1:t,y1:n,x2:o,y2:r}){return e===q.Left||e===q.Right?[.5*(t+o),n]:[t,.5*(n+r)]}function bi({sourceX:e,sourceY:t,sourcePosition:n=q.Bottom,targetX:o,targetY:r,targetPosition:i=q.Top}){const[s,a]=Yo({pos:n,x1:e,y1:t,x2:o,y2:r}),[c,u]=Yo({pos:i,x1:o,y1:r,x2:e,y2:t}),[f,l,d,p]=Vr({sourceX:e,sourceY:t,targetX:o,targetY:r,sourceControlX:s,sourceControlY:a,targetControlX:c,targetControlY:u});return[`M${e},${t} C${s},${a} ${c},${u} ${o},${r}`,f,l,d,p]}function Ei(e){return I.memo(({id:t,sourceX:n,sourceY:o,targetX:r,targetY:i,sourcePosition:s,targetPosition:a,label:c,labelStyle:u,labelShowBg:f,labelBgStyle:l,labelBgPadding:d,labelBgBorderRadius:p,style:g,markerEnd:x,markerStart:v,interactionWidth:m})=>{const[b,h,w]=bi({sourceX:n,sourceY:o,sourcePosition:s,targetX:r,targetY:i,targetPosition:a}),_=e.isInternal?void 0:t;return y.jsx(Ut,{id:_,path:b,labelX:h,labelY:w,label:c,labelStyle:u,labelShowBg:f,labelBgStyle:l,labelBgPadding:d,labelBgBorderRadius:p,style:g,markerEnd:x,markerStart:v,interactionWidth:m})})}const Lf=Ei({isInternal:!1}),Si=Ei({isInternal:!0});Lf.displayName="SimpleBezierEdge";Si.displayName="SimpleBezierEdgeInternal";function _i(e){return I.memo(({id:t,sourceX:n,sourceY:o,targetX:r,targetY:i,label:s,labelStyle:a,labelShowBg:c,labelBgStyle:u,labelBgPadding:f,labelBgBorderRadius:l,style:d,sourcePosition:p=q.Bottom,targetPosition:g=q.Top,markerEnd:x,markerStart:v,pathOptions:m,interactionWidth:b})=>{const[h,w,_]=vn({sourceX:n,sourceY:o,sourcePosition:p,targetX:r,targetY:i,targetPosition:g,borderRadius:m==null?void 0:m.borderRadius,offset:m==null?void 0:m.offset,stepPosition:m==null?void 0:m.stepPosition}),S=e.isInternal?void 0:t;return y.jsx(Ut,{id:S,path:h,labelX:w,labelY:_,label:s,labelStyle:a,labelShowBg:c,labelBgStyle:u,labelBgPadding:f,labelBgBorderRadius:l,style:d,markerEnd:x,markerStart:v,interactionWidth:b})})}const Ci=_i({isInternal:!1}),Ni=_i({isInternal:!0});Ci.displayName="SmoothStepEdge";Ni.displayName="SmoothStepEdgeInternal";function ki(e){return I.memo(({id:t,...n})=>{var r;const o=e.isInternal?void 0:t;return y.jsx(Ci,{...n,id:o,pathOptions:I.useMemo(()=>{var i;return{borderRadius:0,offset:(i=n.pathOptions)==null?void 0:i.offset}},[(r=n.pathOptions)==null?void 0:r.offset])})})}const Bf=ki({isInternal:!1}),Mi=ki({isInternal:!0});Bf.displayName="StepEdge";Mi.displayName="StepEdgeInternal";function Ii(e){return I.memo(({id:t,sourceX:n,sourceY:o,targetX:r,targetY:i,label:s,labelStyle:a,labelShowBg:c,labelBgStyle:u,labelBgPadding:f,labelBgBorderRadius:l,style:d,markerEnd:p,markerStart:g,interactionWidth:x})=>{const[v,m,b]=Xr({sourceX:n,sourceY:o,targetX:r,targetY:i}),h=e.isInternal?void 0:t;return y.jsx(Ut,{id:h,path:v,labelX:m,labelY:b,label:s,labelStyle:a,labelShowBg:c,labelBgStyle:u,labelBgPadding:f,labelBgBorderRadius:l,style:d,markerEnd:p,markerStart:g,interactionWidth:x})})}const Hf=Ii({isInternal:!1}),Ai=Ii({isInternal:!0});Hf.displayName="StraightEdge";Ai.displayName="StraightEdgeInternal";function zi(e){return I.memo(({id:t,sourceX:n,sourceY:o,targetX:r,targetY:i,sourcePosition:s=q.Bottom,targetPosition:a=q.Top,label:c,labelStyle:u,labelShowBg:f,labelBgStyle:l,labelBgPadding:d,labelBgBorderRadius:p,style:g,markerEnd:x,markerStart:v,pathOptions:m,interactionWidth:b})=>{const[h,w,_]=Or({sourceX:n,sourceY:o,sourcePosition:s,targetX:r,targetY:i,targetPosition:a,curvature:m==null?void 0:m.curvature}),S=e.isInternal?void 0:t;return y.jsx(Ut,{id:S,path:h,labelX:w,labelY:_,label:c,labelStyle:u,labelShowBg:f,labelBgStyle:l,labelBgPadding:d,labelBgBorderRadius:p,style:g,markerEnd:x,markerStart:v,interactionWidth:b})})}const Vf=zi({isInternal:!1}),Pi=zi({isInternal:!0});Vf.displayName="BezierEdge";Pi.displayName="BezierEdgeInternal";const Xo={default:Pi,straight:Ai,step:Mi,smoothstep:Ni,simplebezier:Si},Go={sourceX:null,sourceY:null,targetX:null,targetY:null,sourcePosition:null,targetPosition:null},Of=(e,t,n)=>n===q.Left?e-t:n===q.Right?e+t:e,Wf=(e,t,n)=>n===q.Top?e-t:n===q.Bottom?e+t:e,qo="react-flow__edgeupdater";function Uo({position:e,centerX:t,centerY:n,radius:o=10,onMouseDown:r,onMouseEnter:i,onMouseOut:s,type:a}){return y.jsx("circle",{onMouseDown:r,onMouseEnter:i,onMouseOut:s,className:se([qo,`${qo}-${a}`]),cx:Of(t,o,e),cy:Wf(n,o,e),r:o,stroke:"transparent",fill:"transparent"})}function Yf({isReconnectable:e,reconnectRadius:t,edge:n,sourceX:o,sourceY:r,targetX:i,targetY:s,sourcePosition:a,targetPosition:c,onReconnect:u,onReconnectStart:f,onReconnectEnd:l,setReconnecting:d,setUpdateHover:p}){const g=ie(),x=(w,_)=>{if(w.button!==0)return;const{autoPanOnConnect:S,domNode:N,connectionMode:F,connectionRadius:T,lib:H,onConnectStart:A,cancelConnection:j,nodeLookup:B,rfId:E,panBy:z,updateConnection:C}=g.getState(),P=_.type==="target",M=(L,R)=>{d(!1),l==null||l(L,n,_.type,R)},k=L=>u==null?void 0:u(n,L),D=(L,R)=>{d(!0),f==null||f(w,n,_.type),A==null||A(L,R)};Sn.onPointerDown(w.nativeEvent,{autoPanOnConnect:S,connectionMode:F,connectionRadius:T,domNode:N,handleId:_.id,nodeId:_.nodeId,nodeLookup:B,isTarget:P,edgeUpdaterType:_.type,lib:H,flowId:E,cancelConnection:j,panBy:z,isValidConnection:(...L)=>{var R,W;return((W=(R=g.getState()).isValidConnection)==null?void 0:W.call(R,...L))??!0},onConnect:k,onConnectStart:D,onConnectEnd:(...L)=>{var R,W;return(W=(R=g.getState()).onConnectEnd)==null?void 0:W.call(R,...L)},onReconnectEnd:M,updateConnection:C,getTransform:()=>g.getState().transform,getFromHandle:()=>g.getState().connection.fromHandle,dragThreshold:g.getState().connectionDragThreshold,handleDomNode:w.currentTarget})},v=w=>x(w,{nodeId:n.target,id:n.targetHandle??null,type:"target"}),m=w=>x(w,{nodeId:n.source,id:n.sourceHandle??null,type:"source"}),b=()=>p(!0),h=()=>p(!1);return y.jsxs(y.Fragment,{children:[(e===!0||e==="source")&&y.jsx(Uo,{position:a,centerX:o,centerY:r,radius:t,onMouseDown:v,onMouseEnter:b,onMouseOut:h,type:"source"}),(e===!0||e==="target")&&y.jsx(Uo,{position:c,centerX:i,centerY:s,radius:t,onMouseDown:m,onMouseEnter:b,onMouseOut:h,type:"target"})]})}function Xf({id:e,edgesFocusable:t,edgesReconnectable:n,elementsSelectable:o,onClick:r,onDoubleClick:i,onContextMenu:s,onMouseEnter:a,onMouseMove:c,onMouseLeave:u,reconnectRadius:f,onReconnect:l,onReconnectStart:d,onReconnectEnd:p,rfId:g,edgeTypes:x,noPanClassName:v,onError:m,disableKeyboardA11y:b}){let h=ee(K=>K.edgeLookup.get(e));const w=ee(K=>K.defaultEdgeOptions);h=w?{...w,...h}:h;let _=h.type||"default",S=(x==null?void 0:x[_])||Xo[_];S===void 0&&(m==null||m("011",pe.error011(_)),_="default",S=(x==null?void 0:x.default)||Xo.default);const N=!!(h.focusable||t&&typeof h.focusable>"u"),F=typeof l<"u"&&(h.reconnectable||n&&typeof h.reconnectable>"u"),T=!!(h.selectable||o&&typeof h.selectable>"u"),H=I.useRef(null),[A,j]=I.useState(!1),[B,E]=I.useState(!1),z=ie(),{zIndex:C,sourceX:P,sourceY:M,targetX:k,targetY:D,sourcePosition:L,targetPosition:R}=ee(I.useCallback(K=>{const U=K.nodeLookup.get(h.source),ne=K.nodeLookup.get(h.target);if(!U||!ne)return{zIndex:h.zIndex,...Go};const oe=$u({id:e,sourceNode:U,targetNode:ne,sourceHandle:h.sourceHandle||null,targetHandle:h.targetHandle||null,connectionMode:K.connectionMode,onError:m});return{zIndex:Iu({selected:h.selected,zIndex:h.zIndex,sourceNode:U,targetNode:ne,elevateOnSelect:K.elevateEdgesOnSelect,zIndexMode:K.zIndexMode}),...oe||Go}},[h.source,h.target,h.sourceHandle,h.targetHandle,h.selected,h.zIndex]),re),W=I.useMemo(()=>h.markerStart?`url('#${bn(h.markerStart,g)}')`:void 0,[h.markerStart,g]),X=I.useMemo(()=>h.markerEnd?`url('#${bn(h.markerEnd,g)}')`:void 0,[h.markerEnd,g]);if(h.hidden||P===null||M===null||k===null||D===null)return null;const $=K=>{var te;const{addSelectedEdges:U,unselectNodesAndEdges:ne,multiSelectionActive:oe}=z.getState();T&&(z.setState({nodesSelectionActive:!1}),h.selected&&oe?(ne({nodes:[],edges:[h]}),(te=H.current)==null||te.blur()):U([e])),r&&r(K,h)},O=i?K=>{i(K,{...h})}:void 0,Y=s?K=>{s(K,{...h})}:void 0,V=a?K=>{a(K,{...h})}:void 0,G=c?K=>{c(K,{...h})}:void 0,Q=u?K=>{u(K,{...h})}:void 0,Z=K=>{var U;if(!b&&Mr.includes(K.key)&&T){const{unselectNodesAndEdges:ne,addSelectedEdges:oe}=z.getState();K.key==="Escape"?((U=H.current)==null||U.blur(),ne({edges:[h]})):oe([e])}};return y.jsx("svg",{style:{zIndex:C},children:y.jsxs("g",{className:se(["react-flow__edge",`react-flow__edge-${_}`,h.className,v,{selected:h.selected,animated:h.animated,inactive:!T&&!r,updating:A,selectable:T}]),onClick:$,onDoubleClick:O,onContextMenu:Y,onMouseEnter:V,onMouseMove:G,onMouseLeave:Q,onKeyDown:N?Z:void 0,tabIndex:N?0:void 0,role:h.ariaRole??(N?"group":"img"),"aria-roledescription":"edge","data-id":e,"data-testid":`rf__edge-${e}`,"aria-label":h.ariaLabel===null?void 0:h.ariaLabel||`Edge from ${h.source} to ${h.target}`,"aria-describedby":N?`${ai}-${g}`:void 0,ref:H,...h.domAttributes,children:[!B&&y.jsx(S,{id:e,source:h.source,target:h.target,type:h.type,selected:h.selected,animated:h.animated,selectable:T,deletable:h.deletable??!0,label:h.label,labelStyle:h.labelStyle,labelShowBg:h.labelShowBg,labelBgStyle:h.labelBgStyle,labelBgPadding:h.labelBgPadding,labelBgBorderRadius:h.labelBgBorderRadius,sourceX:P,sourceY:M,targetX:k,targetY:D,sourcePosition:L,targetPosition:R,data:h.data,style:h.style,sourceHandleId:h.sourceHandle,targetHandleId:h.targetHandle,markerStart:W,markerEnd:X,pathOptions:"pathOptions"in h?h.pathOptions:void 0,interactionWidth:h.interactionWidth}),F&&y.jsx(Yf,{edge:h,isReconnectable:F,reconnectRadius:f,onReconnect:l,onReconnectStart:d,onReconnectEnd:p,sourceX:P,sourceY:M,targetX:k,targetY:D,sourcePosition:L,targetPosition:R,setUpdateHover:j,setReconnecting:E})]})})}var Gf=I.memo(Xf);const qf=e=>({edgesFocusable:e.edgesFocusable,edgesReconnectable:e.edgesReconnectable,elementsSelectable:e.elementsSelectable,connectionMode:e.connectionMode,onError:e.onError});function ji({defaultMarkerColor:e,onlyRenderVisibleElements:t,rfId:n,edgeTypes:o,noPanClassName:r,onReconnect:i,onEdgeContextMenu:s,onEdgeMouseEnter:a,onEdgeMouseMove:c,onEdgeMouseLeave:u,onEdgeClick:f,reconnectRadius:l,onEdgeDoubleClick:d,onReconnectStart:p,onReconnectEnd:g,disableKeyboardA11y:x}){const{edgesFocusable:v,edgesReconnectable:m,elementsSelectable:b,onError:h}=ee(qf,re),w=Pf(t);return y.jsxs("div",{className:"react-flow__edges",children:[y.jsx(Df,{defaultColor:e,rfId:n}),w.map(_=>y.jsx(Gf,{id:_,edgesFocusable:v,edgesReconnectable:m,elementsSelectable:b,noPanClassName:r,onReconnect:i,onContextMenu:s,onMouseEnter:a,onMouseMove:c,onMouseLeave:u,onClick:f,reconnectRadius:l,onDoubleClick:d,onReconnectStart:p,onReconnectEnd:g,rfId:n,onError:h,edgeTypes:o,disableKeyboardA11y:x},_))]})}ji.displayName="EdgeRenderer";const Uf=I.memo(ji),Kf=e=>`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]})`;function Zf({children:e}){const t=ee(Kf);return y.jsx("div",{className:"react-flow__viewport xyflow__viewport react-flow__container",style:{transform:t},children:e})}function Qf(e){const t=Gt(),n=I.useRef(!1);I.useEffect(()=>{!n.current&&t.viewportInitialized&&e&&(setTimeout(()=>e(t),1),n.current=!0)},[e,t.viewportInitialized])}const Jf=e=>{var t;return(t=e.panZoom)==null?void 0:t.syncViewport};function eh(e){const t=ee(Jf),n=ie();return I.useEffect(()=>{e&&(t==null||t(e),n.setState({transform:[e.x,e.y,e.zoom]}))},[e,t]),null}function th(e){return e.connection.inProgress?{...e.connection,to:pt(e.connection.to,e.transform)}:{...e.connection}}function nh(e){return th}function oh(e){const t=nh();return ee(t,re)}const rh=e=>({nodesConnectable:e.nodesConnectable,isValid:e.connection.isValid,inProgress:e.connection.inProgress,width:e.width,height:e.height});function ih({containerStyle:e,style:t,type:n,component:o}){const{nodesConnectable:r,width:i,height:s,isValid:a,inProgress:c}=ee(rh,re);return!(i&&r&&c)?null:y.jsx("svg",{style:e,width:i,height:s,className:"react-flow__connectionline react-flow__container",children:y.jsx("g",{className:se(["react-flow__connection",zr(a)]),children:y.jsx(Fi,{style:t,type:n,CustomComponent:o,isValid:a})})})}const Fi=({style:e,type:t=Ne.Bezier,CustomComponent:n,isValid:o})=>{const{inProgress:r,from:i,fromNode:s,fromHandle:a,fromPosition:c,to:u,toNode:f,toHandle:l,toPosition:d,pointer:p}=oh();if(!r)return;if(n)return y.jsx(n,{connectionLineType:t,connectionLineStyle:e,fromNode:s,fromHandle:a,fromX:i.x,fromY:i.y,toX:u.x,toY:u.y,fromPosition:c,toPosition:d,connectionStatus:zr(o),toNode:f,toHandle:l,pointer:p});let g="";const x={sourceX:i.x,sourceY:i.y,sourcePosition:c,targetX:u.x,targetY:u.y,targetPosition:d};switch(t){case Ne.Bezier:[g]=Or(x);break;case Ne.SimpleBezier:[g]=bi(x);break;case Ne.Step:[g]=vn({...x,borderRadius:0});break;case Ne.SmoothStep:[g]=vn(x);break;default:[g]=Xr(x)}return y.jsx("path",{d:g,fill:"none",className:"react-flow__connection-path",style:e})};Fi.displayName="ConnectionLine";const sh={};function Ko(e=sh){I.useRef(e),ie(),I.useEffect(()=>{},[e])}function ah(){ie(),I.useRef(!1),I.useEffect(()=>{},[])}function Ti({nodeTypes:e,edgeTypes:t,onInit:n,onNodeClick:o,onEdgeClick:r,onNodeDoubleClick:i,onEdgeDoubleClick:s,onNodeMouseEnter:a,onNodeMouseMove:c,onNodeMouseLeave:u,onNodeContextMenu:f,onSelectionContextMenu:l,onSelectionStart:d,onSelectionEnd:p,connectionLineType:g,connectionLineStyle:x,connectionLineComponent:v,connectionLineContainerStyle:m,selectionKeyCode:b,selectionOnDrag:h,selectionMode:w,multiSelectionKeyCode:_,panActivationKeyCode:S,zoomActivationKeyCode:N,deleteKeyCode:F,onlyRenderVisibleElements:T,elementsSelectable:H,defaultViewport:A,translateExtent:j,minZoom:B,maxZoom:E,preventScrolling:z,defaultMarkerColor:C,zoomOnScroll:P,zoomOnPinch:M,panOnScroll:k,panOnScrollSpeed:D,panOnScrollMode:L,zoomOnDoubleClick:R,panOnDrag:W,onPaneClick:X,onPaneMouseEnter:$,onPaneMouseMove:O,onPaneMouseLeave:Y,onPaneScroll:V,onPaneContextMenu:G,paneClickDistance:Q,nodeClickDistance:Z,onEdgeContextMenu:K,onEdgeMouseEnter:U,onEdgeMouseMove:ne,onEdgeMouseLeave:oe,reconnectRadius:te,onReconnect:ae,onReconnectStart:Se,onReconnectEnd:ye,noDragClassName:ke,noWheelClassName:Ue,noPanClassName:Ke,disableKeyboardA11y:Ze,nodeExtent:Kt,rfId:mt,viewport:Fe,onViewportChange:Qe}){return Ko(e),Ko(t),ah(),Qf(n),eh(Fe),y.jsx(Ef,{onPaneClick:X,onPaneMouseEnter:$,onPaneMouseMove:O,onPaneMouseLeave:Y,onPaneContextMenu:G,onPaneScroll:V,paneClickDistance:Q,deleteKeyCode:F,selectionKeyCode:b,selectionOnDrag:h,selectionMode:w,onSelectionStart:d,onSelectionEnd:p,multiSelectionKeyCode:_,panActivationKeyCode:S,zoomActivationKeyCode:N,elementsSelectable:H,zoomOnScroll:P,zoomOnPinch:M,zoomOnDoubleClick:R,panOnScroll:k,panOnScrollSpeed:D,panOnScrollMode:L,panOnDrag:W,defaultViewport:A,translateExtent:j,minZoom:B,maxZoom:E,onSelectionContextMenu:l,preventScrolling:z,noDragClassName:ke,noWheelClassName:Ue,noPanClassName:Ke,disableKeyboardA11y:Ze,onViewportChange:Qe,isControlledViewport:!!Fe,children:y.jsxs(Zf,{children:[y.jsx(Uf,{edgeTypes:t,onEdgeClick:r,onEdgeDoubleClick:s,onReconnect:ae,onReconnectStart:Se,onReconnectEnd:ye,onlyRenderVisibleElements:T,onEdgeContextMenu:K,onEdgeMouseEnter:U,onEdgeMouseMove:ne,onEdgeMouseLeave:oe,reconnectRadius:te,defaultMarkerColor:C,noPanClassName:Ke,disableKeyboardA11y:Ze,rfId:mt}),y.jsx(ih,{style:x,type:g,component:v,containerStyle:m}),y.jsx("div",{className:"react-flow__edgelabel-renderer"}),y.jsx(zf,{nodeTypes:e,onNodeClick:o,onNodeDoubleClick:i,onNodeMouseEnter:a,onNodeMouseMove:c,onNodeMouseLeave:u,onNodeContextMenu:f,nodeClickDistance:Z,onlyRenderVisibleElements:T,noPanClassName:Ke,noDragClassName:ke,disableKeyboardA11y:Ze,nodeExtent:Kt,rfId:mt}),y.jsx("div",{className:"react-flow__viewport-portal"})]})})}Ti.displayName="GraphView";const ch=I.memo(Ti),Zo=({nodes:e,edges:t,defaultNodes:n,defaultEdges:o,width:r,height:i,fitView:s,fitViewOptions:a,minZoom:c=.5,maxZoom:u=2,nodeOrigin:f,nodeExtent:l,zIndexMode:d="basic"}={})=>{const p=new Map,g=new Map,x=new Map,v=new Map,m=o??t??[],b=n??e??[],h=f??[0,0],w=l??st;Ur(x,v,m);const _=En(b,p,g,{nodeOrigin:h,nodeExtent:w,zIndexMode:d});let S=[0,0,1];if(s&&r&&i){const N=ht(p,{filter:A=>!!((A.width||A.initialWidth)&&(A.height||A.initialHeight))}),{x:F,y:T,zoom:H}=Fn(N,r,i,c,u,(a==null?void 0:a.padding)??.1);S=[F,T,H]}return{rfId:"1",width:r??0,height:i??0,transform:S,nodes:b,nodesInitialized:_,nodeLookup:p,parentLookup:g,edges:m,edgeLookup:v,connectionLookup:x,onNodesChange:null,onEdgesChange:null,hasDefaultNodes:n!==void 0,hasDefaultEdges:o!==void 0,panZoom:null,minZoom:c,maxZoom:u,translateExtent:st,nodeExtent:w,nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,connectionMode:Oe.Strict,domNode:null,paneDragging:!1,noPanClassName:"nopan",nodeOrigin:h,nodeDragThreshold:1,connectionDragThreshold:1,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,nodesFocusable:!0,edgesFocusable:!0,edgesReconnectable:!0,elementsSelectable:!0,elevateNodesOnSelect:!0,elevateEdgesOnSelect:!0,selectNodesOnDrag:!0,multiSelectionActive:!1,fitViewQueued:s??!1,fitViewOptions:a,fitViewResolver:null,connection:{...Ar},connectionClickStartHandle:null,connectOnClick:!0,ariaLiveMessage:"",autoPanOnConnect:!0,autoPanOnNodeDrag:!0,autoPanOnNodeFocus:!0,autoPanSpeed:15,connectionRadius:20,onError:Su,isValidConnection:void 0,onSelectionChangeHandlers:[],lib:"react",debug:!1,ariaLabelConfig:Ir,zIndexMode:d,onNodesChangeMiddlewareMap:new Map,onEdgesChangeMiddlewareMap:new Map}},lh=({nodes:e,edges:t,defaultNodes:n,defaultEdges:o,width:r,height:i,fitView:s,fitViewOptions:a,minZoom:c,maxZoom:u,nodeOrigin:f,nodeExtent:l,zIndexMode:d})=>Nd((p,g)=>{async function x(){const{nodeLookup:v,panZoom:m,fitViewOptions:b,fitViewResolver:h,width:w,height:_,minZoom:S,maxZoom:N}=g();m&&(await bu({nodes:v,width:w,height:_,panZoom:m,minZoom:S,maxZoom:N},b),h==null||h.resolve(!0),p({fitViewResolver:null}))}return{...Zo({nodes:e,edges:t,width:r,height:i,fitView:s,fitViewOptions:a,minZoom:c,maxZoom:u,nodeOrigin:f,nodeExtent:l,defaultNodes:n,defaultEdges:o,zIndexMode:d}),setNodes:v=>{const{nodeLookup:m,parentLookup:b,nodeOrigin:h,elevateNodesOnSelect:w,fitViewQueued:_,zIndexMode:S}=g(),N=En(v,m,b,{nodeOrigin:h,nodeExtent:l,elevateNodesOnSelect:w,checkEquality:!0,zIndexMode:S});_&&N?(x(),p({nodes:v,nodesInitialized:N,fitViewQueued:!1,fitViewOptions:void 0})):p({nodes:v,nodesInitialized:N})},setEdges:v=>{const{connectionLookup:m,edgeLookup:b}=g();Ur(m,b,v),p({edges:v})},setDefaultNodesAndEdges:(v,m)=>{if(v){const{setNodes:b}=g();b(v),p({hasDefaultNodes:!0})}if(m){const{setEdges:b}=g();b(m),p({hasDefaultEdges:!0})}},updateNodeInternals:v=>{const{triggerNodeChanges:m,nodeLookup:b,parentLookup:h,domNode:w,nodeOrigin:_,nodeExtent:S,debug:N,fitViewQueued:F,zIndexMode:T}=g(),{changes:H,updatedInternals:A}=Wu(v,b,h,w,_,S,T);A&&(Bu(b,h,{nodeOrigin:_,nodeExtent:S,zIndexMode:T}),F?(x(),p({fitViewQueued:!1,fitViewOptions:void 0})):p({}),(H==null?void 0:H.length)>0&&(N&&console.log("React Flow: trigger node changes",H),m==null||m(H)))},updateNodePositions:(v,m=!1)=>{const b=[];let h=[];const{nodeLookup:w,triggerNodeChanges:_,connection:S,updateConnection:N,onNodesChangeMiddlewareMap:F}=g();for(const[T,H]of v){const A=w.get(T),j=!!(A!=null&&A.expandParent&&(A!=null&&A.parentId)&&(H!=null&&H.position)),B={id:T,type:"position",position:j?{x:Math.max(0,H.position.x),y:Math.max(0,H.position.y)}:H.position,dragging:m};if(A&&S.inProgress&&S.fromNode.id===A.id){const E=je(A,S.fromHandle,q.Left,!0);N({...S,from:E})}j&&A.parentId&&b.push({id:T,parentId:A.parentId,rect:{...H.internals.positionAbsolute,width:H.measured.width??0,height:H.measured.height??0}}),h.push(B)}if(b.length>0){const{parentLookup:T,nodeOrigin:H}=g(),A=Bn(b,w,T,H);h.push(...A)}for(const T of F.values())h=T(h);_(h)},triggerNodeChanges:v=>{const{onNodesChange:m,setNodes:b,nodes:h,hasDefaultNodes:w,debug:_}=g();if(v!=null&&v.length){if(w){const S=ui(v,h);b(S)}_&&console.log("React Flow: trigger node changes",v),m==null||m(v)}},triggerEdgeChanges:v=>{const{onEdgesChange:m,setEdges:b,edges:h,hasDefaultEdges:w,debug:_}=g();if(v!=null&&v.length){if(w){const S=di(v,h);b(S)}_&&console.log("React Flow: trigger edge changes",v),m==null||m(v)}},addSelectedNodes:v=>{const{multiSelectionActive:m,edgeLookup:b,nodeLookup:h,triggerNodeChanges:w,triggerEdgeChanges:_}=g();if(m){const S=v.map(N=>Ie(N,!0));w(S);return}w(Le(h,new Set([...v]),!0)),_(Le(b))},addSelectedEdges:v=>{const{multiSelectionActive:m,edgeLookup:b,nodeLookup:h,triggerNodeChanges:w,triggerEdgeChanges:_}=g();if(m){const S=v.map(N=>Ie(N,!0));_(S);return}_(Le(b,new Set([...v]))),w(Le(h,new Set,!0))},unselectNodesAndEdges:({nodes:v,edges:m}={})=>{const{edges:b,nodes:h,nodeLookup:w,triggerNodeChanges:_,triggerEdgeChanges:S}=g(),N=v||h,F=m||b,T=[];for(const A of N){if(!A.selected)continue;const j=w.get(A.id);j&&(j.selected=!1),T.push(Ie(A.id,!1))}const H=[];for(const A of F)A.selected&&H.push(Ie(A.id,!1));_(T),S(H)},setMinZoom:v=>{const{panZoom:m,maxZoom:b}=g();m==null||m.setScaleExtent([v,b]),p({minZoom:v})},setMaxZoom:v=>{const{panZoom:m,minZoom:b}=g();m==null||m.setScaleExtent([b,v]),p({maxZoom:v})},setTranslateExtent:v=>{var m;(m=g().panZoom)==null||m.setTranslateExtent(v),p({translateExtent:v})},resetSelectedElements:()=>{const{edges:v,nodes:m,triggerNodeChanges:b,triggerEdgeChanges:h,elementsSelectable:w}=g();if(!w)return;const _=m.reduce((N,F)=>F.selected?[...N,Ie(F.id,!1)]:N,[]),S=v.reduce((N,F)=>F.selected?[...N,Ie(F.id,!1)]:N,[]);b(_),h(S)},setNodeExtent:v=>{const{nodes:m,nodeLookup:b,parentLookup:h,nodeOrigin:w,elevateNodesOnSelect:_,nodeExtent:S,zIndexMode:N}=g();v[0][0]===S[0][0]&&v[0][1]===S[0][1]&&v[1][0]===S[1][0]&&v[1][1]===S[1][1]||(En(m,b,h,{nodeOrigin:w,nodeExtent:v,elevateNodesOnSelect:_,checkEquality:!1,zIndexMode:N}),p({nodeExtent:v}))},panBy:v=>{const{transform:m,width:b,height:h,panZoom:w,translateExtent:_}=g();return Yu({delta:v,panZoom:w,transform:m,translateExtent:_,width:b,height:h})},setCenter:async(v,m,b)=>{const{width:h,height:w,maxZoom:_,panZoom:S}=g();if(!S)return Promise.resolve(!1);const N=typeof(b==null?void 0:b.zoom)<"u"?b.zoom:_;return await S.setViewport({x:h/2-v*N,y:w/2-m*N,zoom:N},{duration:b==null?void 0:b.duration,ease:b==null?void 0:b.ease,interpolate:b==null?void 0:b.interpolate}),Promise.resolve(!0)},cancelConnection:()=>{p({connection:{...Ar}})},updateConnection:v=>{p({connection:v})},reset:()=>p({...Zo()})}},Object.is);function $i({initialNodes:e,initialEdges:t,defaultNodes:n,defaultEdges:o,initialWidth:r,initialHeight:i,initialMinZoom:s,initialMaxZoom:a,initialFitViewOptions:c,fitView:u,nodeOrigin:f,nodeExtent:l,zIndexMode:d,children:p}){const[g]=I.useState(()=>lh({nodes:e,edges:t,defaultNodes:n,defaultEdges:o,width:r,height:i,fitView:u,minZoom:s,maxZoom:a,fitViewOptions:c,nodeOrigin:f,nodeExtent:l,zIndexMode:d}));return y.jsx(kd,{value:g,children:y.jsx(Kd,{children:p})})}function uh({children:e,nodes:t,edges:n,defaultNodes:o,defaultEdges:r,width:i,height:s,fitView:a,fitViewOptions:c,minZoom:u,maxZoom:f,nodeOrigin:l,nodeExtent:d,zIndexMode:p}){return I.useContext(Xt)?y.jsx(y.Fragment,{children:e}):y.jsx($i,{initialNodes:t,initialEdges:n,defaultNodes:o,defaultEdges:r,initialWidth:i,initialHeight:s,fitView:a,initialFitViewOptions:c,initialMinZoom:u,initialMaxZoom:f,nodeOrigin:l,nodeExtent:d,zIndexMode:p,children:e})}const dh={width:"100%",height:"100%",overflow:"hidden",position:"relative",zIndex:0};function fh({nodes:e,edges:t,defaultNodes:n,defaultEdges:o,className:r,nodeTypes:i,edgeTypes:s,onNodeClick:a,onEdgeClick:c,onInit:u,onMove:f,onMoveStart:l,onMoveEnd:d,onConnect:p,onConnectStart:g,onConnectEnd:x,onClickConnectStart:v,onClickConnectEnd:m,onNodeMouseEnter:b,onNodeMouseMove:h,onNodeMouseLeave:w,onNodeContextMenu:_,onNodeDoubleClick:S,onNodeDragStart:N,onNodeDrag:F,onNodeDragStop:T,onNodesDelete:H,onEdgesDelete:A,onDelete:j,onSelectionChange:B,onSelectionDragStart:E,onSelectionDrag:z,onSelectionDragStop:C,onSelectionContextMenu:P,onSelectionStart:M,onSelectionEnd:k,onBeforeDelete:D,connectionMode:L,connectionLineType:R=Ne.Bezier,connectionLineStyle:W,connectionLineComponent:X,connectionLineContainerStyle:$,deleteKeyCode:O="Backspace",selectionKeyCode:Y="Shift",selectionOnDrag:V=!1,selectionMode:G=at.Full,panActivationKeyCode:Q="Space",multiSelectionKeyCode:Z=lt()?"Meta":"Control",zoomActivationKeyCode:K=lt()?"Meta":"Control",snapToGrid:U,snapGrid:ne,onlyRenderVisibleElements:oe=!1,selectNodesOnDrag:te,nodesDraggable:ae,autoPanOnNodeFocus:Se,nodesConnectable:ye,nodesFocusable:ke,nodeOrigin:Ue=ci,edgesFocusable:Ke,edgesReconnectable:Ze,elementsSelectable:Kt=!0,defaultViewport:mt=Bd,minZoom:Fe=.5,maxZoom:Qe=2,translateExtent:Vn=st,preventScrolling:Hi=!0,nodeExtent:Zt,defaultMarkerColor:Vi="#b1b1b7",zoomOnScroll:Oi=!0,zoomOnPinch:Wi=!0,panOnScroll:Yi=!1,panOnScrollSpeed:Xi=.5,panOnScrollMode:Gi=Ae.Free,zoomOnDoubleClick:qi=!0,panOnDrag:Ui=!0,onPaneClick:Ki,onPaneMouseEnter:Zi,onPaneMouseMove:Qi,onPaneMouseLeave:Ji,onPaneScroll:es,onPaneContextMenu:ts,paneClickDistance:ns=1,nodeClickDistance:os=0,children:rs,onReconnect:is,onReconnectStart:ss,onReconnectEnd:as,onEdgeContextMenu:cs,onEdgeDoubleClick:ls,onEdgeMouseEnter:us,onEdgeMouseMove:ds,onEdgeMouseLeave:fs,reconnectRadius:hs=10,onNodesChange:gs,onEdgesChange:ps,noDragClassName:ms="nodrag",noWheelClassName:ys="nowheel",noPanClassName:On="nopan",fitView:Wn,fitViewOptions:Yn,connectOnClick:xs,attributionPosition:ws,proOptions:vs,defaultEdgeOptions:bs,elevateNodesOnSelect:Es=!0,elevateEdgesOnSelect:Ss=!1,disableKeyboardA11y:Xn=!1,autoPanOnConnect:_s,autoPanOnNodeDrag:Cs,autoPanSpeed:Ns,connectionRadius:ks,isValidConnection:Ms,onError:Is,style:As,id:Gn,nodeDragThreshold:zs,connectionDragThreshold:Ps,viewport:js,onViewportChange:Fs,width:Ts,height:$s,colorMode:Ds="light",debug:Rs,onScroll:yt,ariaLabelConfig:Ls,zIndexMode:qn="basic",...Bs},Hs){const Qt=Gn||"1",Vs=Wd(Ds),Os=I.useCallback(Un=>{Un.currentTarget.scrollTo({top:0,left:0,behavior:"instant"}),yt==null||yt(Un)},[yt]);return y.jsx("div",{"data-testid":"rf__wrapper",...Bs,onScroll:Os,style:{...As,...dh},ref:Hs,className:se(["react-flow",r,Vs]),id:Gn,role:"application",children:y.jsxs(uh,{nodes:e,edges:t,width:Ts,height:$s,fitView:Wn,fitViewOptions:Yn,minZoom:Fe,maxZoom:Qe,nodeOrigin:Ue,nodeExtent:Zt,zIndexMode:qn,children:[y.jsx(ch,{onInit:u,onNodeClick:a,onEdgeClick:c,onNodeMouseEnter:b,onNodeMouseMove:h,onNodeMouseLeave:w,onNodeContextMenu:_,onNodeDoubleClick:S,nodeTypes:i,edgeTypes:s,connectionLineType:R,connectionLineStyle:W,connectionLineComponent:X,connectionLineContainerStyle:$,selectionKeyCode:Y,selectionOnDrag:V,selectionMode:G,deleteKeyCode:O,multiSelectionKeyCode:Z,panActivationKeyCode:Q,zoomActivationKeyCode:K,onlyRenderVisibleElements:oe,defaultViewport:mt,translateExtent:Vn,minZoom:Fe,maxZoom:Qe,preventScrolling:Hi,zoomOnScroll:Oi,zoomOnPinch:Wi,zoomOnDoubleClick:qi,panOnScroll:Yi,panOnScrollSpeed:Xi,panOnScrollMode:Gi,panOnDrag:Ui,onPaneClick:Ki,onPaneMouseEnter:Zi,onPaneMouseMove:Qi,onPaneMouseLeave:Ji,onPaneScroll:es,onPaneContextMenu:ts,paneClickDistance:ns,nodeClickDistance:os,onSelectionContextMenu:P,onSelectionStart:M,onSelectionEnd:k,onReconnect:is,onReconnectStart:ss,onReconnectEnd:as,onEdgeContextMenu:cs,onEdgeDoubleClick:ls,onEdgeMouseEnter:us,onEdgeMouseMove:ds,onEdgeMouseLeave:fs,reconnectRadius:hs,defaultMarkerColor:Vi,noDragClassName:ms,noWheelClassName:ys,noPanClassName:On,rfId:Qt,disableKeyboardA11y:Xn,nodeExtent:Zt,viewport:js,onViewportChange:Fs}),y.jsx(Od,{nodes:e,edges:t,defaultNodes:n,defaultEdges:o,onConnect:p,onConnectStart:g,onConnectEnd:x,onClickConnectStart:v,onClickConnectEnd:m,nodesDraggable:ae,autoPanOnNodeFocus:Se,nodesConnectable:ye,nodesFocusable:ke,edgesFocusable:Ke,edgesReconnectable:Ze,elementsSelectable:Kt,elevateNodesOnSelect:Es,elevateEdgesOnSelect:Ss,minZoom:Fe,maxZoom:Qe,nodeExtent:Zt,onNodesChange:gs,onEdgesChange:ps,snapToGrid:U,snapGrid:ne,connectionMode:L,translateExtent:Vn,connectOnClick:xs,defaultEdgeOptions:bs,fitView:Wn,fitViewOptions:Yn,onNodesDelete:H,onEdgesDelete:A,onDelete:j,onNodeDragStart:N,onNodeDrag:F,onNodeDragStop:T,onSelectionDrag:z,onSelectionDragStart:E,onSelectionDragStop:C,onMove:f,onMoveStart:l,onMoveEnd:d,noPanClassName:On,nodeOrigin:Ue,rfId:Qt,autoPanOnConnect:_s,autoPanOnNodeDrag:Cs,autoPanSpeed:Ns,onError:Is,connectionRadius:ks,isValidConnection:Ms,selectNodesOnDrag:te,nodeDragThreshold:zs,connectionDragThreshold:Ps,onBeforeDelete:D,debug:Rs,ariaLabelConfig:Ls,zIndexMode:qn}),y.jsx(Ld,{onSelectionChange:B}),rs,y.jsx(Fd,{proOptions:vs,position:ws}),y.jsx(jd,{rfId:Qt,disableKeyboardA11y:Xn})]})})}var hh=fi(fh);function gh(e){const[t,n]=I.useState(e),o=I.useCallback(r=>n(i=>ui(r,i)),[]);return[t,n,o]}function ph(e){const[t,n]=I.useState(e),o=I.useCallback(r=>n(i=>di(r,i)),[]);return[t,n,o]}function mh({dimensions:e,lineWidth:t,variant:n,className:o}){return y.jsx("path",{strokeWidth:t,d:`M${e[0]/2} 0 V${e[1]} M0 ${e[1]/2} H${e[0]}`,className:se(["react-flow__background-pattern",n,o])})}function yh({radius:e,className:t}){return y.jsx("circle",{cx:e,cy:e,r:e,className:se(["react-flow__background-pattern","dots",t])})}var ve;(function(e){e.Lines="lines",e.Dots="dots",e.Cross="cross"})(ve||(ve={}));const xh={[ve.Dots]:1,[ve.Lines]:1,[ve.Cross]:6},wh=e=>({transform:e.transform,patternId:`pattern-${e.rfId}`});function Di({id:e,variant:t=ve.Dots,gap:n=20,size:o,lineWidth:r=1,offset:i=0,color:s,bgColor:a,style:c,className:u,patternClassName:f}){const l=I.useRef(null),{transform:d,patternId:p}=ee(wh,re),g=o||xh[t],x=t===ve.Dots,v=t===ve.Cross,m=Array.isArray(n)?n:[n,n],b=[m[0]*d[2]||1,m[1]*d[2]||1],h=g*d[2],w=Array.isArray(i)?i:[i,i],_=v?[h,h]:b,S=[w[0]*d[2]||1+_[0]/2,w[1]*d[2]||1+_[1]/2],N=`${p}${e||""}`;return y.jsxs("svg",{className:se(["react-flow__background",u]),style:{...c,...qt,"--xy-background-color-props":a,"--xy-background-pattern-color-props":s},ref:l,"data-testid":"rf__background",children:[y.jsx("pattern",{id:N,x:d[0]%b[0],y:d[1]%b[1],width:b[0],height:b[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${S[0]},-${S[1]})`,children:x?y.jsx(yh,{radius:h/2,className:f}):y.jsx(mh,{dimensions:_,lineWidth:r,variant:t,className:f})}),y.jsx("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${N})`})]})}Di.displayName="Background";const vh=I.memo(Di);function bh(){return y.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",children:y.jsx("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"})})}function Eh(){return y.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5",children:y.jsx("path",{d:"M0 0h32v4.2H0z"})})}function Sh(){return y.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30",children:y.jsx("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"})})}function _h(){return y.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:y.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"})})}function Ch(){return y.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:y.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"})})}function _t({children:e,className:t,...n}){return y.jsx("button",{type:"button",className:se(["react-flow__controls-button",t]),...n,children:e})}const Nh=e=>({isInteractive:e.nodesDraggable||e.nodesConnectable||e.elementsSelectable,minZoomReached:e.transform[2]<=e.minZoom,maxZoomReached:e.transform[2]>=e.maxZoom,ariaLabelConfig:e.ariaLabelConfig});function Ri({style:e,showZoom:t=!0,showFitView:n=!0,showInteractive:o=!0,fitViewOptions:r,onZoomIn:i,onZoomOut:s,onFitView:a,onInteractiveChange:c,className:u,children:f,position:l="bottom-left",orientation:d="vertical","aria-label":p}){const g=ie(),{isInteractive:x,minZoomReached:v,maxZoomReached:m,ariaLabelConfig:b}=ee(Nh,re),{zoomIn:h,zoomOut:w,fitView:_}=Gt(),S=()=>{h(),i==null||i()},N=()=>{w(),s==null||s()},F=()=>{_(r),a==null||a()},T=()=>{g.setState({nodesDraggable:!x,nodesConnectable:!x,elementsSelectable:!x}),c==null||c(!x)},H=d==="horizontal"?"horizontal":"vertical";return y.jsxs(qe,{className:se(["react-flow__controls",H,u]),position:l,style:e,"data-testid":"rf__controls","aria-label":p??b["controls.ariaLabel"],children:[t&&y.jsxs(y.Fragment,{children:[y.jsx(_t,{onClick:S,className:"react-flow__controls-zoomin",title:b["controls.zoomIn.ariaLabel"],"aria-label":b["controls.zoomIn.ariaLabel"],disabled:m,children:y.jsx(bh,{})}),y.jsx(_t,{onClick:N,className:"react-flow__controls-zoomout",title:b["controls.zoomOut.ariaLabel"],"aria-label":b["controls.zoomOut.ariaLabel"],disabled:v,children:y.jsx(Eh,{})})]}),n&&y.jsx(_t,{className:"react-flow__controls-fitview",onClick:F,title:b["controls.fitView.ariaLabel"],"aria-label":b["controls.fitView.ariaLabel"],children:y.jsx(Sh,{})}),o&&y.jsx(_t,{className:"react-flow__controls-interactive",onClick:T,title:b["controls.interactive.ariaLabel"],"aria-label":b["controls.interactive.ariaLabel"],children:x?y.jsx(Ch,{}):y.jsx(_h,{})}),f]})}Ri.displayName="Controls";const kh=I.memo(Ri);function Mh({id:e,x:t,y:n,width:o,height:r,style:i,color:s,strokeColor:a,strokeWidth:c,className:u,borderRadius:f,shapeRendering:l,selected:d,onClick:p}){const{background:g,backgroundColor:x}=i||{},v=s||g||x;return y.jsx("rect",{className:se(["react-flow__minimap-node",{selected:d},u]),x:t,y:n,rx:f,ry:f,width:o,height:r,style:{fill:v,stroke:a,strokeWidth:c},shapeRendering:l,onClick:p?m=>p(m,e):void 0})}const Ih=I.memo(Mh),Ah=e=>e.nodes.map(t=>t.id),fn=e=>e instanceof Function?e:()=>e;function zh({nodeStrokeColor:e,nodeColor:t,nodeClassName:n="",nodeBorderRadius:o=5,nodeStrokeWidth:r,nodeComponent:i=Ih,onClick:s}){const a=ee(Ah,re),c=fn(t),u=fn(e),f=fn(n),l=typeof window>"u"||window.chrome?"crispEdges":"geometricPrecision";return y.jsx(y.Fragment,{children:a.map(d=>y.jsx(jh,{id:d,nodeColorFunc:c,nodeStrokeColorFunc:u,nodeClassNameFunc:f,nodeBorderRadius:o,nodeStrokeWidth:r,NodeComponent:i,onClick:s,shapeRendering:l},d))})}function Ph({id:e,nodeColorFunc:t,nodeStrokeColorFunc:n,nodeClassNameFunc:o,nodeBorderRadius:r,nodeStrokeWidth:i,shapeRendering:s,NodeComponent:a,onClick:c}){const{node:u,x:f,y:l,width:d,height:p}=ee(g=>{const x=g.nodeLookup.get(e);if(!x)return{node:void 0,x:0,y:0,width:0,height:0};const v=x.internals.userNode,{x:m,y:b}=x.internals.positionAbsolute,{width:h,height:w}=Ee(v);return{node:v,x:m,y:b,width:h,height:w}},re);return!u||u.hidden||!Dr(u)?null:y.jsx(a,{x:f,y:l,width:d,height:p,style:u.style,selected:!!u.selected,className:o(u),color:t(u),borderRadius:r,strokeColor:n(u),strokeWidth:i,shapeRendering:s,onClick:c,id:u.id})}const jh=I.memo(Ph);var Fh=I.memo(zh);const Th=200,$h=150,Dh=e=>!e.hidden,Rh=e=>{const t={x:-e.transform[0]/e.transform[2],y:-e.transform[1]/e.transform[2],width:e.width/e.transform[2],height:e.height/e.transform[2]};return{viewBB:t,boundingRect:e.nodeLookup.size>0?$r(ht(e.nodeLookup,{filter:Dh}),t):t,rfId:e.rfId,panZoom:e.panZoom,translateExtent:e.translateExtent,flowWidth:e.width,flowHeight:e.height,ariaLabelConfig:e.ariaLabelConfig}},Lh="react-flow__minimap-desc";function Li({style:e,className:t,nodeStrokeColor:n,nodeColor:o,nodeClassName:r="",nodeBorderRadius:i=5,nodeStrokeWidth:s,nodeComponent:a,bgColor:c,maskColor:u,maskStrokeColor:f,maskStrokeWidth:l,position:d="bottom-right",onClick:p,onNodeClick:g,pannable:x=!1,zoomable:v=!1,ariaLabel:m,inversePan:b,zoomStep:h=1,offsetScale:w=5}){const _=ie(),S=I.useRef(null),{boundingRect:N,viewBB:F,rfId:T,panZoom:H,translateExtent:A,flowWidth:j,flowHeight:B,ariaLabelConfig:E}=ee(Rh,re),z=(e==null?void 0:e.width)??Th,C=(e==null?void 0:e.height)??$h,P=N.width/z,M=N.height/C,k=Math.max(P,M),D=k*z,L=k*C,R=w*k,W=N.x-(D-N.width)/2-R,X=N.y-(L-N.height)/2-R,$=D+R*2,O=L+R*2,Y=`${Lh}-${T}`,V=I.useRef(0),G=I.useRef();V.current=k,I.useEffect(()=>{if(S.current&&H)return G.current=ed({domNode:S.current,panZoom:H,getTransform:()=>_.getState().transform,getViewScale:()=>V.current}),()=>{var U;(U=G.current)==null||U.destroy()}},[H]),I.useEffect(()=>{var U;(U=G.current)==null||U.update({translateExtent:A,width:j,height:B,inversePan:b,pannable:x,zoomStep:h,zoomable:v})},[x,v,b,h,A,j,B]);const Q=p?U=>{var te;const[ne,oe]=((te=G.current)==null?void 0:te.pointer(U))||[0,0];p(U,{x:ne,y:oe})}:void 0,Z=g?I.useCallback((U,ne)=>{const oe=_.getState().nodeLookup.get(ne).internals.userNode;g(U,oe)},[]):void 0,K=m??E["minimap.ariaLabel"];return y.jsx(qe,{position:d,style:{...e,"--xy-minimap-background-color-props":typeof c=="string"?c:void 0,"--xy-minimap-mask-background-color-props":typeof u=="string"?u:void 0,"--xy-minimap-mask-stroke-color-props":typeof f=="string"?f:void 0,"--xy-minimap-mask-stroke-width-props":typeof l=="number"?l*k:void 0,"--xy-minimap-node-background-color-props":typeof o=="string"?o:void 0,"--xy-minimap-node-stroke-color-props":typeof n=="string"?n:void 0,"--xy-minimap-node-stroke-width-props":typeof s=="number"?s:void 0},className:se(["react-flow__minimap",t]),"data-testid":"rf__minimap",children:y.jsxs("svg",{width:z,height:C,viewBox:`${W} ${X} ${$} ${O}`,className:"react-flow__minimap-svg",role:"img","aria-labelledby":Y,ref:S,onClick:Q,children:[K&&y.jsx("title",{id:Y,children:K}),y.jsx(Fh,{onClick:Z,nodeColor:o,nodeStrokeColor:n,nodeBorderRadius:i,nodeClassName:r,nodeStrokeWidth:s,nodeComponent:a}),y.jsx("path",{className:"react-flow__minimap-mask",d:`M${W-R},${X-R}h${$+R*2}v${O+R*2}h${-$-R*2}z
        M${F.x},${F.y}h${F.width}v${F.height}h${-F.width}z`,fillRule:"evenodd",pointerEvents:"none"})]})})}Li.displayName="MiniMap";const Bh=I.memo(Li),Hh=e=>t=>e?`${Math.max(1/t.transform[2],1)}`:void 0,Vh={[Ge.Line]:"right",[Ge.Handle]:"bottom-right"};function Oh({nodeId:e,position:t,variant:n=Ge.Handle,className:o,style:r=void 0,children:i,color:s,minWidth:a=10,minHeight:c=10,maxWidth:u=Number.MAX_VALUE,maxHeight:f=Number.MAX_VALUE,keepAspectRatio:l=!1,resizeDirection:d,autoScale:p=!0,shouldResize:g,onResizeStart:x,onResize:v,onResizeEnd:m}){const b=mi(),h=typeof e=="string"?e:b,w=ie(),_=I.useRef(null),S=n===Ge.Handle,N=ee(I.useCallback(Hh(S&&p),[S,p]),re),F=I.useRef(null),T=t??Vh[n];I.useEffect(()=>{if(!(!_.current||!h))return F.current||(F.current=gd({domNode:_.current,nodeId:h,getStoreItems:()=>{const{nodeLookup:A,transform:j,snapGrid:B,snapToGrid:E,nodeOrigin:z,domNode:C}=w.getState();return{nodeLookup:A,transform:j,snapGrid:B,snapToGrid:E,nodeOrigin:z,paneDomNode:C}},onChange:(A,j)=>{const{triggerNodeChanges:B,nodeLookup:E,parentLookup:z,nodeOrigin:C}=w.getState(),P=[],M={x:A.x,y:A.y},k=E.get(h);if(k&&k.expandParent&&k.parentId){const D=k.origin??C,L=A.width??k.measured.width??0,R=A.height??k.measured.height??0,W={id:k.id,parentId:k.parentId,rect:{width:L,height:R,...Rr({x:A.x??k.position.x,y:A.y??k.position.y},{width:L,height:R},k.parentId,E,D)}},X=Bn([W],E,z,C);P.push(...X),M.x=A.x?Math.max(D[0]*L,A.x):void 0,M.y=A.y?Math.max(D[1]*R,A.y):void 0}if(M.x!==void 0&&M.y!==void 0){const D={id:h,type:"position",position:{...M}};P.push(D)}if(A.width!==void 0&&A.height!==void 0){const L={id:h,type:"dimensions",resizing:!0,setAttributes:d?d==="horizontal"?"width":"height":!0,dimensions:{width:A.width,height:A.height}};P.push(L)}for(const D of j){const L={...D,type:"position"};P.push(L)}B(P)},onEnd:({width:A,height:j})=>{const B={id:h,type:"dimensions",resizing:!1,dimensions:{width:A,height:j}};w.getState().triggerNodeChanges([B])}})),F.current.update({controlPosition:T,boundaries:{minWidth:a,minHeight:c,maxWidth:u,maxHeight:f},keepAspectRatio:l,resizeDirection:d,onResizeStart:x,onResize:v,onResizeEnd:m,shouldResize:g}),()=>{var A;(A=F.current)==null||A.destroy()}},[T,a,c,u,f,l,x,v,m,g]);const H=T.split("-");return y.jsx("div",{className:se(["react-flow__resize-control","nodrag",...H,n,o]),ref:_,style:{...r,scale:N,...s&&{[S?"backgroundColor":"borderColor"]:s}},children:i})}I.memo(Oh);const $e=`https://${Xs}.supabase.co/functions/v1/api/ideas`,De={"Content-Type":"application/json",Authorization:`Bearer ${Gs}`},J="#FF6835",Qo=[{id:"general",label:"General",color:"#9CA3AF"},{id:"depends",label:"Depende de",color:"#FF6835"},{id:"blocks",label:"Bloquea",color:"#EF4444"},{id:"enables",label:"Habilita",color:"#10B981"},{id:"part_of",label:"Parte de",color:"#3B82F6"}],Wh=[{id:"ecommerce",label:"eCommerce",emoji:"",color:"#3B82F6",modules:[{id:"ecommerce",label:"eCommerce"},{id:"pedidos",label:"Pedidos"},{id:"pagos",label:"Pagos & Transacciones"},{id:"departamentos",label:"Departamentos"},{id:"clientes",label:"Clientes"},{id:"storefront",label:"Portal del Cliente"},{id:"secondhand",label:"Second Hand"}]},{id:"logistica",label:"Logstica",emoji:"",color:"#10B981",modules:[{id:"logistica",label:"Hub Logstico"},{id:"envios",label:"Envos"},{id:"transportistas",label:"Transportistas"},{id:"rutas",label:"Rutas"},{id:"fulfillment",label:"Fulfillment"},{id:"produccion",label:"Produccin / Armado"},{id:"abastecimiento",label:"Abastecimiento"},{id:"mapa-envios",label:"Mapa de Envos"},{id:"tracking-publico",label:"Tracking Pblico"}]},{id:"marketing",label:"Marketing",emoji:"",color:"#F59E0B",modules:[{id:"marketing",label:"Dashboard Marketing"},{id:"mailing",label:"Email / Mailing"},{id:"google-ads",label:"Google Ads"},{id:"seo",label:"SEO"},{id:"fidelizacion",label:"Fidelizacin"},{id:"rueda-sorteos",label:"Rueda de Sorteos"},{id:"etiqueta-emotiva",label:"Etiqueta Emotiva"}]},{id:"rrss",label:"RRSS",emoji:"",color:"#EC4899",modules:[{id:"redes-sociales",label:"Centro Operativo"},{id:"migracion-rrss",label:"Migracin RRSS"}]},{id:"gestion",label:"Gestin",emoji:"",color:"#6B7280",modules:[{id:"gestion",label:"Resumen ERP"},{id:"erp-inventario",label:"Inventario"},{id:"erp-facturacion",label:"Facturacin"},{id:"erp-compras",label:"Compras"},{id:"erp-crm",label:"CRM"},{id:"erp-contabilidad",label:"Contabilidad"},{id:"erp-rrhh",label:"RRHH"},{id:"proyectos",label:"Proyectos"},{id:"personas",label:"Personas"},{id:"organizaciones",label:"Organizaciones"}]},{id:"herramientas",label:"Herramientas",emoji:"",color:"#8B5CF6",modules:[{id:"qr-generator",label:"Generador QR"},{id:"herramientas",label:"Hub Herramientas"}]},{id:"sistema",label:"Sistema",emoji:"",color:"#1F2937",modules:[{id:"sistema",label:"Configuracin"},{id:"metodos-pago",label:"Mtodos de Pago"},{id:"metodos-envio",label:"Mtodos de Envo"},{id:"integraciones",label:"Integraciones"},{id:"diseno",label:"Diseo / Marca"}]}];function Bi(e){const t=qs.get(e);return!t||!t.isReal?"pending":t.hasSupabase?"completed-db":"ui-only"}const Cn={"completed-db":{color:"#10B981",label:" DB"},"ui-only":{color:"#3B82F6",label:" UI"},pending:{color:"#9CA3AF",label:" Pend."},idea:{color:"#FF6835",label:" Idea"}};function Yh({id:e,data:t,selected:n}){const o=t,[r,i]=I.useState(!1),[s,a]=I.useState(o.text??""),[c,u]=I.useState(!1),[f,l]=I.useState(o.area||""),[d,p]=I.useState(""),g=Cn[o.status]??Cn.pending,x=()=>{i(!1),o.onChange&&o.onChange(e,s)},v=async()=>{if(!o.ideaId||!o.text){Jt.error("Idea sin ID o texto");return}try{await Ks({idea_id:o.ideaId,idea_texto:o.text,idea_area:f||o.area||"general",notas:d||void 0}),Jt.success(" Idea enviada al Roadmap para aprobacin"),u(!1),o.onPromote&&o.onPromote(o.ideaId,o.text,f||o.area||"general")}catch(m){console.error("[IdeasBoard] Error promoviendo idea:",m),Jt.error(" Error al promover idea")}};return y.jsxs("div",{style:{width:180,minHeight:90,backgroundColor:"#FFFFFF",borderRadius:10,border:n?`2px solid ${J}`:"1.5px solid #E5E7EB",boxShadow:n?`0 0 0 3px ${J}33`:"0 2px 8px rgba(0,0,0,0.08)",overflow:"hidden",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',position:"relative"},children:[y.jsx("div",{style:{height:4,backgroundColor:o.familyColor??J}}),y.jsx(ge,{type:"target",position:q.Top,style:{background:"#9CA3AF",width:8,height:8}}),y.jsx(ge,{type:"source",position:q.Bottom,style:{background:"#9CA3AF",width:8,height:8}}),y.jsx(ge,{type:"target",position:q.Left,style:{background:"#9CA3AF",width:8,height:8}}),y.jsx(ge,{type:"source",position:q.Right,style:{background:"#9CA3AF",width:8,height:8}}),y.jsxs("div",{style:{padding:"8px 10px"},children:[o.family&&y.jsx("p",{style:{margin:"0 0 3px",fontSize:"0.62rem",fontWeight:"700",color:o.familyColor??J,textTransform:"uppercase",letterSpacing:"0.06em"},children:o.family}),y.jsx("p",{style:{margin:"0 0 5px",fontSize:"0.78rem",fontWeight:"700",color:"#111827",lineHeight:1.3},children:o.label}),r?y.jsxs("div",{children:[y.jsx("textarea",{value:s,onChange:m=>a(m.target.value),autoFocus:!0,rows:3,style:{width:"100%",fontSize:"0.72rem",border:`1px solid ${J}`,borderRadius:5,padding:"4px 6px",resize:"none",outline:"none",fontFamily:"inherit",boxSizing:"border-box"}}),y.jsxs("button",{onClick:x,style:{marginTop:3,padding:"2px 8px",backgroundColor:J,color:"#fff",border:"none",borderRadius:5,fontSize:"0.68rem",fontWeight:"700",cursor:"pointer"},children:[y.jsx(oa,{size:10,style:{display:"inline",marginRight:3}}),"OK"]})]}):o.text&&y.jsx("p",{style:{margin:"0 0 5px",fontSize:"0.72rem",color:"#6B7280",lineHeight:1.4},children:o.text}),y.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:4},children:[y.jsx("span",{style:{fontSize:"0.62rem",fontWeight:"700",color:g.color,backgroundColor:`${g.color}18`,padding:"2px 6px",borderRadius:4},children:g.label}),y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[o.status==="idea"&&o.ideaId&&y.jsx("button",{onMouseDown:m=>m.stopPropagation(),onClick:m=>{m.stopPropagation(),m.preventDefault(),u(!0)},title:"Promover a mdulo",style:{background:"none",border:"none",cursor:"pointer",padding:"2px 4px",color:J,display:"flex",alignItems:"center"},children:y.jsx(ra,{size:11})}),o.editable&&!r&&y.jsx("button",{onClick:()=>{a(o.text??""),i(!0)},style:{background:"none",border:"none",cursor:"pointer",padding:"2px 4px",color:"#9CA3AF",display:"flex",alignItems:"center"},children:y.jsx(tr,{size:11})}),o.timestamp&&y.jsx("span",{style:{fontSize:"0.58rem",color:"#D1D5DB"},children:new Date(o.timestamp).toLocaleDateString("es-UY",{day:"2-digit",month:"2-digit"})})]})]})]}),c&&y.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:()=>u(!1),children:y.jsxs("div",{style:{backgroundColor:"#FFFFFF",borderRadius:12,padding:24,maxWidth:400,width:"90%",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"},onClick:m=>m.stopPropagation(),children:[y.jsx("h3",{style:{margin:"0 0 16px",fontSize:"1.1rem",fontWeight:"700",color:"#111827"},children:"Promover a modulo"}),y.jsx("p",{style:{margin:"0 0 16px",fontSize:"0.875rem",color:"#6B7280"},children:o.text}),y.jsxs("div",{style:{marginBottom:16},children:[y.jsx("label",{style:{display:"block",marginBottom:6,fontSize:"0.8rem",fontWeight:"600",color:"#374151"},children:"Area / Categoria"}),y.jsx("input",{type:"text",value:f,onChange:m=>l(m.target.value),placeholder:o.area||"general",style:{width:"100%",padding:"8px 12px",border:"1px solid #D1D5DB",borderRadius:6,fontSize:"0.875rem"}})]}),y.jsxs("div",{style:{marginBottom:16},children:[y.jsx("label",{style:{display:"block",marginBottom:6,fontSize:"0.8rem",fontWeight:"600",color:"#374151"},children:"Notas (opcional)"}),y.jsx("textarea",{value:d,onChange:m=>p(m.target.value),placeholder:"Notas adicionales...",rows:3,style:{width:"100%",padding:"8px 12px",border:"1px solid #D1D5DB",borderRadius:6,fontSize:"0.875rem",resize:"vertical"}})]}),y.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:[y.jsx("button",{onClick:()=>u(!1),style:{padding:"8px 16px",border:"1px solid #D1D5DB",borderRadius:6,backgroundColor:"#FFFFFF",color:"#374151",fontSize:"0.875rem",fontWeight:"600",cursor:"pointer"},children:"Cancelar"}),y.jsx("button",{onClick:v,style:{padding:"8px 16px",border:"none",borderRadius:6,backgroundColor:J,color:"#FFFFFF",fontSize:"0.875rem",fontWeight:"600",cursor:"pointer"},children:"Promover"})]})]})})]})}function Xh({data:e}){const t=e,[n,o]=I.useState(!1),r=t.linkType==="parent";return y.jsxs("div",{onClick:()=>{var i;return(i=t.onNavigate)==null?void 0:i.call(t,t.canvasId)},onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),style:{width:44,height:44,borderRadius:"50%",border:`2.5px solid ${J}`,backgroundColor:n?`${J}22`:"#FFFFFF",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",boxShadow:`0 2px 8px ${J}33`,transition:"all 0.15s",position:"relative",userSelect:"none"},title:`${r?"Canvas padre":"Canvas hijo"}: ${t.canvasName}`,children:[y.jsx(ge,{type:"target",position:q.Top,style:{opacity:0,width:4,height:4}}),y.jsx(ge,{type:"source",position:q.Bottom,style:{opacity:0,width:4,height:4}}),r?y.jsx("div",{style:{width:10,height:10,borderRadius:"50%",backgroundColor:J}}):y.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 14 14",children:[y.jsx("line",{x1:"7",y1:"1",x2:"7",y2:"13",stroke:J,strokeWidth:"2.2",strokeLinecap:"round"}),y.jsx("line",{x1:"1",y1:"7",x2:"13",y2:"7",stroke:J,strokeWidth:"2.2",strokeLinecap:"round"})]}),n&&y.jsxs("div",{style:{position:"absolute",bottom:50,left:"50%",transform:"translateX(-50%)",backgroundColor:"#1F2937",color:"#fff",fontSize:"0.68rem",fontWeight:"600",padding:"4px 8px",borderRadius:6,whiteSpace:"nowrap",pointerEvents:"none",zIndex:100},children:[r?"(o)":"(+)"," ",t.canvasName]})]})}const Gh={sticker:Yh,canvasLink:Xh};function qh({canvasNodes:e,onDragStart:t,onAddIdea:n}){const[o,r]=I.useState({}),i=new Set(e.filter(a=>a.type==="sticker").map(a=>a.data.moduleId)),s=a=>r(c=>({...c,[a]:!c[a]}));return y.jsxs("div",{style:{width:220,backgroundColor:"#FFFFFF",borderRight:"1px solid #E5E7EB",display:"flex",flexDirection:"column",overflow:"hidden",flexShrink:0},children:[y.jsxs("div",{style:{padding:"12px 14px",borderBottom:"1px solid #E5E7EB",backgroundColor:"#F9FAFB"},children:[y.jsx("p",{style:{margin:0,fontSize:"0.72rem",fontWeight:"800",color:"#374151",textTransform:"uppercase",letterSpacing:"0.06em"},children:"Mdulos del Sistema"}),y.jsx("p",{style:{margin:"2px 0 0",fontSize:"0.65rem",color:"#9CA3AF"},children:"Arrastr al canvas"})]}),y.jsxs("button",{onClick:n,style:{margin:"10px 10px 6px",padding:"8px 12px",backgroundColor:`${J}12`,border:`1.5px dashed ${J}66`,borderRadius:8,cursor:"pointer",display:"flex",alignItems:"center",gap:7,color:J,fontSize:"0.78rem",fontWeight:"700",transition:"all 0.15s"},onMouseEnter:a=>a.currentTarget.style.backgroundColor=`${J}22`,onMouseLeave:a=>a.currentTarget.style.backgroundColor=`${J}12`,children:[y.jsx(Nn,{size:14}),"Nueva Idea"]}),y.jsx("div",{style:{flex:1,overflowY:"auto",padding:"4px 0 12px"},children:Wh.map(a=>y.jsxs("div",{children:[y.jsxs("button",{onClick:()=>s(a.id),style:{width:"100%",display:"flex",alignItems:"center",gap:8,padding:"7px 14px",border:"none",background:"none",cursor:"pointer",textAlign:"left"},children:[y.jsx("span",{style:{fontSize:"0.85rem"},children:a.emoji}),y.jsx("span",{style:{flex:1,fontSize:"0.75rem",fontWeight:"700",color:"#374151"},children:a.label}),y.jsxs("span",{style:{fontSize:"0.65rem",color:"#9CA3AF",marginRight:2},children:[a.modules.filter(c=>i.has(c.id)).length,"/",a.modules.length]}),o[a.id]?y.jsx(er,{size:12,color:"#9CA3AF"}):y.jsx(na,{size:12,color:"#9CA3AF"})]}),o[a.id]&&y.jsx("div",{style:{paddingBottom:4},children:a.modules.map(c=>{const u=Bi(c.id),f=Cn[u],l=i.has(c.id);return y.jsxs("div",{draggable:!l,onDragStart:d=>!l&&t(d,a,c),style:{display:"flex",alignItems:"center",gap:8,padding:"5px 14px 5px 30px",cursor:l?"default":"grab",opacity:l?.45:1,transition:"background 0.1s"},onMouseEnter:d=>!l&&(d.currentTarget.style.backgroundColor="#F9FAFB"),onMouseLeave:d=>d.currentTarget.style.backgroundColor="transparent",children:[y.jsx("div",{style:{width:7,height:7,borderRadius:"50%",backgroundColor:f.color,flexShrink:0}}),y.jsx("span",{style:{fontSize:"0.72rem",color:"#374151",flex:1,lineHeight:1.3},children:c.label}),l&&y.jsx("span",{style:{fontSize:"0.58rem",color:"#D1D5DB"},children:""})]},c.id)})})]},a.id))})]})}const Uh=["General","Logstica","Pagos","Tiendas","Redes Sociales","Servicios","eCommerce","Marketing","ERP","Sistema","Herramientas"];function Kh({onClose:e,onSave:t,ideas:n}){const[o,r]=I.useState("General"),[i,s]=I.useState(""),a=n.filter(c=>c.area===o).slice(0,4);return y.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"#FFFFFF",borderRadius:14,border:"1.5px solid #E5E7EB",boxShadow:"0 20px 60px rgba(0,0,0,0.18)",width:360,zIndex:1e3,overflow:"hidden"},children:[y.jsxs("div",{style:{backgroundColor:J,padding:"14px 18px",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[y.jsx(Nn,{size:16,color:"#fff"}),y.jsx("span",{style:{color:"#fff",fontWeight:"800",fontSize:"0.9rem"},children:"Nueva Idea"})]}),y.jsx("button",{onClick:e,style:{background:"none",border:"none",cursor:"pointer",color:"rgba(255,255,255,0.8)",display:"flex"},children:y.jsx(ia,{size:16})})]}),y.jsxs("div",{style:{padding:"16px 18px"},children:[y.jsx("label",{style:{fontSize:"0.72rem",fontWeight:"700",color:"#374151",display:"block",marginBottom:5},children:"Area"}),y.jsx("select",{value:o,onChange:c=>r(c.target.value),style:{width:"100%",padding:"7px 10px",border:"1.5px solid #E5E7EB",borderRadius:8,fontSize:"0.82rem",outline:"none",marginBottom:12,color:"#111827"},children:Uh.map(c=>y.jsx("option",{value:c,children:c},c))}),y.jsx("label",{style:{fontSize:"0.72rem",fontWeight:"700",color:"#374151",display:"block",marginBottom:5},children:"Idea"}),y.jsx("textarea",{value:i,onChange:c=>s(c.target.value),placeholder:"Escrib tu idea...",rows:3,style:{width:"100%",padding:"8px 10px",border:"1.5px solid #E5E7EB",borderRadius:8,fontSize:"0.82rem",resize:"none",outline:"none",fontFamily:"inherit",color:"#111827",boxSizing:"border-box"},onFocus:c=>c.target.style.borderColor=J,onBlur:c=>c.target.style.borderColor="#E5E7EB"}),a.length>0&&y.jsxs("div",{style:{marginTop:12},children:[y.jsxs("p",{style:{fontSize:"0.68rem",fontWeight:"700",color:"#9CA3AF",margin:"0 0 6px",textTransform:"uppercase",letterSpacing:"0.05em"},children:["Recientes en ",o]}),y.jsx("div",{style:{display:"flex",flexDirection:"column",gap:5},children:a.map(c=>y.jsxs("div",{style:{padding:"6px 9px",backgroundColor:"#F9FAFB",borderRadius:7,border:"1px solid #E5E7EB"},children:[y.jsx("p",{style:{margin:0,fontSize:"0.72rem",color:"#374151",lineHeight:1.4},children:c.text.length>60?c.text.slice(0,60)+"":c.text}),y.jsx("p",{style:{margin:"2px 0 0",fontSize:"0.62rem",color:"#9CA3AF"},children:new Date(c.timestamp).toLocaleString("es-UY",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})})]},c.id))})]}),y.jsx("button",{disabled:!i.trim(),onClick:()=>{t(o,i),e()},style:{marginTop:14,width:"100%",padding:"10px",backgroundColor:i.trim()?J:"#E5E7EB",color:i.trim()?"#fff":"#9CA3AF",border:"none",borderRadius:8,fontSize:"0.85rem",fontWeight:"700",cursor:i.trim()?"pointer":"not-allowed",transition:"all 0.15s"},children:"Guardar en canvas"})]})]})}function Zh({canvases:e,activeCanvas:t,onNewCanvas:n,onSelectCanvas:o,onUpdateCanvas:r,onLinkCanvas:i,ideas:s,onSaveIdea:a}){const c=Gt(),[u,f,l]=gh([]),[d,p,g]=ph([]),[x,v]=I.useState(Qo[0]),[m,b]=I.useState(!1),[h,w]=I.useState(!1),[_,S]=I.useState(!1),[N,F]=I.useState(""),T=I.useRef(null);I.useEffect(()=>{t&&(f(t.nodes??[]),p(t.edges??[]))},[t==null?void 0:t.id]);const H=I.useCallback(($,O)=>{T.current&&clearTimeout(T.current),T.current=setTimeout(()=>{r($,O)},1200)},[r]),A=I.useCallback($=>{l($)},[l]),j=I.useCallback($=>{g($)},[g]),B=I.useCallback($=>{const O={...$,id:`e-${Date.now()}`,style:{stroke:x.color,strokeWidth:2},type:"default",animated:!1};p(Y=>{const V=Yr(O,Y);return H(u,V),V})},[x,u,H]),E=I.useCallback(()=>{f($=>(H($,d),$))},[d,H]),z=I.useCallback($=>{$.preventDefault();const O=$.dataTransfer.getData("application/reactflow");if(!O)return;const{family:Y,mod:V}=JSON.parse(O),G=c.screenToFlowPosition({x:$.clientX,y:$.clientY}),Q=Bi(V.id),Z={id:`${V.id}-${Date.now()}`,type:"sticker",position:G,data:{label:V.label,family:Y.label,familyColor:Y.color,moduleId:V.id,status:Q,editable:Q==="pending",text:"",onChange:C}};f(K=>{const U=[...K,Z];return H(U,d),U})},[c,d,H]),C=I.useCallback(($,O)=>{f(Y=>{const V=Y.map(G=>G.id===$?{...G,data:{...G.data,text:O}}:G);return H(V,d),V})},[d,H]),P=$=>{$.preventDefault(),$.dataTransfer.dropEffect="move"},M=($,O,Y)=>{$.dataTransfer.setData("application/reactflow",JSON.stringify({family:O,mod:Y})),$.dataTransfer.effectAllowed="move"},k=async($,O)=>{const Y=await a($,O);if(!Y)return;const V=c.screenToFlowPosition({x:window.innerWidth/2+Math.random()*100-50,y:window.innerHeight/2+Math.random()*100-50}),G={id:`idea-${Y.id}`,type:"sticker",position:V,data:{label:$,text:O,area:$,family:` Idea  ${$}`,familyColor:J,status:"idea",editable:!0,ideaId:Y.id,timestamp:Y.timestamp,onChange:C}};f(Q=>{const Z=[...Q,G];return H(Z,d),Z})},D=()=>{if(!N.trim()){S(!1);return}r(u,d,N),S(!1)},L=()=>{f($=>{const O=$.filter(Y=>!Y.selected);return p(Y=>{const V=Y.filter(G=>O.some(Q=>Q.id===G.source)&&O.some(Q=>Q.id===G.target));return H(O,V),V}),O})},R=(t==null?void 0:t.name)??"Sin canvas",W=e.find($=>$.id===(t==null?void 0:t.parentId)),X=e.filter($=>$.parentId===(t==null?void 0:t.id));return y.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",position:"relative"},children:[y.jsxs("div",{style:{height:54,backgroundColor:"#FFFFFF",borderBottom:"1px solid #E5E7EB",display:"flex",alignItems:"center",padding:"0 18px",gap:12,flexShrink:0,zIndex:10},children:[y.jsxs("div",{style:{position:"relative"},children:[y.jsxs("button",{onClick:()=>w($=>!$),style:{display:"flex",alignItems:"center",gap:7,padding:"6px 12px",border:"1.5px solid #E5E7EB",borderRadius:8,backgroundColor:"#F9FAFB",cursor:"pointer",fontSize:"0.82rem",fontWeight:"700",color:"#111827"},children:[y.jsx(Qn,{size:14,color:J}),_?y.jsx("input",{value:N,onChange:$=>F($.target.value),onKeyDown:$=>{$.key==="Enter"&&D(),$.key==="Escape"&&S(!1)},autoFocus:!0,style:{border:"none",outline:"none",background:"none",fontSize:"0.82rem",fontWeight:"700",width:120},onClick:$=>$.stopPropagation()}):R,y.jsx(er,{size:12,color:"#9CA3AF"})]}),h&&y.jsxs("div",{style:{position:"absolute",top:40,left:0,backgroundColor:"#FFFFFF",border:"1px solid #E5E7EB",borderRadius:10,boxShadow:"0 8px 30px rgba(0,0,0,0.12)",minWidth:200,zIndex:100},children:[e.map($=>y.jsxs("button",{onClick:()=>{o($.id),w(!1)},style:{width:"100%",display:"flex",alignItems:"center",gap:8,padding:"9px 14px",border:"none",background:$.id===(t==null?void 0:t.id)?`${J}12`:"none",cursor:"pointer",fontSize:"0.8rem",color:"#111827",textAlign:"left"},children:[y.jsx(Qn,{size:13,color:$.id===(t==null?void 0:t.id)?J:"#9CA3AF"}),$.name,$.id===(t==null?void 0:t.id)&&y.jsx("span",{style:{marginLeft:"auto",color:J,fontSize:"0.65rem"},children:"Activo"})]},$.id)),y.jsx("div",{style:{borderTop:"1px solid #E5E7EB",padding:"6px 8px"},children:y.jsxs("button",{onClick:()=>{n(),w(!1)},style:{width:"100%",display:"flex",alignItems:"center",gap:7,padding:"7px 6px",border:"none",background:"none",cursor:"pointer",fontSize:"0.78rem",color:J,fontWeight:"700"},children:[y.jsx(Js,{size:13})," Nuevo Canvas"]})})]})]}),y.jsx("button",{onClick:()=>{F(R),S(!0),w(!1)},title:"Renombrar canvas",style:{background:"none",border:"none",cursor:"pointer",color:"#9CA3AF",display:"flex",padding:5},children:y.jsx(tr,{size:14})}),y.jsx("div",{style:{width:1,height:24,backgroundColor:"#E5E7EB"}}),W&&y.jsxs("button",{onClick:()=>o(W.id),title:`Canvas padre: ${W.name}`,style:{display:"flex",alignItems:"center",gap:5,padding:"5px 10px",border:`1.5px solid ${J}66`,borderRadius:20,backgroundColor:`${J}0D`,color:J,fontSize:"0.72rem",fontWeight:"700",cursor:"pointer"},children:[y.jsx("span",{style:{width:14,height:14,borderRadius:"50%",border:`2px solid ${J}`,display:"flex",alignItems:"center",justifyContent:"center"},children:y.jsx("div",{style:{width:5,height:5,borderRadius:"50%",backgroundColor:J}})}),W.name]}),X.map($=>y.jsxs("button",{onClick:()=>o($.id),title:`Canvas hijo: ${$.name}`,style:{display:"flex",alignItems:"center",gap:5,padding:"5px 10px",border:"1.5px solid #3B82F666",borderRadius:20,backgroundColor:"#3B82F60D",color:"#3B82F6",fontSize:"0.72rem",fontWeight:"700",cursor:"pointer"},children:[y.jsx("span",{style:{width:14,height:14,borderRadius:"50%",border:"2px solid #3B82F6",display:"flex",alignItems:"center",justifyContent:"center"},children:y.jsxs("svg",{width:"7",height:"7",viewBox:"0 0 7 7",children:[y.jsx("line",{x1:"3.5",y1:"0.5",x2:"3.5",y2:"6.5",stroke:"#3B82F6",strokeWidth:"1.5",strokeLinecap:"round"}),y.jsx("line",{x1:"0.5",y1:"3.5",x2:"6.5",y2:"3.5",stroke:"#3B82F6",strokeWidth:"1.5",strokeLinecap:"round"})]})}),$.name]},$.id)),y.jsxs("div",{style:{marginLeft:"auto",display:"flex",gap:8},children:[y.jsxs("button",{onClick:L,title:"Eliminar seleccionados",style:{display:"flex",alignItems:"center",gap:5,padding:"6px 10px",border:"1.5px solid #FECACA",borderRadius:7,backgroundColor:"#FFF5F5",color:"#EF4444",fontSize:"0.75rem",fontWeight:"600",cursor:"pointer"},children:[y.jsx(ea,{size:13})," Borrar"]}),y.jsxs("button",{onClick:()=>H(u,d),title:"Guardar ahora",style:{display:"flex",alignItems:"center",gap:5,padding:"6px 12px",border:"none",borderRadius:7,backgroundColor:J,color:"#fff",fontSize:"0.75rem",fontWeight:"700",cursor:"pointer"},children:[y.jsx(ta,{size:13})," Guardar"]})]})]}),y.jsxs("div",{style:{flex:1,display:"flex",overflow:"hidden",position:"relative"},children:[y.jsx(qh,{canvasNodes:u,onDragStart:M,onAddIdea:()=>b(!0)}),y.jsx("div",{style:{flex:1,position:"relative"},children:y.jsxs(hh,{nodes:u,edges:d,onNodesChange:A,onEdgesChange:j,onConnect:B,onNodeDragStop:E,onDrop:z,onDragOver:P,nodeTypes:Gh,fitView:!0,fitViewOptions:{padding:.2},onClick:()=>w(!1),minZoom:.2,maxZoom:2,children:[y.jsx(vh,{variant:ve.Dots,gap:20,size:1,color:"#E5E7EB"}),y.jsx(kh,{style:{boxShadow:"0 2px 8px rgba(0,0,0,0.1)"}}),y.jsx(Bh,{nodeColor:$=>{const O=$.data;return(O==null?void 0:O.familyColor)??J},style:{backgroundColor:"#F9FAFB",border:"1px solid #E5E7EB"}}),y.jsx(qe,{position:"bottom-center",children:y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,backgroundColor:"#FFFFFF",border:"1px solid #E5E7EB",borderRadius:30,padding:"6px 14px",boxShadow:"0 4px 16px rgba(0,0,0,0.1)"},children:[y.jsx("span",{style:{fontSize:"0.68rem",fontWeight:"700",color:"#9CA3AF",marginRight:4},children:"Conector:"}),Qo.map($=>y.jsx("button",{onClick:()=>v($),title:$.label,style:{width:22,height:22,borderRadius:"50%",backgroundColor:$.color,border:x.id===$.id?"3px solid #111827":"2px solid transparent",cursor:"pointer",transition:"all 0.15s",transform:x.id===$.id?"scale(1.25)":"scale(1)",outline:"none"}},$.id)),y.jsx("div",{style:{width:1,height:18,backgroundColor:"#E5E7EB",margin:"0 4px"}}),y.jsx("span",{style:{fontSize:"0.68rem",color:x.color,fontWeight:"700"},children:x.label})]})}),u.length===0&&y.jsx(qe,{position:"top-center",children:y.jsxs("div",{style:{marginTop:60,textAlign:"center",backgroundColor:"#FFFFFF",border:"1.5px dashed #E5E7EB",borderRadius:14,padding:"28px 40px"},children:[y.jsx("p",{style:{fontSize:"2rem",margin:"0 0 8px"},children:""}),y.jsx("p",{style:{fontSize:"0.9rem",fontWeight:"700",color:"#374151",margin:"0 0 4px"},children:"Canvas vaco"}),y.jsxs("p",{style:{fontSize:"0.78rem",color:"#9CA3AF",margin:0},children:["Arrastr mdulos desde el panel izquierdo",y.jsx("br",{}),"o cre una nueva idea"]})]})})]})}),m&&y.jsxs(y.Fragment,{children:[y.jsx("div",{style:{position:"absolute",inset:0,backgroundColor:"rgba(0,0,0,0.3)",zIndex:999},onClick:()=>b(!1)}),y.jsx(Kh,{onClose:()=>b(!1),onSave:k,ideas:s})]})]})]})}function yg({onNavigate:e}){const[t,n]=I.useState([]),[o,r]=I.useState(null),[i,s]=I.useState(null),[a,c]=I.useState([]),[u,f]=I.useState(!0);I.useEffect(()=>{(async()=>{try{const m=await fetch(`${$e}/canvases`,{headers:De}),{canvases:b}=await m.json();if(b!=null&&b.length)n(b),r(b[0].id);else{const h=await l("Mi Canvas Principal");h&&(n([h]),r(h.id))}}catch(m){console.error("[IdeasBoard] Error cargando canvases:",m)}finally{f(!1)}})()},[]),I.useEffect(()=>{(async()=>{try{const m=await fetch(`${$e}/ideas`,{headers:De}),{ideas:b}=await m.json();c(b??[])}catch(m){console.error("[IdeasBoard] Error cargando ideas:",m)}})()},[]),I.useEffect(()=>{o&&(async()=>{try{const m=await fetch(`${$e}/canvases/${o}`,{headers:De}),{canvas:b}=await m.json();s(b??null)}catch(m){console.error("[IdeasBoard] Error cargando canvas activo:",m)}})()},[o]);const l=async(m,b)=>{try{const h=await fetch(`${$e}/canvases`,{method:"POST",headers:De,body:JSON.stringify({name:m,parentId:b??null})}),{canvas:w}=await h.json();return w}catch(h){return console.error("[IdeasBoard] Error creando canvas:",h),null}},d=async()=>{const m=`Canvas ${t.length+1}`,b=await l(m);b&&(n(h=>[...h,b]),r(b.id))},p=m=>{r(m)},g=async(m,b,h)=>{if(o)try{const w={nodes:m,edges:b};h&&(w.name=h);const _=await fetch(`${$e}/canvases/${o}`,{method:"PUT",headers:De,body:JSON.stringify(w)}),{canvas:S}=await _.json();h&&n(N=>N.map(F=>F.id===o?{...F,name:h}:F)),s(S)}catch(w){console.error("[IdeasBoard] Error guardando canvas:",w)}},x=async m=>{if(m==="child"){const b=`Sub-canvas de ${(i==null?void 0:i.name)??"este canvas"}`,h=await l(b,o??void 0);h&&n(w=>[...w,h])}},v=async(m,b)=>{try{const h=await fetch(`${$e}/ideas`,{method:"POST",headers:De,body:JSON.stringify({area:m,text:b})}),{idea:w}=await h.json();return c(_=>[w,..._]),w}catch(h){return console.error("[IdeasBoard] Error guardando idea:",h),null}};return u?y.jsx("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#F8F9FA"},children:y.jsxs("div",{style:{textAlign:"center"},children:[y.jsx(Qs,{size:32,color:J,style:{animation:"spin 1s linear infinite"}}),y.jsx("p",{style:{color:"#6B7280",marginTop:12,fontSize:"0.875rem"},children:"Cargando Registro de Ideas"})]})}):y.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:[y.jsx(Zs,{icon:Nn,title:"Registro de Ideas",subtitle:`Canvas visual de modulos e ideas - ${t.length} canvas${t.length!==1?"es":""}`,onNavigate:e,actions:[{label:"Checklist & Roadmap",onClick:()=>e("checklist"),primary:!0},{label:" Herramientas",onClick:()=>e("herramientas")}]}),y.jsx("div",{style:{flex:1,display:"flex",overflow:"hidden"},children:y.jsx($i,{children:y.jsx(Zh,{canvases:t,activeCanvas:i,onNewCanvas:d,onSelectCanvas:p,onUpdateCanvas:g,onLinkCanvas:x,ideas:a,onSaveIdea:v})})})]})}export{Qo as EDGE_COLORS,yg as IdeasBoardView};
