import{r as s,j as e,R as Y,u as H,k as J,T as X,i as V,f as Z}from"./index-CqR9Aq3W.js";import{O as $}from"./OrangeHeader-CKn4kf1Z.js";import{X as Q}from"./x-C1iZqykG.js";import{C as ee}from"./check-DxH8CQRW.js";import{L as K}from"./loader-circle-BuSgv4T0.js";import{C as oe}from"./chevron-right-B8JRCTek.js";import{U as te}from"./users-BJL6bQIe.js";import{M as re}from"./map-pin-0CDjZxym.js";import{P as ie}from"./plus-CCYOtKpX.js";import{C as ne}from"./clock-j6cEw-Pq.js";import"./zap-CK1ljsId.js";import"./lightbulb-BTF3XheD.js";function le(){return typeof window>"u"?"#FF6835":getComputedStyle(document.documentElement).getPropertyValue("--color-primary").trim()||"#FF6835"}function se(t,n){return t<n?"done":t===n?"active":"pending"}function U({field:t,value:n,onChange:E,error:l,primaryColor:p}){var w,F;const c={width:"100%",padding:"10px 12px",border:`1px solid ${l?"#ef4444":"#e2e8f0"}`,borderRadius:"8px",fontSize:"13px",outline:"none",boxSizing:"border-box",fontFamily:"inherit",transition:"all 0.15s",backgroundColor:"#fff"},f={borderColor:p,boxShadow:`0 0 0 3px ${p}1A`},B={borderColor:"#ef4444",boxShadow:"0 0 0 3px rgba(239,68,68,0.1)"},[a,C]=s.useState(!1),h=S=>{E(S)},T={...c,...a&&!l?f:{},...l?B:{}};switch(t.type){case"textarea":return e.jsxs("div",{children:[e.jsxs("label",{style:{display:"block",fontSize:"12px",fontWeight:600,color:"#475569",marginBottom:"6px"},children:[t.label,t.required&&e.jsx("span",{style:{color:"#ef4444",marginLeft:"2px"},children:"*"})]}),e.jsx("textarea",{value:String(n||""),onChange:i=>h(i.target.value),onFocus:()=>C(!0),onBlur:()=>C(!1),placeholder:t.placeholder,required:t.required,rows:4,style:{...T,resize:"vertical",fontFamily:"inherit"}}),t.hint&&e.jsx("p",{style:{margin:"4px 0 0",fontSize:"11px",color:"#94a3b8"},children:t.hint}),l&&e.jsx("p",{style:{margin:"4px 0 0",fontSize:"11px",color:"#ef4444"},children:l})]});case"select":return e.jsxs("div",{children:[e.jsxs("label",{style:{display:"block",fontSize:"12px",fontWeight:600,color:"#475569",marginBottom:"6px"},children:[t.label,t.required&&e.jsx("span",{style:{color:"#ef4444",marginLeft:"2px"},children:"*"})]}),e.jsxs("div",{style:{position:"relative"},children:[e.jsxs("select",{value:String(n||""),onChange:i=>h(i.target.value),onFocus:()=>C(!0),onBlur:()=>C(!1),required:t.required,style:{...T,appearance:"none",paddingRight:"36px",cursor:"pointer"},children:[e.jsx("option",{value:"",children:"Seleccionar..."}),(w=t.options)==null?void 0:w.map(i=>e.jsx("option",{value:i.value,children:i.label},i.value))]}),e.jsx(oe,{size:16,color:"#94a3b8",style:{position:"absolute",right:"12px",top:"50%",transform:"translateY(-50%) rotate(90deg)",pointerEvents:"none"}})]}),t.hint&&e.jsx("p",{style:{margin:"4px 0 0",fontSize:"11px",color:"#94a3b8"},children:t.hint}),l&&e.jsx("p",{style:{margin:"4px 0 0",fontSize:"11px",color:"#ef4444"},children:l})]});case"toggle":const S=!!n;return e.jsxs("div",{children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"10px",cursor:"pointer"},children:[e.jsx("div",{style:{width:"44px",height:"24px",borderRadius:"12px",backgroundColor:S?p:"#cbd5e1",display:"flex",alignItems:"center",padding:"2px",transition:"all 0.2s",position:"relative"},children:e.jsx("div",{style:{width:"20px",height:"20px",borderRadius:"50%",backgroundColor:"#fff",transform:S?"translateX(20px)":"translateX(0)",transition:"transform 0.2s",boxShadow:"0 1px 3px rgba(0,0,0,0.2)"}})}),e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{fontSize:"12px",fontWeight:600,color:"#475569"},children:[t.label,t.required&&e.jsx("span",{style:{color:"#ef4444",marginLeft:"2px"},children:"*"})]}),t.helpText&&e.jsx("p",{style:{margin:"2px 0 0",fontSize:"11px",color:"#94a3b8"},children:t.helpText})]})]}),e.jsx("input",{type:"checkbox",checked:S,onChange:i=>h(i.target.checked),style:{display:"none"}}),l&&e.jsx("p",{style:{margin:"4px 0 0",fontSize:"11px",color:"#ef4444"},children:l})]});case"multicheck":const A=Array.isArray(n)?n:[];return e.jsxs("div",{children:[e.jsxs("label",{style:{display:"block",fontSize:"12px",fontWeight:600,color:"#475569",marginBottom:"6px"},children:[t.label,t.required&&e.jsx("span",{style:{color:"#ef4444",marginLeft:"2px"},children:"*"})]}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:(F=t.options)==null?void 0:F.map(i=>{const m=A.includes(i.value);return e.jsx("button",{type:"button",onClick:()=>{const v=m?A.filter(R=>R!==i.value):[...A,i.value];h(v)},style:{padding:"6px 12px",borderRadius:"20px",border:`1px solid ${m?p:"#e2e8f0"}`,backgroundColor:m?`${p}15`:"#fff",color:m?p:"#475569",fontSize:"12px",fontWeight:600,cursor:"pointer",transition:"all 0.15s",outline:"none"},children:i.label},i.value)})}),t.hint&&e.jsx("p",{style:{margin:"4px 0 0",fontSize:"11px",color:"#94a3b8"},children:t.hint}),l&&e.jsx("p",{style:{margin:"4px 0 0",fontSize:"11px",color:"#ef4444"},children:l})]});case"image":const[z,u]=s.useState(typeof n=="string"&&n?n:null),x=s.useRef(null),y=i=>{var v;const m=(v=i.target.files)==null?void 0:v[0];if(m){const R=new FileReader;R.onloadend=()=>{const L=R.result;u(L),h(L)},R.readAsDataURL(m)}};return e.jsxs("div",{children:[e.jsxs("label",{style:{display:"block",fontSize:"12px",fontWeight:600,color:"#475569",marginBottom:"6px"},children:[t.label,t.required&&e.jsx("span",{style:{color:"#ef4444",marginLeft:"2px"},children:"*"})]}),e.jsxs("div",{onClick:()=>{var i;return(i=x.current)==null?void 0:i.click()},style:{border:"2px dashed #e2e8f0",borderRadius:"8px",padding:"24px",textAlign:"center",cursor:"pointer",transition:"all 0.15s",backgroundColor:z?"#f8fafc":"#fff"},onMouseEnter:i=>{z||(i.currentTarget.style.borderColor=p,i.currentTarget.style.backgroundColor="#f8fafc")},onMouseLeave:i=>{z||(i.currentTarget.style.borderColor="#e2e8f0",i.currentTarget.style.backgroundColor="#fff")},children:[e.jsx("input",{ref:x,type:"file",accept:"image/*",onChange:y,style:{display:"none"}}),z?e.jsxs("div",{children:[e.jsx("img",{src:z,alt:"Preview",style:{maxWidth:"100%",maxHeight:"200px",borderRadius:"8px",marginBottom:"8px"}}),e.jsx("p",{style:{fontSize:"11px",color:"#94a3b8",margin:0},children:"Click para cambiar imagen"})]}):e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:"13px",color:"#475569",margin:"0 0 4px",fontWeight:600},children:"Arrastra una imagen aquÃ­ o click para seleccionar"}),e.jsx("p",{style:{fontSize:"11px",color:"#94a3b8",margin:0},children:t.hint||"JPG, PNG, PDF hasta 10MB"})]})]}),l&&e.jsx("p",{style:{margin:"4px 0 0",fontSize:"11px",color:"#ef4444"},children:l})]});default:return e.jsxs("div",{children:[e.jsxs("label",{style:{display:"block",fontSize:"12px",fontWeight:600,color:"#475569",marginBottom:"6px"},children:[t.label,t.required&&e.jsx("span",{style:{color:"#ef4444",marginLeft:"2px"},children:"*"})]}),e.jsx("input",{type:t.type,value:String(n||""),onChange:i=>h(i.target.value),onFocus:()=>C(!0),onBlur:()=>C(!1),placeholder:t.placeholder,required:t.required,style:T}),t.hint&&e.jsx("p",{style:{margin:"4px 0 0",fontSize:"11px",color:"#94a3b8"},children:t.hint}),l&&e.jsx("p",{style:{margin:"4px 0 0",fontSize:"11px",color:"#ef4444"},children:l})]})}}function ae({open:t,onClose:n,onSave:E,title:l,icon:p,sheets:c,initialData:f={},loading:B=!1}){const[a,C]=s.useState(0),[h,T]=s.useState(f),[w,F]=s.useState({}),[S,A]=s.useState(!1),[z,u]=s.useState(null),[x,y]=s.useState("#FF6835"),i=s.useRef(null);s.useEffect(()=>{y(le())},[]),s.useEffect(()=>{t&&(C(0),T(f),F({}),u(null))},[t,f]),s.useEffect(()=>{if(!t)return;const r=b=>{b.key==="Escape"&&n()};return document.addEventListener("keydown",r),()=>document.removeEventListener("keydown",r)},[t,n]),s.useEffect(()=>{if(!t||!i.current)return;const b=i.current.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),d=b[0],j=b[b.length-1],I=q=>{q.key==="Tab"&&(q.shiftKey?document.activeElement===d&&(q.preventDefault(),j==null||j.focus()):document.activeElement===j&&(q.preventDefault(),d==null||d.focus()))};return document.addEventListener("keydown",I),d==null||d.focus(),()=>document.removeEventListener("keydown",I)},[t,a]);const m=s.useCallback((r,b)=>{T(d=>({...d,[r]:b})),w[r]&&F(d=>{const j={...d};return delete j[r],j})},[w]),v=s.useCallback(r=>{const b=c[r];if(!b)return!0;const d={};return b.fields.forEach(j=>{if(j.required){const I=h[j.id];(I==null||I===""||Array.isArray(I)&&I.length===0)&&(d[j.id]=`${j.label} es requerido`)}}),F(d),Object.keys(d).length===0},[c,h]),R=s.useCallback(()=>{v(a)&&a<c.length-1&&C(a+1)},[a,c,v]),L=s.useCallback(()=>{a>0&&C(a-1)},[a]),_=s.useCallback(r=>{if(r<=a+1&&r>=0&&r<c.length){if(r===a+1&&!v(a))return;C(r)}},[a,c,v]),M=s.useCallback(async()=>{if(!v(c.length-1)){C(c.length-1);return}A(!0),u(null);try{await E(h),n()}catch(r){u(r instanceof Error?r.message:"Error al guardar")}finally{A(!1)}},[h,E,n,c,v]);if(!t)return null;const D=c[a],o=a===0,g=a===c.length-1,k={},P=[];return D.fields.forEach(r=>{r.row?(k[r.row]||(k[r.row]=[]),k[r.row].push(r)):P.push(r)}),e.jsxs(e.Fragment,{children:[e.jsx("div",{onClick:n,style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(15,23,42,0.45)",backdropFilter:"blur(2px)",zIndex:9998,animation:"fadeIn 0.3s ease"}}),e.jsxs("div",{ref:i,style:{position:"fixed",top:0,right:t?0:"-500px",width:"500px",maxWidth:"100vw",height:"100vh",backgroundColor:"#fff",boxShadow:"-8px 0 40px rgba(0,0,0,0.18)",zIndex:9999,display:"flex",flexDirection:"column",transition:"right 0.3s ease"},children:[e.jsxs("div",{style:{padding:"18px 24px",borderBottom:"1px solid #e2e8f0",flexShrink:0,display:"flex",alignItems:"center",gap:"12px"},children:[p&&e.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"10px",backgroundColor:"#FFF7ED",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:e.jsx(p,{size:20,color:x})}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",flexWrap:"wrap"},children:[e.jsx("h2",{style:{margin:0,fontSize:"16px",fontWeight:700,color:"#111827"},children:l}),o&&e.jsx("span",{style:{fontSize:"10px",fontWeight:700,color:"#ef4444",backgroundColor:"#FEE2E2",padding:"2px 6px",borderRadius:"4px"},children:"â— Obligatorios en pÃ¡g. 1"})]}),D.subtitle&&e.jsx("p",{style:{margin:"2px 0 0",fontSize:"12px",color:"#6B7280"},children:D.subtitle})]}),e.jsx("button",{onClick:n,style:{width:"32px",height:"32px",borderRadius:"8px",border:"1px solid #e2e8f0",backgroundColor:"transparent",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",flexShrink:0,transition:"all 0.15s"},onMouseEnter:r=>{r.currentTarget.style.backgroundColor="#f1f5f9"},onMouseLeave:r=>{r.currentTarget.style.backgroundColor="transparent"},children:e.jsx(Q,{size:16,color:"#475569"})})]}),e.jsx("div",{style:{padding:"16px 24px",borderBottom:"1px solid #f1f5f9",flexShrink:0,overflowX:"auto"},children:e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:c.map((r,b)=>{const d=se(b,a),j=b<=a+1;return e.jsxs(Y.Fragment,{children:[e.jsxs("button",{type:"button",onClick:()=>_(b),disabled:!j,style:{display:"flex",alignItems:"center",gap:"8px",border:"none",backgroundColor:"transparent",cursor:j?"pointer":"not-allowed",padding:"4px 0",opacity:j?1:.5},children:[e.jsx("div",{style:{width:"24px",height:"24px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"11px",fontWeight:700,flexShrink:0,backgroundColor:d==="done"?"#ECFDF5":d==="active"?x:"#f1f5f9",color:d==="done"?"#059669":d==="active"?"#fff":"#94a3b8"},children:d==="done"?e.jsx(ee,{size:12}):b+1}),e.jsx("span",{style:{fontSize:"12px",fontWeight:d==="active"?700:500,color:d==="active"?"#111827":d==="done"?"#059669":"#94a3b8",whiteSpace:"nowrap"},children:r.title})]}),b<c.length-1&&e.jsx("div",{style:{width:"16px",height:"1px",backgroundColor:"#e2e8f0",flexShrink:0}})]},r.id)})})}),e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"24px",display:"flex",flexDirection:"column",gap:"18px"},children:[Object.entries(k).map(([r,b])=>e.jsx("div",{style:{display:"flex",gap:"16px"},children:b.map(d=>e.jsx("div",{style:{flex:1},children:e.jsx(U,{field:d,value:h[d.id],onChange:j=>m(d.id,j),error:w[d.id],primaryColor:x})},d.id))},r)),P.map(r=>e.jsx(U,{field:r,value:h[r.id],onChange:b=>m(r.id,b),error:w[r.id],primaryColor:x},r.id))]}),e.jsxs("div",{style:{padding:"14px 24px",borderTop:"1px solid #e2e8f0",flexShrink:0,display:"flex",alignItems:"center",gap:"10px",backgroundColor:"#fff"},children:[e.jsx("button",{type:"button",onClick:n,style:{padding:"8px 16px",border:"1px solid #e2e8f0",borderRadius:"8px",backgroundColor:"#fff",color:"#475569",fontSize:"13px",fontWeight:600,cursor:"pointer",transition:"all 0.15s"},onMouseEnter:r=>{r.currentTarget.style.backgroundColor="#f8fafc"},onMouseLeave:r=>{r.currentTarget.style.backgroundColor="#fff"},children:"Cancelar"}),!o&&e.jsx("button",{type:"button",onClick:L,style:{padding:"8px 16px",border:"1px solid #e2e8f0",borderRadius:"8px",backgroundColor:"#fff",color:"#475569",fontSize:"13px",fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",gap:"4px",transition:"all 0.15s"},onMouseEnter:r=>{r.currentTarget.style.backgroundColor="#f8fafc"},onMouseLeave:r=>{r.currentTarget.style.backgroundColor="#fff"},children:"â† Ant."}),e.jsxs("div",{style:{flex:1,textAlign:"center",fontSize:"12px",color:"#94a3b8"},children:["PÃ¡gina ",a+1," de ",c.length]}),!g&&e.jsx("button",{type:"button",onClick:R,style:{padding:"8px 16px",border:"1px solid #e2e8f0",borderRadius:"8px",backgroundColor:"#fff",color:"#475569",fontSize:"13px",fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",gap:"4px",transition:"all 0.15s"},onMouseEnter:r=>{r.currentTarget.style.backgroundColor="#f8fafc"},onMouseLeave:r=>{r.currentTarget.style.backgroundColor="#fff"},children:"Sig. â†’"}),g&&e.jsx("button",{type:"button",onClick:M,disabled:S||B,style:{padding:"8px 20px",border:"none",borderRadius:"8px",backgroundColor:S||B?"#cbd5e1":x,color:"#fff",fontSize:"13px",fontWeight:700,cursor:S||B?"not-allowed":"pointer",display:"flex",alignItems:"center",gap:"6px",transition:"all 0.15s"},children:S||B?e.jsxs(e.Fragment,{children:[e.jsx(K,{size:14,style:{animation:"spin 1s linear infinite"}}),"Guardando..."]}):e.jsx(e.Fragment,{children:"ðŸ’¾ Guardar"})}),z&&e.jsxs("div",{style:{position:"absolute",bottom:"60px",left:"24px",right:"24px",padding:"10px 14px",backgroundColor:"#FEE2E2",color:"#DC2626",borderRadius:"8px",fontSize:"12px",fontWeight:600,border:"1px solid #FECACA"},children:["âš  ",z]})]})]}),e.jsx("style",{children:`
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }
      `})]})}const O=new Map;function de(){var n,E;const{config:t}=H();return s.useMemo(()=>{var c,f;const l=(c=t==null?void 0:t.backend)==null?void 0:c.supabaseUrl,p=(f=t==null?void 0:t.backend)==null?void 0:f.supabaseKey;return!l||!p?null:(O.has(l)||O.set(l,J(l,p)),O.get(l))},[(n=t==null?void 0:t.backend)==null?void 0:n.supabaseUrl,(E=t==null?void 0:t.backend)==null?void 0:E.supabaseKey])}function G(t,n={}){const{select:E="*",filters:l={},orderBy:p,autoFetch:c=!0}=n,f=de(),[B,a]=s.useState([]),[C,h]=s.useState(c),[T,w]=s.useState(null),F=s.useCallback(async()=>{if(!f){w("Supabase client no disponible â€” verificÃ¡ config.backend del tenant"),h(!1);return}h(!0),w(null);try{let u=f.from(t).select(E);Object.entries(l).forEach(([i,m])=>{u=u.eq(i,m)}),p&&(u=u.order(p.column,{ascending:p.ascending??!0}));const{data:x,error:y}=await u;if(y)throw new Error(y.message);a(x??[])}catch(u){const x=u instanceof Error?u.message:"Error desconocido";w(x),console.error(`[useTable] Error en "${t}":`,x)}finally{h(!1)}},[f,t,E,JSON.stringify(l),p==null?void 0:p.column,p==null?void 0:p.ascending]);s.useEffect(()=>{c&&F()},[F,c]);const S=s.useCallback(async u=>{if(!f)return{data:null,error:"Supabase client no disponible"};const{data:x,error:y}=await f.from(t).insert(u).select().single();return y?(console.error(`[useTable] insert en "${t}":`,y.message),{data:null,error:y.message}):(a(i=>[...i,x]),{data:x,error:null})},[f,t]),A=s.useCallback(async(u,x)=>{if(!f)return{error:"Supabase client no disponible"};const{error:y}=await f.from(t).update(x).eq("id",u);return y?(console.error(`[useTable] update en "${t}":`,y.message),{error:y.message}):(a(i=>i.map(m=>m.id===u?{...m,...x}:m)),{error:null})},[f,t]),z=s.useCallback(async u=>{if(!f)return{error:"Supabase client no disponible"};const{error:x}=await f.from(t).delete().eq("id",u);return x?(console.error(`[useTable] remove en "${t}":`,x.message),{error:x.message}):(a(y=>y.filter(i=>i.id!==u)),{error:null})},[f,t]);return{data:B,loading:C,error:T,refresh:F,insert:S,update:A,remove:z}}const W="#FF6835",ce=[{id:"general",title:"General",subtitle:"Datos generales Â· InformaciÃ³n principal del carrier",fields:[{id:"nombre",label:"Nombre del carrier",type:"text",required:!0,placeholder:"Ej: Transporte del Sur SRL"},{id:"tipo",label:"Tipo",type:"select",required:!0,options:[{value:"propio",label:"Propio"},{value:"tercero",label:"Tercero"},{value:"courier",label:"Courier"},{value:"nacional",label:"Nacional"},{value:"internacional",label:"Internacional"}],row:"row1"},{id:"estado",label:"Estado",type:"select",required:!0,options:[{value:"activo",label:"Activo"},{value:"inactivo",label:"Inactivo"}],row:"row1"},{id:"logo",label:"Logo / Imagen",type:"image"},{id:"activo",label:"Carrier activo",type:"toggle",helpText:"Visible para asignaciÃ³n de envÃ­os"}]},{id:"contacto",title:"Contacto",subtitle:"Contacto Â· Persona y medios de comunicaciÃ³n",fields:[{id:"contacto",label:"Nombre completo",type:"text",placeholder:"Ej: Juan PÃ©rez"},{id:"email",label:"Email",type:"email",placeholder:"contacto@empresa.com",row:"row1"},{id:"telefono",label:"TelÃ©fono",type:"tel",placeholder:"09X XXX XXX",row:"row1"},{id:"rut",label:"Documento / RUT",type:"text",placeholder:"XX.XXX.XXX-X",row:"row2"},{id:"cargo",label:"Cargo",type:"text",placeholder:"Ej: Gerente logÃ­stica",row:"row2"},{id:"web",label:"Sitio web",type:"url",placeholder:"https://empresa.com",row:"row3"},{id:"whatsapp",label:"WhatsApp",type:"tel",placeholder:"598 9X XXX XXX",row:"row3"}]},{id:"direccion",title:"DirecciÃ³n",subtitle:"DirecciÃ³n y cobertura Â· UbicaciÃ³n y zonas operativas",fields:[{id:"calle",label:"Calle y nÃºmero",type:"text",placeholder:"Ej: Av. Italia 2500"},{id:"ciudad",label:"Ciudad",type:"text",placeholder:"Montevideo",row:"row1"},{id:"cp",label:"CÃ³digo postal",type:"text",placeholder:"11300",row:"row1"},{id:"departamento",label:"Departamento / Estado",type:"text",placeholder:"Montevideo",row:"row2"},{id:"pais",label:"PaÃ­s",type:"select",options:[{value:"uy",label:"Uruguay"},{value:"ar",label:"Argentina"},{value:"br",label:"Brasil"}],row:"row2"},{id:"tramos",label:"Tramos habilitados",type:"multicheck",options:[{value:"local",label:"Local"},{value:"intercity",label:"Intercity"},{value:"internacional",label:"Internacional"},{value:"last_mile",label:"Last mile"}]}]},{id:"depositos",title:"DepÃ³sitos",subtitle:"DepÃ³sitos y horarios Â· Instalaciones y disponibilidad",fields:[{id:"depositos_ids",label:"DepÃ³sitos asociados",type:"text",placeholder:"Se conectarÃ¡ a datos reales",hint:"PrÃ³ximamente: selector de depÃ³sitos existentes"},{id:"horario_lv_desde",label:"Lun-Vie desde",type:"time",row:"row1"},{id:"horario_lv_hasta",label:"Lun-Vie hasta",type:"time",row:"row1"},{id:"horario_sab_desde",label:"SÃ¡bado desde",type:"time",row:"row2"},{id:"horario_sab_hasta",label:"SÃ¡bado hasta",type:"time",row:"row2"}]},{id:"tarifas",title:"Tarifas",subtitle:"Tarifas y configuraciÃ³n Â· Costos y condiciones",fields:[{id:"tarifa_base",label:"Tarifa base",type:"number",placeholder:"0.00",row:"row1"},{id:"moneda",label:"Moneda",type:"select",options:[{value:"UYU",label:"UYU"},{value:"USD",label:"USD"},{value:"ARS",label:"ARS"}],row:"row1"},{id:"tiempo_promedio",label:"Tiempo promedio entrega",type:"text",placeholder:"Ej: 24-48hs",row:"row2"},{id:"rating",label:"Rating inicial",type:"number",placeholder:"0.0",row:"row2"},{id:"notas",label:"Observaciones",type:"textarea",placeholder:"Condiciones especiales, acuerdos, notas..."}]},{id:"documentos",title:"Docs",subtitle:"Documentos Â· Contratos y habilitaciones",fields:[{id:"doc_contrato",label:"Contrato de servicio",type:"image",hint:"PDF, DOC hasta 10MB"},{id:"doc_habilitacion",label:"HabilitaciÃ³n / Licencia",type:"image",hint:"PDF, JPG, PNG hasta 10MB"},{id:"doc_tarifario",label:"Tarifario completo",type:"image",hint:"PDF, XLS, CSV hasta 10MB"}]}],N={local:{label:"Local",color:"#059669",bg:"#ECFDF5"},nacional:{label:"Nacional",color:"#2563EB",bg:"#EFF6FF"},intercity:{label:"Intercity",color:"#7C3AED",bg:"#F5F3FF"},internacional:{label:"Internacional",color:"#D97706",bg:"#FFFBEB"},propio:{label:"Propio",color:"#059669",bg:"#ECFDF5"},tercero:{label:"Tercero",color:"#2563EB",bg:"#EFF6FF"},courier:{label:"Courier",color:"#7C3AED",bg:"#F5F3FF"}};function pe({n:t}){return e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"2px"},children:[[1,2,3,4,5].map(n=>e.jsx(V,{size:11,color:n<=Math.round(t)?"#F59E0B":"#E5E7EB",fill:n<=Math.round(t)?"#F59E0B":"none"},n)),e.jsx("span",{style:{fontSize:"11px",color:"#6B7280",marginLeft:"3px"},children:t})]})}function ke({onNavigate:t}){const[n,E]=s.useState("transportistas"),[l,p]=s.useState(""),[c,f]=s.useState(null),[B,a]=s.useState(!1),[C,h]=s.useState(!1),{data:T,loading:w,error:F,insert:S,refresh:A}=G("transportistas",{orderBy:{column:"nombre",ascending:!0}}),{data:z,loading:u,error:x}=G("tramos",{orderBy:{column:"origen",ascending:!0}}),y=w||u,i=F||x,m=async o=>{h(!0);const{error:g}=await S({nombre:o.nombre,tipo:o.tipo,estado:o.estado??"activo",activo:o.activo??!0,logo:o.logo,contacto:o.contacto,email:o.email,telefono:o.telefono,rating:o.rating?Number(o.rating):0,tiempo_promedio:o.tiempo_promedio});h(!1),g?console.error("[TransportistasView] Error guardando carrier:",g):a(!1)},v=T.map(o=>({...o,enviosActivos:o.envios_activos??0,enviosTotales:o.envios_totales??0,tiempoPromedio:o.tiempo_promedio,cobertura:Array.isArray(o.cobertura)?o.cobertura:[],activo:o.activo??o.estado==="activo"})),R=z.map(o=>{const g=T.find(k=>k.id===o.transportista_id);return{...o,carrier:(g==null?void 0:g.nombre)??"",carrierId:o.transportista_id,tiempoEstimado:o.tiempo_estimado,tarifaBase:o.tarifa_base,tarifaKg:o.tarifa_kg,activo:o.activo??o.estado==="activo"}}),L=v.filter(o=>o.activo).length,_=v.reduce((o,g)=>o+(g.enviosActivos||0),0),M=v.filter(o=>!l||o.nombre.toLowerCase().includes(l.toLowerCase())),D=R.filter(o=>!l||o.carrier.toLowerCase().includes(l.toLowerCase())||o.origen.toLowerCase().includes(l.toLowerCase())||o.destino.toLowerCase().includes(l.toLowerCase()));return y?e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsx($,{icon:X,title:"Transportistas",subtitle:"Cargando...",actions:[{label:"â† LogÃ­stica",onClick:()=>t("logistica")}]}),e.jsx("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(K,{size:32,color:W,style:{animation:"spin 1s linear infinite"}})})]}):i?e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:e.jsx($,{icon:X,title:"Transportistas",subtitle:`Error: ${i}`,actions:[{label:"â† LogÃ­stica",onClick:()=>t("logistica")},{label:"â†» Reintentar",primary:!0,onClick:A}]})}):e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsx($,{icon:X,title:"Transportistas",subtitle:`${L} carriers activos Â· ${_} envÃ­os en curso`,actions:[{label:"â† LogÃ­stica",onClick:()=>t("logistica")},{label:"+ Nuevo Carrier",primary:!0,onClick:()=>a(!0)}]}),e.jsxs("div",{style:{flex:1,overflow:"hidden",display:"flex",flexDirection:"column",backgroundColor:"#F8F9FA"},children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:"12px",padding:"20px 20px 0"},children:[{label:"Carriers Activos",value:L,icon:te,color:W},{label:"EnvÃ­os en curso",value:_,icon:X,color:"#2563EB"},{label:"Tramos configurados",value:R.filter(o=>o.activo).length,icon:re,color:"#7C3AED"},{label:"Rating promedio",value:v.length>0?(v.reduce((o,g)=>o+(g.rating||0),0)/v.length).toFixed(1)+"â˜…":"0â˜…",icon:V,color:"#F59E0B"}].map(o=>{const g=o.icon;return e.jsxs("div",{style:{backgroundColor:"#fff",borderRadius:"12px",border:"1px solid #E5E7EB",padding:"16px",display:"flex",gap:"12px",alignItems:"center"},children:[e.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"10px",backgroundColor:`${o.color}15`,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:e.jsx(g,{size:18,color:o.color})}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"20px",fontWeight:800,color:"#111"},children:o.value}),e.jsx("div",{style:{fontSize:"11px",color:"#6B7280"},children:o.label})]})]},o.label)})}),e.jsxs("div",{style:{display:"flex",gap:"0",padding:"16px 20px 0",borderBottom:"1px solid #E5E7EB",backgroundColor:"#fff",marginTop:"16px"},children:[[["transportistas","Transportistas"],["tramos","Tramos & Zonas"],["tarifas","Simulador de Tarifas"]].map(([o,g])=>e.jsx("button",{onClick:()=>E(o),style:{padding:"10px 20px",border:"none",backgroundColor:"transparent",cursor:"pointer",fontSize:"13px",fontWeight:n===o?700:500,color:n===o?W:"#6B7280",borderBottom:n===o?`2px solid ${W}`:"2px solid transparent",transition:"all 0.15s"},children:g},o)),e.jsx("div",{style:{flex:1}}),e.jsxs("div",{style:{position:"relative",padding:"6px 0"},children:[e.jsx(Z,{size:13,color:"#9CA3AF",style:{position:"absolute",left:"10px",top:"50%",transform:"translateY(-50%)"}}),e.jsx("input",{value:l,onChange:o=>p(o.target.value),placeholder:"Buscar...",style:{paddingLeft:"30px",paddingRight:"12px",paddingTop:"7px",paddingBottom:"7px",border:"1px solid #E5E7EB",borderRadius:"8px",fontSize:"12px",outline:"none",width:"180px"}})]})]}),e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"16px 20px"},children:[n==="transportistas"&&e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(340px,1fr))",gap:"12px"},children:[M.map(o=>{const g=N[o.tipo]??{label:o.tipo,color:"#6B7280",bg:"#F3F4F6"},k=(c==null?void 0:c.id)===o.id;return e.jsxs("div",{onClick:()=>f(k?null:o),style:{backgroundColor:"#fff",borderRadius:"12px",border:`1.5px solid ${k?W:o.activo?"#E5E7EB":"#F3F4F6"}`,padding:"18px",cursor:"pointer",opacity:o.activo?1:.6,boxShadow:k?`0 0 0 3px ${W}22`:"0 1px 4px rgba(0,0,0,0.04)",transition:"all 0.15s"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px",marginBottom:"12px"},children:[e.jsx("div",{style:{width:"44px",height:"44px",borderRadius:"12px",backgroundColor:"#F3F4F6",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"22px",flexShrink:0},children:o.logo}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",flexWrap:"wrap"},children:[e.jsx("span",{style:{fontSize:"14px",fontWeight:800,color:"#111"},children:o.nombre}),e.jsx("span",{style:{fontSize:"10px",fontWeight:700,color:g.color,backgroundColor:g.bg,padding:"2px 7px",borderRadius:"10px"},children:g.label}),!o.activo&&e.jsx("span",{style:{fontSize:"10px",fontWeight:700,color:"#9CA3AF",backgroundColor:"#F3F4F6",padding:"2px 7px",borderRadius:"10px"},children:"Inactivo"})]}),e.jsx(pe,{n:o.rating||0})]}),e.jsx("div",{style:{width:"36px",height:"20px",borderRadius:"10px",backgroundColor:o.activo?"#D1FAE5":"#F3F4F6",display:"flex",alignItems:"center",padding:"0 2px",cursor:"pointer",flexShrink:0,justifyContent:o.activo?"flex-end":"flex-start"},children:e.jsx("div",{style:{width:"16px",height:"16px",borderRadius:"50%",backgroundColor:o.activo?"#059669":"#9CA3AF"}})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px",marginBottom:"12px"},children:[e.jsxs("div",{style:{fontSize:"11px",color:"#6B7280"},children:["â± ",o.tiempoPromedio||"â€”"]}),e.jsxs("div",{style:{fontSize:"11px",color:"#6B7280"},children:["ðŸ“¦ ",o.enviosActivos||0," activos"]}),e.jsxs("div",{style:{fontSize:"11px",color:"#6B7280"},children:["ðŸ“Š ",o.enviosTotales||0," totales"]}),e.jsxs("div",{style:{fontSize:"11px",color:"#6B7280"},children:["â˜Ž ",o.telefono||"â€”"]})]}),o.cobertura&&o.cobertura.length>0&&e.jsx("div",{style:{display:"flex",gap:"4px",flexWrap:"wrap"},children:o.cobertura.map(P=>e.jsx("span",{style:{fontSize:"10px",color:"#374151",backgroundColor:"#F3F4F6",padding:"2px 7px",borderRadius:"6px"},children:P},P))})]},o.id)}),e.jsxs("div",{onClick:()=>a(!0),style:{backgroundColor:"#FAFAFA",borderRadius:"12px",border:"2px dashed #E5E7EB",padding:"24px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"10px",cursor:"pointer",minHeight:"160px"},children:[e.jsx("div",{style:{width:"44px",height:"44px",borderRadius:"50%",backgroundColor:"#FFF4EC",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(ie,{size:22,color:W})}),e.jsx("span",{style:{fontSize:"13px",fontWeight:700,color:W},children:"Agregar Carrier"}),e.jsx("span",{style:{fontSize:"11px",color:"#9CA3AF",textAlign:"center"},children:"Conectar nuevo transportista al sistema"})]})]}),n==="tramos"&&e.jsx("div",{style:{backgroundColor:"#fff",borderRadius:"12px",border:"1px solid #E5E7EB",overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{backgroundColor:"#F9FAFB"},children:["Carrier","Origen","Destino","Tipo","Tiempo Est.","Tarifa Base","$/Kg","Estado"].map(o=>e.jsx("th",{style:{padding:"12px 14px",textAlign:"left",fontSize:"11px",fontWeight:700,color:"#6B7280",textTransform:"uppercase",letterSpacing:"0.05em",borderBottom:"1px solid #E5E7EB"},children:o},o))})}),e.jsx("tbody",{children:D.map((o,g)=>{const k=N[o.tipo]??{label:o.tipo,color:"#6B7280",bg:"#F3F4F6"};return e.jsxs("tr",{style:{borderBottom:g<D.length-1?"1px solid #F3F4F6":"none"},children:[e.jsx("td",{style:{padding:"12px 14px",fontSize:"13px",fontWeight:600,color:"#374151"},children:o.carrier}),e.jsx("td",{style:{padding:"12px 14px",fontSize:"12px",color:"#6B7280"},children:o.origen}),e.jsx("td",{style:{padding:"12px 14px",fontSize:"12px",color:"#374151",fontWeight:500},children:o.destino}),e.jsx("td",{style:{padding:"12px 14px"},children:e.jsx("span",{style:{fontSize:"10px",fontWeight:700,color:k.color,backgroundColor:k.bg,padding:"3px 8px",borderRadius:"10px"},children:k.label})}),e.jsxs("td",{style:{padding:"12px 14px",fontSize:"12px",color:"#374151",display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(ne,{size:11,color:"#9CA3AF"})," ",o.tiempoEstimado||"â€”"]}),e.jsxs("td",{style:{padding:"12px 14px",fontSize:"13px",fontWeight:700,color:"#111"},children:["$",(o.tarifaBase||0).toLocaleString("es-AR")]}),e.jsxs("td",{style:{padding:"12px 14px",fontSize:"12px",color:"#6B7280"},children:["$",o.tarifaKg||0,"/kg"]}),e.jsx("td",{style:{padding:"12px 14px"},children:e.jsx("span",{style:{fontSize:"10px",fontWeight:700,color:o.activo?"#059669":"#9CA3AF",backgroundColor:o.activo?"#ECFDF5":"#F3F4F6",padding:"3px 8px",borderRadius:"10px"},children:o.activo?"â— Activo":"â—‹ Inactivo"})})]},o.id)})})]})}),n==="tarifas"&&e.jsx("div",{style:{maxWidth:"560px"},children:e.jsxs("div",{style:{backgroundColor:"#fff",borderRadius:"12px",border:"1px solid #E5E7EB",padding:"24px"},children:[e.jsx("h3",{style:{margin:"0 0 20px",fontSize:"15px",fontWeight:800,color:"#111"},children:"Simulador de Tarifa de EnvÃ­o"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"14px"},children:[[{label:"Peso (kg)",type:"number",placeholder:"Ej: 2.5"},{label:"Volumen (mÂ³)",type:"number",placeholder:"Ej: 0.02"},{label:"CÃ³digo Postal Origen",type:"text",placeholder:"Ej: C1001"},{label:"CÃ³digo Postal Destino",type:"text",placeholder:"Ej: 5000"}].map(o=>e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"12px",fontWeight:700,color:"#374151",marginBottom:"6px"},children:o.label}),e.jsx("input",{type:o.type,placeholder:o.placeholder,style:{width:"100%",padding:"10px 12px",border:"1px solid #E5E7EB",borderRadius:"8px",fontSize:"13px",outline:"none",boxSizing:"border-box"}})]},o.label)),e.jsx("button",{style:{marginTop:"6px",padding:"12px",border:"none",borderRadius:"10px",backgroundColor:W,color:"#fff",fontSize:"14px",fontWeight:700,cursor:"pointer"},children:"Calcular tarifas disponibles"})]}),e.jsxs("div",{style:{marginTop:"20px",padding:"14px",backgroundColor:"#F9FAFB",borderRadius:"10px",border:"1px solid #E5E7EB"},children:[e.jsx("p",{style:{margin:"0 0 10px",fontSize:"12px",fontWeight:700,color:"#374151"},children:"Tarifas estimadas:"}),[{carrier:"Express Delivery GBA",tiempo:"Same day",precio:1400},{carrier:"OCA",tiempo:"24-48h",precio:1680},{carrier:"Correo Argentino",tiempo:"3-4 dÃ­as",precio:2450},{carrier:"Andreani",tiempo:"2-3 dÃ­as",precio:2750}].map(o=>e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px 0",borderBottom:"1px solid #E5E7EB"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"12px",fontWeight:600,color:"#111"},children:o.carrier}),e.jsx("div",{style:{fontSize:"11px",color:"#9CA3AF"},children:o.tiempo})]}),e.jsxs("div",{style:{fontSize:"14px",fontWeight:800,color:W},children:["$",o.precio.toLocaleString("es-AR")]})]},o.carrier))]})]})})]})]}),e.jsx(ae,{open:B,onClose:()=>a(!1),onSave:m,title:"Nuevo Carrier",icon:X,sheets:ce})]})}export{ke as TransportistasView};
