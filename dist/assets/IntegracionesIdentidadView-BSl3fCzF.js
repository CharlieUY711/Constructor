import{r as l,j as e,C as L}from"./index-CqR9Aq3W.js";import{O as V}from"./OrangeHeader-CKn4kf1Z.js";import{g as u,a as M,u as O,p as Y}from"./integracionesApi-UG3UHtMr.js";import{S as G}from"./shield-D1-1A3yR.js";import{Z as H}from"./zap-CK1ljsId.js";import{C as N}from"./clock-j6cEw-Pq.js";import{C as P}from"./circle-check-DsGsjON6.js";import{S as Z}from"./settings-2-D0qmtiDw.js";import"./lightbulb-BTF3XheD.js";import"./map-pin-0CDjZxym.js";const b="#FF6835",B={activo:{label:"Activo",color:"#10B981",bg:"#D1FAE5",Icon:P},inactivo:{label:"Inactivo",color:"#9CA3AF",bg:"#F3F4F6",Icon:N},error:{label:"Error",color:"#EF4444",bg:"#FEE2E2",Icon:L},configurando:{label:"Configurando",color:"#F59E0B",bg:"#FEF3C7",Icon:H}};function re({onNavigate:I}){const[s,x]=l.useState([]),[m,A]=l.useState(!0),[z,h]=l.useState(null),[y,v]=l.useState({}),[a,j]=l.useState(null),[w,k]=l.useState({}),[C,R]=l.useState({});l.useEffect(()=>{(async()=>{try{const r=await u({tipo:"identidad"});x(r);const n={};r.forEach(i=>{i.config&&typeof i.config=="object"&&(n[i.id]=i.config);const d=i.config;d!=null&&d.stats&&R(c=>({...c,[i.id]:d.stats}))}),v(n)}catch(r){console.error("Error cargando integraciones de identidad:",r)}finally{A(!1)}})()},[]);const W=async o=>{try{const r=y[o.id]||{};await O(o.id,{config:r,estado:"configurando"});const n=await u({tipo:"identidad"});x(n),h(null)}catch(r){console.error("Error guardando configuraci√≥n:",r),alert("Error al guardar la configuraci√≥n")}},T=async o=>{j(o.id);try{await Y(o.id);const r=await u({tipo:"identidad"});x(r),E(o.id)}catch(r){console.error("Error en ping:",r),alert("Error al probar la conexi√≥n")}finally{j(null)}},E=async o=>{try{const r=await M(o,10);k(n=>({...n,[o]:r}))}catch(r){console.error("Error cargando logs:",r)}},D=s.filter(o=>o.estado==="activo").length,S=s.find(o=>o.nombre==="metamap")||s[0],f=S?C[S.id]:null;return e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsx(V,{icon:G,title:"Identidad",subtitle:"MetaMap (KYC) ‚Äî Verificaci√≥n de identidad y cumplimiento normativo",actions:[{label:"‚Üê Integraciones",onClick:()=>I("integraciones")}]}),e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"24px 32px",backgroundColor:"#F8F9FA"},children:[e.jsx("div",{style:{display:"flex",gap:10,marginBottom:20},children:[{label:"Integraciones",value:m?"...":s.length,color:"#111827"},{label:"Activas",value:m?"...":D,color:"#10B981"},{label:"Verificaciones",value:f?f.verificaciones:"‚Äî",color:"#3B82F6"},{label:"Aprobadas",value:f?f.aprobadas:"‚Äî",color:"#10B981"}].map((o,r)=>e.jsxs("div",{style:{flex:1,backgroundColor:"#fff",borderRadius:10,padding:"12px 16px",border:"1px solid #E5E7EB",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"800",color:o.color},children:o.value}),e.jsx("div",{style:{fontSize:"0.7rem",color:"#9CA3AF",marginTop:2},children:o.label})]},r))}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:14},children:s.map(o=>{const r=B[o.estado]||B.inactivo,n=r.Icon,i=z===o.id,d=y[o.id]||{},c=w[o.id]||[],g=C[o.id];return e.jsxs("div",{style:{backgroundColor:"#fff",borderRadius:14,border:"1px solid #E5E7EB",overflow:"hidden"},children:[e.jsx("div",{style:{height:3,backgroundColor:r.color}}),e.jsxs("div",{style:{padding:"16px 18px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:12,marginBottom:10},children:[e.jsx("div",{style:{width:42,height:42,borderRadius:10,backgroundColor:"#F9FAFB",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.3rem",flexShrink:0},children:"üõ°Ô∏è"}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontWeight:"800",color:"#111827",fontSize:"0.95rem",marginBottom:4},children:o.proveedor}),e.jsx("div",{style:{fontSize:"0.75rem",color:"#6B7280"},children:o.nombre})]})]}),g&&e.jsx("div",{style:{marginBottom:10,padding:"10px",backgroundColor:"#F9FAFB",borderRadius:8,border:"1px solid #E5E7EB"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-around",gap:8},children:[e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"1.2rem",fontWeight:"800",color:"#3B82F6"},children:g.verificaciones}),e.jsx("div",{style:{fontSize:"0.65rem",color:"#6B7280"},children:"Total"})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"1.2rem",fontWeight:"800",color:"#10B981"},children:g.aprobadas}),e.jsx("div",{style:{fontSize:"0.65rem",color:"#6B7280"},children:"Aprobadas"})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"1.2rem",fontWeight:"800",color:"#EF4444"},children:g.rechazadas}),e.jsx("div",{style:{fontSize:"0.65rem",color:"#6B7280"},children:"Rechazadas"})]})]})}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:10},children:[e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:4,padding:"4px 9px",backgroundColor:r.bg,color:r.color,borderRadius:20,fontSize:"0.7rem",fontWeight:"700"},children:[e.jsx(n,{size:11})," ",r.label]}),e.jsx("div",{style:{display:"flex",gap:6},children:e.jsxs("button",{onClick:()=>{i?h(null):(h(o.id),c.length===0&&E(o.id))},style:{display:"flex",alignItems:"center",gap:4,padding:"5px 12px",borderRadius:7,border:"none",backgroundColor:b,color:"#fff",fontSize:"0.72rem",fontWeight:"700",cursor:"pointer"},children:[e.jsx(Z,{size:11})," ",i?"Cerrar":"Configurar"]})})]}),i&&e.jsxs("div",{style:{marginTop:14,padding:"14px",backgroundColor:"#F9FAFB",borderRadius:10,border:"1px solid #E5E7EB"},children:[e.jsxs("p",{style:{margin:"0 0 10px",fontSize:"0.72rem",fontWeight:"700",color:"#374151"},children:["Credenciales ‚Äî ",o.proveedor]}),["clientId","clientSecret","flowId"].map(t=>e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("label",{style:{fontSize:"0.68rem",fontWeight:"700",color:"#9CA3AF",display:"block",marginBottom:3,textTransform:"uppercase",letterSpacing:"0.05em"},children:t==="clientId"?"Client ID":t==="clientSecret"?"Client Secret":"Flow ID"}),e.jsx("input",{type:t==="clientSecret"?"password":"text",value:d[t]||"",onChange:p=>v(F=>({...F,[o.id]:{...F[o.id]||{},[t]:p.target.value}})),placeholder:`${t==="clientId"?"Client ID":t==="clientSecret"?"Client Secret":"Flow ID"}...`,style:{width:"100%",padding:"7px 10px",border:"1.5px solid #E5E7EB",borderRadius:7,fontSize:"0.8rem",outline:"none",boxSizing:"border-box",backgroundColor:"#fff"},onFocus:p=>p.target.style.borderColor=b,onBlur:p=>p.target.style.borderColor="#E5E7EB"})]},t)),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:10},children:[e.jsx("button",{onClick:()=>W(o),style:{flex:1,padding:"8px",backgroundColor:b,color:"#fff",border:"none",borderRadius:7,fontSize:"0.78rem",fontWeight:"700",cursor:"pointer"},children:"Guardar"}),e.jsx("button",{onClick:()=>T(o),disabled:a===o.id,style:{padding:"8px 12px",backgroundColor:a===o.id?"#E5E7EB":"#10B981",color:a===o.id?"#9CA3AF":"#fff",border:"none",borderRadius:7,fontSize:"0.78rem",fontWeight:"700",cursor:a===o.id?"not-allowed":"pointer"},children:a===o.id?"Probando...":"Test conexi√≥n"})]}),c.length>0&&e.jsxs("div",{style:{marginTop:14,padding:"10px",backgroundColor:"#fff",borderRadius:7,border:"1px solid #E5E7EB"},children:[e.jsx("p",{style:{margin:"0 0 8px",fontSize:"0.7rem",fontWeight:"700",color:"#374151"},children:"√öltimos eventos"}),e.jsx("div",{style:{maxHeight:120,overflowY:"auto"},children:c.map(t=>e.jsxs("div",{style:{padding:"4px 0",fontSize:"0.68rem",color:"#6B7280",borderBottom:"1px solid #F3F4F6"},children:[e.jsx("span",{style:{fontWeight:"600"},children:new Date(t.created_at).toLocaleString()})," ‚Äî ",e.jsx("span",{style:{color:t.nivel==="error"?"#EF4444":t.nivel==="warning"?"#F59E0B":"#6B7280"},children:t.mensaje})]},t.id))})]})]})]})]},o.id)})}),s.length===0&&!m&&e.jsxs("div",{style:{textAlign:"center",padding:"48px 0",color:"#9CA3AF"},children:[e.jsx("p",{style:{fontSize:"2rem",margin:"0 0 8px"},children:"üõ°Ô∏è"}),e.jsx("p",{style:{fontWeight:"600"},children:"No hay integraciones de identidad configuradas"})]})]})]})}export{re as IntegracionesIdentidadView};
