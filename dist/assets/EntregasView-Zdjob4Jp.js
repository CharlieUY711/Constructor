import{s as S,R as s,j as e,t as A}from"./index-azkS-jky.js";import{O as _}from"./OrangeHeader-DXf0Dzcs.js";import{C as j}from"./circle-x-COk-C2Rm.js";import{C as z}from"./clock-D0ZD3uxc.js";import{C as w}from"./circle-check-BVQpnX8W.js";import{L as B}from"./loader-circle-CxJlOYrT.js";import"./ConnectionStatusIcon-B0SH-dg6.js";import"./zap-D43v8-VJ.js";import"./lightbulb-BiOuno9l.js";import"./map-pin-BucniFEY.js";const k="oddy";async function L(i){let r=S.from("entregas").select("*, envios(id, numero, destinatario, destino)").eq("tenant_id",k).order("created_at",{ascending:!1});i!=null&&i.estado&&(r=r.eq("estado",i.estado)),i!=null&&i.desde&&(r=r.gte("fecha_entrega",i.desde)),i!=null&&i.hasta&&(r=r.lte("fecha_entrega",i.hasta));const{data:g,error:l}=await r;if(l)throw console.error("[entregasApi] Error obteniendo entregas:",l),new Error(l.message||"Error cargando entregas");return g||[]}const f="#FF6835",x={entregado:{label:"Entregado",color:"#059669",bg:"#ECFDF5",Icon:w},no_entregado:{label:"No entregado",color:"#EF4444",bg:"#FEF2F2",Icon:j},parcial:{label:"Parcial",color:"#D97706",bg:"#FFFBEB",Icon:z},devuelto:{label:"Devuelto",color:"#6B7280",bg:"#F3F4F6",Icon:j}};function U({onNavigate:i}){const[r,g]=s.useState([]),[l,h]=s.useState(!0),[d,v]=s.useState(""),[c,m]=s.useState(""),[F,E]=s.useState(null),C=async()=>{h(!0);try{g(await L({estado:d||void 0}))}catch{A.error("Error")}finally{h(!1)}};s.useEffect(()=>{C()},[d]);const p=r.filter(o=>{var t,n;return!c||(((t=o.envios)==null?void 0:t.numero)||"").toLowerCase().includes(c.toLowerCase())||(((n=o.envios)==null?void 0:n.destinatario)||"").toLowerCase().includes(c.toLowerCase())});return e.jsxs("div",{style:{minHeight:"100vh",background:"#F8FAFC"},children:[e.jsx(_,{title:"Entregas",subtitle:"Confirmaciones y acuses de recibo",onBack:()=>i("logistica")}),e.jsxs("div",{style:{maxWidth:1100,margin:"0 auto",padding:"24px 16px"},children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:24},children:Object.entries(x).map(([o,t])=>{const{Icon:n}=t;return e.jsxs("button",{onClick:()=>v(d===o?"":o),style:{background:d===o?t.bg:"#fff",border:"2px solid "+(d===o?t.color:"#E5E7EB"),borderRadius:10,padding:14,textAlign:"center",cursor:"pointer"},children:[e.jsx(n,{size:20,style:{color:t.color,marginBottom:6}}),e.jsx("div",{style:{fontSize:22,fontWeight:700,color:t.color},children:r.filter(a=>a.estado===o).length}),e.jsx("div",{style:{fontSize:12,color:"#6B7280"},children:t.label})]},o)})}),e.jsx("input",{value:c,onChange:o=>m(o.target.value),placeholder:"Buscar envio o destinatario...",style:{width:"100%",padding:"9px 12px",border:"1px solid #E5E7EB",borderRadius:8,fontSize:14,marginBottom:16,boxSizing:"border-box"}}),l?e.jsx("div",{style:{textAlign:"center",padding:60},children:e.jsx(B,{size:32,style:{color:f}})}):p.length===0?e.jsx("div",{style:{textAlign:"center",padding:60,color:"#9CA3AF"},children:"No hay entregas."}):e.jsx("div",{style:{display:"grid",gap:10},children:p.map(o=>{var u,y,b;const t=x[o.estado]||x.entregado,{Icon:n}=t,a=F===o.id;return e.jsxs("div",{onClick:()=>E(a?null:o.id),style:{background:"#fff",border:"1px solid "+(a?f:"#E5E7EB"),borderRadius:10,padding:"16px 20px",cursor:"pointer"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:14},children:[e.jsx("div",{style:{width:40,height:40,borderRadius:10,background:t.bg,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:e.jsx(n,{size:18,style:{color:t.color}})}),e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{fontWeight:700},children:[((u=o.envios)==null?void 0:u.numero)||o.envio_id.slice(0,8),e.jsx("span",{style:{marginLeft:8,background:t.bg,color:t.color,fontSize:11,fontWeight:600,padding:"2px 8px",borderRadius:20},children:t.label})]}),e.jsxs("div",{style:{fontSize:13,color:"#6B7280"},children:[(y=o.envios)==null?void 0:y.destinatario,((b=o.envios)==null?void 0:b.destino)&&" - "+o.envios.destino]})]}),e.jsxs("div",{style:{textAlign:"right",fontSize:12,color:"#9CA3AF"},children:[e.jsx("div",{children:new Date(o.fecha_entrega).toLocaleDateString("es-UY")}),e.jsx("div",{children:new Date(o.fecha_entrega).toLocaleTimeString("es-UY",{hour:"2-digit",minute:"2-digit"})})]})]}),a&&e.jsxs("div",{style:{marginTop:14,paddingTop:14,borderTop:"1px solid #F3F4F6",display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(180px,1fr))",gap:12},children:[o.firmado_por&&e.jsxs("div",{children:[e.jsx("span",{style:{fontSize:11,color:"#9CA3AF",display:"block"},children:"Firmado por"}),e.jsx("strong",{children:o.firmado_por})]}),o.notas&&e.jsxs("div",{children:[e.jsx("span",{style:{fontSize:11,color:"#9CA3AF",display:"block"},children:"Notas"}),e.jsx("span",{style:{fontSize:13},children:o.notas})]}),o.motivo_no_entrega&&e.jsxs("div",{children:[e.jsx("span",{style:{fontSize:11,color:"#9CA3AF",display:"block"},children:"Motivo"}),e.jsx("span",{style:{fontSize:13,color:"#EF4444"},children:o.motivo_no_entrega})]}),o.foto_url&&e.jsxs("div",{children:[e.jsx("span",{style:{fontSize:11,color:"#9CA3AF",display:"block"},children:"Foto"}),e.jsx("a",{href:o.foto_url,target:"_blank",rel:"noopener noreferrer",style:{color:f,fontSize:13},children:"Ver foto"})]})]})]},o.id)})})]})]})}export{U as EntregasView};
