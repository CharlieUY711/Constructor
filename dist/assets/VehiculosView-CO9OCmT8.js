import{s as x,r as s,j as e,f as T,T as W,t as c}from"./index-CqR9Aq3W.js";import{O as D}from"./OrangeHeader-CKn4kf1Z.js";import{P as I}from"./plus-CCYOtKpX.js";import{L as V}from"./loader-circle-BuSgv4T0.js";import{P as q}from"./pen-CTPUdUoW.js";import{T as L}from"./trash-2-B_fu8ItL.js";import"./zap-CK1ljsId.js";import"./lightbulb-BTF3XheD.js";import"./map-pin-0CDjZxym.js";const m="oddy";async function N(r){let i=x.from("vehiculos").select("*, transportistas(id, nombre)").eq("tenant_id",m);const{data:a,error:n}=await i.order("patente");if(n)throw console.error("[vehiculosApi] Error obteniendo vehÃ­culos:",n),new Error(n.message||"Error cargando vehÃ­culos");return a||[]}async function P(r){const{data:i,error:a}=await x.from("vehiculos").insert({...r,tenant_id:m,activo:r.activo??!0}).select().single();if(a)throw console.error("[vehiculosApi] Error creando vehÃ­culo:",a),new Error(a.message||"Error creando vehÃ­culo");return i}async function O(r,i){const{data:a,error:n}=await x.from("vehiculos").update({...i,updated_at:new Date().toISOString()}).eq("id",r).eq("tenant_id",m).select().single();if(n)throw console.error("[vehiculosApi] Error actualizando vehÃ­culo:",n),new Error(n.message||"Error actualizando vehÃ­culo");return a}async function G(r){const{error:i}=await x.from("vehiculos").delete().eq("id",r).eq("tenant_id",m);return i?(console.error("[vehiculosApi] Error eliminando vehÃ­culo:",i),!1):!0}const j="#FF6835",h={moto:{label:"Moto",emoji:"ðŸï¸"},auto:{label:"Auto",emoji:"ðŸš—"},furgon:{label:"FurgÃ³n",emoji:"ðŸš"},camioneta:{label:"Camioneta",emoji:"ðŸ›»"},camion:{label:"CamiÃ³n",emoji:"ðŸšš"}},z={tipo:"moto",activo:!0};function Z({onNavigate:r}){const[i,a]=s.useState([]),[n,v]=s.useState(!0),[u,C]=s.useState(""),[l,p]=s.useState(z),[f,k]=s.useState(null),[w,g]=s.useState(!1),[y,E]=s.useState(!1),b=async()=>{v(!0);try{a(await N())}catch{c.error("Error cargando vehÃ­culos")}finally{v(!1)}};s.useEffect(()=>{b()},[]);const S=i.filter(t=>t.patente.toLowerCase().includes(u.toLowerCase())||(t.marca||"").toLowerCase().includes(u.toLowerCase())),A=()=>{p(z),k(null),g(!0)},F=t=>{p(t),k(t.id),g(!0)},B=async()=>{if(!l.patente||!l.tipo)return c.error("Patente y tipo son requeridos");E(!0);try{f?(await O(f,l),c.success("VehÃ­culo actualizado")):(await P(l),c.success("VehÃ­culo creado")),g(!1),b()}catch{c.error("Error guardando")}finally{E(!1)}},R=async t=>{confirm("Â¿Eliminar vehÃ­culo?")&&(await G(t),c.success("Eliminado"),b())};return e.jsxs("div",{style:{minHeight:"100vh",background:"#F8FAFC"},children:[e.jsx(D,{title:"VehÃ­culos",subtitle:"Flota propia y de transportistas",onBack:()=>r("logistica")}),e.jsxs("div",{style:{maxWidth:1100,margin:"0 auto",padding:"24px 16px"},children:[e.jsxs("div",{style:{display:"flex",gap:12,marginBottom:24},children:[e.jsxs("div",{style:{flex:1,position:"relative"},children:[e.jsx(T,{size:16,style:{position:"absolute",left:12,top:"50%",transform:"translateY(-50%)",color:"#9CA3AF"}}),e.jsx("input",{value:u,onChange:t=>C(t.target.value),placeholder:"Buscar por patente o marca...",style:{width:"100%",paddingLeft:36,paddingRight:12,paddingTop:10,paddingBottom:10,border:"1px solid #E5E7EB",borderRadius:8,fontSize:14,boxSizing:"border-box"}})]}),e.jsxs("button",{onClick:A,style:{display:"flex",alignItems:"center",gap:6,background:j,color:"#fff",border:"none",borderRadius:8,padding:"10px 18px",fontWeight:600,cursor:"pointer",fontSize:14},children:[e.jsx(I,{size:16})," Nuevo"]})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(140px, 1fr))",gap:12,marginBottom:24},children:Object.entries(h).map(([t,o])=>{const d=i.filter(_=>_.tipo===t).length;return e.jsxs("div",{style:{background:"#fff",border:"1px solid #E5E7EB",borderRadius:10,padding:"14px 16px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:24},children:o.emoji}),e.jsx("div",{style:{fontSize:22,fontWeight:700,color:"#111"},children:d}),e.jsx("div",{style:{fontSize:12,color:"#6B7280"},children:o.label})]},t)})}),n?e.jsx("div",{style:{textAlign:"center",padding:60},children:e.jsx(V,{size:32,style:{color:j,animation:"spin 1s linear infinite"}})}):S.length===0?e.jsxs("div",{style:{textAlign:"center",padding:60,color:"#9CA3AF"},children:[e.jsx(W,{size:48,style:{marginBottom:12,opacity:.3}}),e.jsxs("p",{children:["No hay vehÃ­culos",u?" que coincidan":". AgregÃ¡ el primero."]})]}):e.jsx("div",{style:{display:"grid",gap:10},children:S.map(t=>{var o,d;return e.jsxs("div",{style:{background:"#fff",border:"1px solid #E5E7EB",borderRadius:10,padding:"16px 20px",display:"flex",alignItems:"center",gap:16},children:[e.jsx("div",{style:{fontSize:28,minWidth:40,textAlign:"center"},children:((o=h[t.tipo])==null?void 0:o.emoji)||"ðŸš—"}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontWeight:700,fontSize:16},children:t.patente}),e.jsxs("div",{style:{fontSize:13,color:"#6B7280"},children:[(d=h[t.tipo])==null?void 0:d.label," ",t.marca&&`Â· ${t.marca}`," ",t.modelo&&t.modelo," ",t.anio&&`(${t.anio})`]}),(t.capacidad_kg||t.capacidad_m3)&&e.jsxs("div",{style:{fontSize:12,color:"#9CA3AF",marginTop:2},children:[t.capacidad_kg&&`${t.capacidad_kg} kg`," ",t.capacidad_m3&&`Â· ${t.capacidad_m3} mÂ³`]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[t.activo?e.jsx("span",{style:{background:"#ECFDF5",color:"#059669",fontSize:12,fontWeight:600,padding:"3px 10px",borderRadius:20},children:"Activo"}):e.jsx("span",{style:{background:"#F3F4F6",color:"#6B7280",fontSize:12,fontWeight:600,padding:"3px 10px",borderRadius:20},children:"Inactivo"}),e.jsx("button",{onClick:()=>F(t),style:{background:"none",border:"none",cursor:"pointer",color:"#6B7280",padding:6},children:e.jsx(q,{size:15})}),e.jsx("button",{onClick:()=>R(t.id),style:{background:"none",border:"none",cursor:"pointer",color:"#EF4444",padding:6},children:e.jsx(L,{size:15})})]})]},t.id)})})]}),w&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:16},children:e.jsxs("div",{style:{background:"#fff",borderRadius:14,padding:28,width:"100%",maxWidth:480},children:[e.jsx("h3",{style:{margin:"0 0 20px",fontSize:18,fontWeight:700},children:f?"Editar vehÃ­culo":"Nuevo vehÃ­culo"}),e.jsxs("div",{style:{display:"grid",gap:14},children:[[{key:"patente",label:"Patente *",type:"text"},{key:"marca",label:"Marca",type:"text"},{key:"modelo",label:"Modelo",type:"text"},{key:"anio",label:"AÃ±o",type:"number"},{key:"capacidad_kg",label:"Capacidad (kg)",type:"number"},{key:"capacidad_m3",label:"Capacidad (mÂ³)",type:"number"}].map(t=>e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:13,fontWeight:600,color:"#374151",display:"block",marginBottom:4},children:t.label}),e.jsx("input",{type:t.type,value:l[t.key]||"",onChange:o=>p(d=>({...d,[t.key]:t.type==="number"?Number(o.target.value):o.target.value})),style:{width:"100%",border:"1px solid #D1D5DB",borderRadius:8,padding:"9px 12px",fontSize:14,boxSizing:"border-box"}})]},t.key)),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:13,fontWeight:600,color:"#374151",display:"block",marginBottom:4},children:"Tipo *"}),e.jsx("select",{value:l.tipo||"moto",onChange:t=>p(o=>({...o,tipo:t.target.value})),style:{width:"100%",border:"1px solid #D1D5DB",borderRadius:8,padding:"9px 12px",fontSize:14},children:Object.entries(h).map(([t,o])=>e.jsxs("option",{value:t,children:[o.emoji," ",o.label]},t))})]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:l.activo??!0,onChange:t=>p(o=>({...o,activo:t.target.checked}))}),e.jsx("span",{style:{fontSize:14},children:"Activo"})]})]}),e.jsxs("div",{style:{display:"flex",gap:10,marginTop:22,justifyContent:"flex-end"},children:[e.jsx("button",{onClick:()=>g(!1),style:{padding:"9px 18px",border:"1px solid #D1D5DB",borderRadius:8,background:"#fff",cursor:"pointer",fontSize:14},children:"Cancelar"}),e.jsx("button",{onClick:B,disabled:y,style:{padding:"9px 18px",background:j,color:"#fff",border:"none",borderRadius:8,fontWeight:600,cursor:"pointer",fontSize:14,opacity:y?.7:1},children:y?"Guardando...":"Guardar"})]})]})})]})}export{Z as VehiculosView};
