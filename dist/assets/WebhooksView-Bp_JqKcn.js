import{c as v,r as l,j as o}from"./index-azkS-jky.js";import{O as k}from"./OrangeHeader-DXf0Dzcs.js";import{e as I,f as R,h as _,i as w}from"./integracionesApi-YoMxfqRk.js";import{W as T}from"./webhook-BGDVDyev.js";import{P as N}from"./plus-DQBZQ3QI.js";import{Z as D}from"./zap-D43v8-VJ.js";import{T as P}from"./trash-2-DR8C_KhM.js";import{C as L}from"./circle-check-BVQpnX8W.js";import{C as O}from"./circle-x-COk-C2Rm.js";import"./ConnectionStatusIcon-B0SH-dg6.js";import"./lightbulb-BiOuno9l.js";import"./map-pin-BucniFEY.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"8",cy:"12",r:"2",key:"1nvbw3"}]],H=v("toggle-left",U);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"16",cy:"12",r:"2",key:"4ma0v8"}]],V=v("toggle-right",M),c="#FF6835",b=[{id:"pedido.creado",label:"Pedido creado"},{id:"pedido.actualizado",label:"Pedido actualizado"},{id:"pago.confirmado",label:"Pago confirmado"},{id:"pago.fallido",label:"Pago fallido"},{id:"envio.actualizado",label:"EnvÃ­o actualizado"},{id:"usuario.registrado",label:"Usuario registrado"}];function te({onNavigate:E}){const[s,j]=l.useState([]),[p,C]=l.useState(!0),[F,g]=l.useState(!1),[u,f]=l.useState(null),[t,n]=l.useState({nombre:"",url:"",eventos:[]}),[a,h]=l.useState(null),[d,y]=l.useState(null);l.useEffect(()=>{x()},[]);const x=async()=>{try{const e=await I();j(e)}catch(e){console.error("Error cargando webhooks:",e)}finally{C(!1)}},S=async()=>{if(!t.nombre.trim()||!t.url.trim()){alert("El nombre y la URL son requeridos");return}try{await w({...t,estado:"activo"}),n({nombre:"",url:"",eventos:[]}),g(!1),await x()}catch(e){console.error("Error creando webhook:",e),alert("Error al crear el webhook")}},z=async(e,r)=>{try{await R(e,r),await x()}catch(i){console.error("Error actualizando webhook:",i),alert("Error al actualizar el webhook")}},B=async e=>{if(confirm("Â¿EstÃ¡s seguro de eliminar este webhook?")){y(e);try{await _(e),await x()}catch(r){console.error("Error eliminando webhook:",r),alert("Error al eliminar el webhook")}finally{y(null)}}},W=async e=>{h(e.id);try{await new Promise(r=>setTimeout(r,1500)),alert("Webhook de prueba enviado")}catch(r){console.error("Error en test:",r),alert("Error al enviar el webhook de prueba")}finally{h(null)}},A=s.filter(e=>e.estado==="activo").length;return o.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:[o.jsx(k,{icon:T,title:"Webhooks",subtitle:"ConfigurÃ¡ webhooks para recibir eventos externos y notificaciones en tiempo real",actions:[{label:"â† Integraciones",onClick:()=>E("integraciones")}]}),o.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"24px 32px",backgroundColor:"#F8F9FA"},children:[o.jsx("div",{style:{display:"flex",gap:10,marginBottom:20},children:[{label:"Webhooks",value:p?"...":s.length,color:"#111827"},{label:"Activos",value:p?"...":A,color:"#10B981"},{label:"Inactivos",value:p?"...":s.filter(e=>e.estado==="inactivo").length,color:"#9CA3AF"}].map((e,r)=>o.jsxs("div",{style:{flex:1,backgroundColor:"#fff",borderRadius:10,padding:"12px 16px",border:"1px solid #E5E7EB",textAlign:"center"},children:[o.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"800",color:e.color},children:e.value}),o.jsx("div",{style:{fontSize:"0.7rem",color:"#9CA3AF",marginTop:2},children:e.label})]},r))}),o.jsx("div",{style:{marginBottom:20},children:o.jsxs("button",{onClick:()=>{f(null),n({nombre:"",url:"",eventos:[]}),g(!0)},style:{display:"flex",alignItems:"center",gap:6,padding:"10px 16px",borderRadius:8,backgroundColor:c,color:"#fff",border:"none",fontSize:"0.85rem",fontWeight:"700",cursor:"pointer"},children:[o.jsx(N,{size:16})," Nuevo Webhook"]})}),o.jsx("div",{style:{display:"grid",gap:12},children:s.map(e=>o.jsxs("div",{style:{backgroundColor:"#fff",borderRadius:12,border:"1px solid #E5E7EB",padding:"16px 20px"},children:[o.jsxs("div",{style:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",marginBottom:12},children:[o.jsxs("div",{style:{flex:1},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4},children:[o.jsx("span",{style:{fontWeight:"800",color:"#111827",fontSize:"0.95rem"},children:e.nombre}),o.jsx("span",{style:{padding:"2px 8px",borderRadius:12,fontSize:"0.65rem",fontWeight:"700",backgroundColor:e.estado==="activo"?"#D1FAE5":"#F3F4F6",color:e.estado==="activo"?"#10B981":"#6B7280"},children:e.estado==="activo"?"Activo":"Inactivo"})]}),o.jsx("code",{style:{padding:"4px 8px",borderRadius:4,backgroundColor:"#F9FAFB",border:"1px solid #E5E7EB",fontSize:"0.75rem",fontFamily:"monospace",color:"#374151",display:"inline-block"},children:e.url})]}),o.jsxs("div",{style:{display:"flex",gap:6},children:[o.jsxs("button",{onClick:()=>W(e),disabled:a===e.id,style:{padding:"6px 10px",borderRadius:6,border:"1px solid #E5E7EB",backgroundColor:a===e.id?"#F3F4F6":"#EFF6FF",color:a===e.id?"#9CA3AF":"#2563EB",cursor:a===e.id?"not-allowed":"pointer",fontSize:"0.72rem",fontWeight:"600",display:"flex",alignItems:"center",gap:4},children:[o.jsx(D,{size:12})," ",a===e.id?"Enviando...":"Test"]}),o.jsx("button",{onClick:()=>z(e.id,{estado:e.estado==="activo"?"inactivo":"activo"}),style:{padding:"6px 10px",borderRadius:6,border:"none",backgroundColor:e.estado==="activo"?"#F3F4F6":"#D1FAE5",color:e.estado==="activo"?"#6B7280":"#10B981",cursor:"pointer",fontSize:"0.72rem",fontWeight:"600",display:"flex",alignItems:"center",gap:4},children:e.estado==="activo"?o.jsx(H,{size:16}):o.jsx(V,{size:16})}),o.jsxs("button",{onClick:()=>B(e.id),disabled:d===e.id,style:{padding:"6px 10px",borderRadius:6,border:"none",backgroundColor:d===e.id?"#F3F4F6":"#FEE2E2",color:d===e.id?"#9CA3AF":"#EF4444",cursor:d===e.id?"not-allowed":"pointer",fontSize:"0.72rem",fontWeight:"600",display:"flex",alignItems:"center",gap:4},children:[o.jsx(P,{size:12})," ",d===e.id?"Eliminando...":"Eliminar"]})]})]}),o.jsxs("div",{style:{marginBottom:8},children:[o.jsx("span",{style:{fontSize:"0.7rem",color:"#9CA3AF",fontWeight:"700"},children:"Eventos: "}),o.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:4,marginTop:4},children:e.eventos.length>0?e.eventos.map(r=>{var i;return o.jsx("span",{style:{padding:"2px 8px",borderRadius:4,fontSize:"0.68rem",fontWeight:"600",backgroundColor:"#EFF6FF",color:"#2563EB"},children:((i=b.find(m=>m.id===r))==null?void 0:i.label)||r},r)}):o.jsx("span",{style:{fontSize:"0.68rem",color:"#9CA3AF",fontStyle:"italic"},children:"Sin eventos"})})]}),e.ultimo_intento&&o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,fontSize:"0.7rem",color:"#6B7280"},children:[o.jsxs("span",{children:["Ãšltimo intento: ",new Date(e.ultimo_intento).toLocaleString()]}),e.ultimo_status&&o.jsxs(o.Fragment,{children:[o.jsx("span",{children:"â€¢"}),o.jsx("span",{style:{display:"flex",alignItems:"center",gap:4},children:e.ultimo_status>=200&&e.ultimo_status<300?o.jsxs(o.Fragment,{children:[o.jsx(L,{size:12,color:"#10B981"})," ",e.ultimo_status]}):o.jsxs(o.Fragment,{children:[o.jsx(O,{size:12,color:"#EF4444"})," ",e.ultimo_status]})})]}),e.intentos_fallidos>0&&o.jsxs(o.Fragment,{children:[o.jsx("span",{children:"â€¢"}),o.jsxs("span",{style:{color:"#EF4444",fontWeight:"600"},children:[e.intentos_fallidos," intentos fallidos"]})]})]})]},e.id))}),s.length===0&&!p&&o.jsxs("div",{style:{textAlign:"center",padding:"48px 0",color:"#9CA3AF"},children:[o.jsx("p",{style:{fontSize:"2rem",margin:"0 0 8px"},children:"ðŸ”—"}),o.jsx("p",{style:{fontWeight:"600"},children:"No hay webhooks configurados"})]})]}),F&&o.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:o.jsxs("div",{style:{backgroundColor:"#fff",borderRadius:12,padding:"24px",width:"90%",maxWidth:500,maxHeight:"90vh",overflowY:"auto"},children:[o.jsx("h3",{style:{margin:"0 0 20px",fontSize:"1rem",fontWeight:"800",color:"#111827"},children:u?"Editar Webhook":"Nuevo Webhook"}),o.jsxs("div",{style:{marginBottom:16},children:[o.jsx("label",{style:{fontSize:"0.7rem",fontWeight:"700",color:"#9CA3AF",display:"block",marginBottom:6},children:"Nombre *"}),o.jsx("input",{type:"text",value:t.nombre,onChange:e=>n(r=>({...r,nombre:e.target.value})),placeholder:"Ej: Webhook de producciÃ³n",style:{width:"100%",padding:"9px 12px",border:"1.5px solid #E5E7EB",borderRadius:8,fontSize:"0.85rem",outline:"none",boxSizing:"border-box"},onFocus:e=>e.target.style.borderColor=c,onBlur:e=>e.target.style.borderColor="#E5E7EB"})]}),o.jsxs("div",{style:{marginBottom:16},children:[o.jsx("label",{style:{fontSize:"0.7rem",fontWeight:"700",color:"#9CA3AF",display:"block",marginBottom:6},children:"URL *"}),o.jsx("input",{type:"url",value:t.url,onChange:e=>n(r=>({...r,url:e.target.value})),placeholder:"https://tu-servidor.com/webhook",style:{width:"100%",padding:"9px 12px",border:"1.5px solid #E5E7EB",borderRadius:8,fontSize:"0.85rem",outline:"none",boxSizing:"border-box"},onFocus:e=>e.target.style.borderColor=c,onBlur:e=>e.target.style.borderColor="#E5E7EB"})]}),o.jsxs("div",{style:{marginBottom:16},children:[o.jsx("label",{style:{fontSize:"0.7rem",fontWeight:"700",color:"#9CA3AF",display:"block",marginBottom:8},children:"Eventos"}),o.jsx("div",{style:{display:"flex",flexDirection:"column",gap:6},children:b.map(e=>o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,cursor:"pointer"},children:[o.jsx("input",{type:"checkbox",checked:t.eventos.includes(e.id),onChange:r=>{r.target.checked?n(i=>({...i,eventos:[...i.eventos,e.id]})):n(i=>({...i,eventos:i.eventos.filter(m=>m!==e.id)}))},style:{cursor:"pointer"}}),o.jsx("span",{style:{fontSize:"0.8rem",color:"#374151"},children:e.label})]},e.id))})]}),o.jsxs("div",{style:{marginBottom:16},children:[o.jsx("label",{style:{fontSize:"0.7rem",fontWeight:"700",color:"#9CA3AF",display:"block",marginBottom:6},children:"Secret (opcional)"}),o.jsx("input",{type:"password",value:t.secret||"",onChange:e=>n(r=>({...r,secret:e.target.value})),placeholder:"Secret para verificar firma",style:{width:"100%",padding:"9px 12px",border:"1.5px solid #E5E7EB",borderRadius:8,fontSize:"0.85rem",outline:"none",boxSizing:"border-box"},onFocus:e=>e.target.style.borderColor=c,onBlur:e=>e.target.style.borderColor="#E5E7EB"})]}),o.jsxs("div",{style:{display:"flex",gap:8},children:[o.jsx("button",{onClick:S,disabled:!t.nombre.trim()||!t.url.trim(),style:{flex:1,padding:"10px",borderRadius:8,backgroundColor:t.nombre.trim()&&t.url.trim()?c:"#E5E7EB",color:t.nombre.trim()&&t.url.trim()?"#fff":"#9CA3AF",border:"none",fontSize:"0.85rem",fontWeight:"700",cursor:t.nombre.trim()&&t.url.trim()?"pointer":"not-allowed"},children:u?"Actualizar":"Crear Webhook"}),o.jsx("button",{onClick:()=>{g(!1),f(null)},style:{padding:"10px 16px",borderRadius:8,border:"1px solid #E5E7EB",backgroundColor:"#fff",color:"#6B7280",fontSize:"0.85rem",fontWeight:"600",cursor:"pointer"},children:"Cancelar"})]})]})})]})}export{te as WebhooksView};
