import{r as a,j as e,T as f,i as A,f as $}from"./index-DufFdXmn.js";import{O as h}from"./OrangeHeader-KafCQxVY.js";import{p as P,a as _}from"./info-tCLo8W3J.js";import{L as O}from"./loader-circle-B__HoSdu.js";import{U as M}from"./users-Df0Ecbcx.js";import{M as K}from"./map-pin-BcVW-XRo.js";import{P as G}from"./plus-e4_Qxrcj.js";import{C as H}from"./clock-DjCQC3It.js";import"./ConnectionStatusIcon-BVSyzm9s.js";import"./zap-Dw_LsZ_j.js";import"./lightbulb-Bo6upu0R.js";const z=`https://${P}.supabase.co/functions/v1/api/transportistas`,w={"Content-Type":"application/json",Authorization:`Bearer ${_}`};async function S(){const i=await(await fetch(`${z}`,{headers:w})).json();if(i.error)throw new Error(i.error);return i.data||[]}async function U(s){const c=await(await fetch(`${z}/${s}/tramos`,{headers:w})).json();if(c.error)throw new Error(c.error);return c.data||[]}const n="#FF6835",B={local:{label:"Local",color:"#059669",bg:"#ECFDF5"},nacional:{label:"Nacional",color:"#2563EB",bg:"#EFF6FF"},intercity:{label:"Intercity",color:"#7C3AED",bg:"#F5F3FF"},internacional:{label:"Internacional",color:"#D97706",bg:"#FFFBEB"}};function V({n:s}){return e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"2px"},children:[[1,2,3,4,5].map(i=>e.jsx(A,{size:11,color:i<=Math.round(s)?"#F59E0B":"#E5E7EB",fill:i<=Math.round(s)?"#F59E0B":"none"},i)),e.jsx("span",{style:{fontSize:"11px",color:"#6B7280",marginLeft:"3px"},children:s})]})}function re({onNavigate:s}){const[i,c]=a.useState("transportistas"),[d,k]=a.useState(""),[g,T]=a.useState(null),[p,R]=a.useState([]),[u,W]=a.useState([]),[I,m]=a.useState(!1),[y,b]=a.useState(null);a.useEffect(()=>{j()},[]);const j=async()=>{m(!0),b(null);try{const[o,r]=await Promise.all([S(),Promise.all((await S()).map(t=>U(t.id))).then(t=>t.flat())]),l=o.map(t=>({id:t.id,nombre:t.nombre,tipo:t.tipo,logo:t.logo,contacto:t.contacto,email:t.email,telefono:t.telefono,rating:t.rating||0,enviosActivos:t.envios_activos||0,enviosTotales:t.envios_totales||0,activo:t.activo??t.estado==="activo",tiempoPromedio:t.tiempo_promedio,cobertura:Array.isArray(t.cobertura)?t.cobertura:[]})),x=new Map(o.map(t=>[t.id,t])),L=r.map(t=>{var F;return{id:t.id,carrierId:t.transportista_id,carrier:((F=x.get(t.transportista_id))==null?void 0:F.nombre)||"",origen:t.origen,destino:t.destino,tipo:t.tipo,tiempoEstimado:t.tiempo_estimado,tarifaBase:t.tarifa_base,tarifaKg:t.tarifa_kg,activo:t.activo??t.estado==="activo"}});R(l),W(L)}catch(o){b(o instanceof Error?o.message:"Error cargando datos"),console.error("Error cargando transportistas:",o)}finally{m(!1)}},v=p.filter(o=>o.activo).length,C=p.reduce((o,r)=>o+(r.enviosActivos||0),0),D=p.filter(o=>!d||o.nombre.toLowerCase().includes(d.toLowerCase())),E=u.filter(o=>!d||o.carrier.toLowerCase().includes(d.toLowerCase())||o.origen.toLowerCase().includes(d.toLowerCase())||o.destino.toLowerCase().includes(d.toLowerCase()));return I?e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsx(h,{icon:f,title:"Transportistas",subtitle:"Cargando...",actions:[{label:"â† LogÃ­stica",onClick:()=>s("logistica")}]}),e.jsx("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(O,{size:32,color:n,style:{animation:"spin 1s linear infinite"}})})]}):y?e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:e.jsx(h,{icon:f,title:"Transportistas",subtitle:`Error: ${y}`,actions:[{label:"â† LogÃ­stica",onClick:()=>s("logistica")},{label:"â†» Reintentar",primary:!0,onClick:j}]})}):e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsx(h,{icon:f,title:"Transportistas",subtitle:`${v} carriers activos Â· ${C} envÃ­os en curso`,actions:[{label:"â† LogÃ­stica",onClick:()=>s("logistica")},{label:"+ Nuevo Carrier",primary:!0}]}),e.jsxs("div",{style:{flex:1,overflow:"hidden",display:"flex",flexDirection:"column",backgroundColor:"#F8F9FA"},children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:"12px",padding:"20px 20px 0"},children:[{label:"Carriers Activos",value:v,icon:M,color:n},{label:"EnvÃ­os en curso",value:C,icon:f,color:"#2563EB"},{label:"Tramos configurados",value:u.filter(o=>o.activo).length,icon:K,color:"#7C3AED"},{label:"Rating promedio",value:p.length>0?(p.reduce((o,r)=>o+(r.rating||0),0)/p.length).toFixed(1)+"â˜…":"0â˜…",icon:A,color:"#F59E0B"}].map(o=>{const r=o.icon;return e.jsxs("div",{style:{backgroundColor:"#fff",borderRadius:"12px",border:"1px solid #E5E7EB",padding:"16px",display:"flex",gap:"12px",alignItems:"center"},children:[e.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"10px",backgroundColor:`${o.color}15`,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:e.jsx(r,{size:18,color:o.color})}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"20px",fontWeight:800,color:"#111"},children:o.value}),e.jsx("div",{style:{fontSize:"11px",color:"#6B7280"},children:o.label})]})]},o.label)})}),e.jsxs("div",{style:{display:"flex",gap:"0",padding:"16px 20px 0",borderBottom:"1px solid #E5E7EB",backgroundColor:"#fff",marginTop:"16px"},children:[[["transportistas","Transportistas"],["tramos","Tramos & Zonas"],["tarifas","Simulador de Tarifas"]].map(([o,r])=>e.jsx("button",{onClick:()=>c(o),style:{padding:"10px 20px",border:"none",backgroundColor:"transparent",cursor:"pointer",fontSize:"13px",fontWeight:i===o?700:500,color:i===o?n:"#6B7280",borderBottom:i===o?`2px solid ${n}`:"2px solid transparent",transition:"all 0.15s"},children:r},o)),e.jsx("div",{style:{flex:1}}),e.jsxs("div",{style:{position:"relative",padding:"6px 0"},children:[e.jsx($,{size:13,color:"#9CA3AF",style:{position:"absolute",left:"10px",top:"50%",transform:"translateY(-50%)"}}),e.jsx("input",{value:d,onChange:o=>k(o.target.value),placeholder:"Buscar...",style:{paddingLeft:"30px",paddingRight:"12px",paddingTop:"7px",paddingBottom:"7px",border:"1px solid #E5E7EB",borderRadius:"8px",fontSize:"12px",outline:"none",width:"180px"}})]})]}),e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"16px 20px"},children:[i==="transportistas"&&e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(340px,1fr))",gap:"12px"},children:[D.map(o=>{const r=B[o.tipo],l=(g==null?void 0:g.id)===o.id;return e.jsxs("div",{onClick:()=>T(l?null:o),style:{backgroundColor:"#fff",borderRadius:"12px",border:`1.5px solid ${l?n:o.activo?"#E5E7EB":"#F3F4F6"}`,padding:"18px",cursor:"pointer",opacity:o.activo?1:.6,boxShadow:l?`0 0 0 3px ${n}22`:"0 1px 4px rgba(0,0,0,0.04)",transition:"all 0.15s"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px",marginBottom:"12px"},children:[e.jsx("div",{style:{width:"44px",height:"44px",borderRadius:"12px",backgroundColor:"#F3F4F6",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"22px",flexShrink:0},children:o.logo}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",flexWrap:"wrap"},children:[e.jsx("span",{style:{fontSize:"14px",fontWeight:800,color:"#111"},children:o.nombre}),e.jsx("span",{style:{fontSize:"10px",fontWeight:700,color:r.color,backgroundColor:r.bg,padding:"2px 7px",borderRadius:"10px"},children:r.label}),!o.activo&&e.jsx("span",{style:{fontSize:"10px",fontWeight:700,color:"#9CA3AF",backgroundColor:"#F3F4F6",padding:"2px 7px",borderRadius:"10px"},children:"Inactivo"})]}),e.jsx(V,{n:o.rating||0})]}),e.jsx("div",{style:{width:"36px",height:"20px",borderRadius:"10px",backgroundColor:o.activo?"#D1FAE5":"#F3F4F6",display:"flex",alignItems:"center",padding:"0 2px",cursor:"pointer",flexShrink:0,justifyContent:o.activo?"flex-end":"flex-start"},children:e.jsx("div",{style:{width:"16px",height:"16px",borderRadius:"50%",backgroundColor:o.activo?"#059669":"#9CA3AF"}})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px",marginBottom:"12px"},children:[e.jsxs("div",{style:{fontSize:"11px",color:"#6B7280"},children:["â± ",o.tiempoPromedio||"â€”"]}),e.jsxs("div",{style:{fontSize:"11px",color:"#6B7280"},children:["ðŸ“¦ ",o.enviosActivos||0," activos"]}),e.jsxs("div",{style:{fontSize:"11px",color:"#6B7280"},children:["ðŸ“Š ",o.enviosTotales||0," totales"]}),e.jsxs("div",{style:{fontSize:"11px",color:"#6B7280"},children:["â˜Ž ",o.telefono||"â€”"]})]}),o.cobertura&&o.cobertura.length>0&&e.jsx("div",{style:{display:"flex",gap:"4px",flexWrap:"wrap"},children:o.cobertura.map(x=>e.jsx("span",{style:{fontSize:"10px",color:"#374151",backgroundColor:"#F3F4F6",padding:"2px 7px",borderRadius:"6px"},children:x},x))})]},o.id)}),e.jsxs("div",{style:{backgroundColor:"#FAFAFA",borderRadius:"12px",border:"2px dashed #E5E7EB",padding:"24px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"10px",cursor:"pointer",minHeight:"160px"},children:[e.jsx("div",{style:{width:"44px",height:"44px",borderRadius:"50%",backgroundColor:"#FFF4EC",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(G,{size:22,color:n})}),e.jsx("span",{style:{fontSize:"13px",fontWeight:700,color:n},children:"Agregar Carrier"}),e.jsx("span",{style:{fontSize:"11px",color:"#9CA3AF",textAlign:"center"},children:"Conectar nuevo transportista al sistema"})]})]}),i==="tramos"&&e.jsx("div",{style:{backgroundColor:"#fff",borderRadius:"12px",border:"1px solid #E5E7EB",overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{backgroundColor:"#F9FAFB"},children:["Carrier","Origen","Destino","Tipo","Tiempo Est.","Tarifa Base","$/Kg","Estado"].map(o=>e.jsx("th",{style:{padding:"12px 14px",textAlign:"left",fontSize:"11px",fontWeight:700,color:"#6B7280",textTransform:"uppercase",letterSpacing:"0.05em",borderBottom:"1px solid #E5E7EB"},children:o},o))})}),e.jsx("tbody",{children:E.map((o,r)=>{const l=B[o.tipo];return e.jsxs("tr",{style:{borderBottom:r<E.length-1?"1px solid #F3F4F6":"none"},children:[e.jsx("td",{style:{padding:"12px 14px",fontSize:"13px",fontWeight:600,color:"#374151"},children:o.carrier}),e.jsx("td",{style:{padding:"12px 14px",fontSize:"12px",color:"#6B7280"},children:o.origen}),e.jsx("td",{style:{padding:"12px 14px",fontSize:"12px",color:"#374151",fontWeight:500},children:o.destino}),e.jsx("td",{style:{padding:"12px 14px"},children:e.jsx("span",{style:{fontSize:"10px",fontWeight:700,color:l.color,backgroundColor:l.bg,padding:"3px 8px",borderRadius:"10px"},children:l.label})}),e.jsxs("td",{style:{padding:"12px 14px",fontSize:"12px",color:"#374151",display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(H,{size:11,color:"#9CA3AF"})," ",o.tiempoEstimado||"â€”"]}),e.jsxs("td",{style:{padding:"12px 14px",fontSize:"13px",fontWeight:700,color:"#111"},children:["$",(o.tarifaBase||0).toLocaleString("es-AR")]}),e.jsxs("td",{style:{padding:"12px 14px",fontSize:"12px",color:"#6B7280"},children:["$",o.tarifaKg||0,"/kg"]}),e.jsx("td",{style:{padding:"12px 14px"},children:e.jsx("span",{style:{fontSize:"10px",fontWeight:700,color:o.activo?"#059669":"#9CA3AF",backgroundColor:o.activo?"#ECFDF5":"#F3F4F6",padding:"3px 8px",borderRadius:"10px"},children:o.activo?"â— Activo":"â—‹ Inactivo"})})]},o.id)})})]})}),i==="tarifas"&&e.jsx("div",{style:{maxWidth:"560px"},children:e.jsxs("div",{style:{backgroundColor:"#fff",borderRadius:"12px",border:"1px solid #E5E7EB",padding:"24px"},children:[e.jsx("h3",{style:{margin:"0 0 20px",fontSize:"15px",fontWeight:800,color:"#111"},children:"Simulador de Tarifa de EnvÃ­o"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"14px"},children:[[{label:"Peso (kg)",type:"number",placeholder:"Ej: 2.5"},{label:"Volumen (mÂ³)",type:"number",placeholder:"Ej: 0.02"},{label:"CÃ³digo Postal Origen",type:"text",placeholder:"Ej: C1001"},{label:"CÃ³digo Postal Destino",type:"text",placeholder:"Ej: 5000"}].map(o=>e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"12px",fontWeight:700,color:"#374151",marginBottom:"6px"},children:o.label}),e.jsx("input",{type:o.type,placeholder:o.placeholder,style:{width:"100%",padding:"10px 12px",border:"1px solid #E5E7EB",borderRadius:"8px",fontSize:"13px",outline:"none",boxSizing:"border-box"}})]},o.label)),e.jsx("button",{style:{marginTop:"6px",padding:"12px",border:"none",borderRadius:"10px",backgroundColor:n,color:"#fff",fontSize:"14px",fontWeight:700,cursor:"pointer"},children:"Calcular tarifas disponibles"})]}),e.jsxs("div",{style:{marginTop:"20px",padding:"14px",backgroundColor:"#F9FAFB",borderRadius:"10px",border:"1px solid #E5E7EB"},children:[e.jsx("p",{style:{margin:"0 0 10px",fontSize:"12px",fontWeight:700,color:"#374151"},children:"Tarifas estimadas:"}),[{carrier:"Express Delivery GBA",tiempo:"Same day",precio:1400},{carrier:"OCA",tiempo:"24-48h",precio:1680},{carrier:"Correo Argentino",tiempo:"3-4 dÃ­as",precio:2450},{carrier:"Andreani",tiempo:"2-3 dÃ­as",precio:2750}].map(o=>e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px 0",borderBottom:"1px solid #E5E7EB"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"12px",fontWeight:600,color:"#111"},children:o.carrier}),e.jsx("div",{style:{fontSize:"11px",color:"#9CA3AF"},children:o.tiempo})]}),e.jsxs("div",{style:{fontSize:"14px",fontWeight:800,color:n},children:["$",o.precio.toLocaleString("es-AR")]})]},o.carrier))]})]})})]})]})]})}export{re as TransportistasView};
