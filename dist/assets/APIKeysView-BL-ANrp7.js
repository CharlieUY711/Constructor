import{r as s,j as e}from"./index-D8gJryvN.js";import{O as z}from"./OrangeHeader-CD_39fGA.js";import{b as I,d as w,c as k}from"./integracionesApi-Dai6OOlU.js";import{K as W}from"./key-rimzy6DP.js";import{P as R}from"./plus-B8VvAZH3.js";import{T as P}from"./trash-2-DSvNgW5p.js";import{T as K}from"./triangle-alert-BhnVGdkY.js";import{C as N}from"./check-DEYrz3IC.js";import{C as D}from"./copy-CU4pks2E.js";import"./ConnectionStatusIcon-D1UUScUD.js";import"./zap-DVZ7QpUM.js";import"./lightbulb-Baf-YTXC.js";import"./map-pin-C0eCdOxB.js";const d="#FF6835",y=[{id:"read:pedidos",label:"Leer pedidos"},{id:"write:pedidos",label:"Escribir pedidos"},{id:"read:productos",label:"Leer productos"},{id:"write:productos",label:"Escribir productos"},{id:"read:personas",label:"Leer personas"},{id:"webhook:eventos",label:"Webhook eventos"}];function Q({onNavigate:b}){const[l,j]=s.useState([]),[c,v]=s.useState(!0),[E,p]=s.useState(!1),[t,n]=s.useState({nombre:"",descripcion:"",permisos:[]}),[x,g]=s.useState(null),[C,h]=s.useState(null),[a,u]=s.useState(null);s.useEffect(()=>{m()},[]);const m=async()=>{try{const o=await I();j(o)}catch(o){console.error("Error cargando API keys:",o)}finally{v(!1)}},A=async()=>{if(!t.nombre.trim()){alert("El nombre es requerido");return}try{const o=await k(t);g(o.key||null),n({nombre:"",descripcion:"",permisos:[]}),await m()}catch(o){console.error("Error creando API key:",o),alert("Error al crear la API key")}},F=async o=>{if(confirm("Â¿EstÃ¡s seguro de revocar esta API key? No se podrÃ¡ usar mÃ¡s.")){u(o);try{await w(o),await m()}catch(r){console.error("Error revocando API key:",r),alert("Error al revocar la API key")}finally{u(null)}}},S=(o,r)=>{navigator.clipboard.writeText(o).catch(()=>{}),h(r),setTimeout(()=>h(null),1500)},B=l.filter(o=>o.estado==="activo").length;return e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsx(z,{icon:W,title:"API Keys",subtitle:"GestionÃ¡ las API keys para dar acceso a terceros a tu plataforma",actions:[{label:"â† Integraciones",onClick:()=>b("integraciones")}]}),e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"24px 32px",backgroundColor:"#F8F9FA"},children:[e.jsx("div",{style:{display:"flex",gap:10,marginBottom:20},children:[{label:"API Keys",value:c?"...":l.length,color:"#111827"},{label:"Activas",value:c?"...":B,color:"#10B981"},{label:"Revocadas",value:c?"...":l.filter(o=>o.estado==="revocado").length,color:"#9CA3AF"}].map((o,r)=>e.jsxs("div",{style:{flex:1,backgroundColor:"#fff",borderRadius:10,padding:"12px 16px",border:"1px solid #E5E7EB",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"800",color:o.color},children:o.value}),e.jsx("div",{style:{fontSize:"0.7rem",color:"#9CA3AF",marginTop:2},children:o.label})]},r))}),e.jsx("div",{style:{marginBottom:20},children:e.jsxs("button",{onClick:()=>p(!0),style:{display:"flex",alignItems:"center",gap:6,padding:"10px 16px",borderRadius:8,backgroundColor:d,color:"#fff",border:"none",fontSize:"0.85rem",fontWeight:"700",cursor:"pointer"},children:[e.jsx(R,{size:16})," Nueva API Key"]})}),e.jsx("div",{style:{display:"grid",gap:12},children:l.map(o=>e.jsxs("div",{style:{backgroundColor:"#fff",borderRadius:12,border:"1px solid #E5E7EB",padding:"16px 20px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",marginBottom:12},children:[e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4},children:[e.jsx("span",{style:{fontWeight:"800",color:"#111827",fontSize:"0.95rem"},children:o.nombre}),e.jsx("span",{style:{padding:"2px 8px",borderRadius:12,fontSize:"0.65rem",fontWeight:"700",backgroundColor:o.estado==="activo"?"#D1FAE5":"#F3F4F6",color:o.estado==="activo"?"#10B981":"#6B7280"},children:o.estado==="activo"?"Activa":"Revocada"})]}),o.descripcion&&e.jsx("p",{style:{margin:0,fontSize:"0.78rem",color:"#6B7280"},children:o.descripcion})]}),e.jsxs("button",{onClick:()=>F(o.id),disabled:a===o.id||o.estado==="revocado",style:{padding:"6px 10px",borderRadius:6,border:"none",backgroundColor:a===o.id||o.estado==="revocado"?"#F3F4F6":"#FEE2E2",color:a===o.id||o.estado==="revocado"?"#9CA3AF":"#EF4444",cursor:a===o.id||o.estado==="revocado"?"not-allowed":"pointer",fontSize:"0.72rem",fontWeight:"600",display:"flex",alignItems:"center",gap:4},children:[e.jsx(P,{size:12})," ",a===o.id?"Revocando...":"Revocar"]})]}),e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:8,marginBottom:12},children:[e.jsxs("div",{style:{flex:"0 0 auto"},children:[e.jsx("span",{style:{fontSize:"0.7rem",color:"#9CA3AF",fontWeight:"700"},children:"Prefijo: "}),e.jsxs("code",{style:{padding:"3px 8px",borderRadius:4,backgroundColor:"#F9FAFB",border:"1px solid #E5E7EB",fontSize:"0.75rem",fontFamily:"monospace",color:"#374151"},children:[o.key_prefix,"..."]})]}),o.ultimo_uso&&e.jsxs("div",{style:{flex:"0 0 auto"},children:[e.jsx("span",{style:{fontSize:"0.7rem",color:"#9CA3AF",fontWeight:"700"},children:"Ãšltimo uso: "}),e.jsx("span",{style:{fontSize:"0.7rem",color:"#6B7280"},children:new Date(o.ultimo_uso).toLocaleString()})]}),e.jsxs("div",{style:{flex:"0 0 auto"},children:[e.jsx("span",{style:{fontSize:"0.7rem",color:"#9CA3AF",fontWeight:"700"},children:"Usos totales: "}),e.jsx("span",{style:{fontSize:"0.7rem",color:"#6B7280",fontWeight:"600"},children:o.usos_totales})]})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("span",{style:{fontSize:"0.7rem",color:"#9CA3AF",fontWeight:"700"},children:"Permisos: "}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:4,marginTop:4},children:o.permisos.length>0?o.permisos.map(r=>{var i;return e.jsx("span",{style:{padding:"2px 8px",borderRadius:4,fontSize:"0.68rem",fontWeight:"600",backgroundColor:"#EFF6FF",color:"#2563EB"},children:((i=y.find(f=>f.id===r))==null?void 0:i.label)||r},r)}):e.jsx("span",{style:{fontSize:"0.68rem",color:"#9CA3AF",fontStyle:"italic"},children:"Sin permisos"})})]})]},o.id))}),l.length===0&&!c&&e.jsxs("div",{style:{textAlign:"center",padding:"48px 0",color:"#9CA3AF"},children:[e.jsx("p",{style:{fontSize:"2rem",margin:"0 0 8px"},children:"ðŸ”‘"}),e.jsx("p",{style:{fontWeight:"600"},children:"No hay API keys creadas"})]})]}),E&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsx("div",{style:{backgroundColor:"#fff",borderRadius:12,padding:"24px",width:"90%",maxWidth:500,maxHeight:"90vh",overflowY:"auto"},children:x?e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:16,padding:"12px",backgroundColor:"#FEF3C7",borderRadius:8,border:"1.5px solid #F59E0B"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,marginBottom:8},children:[e.jsx(K,{size:16,color:"#F59E0B"}),e.jsx("span",{style:{fontSize:"0.85rem",fontWeight:"700",color:"#92400E"},children:"Â¡Importante! Esta key solo se mostrarÃ¡ UNA VEZ"})]}),e.jsx("p",{style:{margin:0,fontSize:"0.78rem",color:"#78350F"},children:"CopiÃ¡ la key ahora. No podrÃ¡s verla de nuevo despuÃ©s de cerrar este modal."})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("label",{style:{fontSize:"0.7rem",fontWeight:"700",color:"#9CA3AF",display:"block",marginBottom:6},children:"Tu API Key"}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx("code",{style:{flex:1,padding:"10px 12px",borderRadius:8,backgroundColor:"#F9FAFB",border:"1.5px solid #E5E7EB",fontSize:"0.85rem",fontFamily:"monospace",color:"#374151",wordBreak:"break-all"},children:x}),e.jsx("button",{onClick:()=>S(x,"new"),style:{padding:"10px 12px",borderRadius:8,border:"1px solid #E5E7EB",backgroundColor:"#fff",cursor:"pointer",display:"flex",alignItems:"center"},children:C==="new"?e.jsx(N,{size:16,color:"#10B981"}):e.jsx(D,{size:16})})]})]}),e.jsx("button",{onClick:()=>{p(!1),g(null)},style:{width:"100%",padding:"10px",borderRadius:8,backgroundColor:d,color:"#fff",border:"none",fontSize:"0.85rem",fontWeight:"700",cursor:"pointer"},children:"Cerrar"})]}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{style:{margin:"0 0 20px",fontSize:"1rem",fontWeight:"800",color:"#111827"},children:"Nueva API Key"}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("label",{style:{fontSize:"0.7rem",fontWeight:"700",color:"#9CA3AF",display:"block",marginBottom:6},children:"Nombre *"}),e.jsx("input",{type:"text",value:t.nombre,onChange:o=>n(r=>({...r,nombre:o.target.value})),placeholder:"Ej: App mÃ³vil",style:{width:"100%",padding:"9px 12px",border:"1.5px solid #E5E7EB",borderRadius:8,fontSize:"0.85rem",outline:"none",boxSizing:"border-box"},onFocus:o=>o.target.style.borderColor=d,onBlur:o=>o.target.style.borderColor="#E5E7EB"})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("label",{style:{fontSize:"0.7rem",fontWeight:"700",color:"#9CA3AF",display:"block",marginBottom:6},children:"DescripciÃ³n"}),e.jsx("input",{type:"text",value:t.descripcion,onChange:o=>n(r=>({...r,descripcion:o.target.value})),placeholder:"DescripciÃ³n opcional",style:{width:"100%",padding:"9px 12px",border:"1.5px solid #E5E7EB",borderRadius:8,fontSize:"0.85rem",outline:"none",boxSizing:"border-box"},onFocus:o=>o.target.style.borderColor=d,onBlur:o=>o.target.style.borderColor="#E5E7EB"})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("label",{style:{fontSize:"0.7rem",fontWeight:"700",color:"#9CA3AF",display:"block",marginBottom:8},children:"Permisos"}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:6},children:y.map(o=>e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:t.permisos.includes(o.id),onChange:r=>{r.target.checked?n(i=>({...i,permisos:[...i.permisos,o.id]})):n(i=>({...i,permisos:i.permisos.filter(f=>f!==o.id)}))},style:{cursor:"pointer"}}),e.jsx("span",{style:{fontSize:"0.8rem",color:"#374151"},children:o.label})]},o.id))})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("button",{onClick:A,disabled:!t.nombre.trim(),style:{flex:1,padding:"10px",borderRadius:8,backgroundColor:t.nombre.trim()?d:"#E5E7EB",color:t.nombre.trim()?"#fff":"#9CA3AF",border:"none",fontSize:"0.85rem",fontWeight:"700",cursor:t.nombre.trim()?"pointer":"not-allowed"},children:"Crear API Key"}),e.jsx("button",{onClick:()=>p(!1),style:{padding:"10px 16px",borderRadius:8,border:"1px solid #E5E7EB",backgroundColor:"#fff",color:"#6B7280",fontSize:"0.85rem",fontWeight:"600",cursor:"pointer"},children:"Cancelar"})]})]})})})]})}export{Q as APIKeysView};
