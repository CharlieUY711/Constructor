import{r as n,j as o}from"./index-CBzyT8Xh.js";import{i as j,l as b,w as G}from"./loader-CAj64nxW.js";const C={lat:-34.9011,lng:-56.1645},L=13;function T({center:a=C,zoom:f=L,markers:w=[],route:t,height:h="400px",className:E="",onMapReady:g,onMarkerClick:c}){const d=n.useRef(null),i=n.useRef(null),p=n.useRef([]),m=n.useRef(null),u=n.useRef(null),[R,y]=n.useState(!0),[v,N]=n.useState(null);return n.useEffect(()=>{let l=!0;async function e(){try{if(await b(),await G(1e4),!l||!d.current)return;if(!j())throw new Error("Google Maps API no estÃ¡ disponible");const s=window.google,r=new s.maps.Map(d.current,{center:a,zoom:f,language:"es",region:"UY",mapTypeControl:!0,streetViewControl:!1,fullscreenControl:!0});i.current=r,y(!1),g==null||g(r),t&&(m.current=new s.maps.DirectionsService,u.current=new s.maps.DirectionsRenderer({map:r,suppressMarkers:!1}))}catch(s){console.error("[GoogleMap] Error inicializando mapa:",s),N(s instanceof Error?s.message:"Error cargando el mapa"),y(!1)}}return e(),()=>{l=!1}},[]),n.useEffect(()=>{i.current&&(i.current.setCenter(a),i.current.setZoom(f))},[a.lat,a.lng,f]),n.useEffect(()=>{if(!i.current||!j())return;const l=window.google;p.current.forEach(e=>e.setMap(null)),p.current=[],w.forEach(e=>{const s=new l.maps.Marker({position:{lat:e.lat,lng:e.lng},map:i.current,title:e.title,label:e.label,icon:e.icon||(e.color?{path:l.maps.SymbolPath.CIRCLE,scale:8,fillColor:e.color,fillOpacity:1,strokeColor:"#fff",strokeWeight:2}:void 0)});(e.onClick||c)&&s.addListener("click",()=>{var r;(r=e.onClick)==null||r.call(e),c==null||c(e)}),p.current.push(s)})},[w,c]),n.useEffect(()=>{if(!t||!m.current||!u.current)return;const l=window.google,e={origin:{lat:t.origin.lat,lng:t.origin.lng},destination:{lat:t.destination.lat,lng:t.destination.lng},travelMode:l.maps.TravelMode.DRIVING,language:"es",region:"AR"};t.waypoints&&t.waypoints.length>0&&(e.waypoints=t.waypoints.map(s=>({location:{lat:s.lat,lng:s.lng},stopover:!0}))),m.current.route(e,(s,r)=>{if(r==="OK"&&u.current){if(u.current.setDirections(s),t.color){const x=s.routes[0];x&&new l.maps.Polyline({path:x.overview_path,strokeColor:x.color,strokeWeight:4}).setMap(i.current)}}else console.error("[GoogleMap] Error calculando ruta:",r)})},[t]),v?o.jsx("div",{className:`flex items-center justify-center bg-gray-100 rounded-md ${E}`,style:{height:h},children:o.jsxs("div",{className:"text-center text-gray-600",children:[o.jsx("p",{className:"font-medium",children:"Error cargando el mapa"}),o.jsx("p",{className:"text-sm mt-1",children:v})]})}):o.jsxs("div",{className:`relative ${E}`,style:{height:h},children:[R&&o.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100 rounded-md z-10",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500 mx-auto"}),o.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Cargando mapa..."})]})}),o.jsx("div",{ref:d,className:"w-full h-full rounded-md",style:{minHeight:"200px"}})]})}export{T as G};
