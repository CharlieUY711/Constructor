import{c as O,s as z,r as a,j as e,P as b,C as F}from"./index-p8CpflSp.js";import{O as j}from"./OrangeHeader-KMzy6893.js";import{L as I}from"./loader-circle-DeJ4ZewE.js";import{L as _}from"./layers-XEE_Fg3A.js";import{C as P}from"./clock-BxfthX96.js";import{P as $}from"./plus-_4-Ek5H0.js";import"./zap-CDZemBr7.js";import"./lightbulb-ByLI0Oc8.js";import"./map-pin-B_1AdB97.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=[["path",{d:"M2 20a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8l-7 5V8l-7 5V4a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",key:"159hny"}],["path",{d:"M17 18h1",key:"uldtlt"}],["path",{d:"M12 18h1",key:"s9uhes"}],["path",{d:"M7 18h1",key:"1neino"}]],T=O("factory",M);async function L(p){let s=z.from("produccion_articulos").select("*");s=s.eq("activo",p);const{data:x,error:c}=await s.order("nombre");if(c)throw console.error("[produccionApi] Error obteniendo artÃ­culos:",c),new Error(c.message||"Error cargando artÃ­culos");return x||[]}async function K(p){let s=z.from("produccion_ordenes_armado").select("*");const{data:x,error:c}=await s.order("created_at",{ascending:!1});if(c)throw console.error("[produccionApi] Error obteniendo Ã³rdenes:",c),new Error(c.message||"Error cargando Ã³rdenes");return x||[]}const n="#FF6835",N={pendiente:{label:"Pendiente",color:"#D97706",bg:"#FFFBEB"},en_proceso:{label:"En proceso",color:"#2563EB",bg:"#EFF6FF"},completada:{label:"Completada",color:"#059669",bg:"#ECFDF5"},cancelada:{label:"Cancelada",color:"#DC2626",bg:"#FEF2F2"}},u={kit:{label:"Kit",emoji:"ðŸŽ",color:"#7C3AED"},canasta:{label:"Canasta",emoji:"ðŸ§º",color:n},combo:{label:"Combo",emoji:"ðŸ“¦",color:"#2563EB"},pack:{label:"Pack",emoji:"ðŸ—‚ï¸",color:"#059669"}};function te({onNavigate:p}){const[s,x]=a.useState("ordenes"),[c,U]=a.useState(""),[d,h]=a.useState(null),[V,H]=a.useState(null),[B,w]=a.useState([]),[R,W]=a.useState([]),[D,C]=a.useState(!1),[S,E]=a.useState(null);a.useEffect(()=>{k()},[]);const k=async()=>{C(!0),E(null);try{const[o,i]=await Promise.all([L(!0),K()]),r=o.map(t=>({id:t.id,sku:t.sku,nombre:t.nombre,tipo:t.tipo,descripcion:t.descripcion,componentes:Array.isArray(t.componentes)?t.componentes:[],tiempoArmado:t.tiempo_armado||0,costoManoObra:t.costo_mano_obra||0,activo:t.activo??!0})),l=i.map(t=>({id:t.id,numero:t.numero||"",articuloId:t.articulo_id||"",articuloNombre:t.articulo_nombre||"",cantidad:t.cantidad,estado:t.estado,ruta:t.ruta,operario:t.operario,fechaPedido:t.fecha_pedido||"",fechaEntrega:t.fecha_entrega||"",prioridad:t.prioridad||"normal",notas:t.notas}));w(r),W(l),r.length>0&&h(r[0])}catch(o){E(o instanceof Error?o.message:"Error cargando datos"),console.error("Error cargando producciÃ³n:",o)}finally{C(!1)}},f=B,m=R,v=m.filter(o=>o.estado==="pendiente").length,A=m.filter(o=>o.estado==="en_proceso").length,g=f.flatMap(o=>o.componentes||[]).filter(o=>!o.disponible).length;return D?e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsx(j,{icon:b,title:"ProducciÃ³n / Armado",subtitle:"Cargando...",actions:[{label:"â† LogÃ­stica",onClick:()=>p("logistica")}]}),e.jsx("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(I,{size:32,color:n,style:{animation:"spin 1s linear infinite"}})})]}):S?e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:e.jsx(j,{icon:b,title:"ProducciÃ³n / Armado",subtitle:`Error: ${S}`,actions:[{label:"â† LogÃ­stica",onClick:()=>p("logistica")},{label:"â†» Reintentar",primary:!0,onClick:k}]})}):e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsx(j,{icon:b,title:"ProducciÃ³n / Armado",subtitle:`${v} Ã³rdenes pendientes Â· ${A} en proceso Â· ${g>0?`âš  ${g} componentes sin stock`:"Stock OK"}`,actions:[{label:"â† LogÃ­stica",onClick:()=>p("logistica")},{label:"+ Nueva OA",primary:!0}]}),e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",backgroundColor:"#F8F9FA"},children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:"12px",padding:"16px 20px 0"},children:[{label:"ArtÃ­culos Compuestos",value:f.filter(o=>o.activo).length,icon:_,color:"#7C3AED"},{label:"OA Pendientes",value:v,icon:P,color:"#D97706"},{label:"En Proceso",value:A,icon:T,color:"#2563EB"},{label:"Alertas de Stock",value:g,icon:F,color:g>0?"#DC2626":"#059669"}].map(o=>{const i=o.icon;return e.jsxs("div",{style:{backgroundColor:"#fff",borderRadius:"12px",border:"1px solid #E5E7EB",padding:"16px",display:"flex",gap:"12px",alignItems:"center"},children:[e.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"10px",backgroundColor:`${o.color}15`,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:e.jsx(i,{size:18,color:o.color})}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"22px",fontWeight:800,color:"#111"},children:o.value}),e.jsx("div",{style:{fontSize:"11px",color:"#6B7280"},children:o.label})]})]},o.label)})}),e.jsx("div",{style:{display:"flex",padding:"12px 20px 0",backgroundColor:"#fff",borderBottom:"1px solid #E5E7EB",marginTop:"12px"},children:[["ordenes","ðŸ“‹ Ã“rdenes de Armado"],["bom","ðŸ”© BOM â€” ArtÃ­culos"],["articulos","ðŸ“¦ CatÃ¡logo de Kits"]].map(([o,i])=>e.jsx("button",{onClick:()=>x(o),style:{padding:"10px 20px",border:"none",backgroundColor:"transparent",cursor:"pointer",fontSize:"13px",fontWeight:s===o?700:500,color:s===o?n:"#6B7280",borderBottom:s===o?`2px solid ${n}`:"2px solid transparent"},children:i},o))}),e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"16px 20px"},children:[s==="ordenes"&&e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:m.map(o=>{const i=N[o.estado],r=f.find(y=>y.id===o.articuloId),l=r?u[r.tipo]:null,t=r==null?void 0:r.componentes.some(y=>!y.disponible);return e.jsxs("div",{style:{backgroundColor:"#fff",borderRadius:"12px",border:`1px solid ${t&&o.estado==="pendiente"?"#FCA5A5":"#E5E7EB"}`,padding:"16px 20px",display:"flex",gap:"16px",alignItems:"center"},children:[e.jsx("div",{style:{width:"48px",height:"48px",borderRadius:"12px",backgroundColor:`${n}15`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"22px",flexShrink:0},children:(l==null?void 0:l.emoji)||"ðŸ“¦"}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",flexWrap:"wrap",marginBottom:"4px"},children:[e.jsx("span",{style:{fontSize:"13px",fontWeight:800,color:"#111",fontFamily:"monospace"},children:o.numero}),e.jsx("span",{style:{fontSize:"10px",fontWeight:700,color:i.color,backgroundColor:i.bg,padding:"2px 8px",borderRadius:"10px"},children:i.label}),t&&o.estado==="pendiente"&&e.jsx("span",{style:{fontSize:"10px",fontWeight:700,color:"#DC2626",backgroundColor:"#FEE2E2",padding:"2px 8px",borderRadius:"10px"},children:"âš  Sin stock"})]}),e.jsx("div",{style:{fontSize:"13px",fontWeight:600,color:"#374151",marginBottom:"4px"},children:o.articuloNombre}),e.jsxs("div",{style:{display:"flex",gap:"14px",fontSize:"11px",color:"#9CA3AF",flexWrap:"wrap"},children:[e.jsxs("span",{children:["ðŸ“¦ ",o.cantidad," unidades"]}),o.ruta&&e.jsxs("span",{children:["ðŸ—º ",o.ruta]}),o.operario&&e.jsxs("span",{children:["ðŸ‘¤ ",o.operario]}),e.jsxs("span",{children:["ðŸ“… Entrega: ",o.fechaEntrega]})]}),o.notas&&e.jsxs("div",{style:{marginTop:"6px",fontSize:"11px",color:"#92400E",backgroundColor:"#FFFBEB",padding:"4px 8px",borderRadius:"6px",display:"inline-block"},children:["âš  ",o.notas]})]}),e.jsxs("div",{style:{display:"flex",gap:"8px",flexShrink:0},children:[o.estado==="pendiente"&&e.jsx("button",{style:{padding:"8px 14px",border:"none",borderRadius:"8px",backgroundColor:t?"#F3F4F6":n,color:t?"#9CA3AF":"#fff",fontSize:"12px",fontWeight:700,cursor:t?"not-allowed":"pointer"},children:t?"âš  Sin stock":"â–¶ Iniciar"}),o.estado==="en_proceso"&&e.jsx("button",{style:{padding:"8px 14px",border:"none",borderRadius:"8px",backgroundColor:"#059669",color:"#fff",fontSize:"12px",fontWeight:700,cursor:"pointer"},children:"âœ“ Completar"})]})]},o.id)})}),s==="bom"&&e.jsxs("div",{style:{display:"flex",gap:"16px"},children:[e.jsx("div",{style:{width:"260px",flexShrink:0,display:"flex",flexDirection:"column",gap:"8px"},children:f.map(o=>{const i=u[o.tipo],r=o.componentes.some(t=>!t.disponible),l=(d==null?void 0:d.id)===o.id;return e.jsxs("div",{onClick:()=>h(o),style:{backgroundColor:"#fff",borderRadius:"10px",border:`1.5px solid ${l?n:"#E5E7EB"}`,padding:"12px 14px",cursor:"pointer",boxShadow:l?`0 0 0 3px ${n}22`:"none",transition:"all 0.15s"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"4px"},children:[e.jsx("span",{style:{fontSize:"20px"},children:i.emoji}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontSize:"12px",fontWeight:700,color:"#111",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:o.nombre}),e.jsxs("div",{style:{fontSize:"10px",color:"#9CA3AF"},children:["SKU: ",o.sku]})]}),r&&e.jsx(F,{size:14,color:"#DC2626"})]}),e.jsxs("div",{style:{fontSize:"10px",color:"#6B7280"},children:[o.componentes.length," componentes Â· â± ",o.tiempoArmado," min"]})]},o.id)})}),d&&e.jsx("div",{style:{flex:1},children:e.jsxs("div",{style:{backgroundColor:"#fff",borderRadius:"12px",border:"1px solid #E5E7EB",padding:"20px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"16px"},children:[e.jsx("span",{style:{fontSize:"28px"},children:u[d.tipo].emoji}),e.jsxs("div",{children:[e.jsx("h3",{style:{margin:0,fontSize:"15px",fontWeight:800,color:"#111"},children:d.nombre}),e.jsx("div",{style:{fontSize:"12px",color:"#6B7280"},children:d.descripcion}),e.jsxs("div",{style:{display:"flex",gap:"12px",fontSize:"11px",color:"#374151",marginTop:"4px"},children:[e.jsxs("span",{children:["â± ",d.tiempoArmado," min/u"]}),e.jsxs("span",{children:["ðŸ’° $",d.costoManoObra.toLocaleString("es-AR")," mano de obra"]})]})]})]}),e.jsx("h4",{style:{margin:"0 0 12px",fontSize:"12px",fontWeight:700,color:"#6B7280",textTransform:"uppercase",letterSpacing:"0.06em"},children:"Bill of Materials"}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{backgroundColor:"#F9FAFB"},children:["SKU","Componente","Cant.","Unidad","Stock actual","Estado"].map(o=>e.jsx("th",{style:{padding:"10px 12px",textAlign:"left",fontSize:"11px",fontWeight:700,color:"#6B7280",textTransform:"uppercase",letterSpacing:"0.04em",borderBottom:"1px solid #E5E7EB"},children:o},o))})}),e.jsx("tbody",{children:d.componentes.map((o,i)=>e.jsxs("tr",{style:{borderBottom:i<d.componentes.length-1?"1px solid #F3F4F6":"none"},children:[e.jsx("td",{style:{padding:"10px 12px",fontSize:"11px",fontFamily:"monospace",color:"#6B7280"},children:o.sku}),e.jsx("td",{style:{padding:"10px 12px",fontSize:"13px",fontWeight:500,color:"#111"},children:o.descripcion}),e.jsx("td",{style:{padding:"10px 12px",fontSize:"13px",fontWeight:700,color:"#374151"},children:o.cantidad}),e.jsx("td",{style:{padding:"10px 12px",fontSize:"12px",color:"#6B7280"},children:o.unidad}),e.jsx("td",{style:{padding:"10px 12px",fontSize:"12px",color:o.stockActual===0?"#DC2626":"#374151",fontWeight:o.stockActual<20?700:400},children:o.stockActual}),e.jsx("td",{style:{padding:"10px 12px"},children:e.jsx("span",{style:{fontSize:"10px",fontWeight:700,padding:"3px 8px",borderRadius:"10px",color:o.disponible?"#059669":"#DC2626",backgroundColor:o.disponible?"#ECFDF5":"#FEE2E2"},children:o.disponible?"âœ“ OK":"âš  Sin stock"})})]},o.sku))})]}),e.jsxs("div",{style:{marginTop:"16px",display:"flex",gap:"10px"},children:[e.jsx("button",{style:{padding:"10px 20px",border:`1.5px solid ${n}`,borderRadius:"8px",backgroundColor:"transparent",color:n,fontSize:"13px",fontWeight:700,cursor:"pointer"},children:"Editar BOM"}),e.jsx("button",{style:{padding:"10px 20px",border:"none",borderRadius:"8px",backgroundColor:n,color:"#fff",fontSize:"13px",fontWeight:700,cursor:"pointer"},children:"+ Crear Orden de Armado"})]})]})})]}),s==="articulos"&&e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(280px,1fr))",gap:"14px"},children:[f.map(o=>{const i=u[o.tipo],r=o.componentes.some(l=>!l.disponible);return e.jsxs("div",{style:{backgroundColor:"#fff",borderRadius:"12px",border:`1px solid ${r?"#FCA5A5":"#E5E7EB"}`,padding:"20px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px",marginBottom:"14px"},children:[e.jsx("div",{style:{width:"48px",height:"48px",borderRadius:"12px",backgroundColor:`${i.color}15`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"24px",flexShrink:0},children:i.emoji}),e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",flexWrap:"wrap",marginBottom:"3px"},children:[e.jsx("span",{style:{fontSize:"13px",fontWeight:800,color:"#111"},children:o.nombre}),e.jsx("span",{style:{fontSize:"10px",fontWeight:700,color:i.color,backgroundColor:`${i.color}18`,padding:"1px 7px",borderRadius:"10px"},children:i.label}),r&&e.jsx("span",{style:{fontSize:"10px",fontWeight:700,color:"#DC2626",backgroundColor:"#FEE2E2",padding:"1px 7px",borderRadius:"10px"},children:"âš  Stock"})]}),e.jsxs("div",{style:{fontSize:"10px",color:"#9CA3AF"},children:["SKU: ",o.sku]})]})]}),e.jsx("div",{style:{fontSize:"11px",color:"#6B7280",marginBottom:"10px",lineHeight:"1.5"},children:o.descripcion}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"6px",marginBottom:"12px"},children:[e.jsxs("div",{style:{fontSize:"11px",color:"#374151"},children:["ðŸ”© ",o.componentes.length," componentes"]}),e.jsxs("div",{style:{fontSize:"11px",color:"#374151"},children:["â± ",o.tiempoArmado," min/u"]}),e.jsxs("div",{style:{fontSize:"11px",color:"#374151"},children:["ðŸ’° $",o.costoManoObra.toLocaleString()]}),e.jsxs("div",{style:{fontSize:"11px",color:"#374151"},children:["âœ… ",o.componentes.filter(l=>l.disponible).length,"/",o.componentes.length," con stock"]})]}),e.jsx("button",{onClick:()=>{x("bom"),h(o)},style:{width:"100%",padding:"9px",border:`1.5px solid ${n}`,borderRadius:"8px",backgroundColor:"transparent",color:n,fontSize:"12px",fontWeight:700,cursor:"pointer"},children:"Ver BOM"})]},o.id)}),e.jsxs("div",{style:{backgroundColor:"#FAFAFA",borderRadius:"12px",border:"2px dashed #E5E7EB",padding:"24px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"10px",cursor:"pointer",minHeight:"200px"},children:[e.jsx("div",{style:{width:"44px",height:"44px",borderRadius:"50%",backgroundColor:"#FFF4EC",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx($,{size:22,color:n})}),e.jsx("span",{style:{fontSize:"13px",fontWeight:700,color:n},children:"Nuevo ArtÃ­culo Compuesto"}),e.jsx("span",{style:{fontSize:"11px",color:"#9CA3AF",textAlign:"center"},children:"Kit Â· Canasta Â· Combo Â· Pack"})]})]})]})]})]})}export{te as ProduccionView};
