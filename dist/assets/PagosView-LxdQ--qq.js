import{r as l,p as J,h as K,t as v,j as o,g as k,f as X}from"./index-B2QEN0at.js";import{O as Q}from"./OrangeHeader-BG2aU0HP.js";import{D}from"./dollar-sign-jg0OM_xS.js";import{C as Z}from"./credit-card-Dh_4t3UK.js";import{C as I}from"./clock-O4iboF9Q.js";import{C as P}from"./circle-x-CyectIdm.js";import{R as ee}from"./rotate-ccw-CloFsPBu.js";import{T as oe}from"./trending-up-Bd2tDn2g.js";import{E as re}from"./eye-siCqz5MR.js";import{R}from"./refresh-cw-BX2G4xCV.js";import{C as te}from"./chevron-down-DN_GHCaN.js";import"./ConnectionStatusIcon-BYFfkvRW.js";import"./zap-D3tV5HqB.js";import"./lightbulb-D9MyICTq.js";import"./map-pin-CGu7kq9m.js";const B=`https://${J}.supabase.co/functions/v1/api`,_={"Content-Type":"application/json",Authorization:`Bearer ${K}`},p="#FF6835",f={pendiente:{label:"Pendiente",color:"#D97706",bg:"#FFFBEB",icon:I},pagado:{label:"Pagado",color:"#059669",bg:"#ECFDF5",icon:k},parcial:{label:"Pago parcial",color:"#2563EB",bg:"#EFF6FF",icon:oe},fallido:{label:"Fallido",color:"#DC2626",bg:"#FEF2F2",icon:P},reembolsado:{label:"Reembolsado",color:"#7C3AED",bg:"#F5F3FF",icon:ee}},T=[{value:"",label:"Todos"},{value:"pendiente",label:"Pendientes"},{value:"pagado",label:"Pagados"},{value:"parcial",label:"Pago parcial"},{value:"fallido",label:"Fallidos"},{value:"reembolsado",label:"Reembolsados"}],ne={mercadopago:"üõí",stripe:"üí≥",paypal:"üÖøÔ∏è",redpagos:"üî¥",abitab:"üè™"};function u(i){return"$"+(i??0).toLocaleString("es-UY",{minimumFractionDigits:0,maximumFractionDigits:0})}function ie(i){return new Date(i).toLocaleDateString("es-UY",{day:"2-digit",month:"2-digit",year:"2-digit",hour:"2-digit",minute:"2-digit"})}function Ee({onNavigate:i}){const[t,h]=l.useState([]),[$,C]=l.useState(!0),[a,W]=l.useState(""),[g,O]=l.useState(""),[L,E]=l.useState(null),[F,b]=l.useState(null),x=l.useCallback(async()=>{C(!0);try{const e=new URLSearchParams;a&&e.append("estado_pago",a),g&&e.append("search",g);const s=await(await fetch(`${B}/pedidos?${e}`,{headers:_})).json();if(s.error)throw new Error(s.error);h(s.data??[])}catch(e){console.error("Error cargando transacciones:",e),v.error("Error al cargar transacciones")}finally{C(!1)}},[a,g]);l.useEffect(()=>{x()},[x]);const M=async(e,r)=>{var s;E(e.id),b(null);try{const m=await(await fetch(`${B}/pedidos/${e.id}/estado-pago`,{method:"PUT",headers:_,body:JSON.stringify({estado_pago:r})})).json();if(m.error)throw new Error(m.error);v.success(`Estado de pago actualizado: ${(s=f[r])==null?void 0:s.label}`),x()}catch(d){v.error(`Error: ${d instanceof Error?d.message:d}`)}finally{E(null)}},U=t.length,N=t.filter(e=>e.estado_pago==="pagado").length,G=t.filter(e=>e.estado_pago==="pendiente").length,H=t.filter(e=>e.estado_pago==="fallido").length,V=t.filter(e=>e.estado_pago==="pagado").reduce((e,r)=>e+(r.total??0),0),Y=t.filter(e=>e.estado_pago==="pendiente").reduce((e,r)=>e+(r.total??0),0);return o.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100vh",overflow:"hidden"},children:[o.jsx(Q,{icon:D,title:"Pagos & Transacciones",subtitle:"Estado de pagos por pedido ¬∑ vista operacional",actions:[{label:"Ver Pedidos",primary:!1,onClick:()=>i("pedidos")},{label:"‚Ü∫ Actualizar",primary:!0,onClick:x}]}),o.jsx("div",{style:{padding:"12px 28px",backgroundColor:"#fff",borderBottom:"1px solid #E5E7EB",display:"flex",gap:10,flexWrap:"wrap"},children:[{label:"Transacciones",value:U,icon:Z,color:p,sub:"total"},{label:"Cobrado",value:u(V),icon:k,color:"#059669",sub:`${N} pedidos`},{label:"Pendiente cobro",value:u(Y),icon:I,color:"#D97706",sub:`${G} pedidos`},{label:"Fallidos",value:H,icon:P,color:"#DC2626",sub:"requieren atenci√≥n"}].map(e=>o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,padding:"8px 14px",backgroundColor:"#F9FAFB",borderRadius:10,border:"1px solid #E5E7EB",minWidth:150},children:[o.jsx("div",{style:{width:34,height:34,borderRadius:8,backgroundColor:e.color+"18",display:"flex",alignItems:"center",justifyContent:"center"},children:o.jsx(e.icon,{size:16,color:e.color})}),o.jsxs("div",{children:[o.jsx("p",{style:{margin:0,fontSize:"1rem",fontWeight:800,color:"#111827",lineHeight:1},children:e.value}),o.jsx("p",{style:{margin:"2px 0 0",fontSize:"0.68rem",color:"#9CA3AF"},children:e.sub}),o.jsx("p",{style:{margin:0,fontSize:"0.7rem",color:"#6B7280"},children:e.label})]})]},e.label))}),o.jsxs("div",{style:{padding:"10px 28px",backgroundColor:"#F9FAFB",borderBottom:"1px solid #E5E7EB",display:"flex",gap:10,alignItems:"center",flexWrap:"wrap"},children:[o.jsxs("div",{style:{position:"relative"},children:[o.jsx(X,{size:14,color:"#9CA3AF",style:{position:"absolute",left:10,top:"50%",transform:"translateY(-50%)"}}),o.jsx("input",{value:g,onChange:e=>O(e.target.value),placeholder:"Buscar por n¬∫ pedido‚Ä¶",style:{paddingLeft:30,height:34,border:"1.5px solid #E5E7EB",borderRadius:8,fontSize:"0.82rem",outline:"none",width:200,color:"#374151"}})]}),o.jsx("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:T.map(e=>o.jsx("button",{onClick:()=>W(e.value),style:{padding:"5px 12px",borderRadius:20,border:`1.5px solid ${a===e.value?p:"#E5E7EB"}`,backgroundColor:a===e.value?p+"15":"#fff",color:a===e.value?p:"#6B7280",fontSize:"0.78rem",fontWeight:a===e.value?700:500,cursor:"pointer"},children:e.label},e.value))})]}),o.jsx("div",{style:{flex:1,overflow:"auto",padding:"16px 28px"},children:$?o.jsx(ae,{}):t.length===0?o.jsx(se,{filtro:a}):o.jsxs("div",{style:{backgroundColor:"#fff",borderRadius:12,border:"1px solid #E5E7EB",overflow:"hidden",boxShadow:"0 1px 4px rgba(0,0,0,0.05)"},children:[o.jsx("div",{style:{display:"grid",gridTemplateColumns:"140px 1fr 160px 90px 110px 130px",gap:0,backgroundColor:"#F9FAFB",borderBottom:"1px solid #E5E7EB"},children:["# Pedido","Cliente","M√©todo de pago","Monto","Fecha","Estado pago"].map(e=>o.jsx("div",{style:{padding:"10px 14px",fontSize:"0.72rem",fontWeight:700,color:"#6B7280",textTransform:"uppercase",letterSpacing:"0.04em"},children:e},e))}),t.map(e=>{var z,A,w;const r=f[e.estado_pago]??f.pendiente,s=r.icon,d=e.cliente_persona?`${e.cliente_persona.nombre} ${e.cliente_persona.apellido}`:((z=e.cliente_org)==null?void 0:z.nombre)??"‚Äî",m=ne[((A=e.metodo_pago)==null?void 0:A.proveedor)??""]??"üí∞",y=L===e.id,S=F===e.id;return o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"140px 1fr 160px 90px 110px 130px",borderBottom:"1px solid #F3F4F6",alignItems:"center",transition:"background .1s"},onMouseEnter:n=>n.currentTarget.style.backgroundColor="#FAFAFA",onMouseLeave:n=>n.currentTarget.style.backgroundColor="transparent",children:[o.jsx("div",{style:{padding:"12px 14px"},children:o.jsxs("button",{onClick:()=>i("pedidos"),style:{background:"none",border:"none",cursor:"pointer",padding:0,display:"flex",alignItems:"center",gap:5,color:p,fontWeight:700,fontSize:"0.8rem"},children:[o.jsx(re,{size:11}),e.numero_pedido]})}),o.jsxs("div",{style:{padding:"12px 14px"},children:[o.jsx("p",{style:{margin:0,fontSize:"0.83rem",fontWeight:600,color:"#111827"},children:d}),((w=e.cliente_persona)==null?void 0:w.email)&&o.jsx("p",{style:{margin:0,fontSize:"0.72rem",color:"#9CA3AF"},children:e.cliente_persona.email})]}),o.jsx("div",{style:{padding:"12px 14px"},children:e.metodo_pago?o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[o.jsx("span",{style:{fontSize:"1rem"},children:m}),o.jsxs("div",{children:[o.jsx("p",{style:{margin:0,fontSize:"0.8rem",fontWeight:600,color:"#374151"},children:e.metodo_pago.nombre}),o.jsx("p",{style:{margin:0,fontSize:"0.68rem",color:"#9CA3AF",textTransform:"capitalize"},children:e.metodo_pago.tipo})]})]}):o.jsx("span",{style:{fontSize:"0.8rem",color:"#9CA3AF"},children:"‚Äî"})}),o.jsxs("div",{style:{padding:"12px 14px"},children:[o.jsx("p",{style:{margin:0,fontSize:"0.9rem",fontWeight:800,color:"#111827"},children:u(e.total)}),e.descuento>0&&o.jsxs("p",{style:{margin:0,fontSize:"0.68rem",color:"#059669"},children:["-",u(e.descuento)," desc."]})]}),o.jsx("div",{style:{padding:"12px 14px"},children:o.jsx("p",{style:{margin:0,fontSize:"0.75rem",color:"#6B7280"},children:ie(e.created_at)})}),o.jsxs("div",{style:{padding:"12px 14px",position:"relative"},children:[o.jsxs("button",{disabled:y,onClick:()=>b(S?null:e.id),style:{display:"flex",alignItems:"center",gap:5,padding:"4px 8px",borderRadius:20,border:`1.5px solid ${r.color}50`,backgroundColor:r.bg,color:r.color,fontSize:"0.72rem",fontWeight:700,cursor:"pointer",width:"100%",opacity:y?.6:1},children:[y?o.jsx(R,{size:11,style:{animation:"spin 1s linear infinite"}}):o.jsx(s,{size:11}),o.jsx("span",{style:{flex:1,textAlign:"left"},children:r.label}),o.jsx(te,{size:10})]}),S&&o.jsx("div",{style:{position:"absolute",top:"100%",left:14,zIndex:100,backgroundColor:"#fff",border:"1px solid #E5E7EB",borderRadius:10,boxShadow:"0 8px 24px rgba(0,0,0,0.12)",minWidth:160,overflow:"hidden"},children:Object.entries(f).map(([n,c])=>{const q=c.icon;return o.jsxs("button",{onClick:()=>M(e,n),style:{width:"100%",display:"flex",alignItems:"center",gap:8,padding:"9px 12px",border:"none",background:n===e.estado_pago?c.bg:"#fff",cursor:"pointer",fontSize:"0.8rem",fontWeight:n===e.estado_pago?700:500,color:n===e.estado_pago?c.color:"#374151",textAlign:"left"},onMouseEnter:j=>j.currentTarget.style.backgroundColor="#F9FAFB",onMouseLeave:j=>j.currentTarget.style.backgroundColor=n===e.estado_pago?c.bg:"#fff",children:[o.jsx(q,{size:13,color:c.color})," ",c.label,n===e.estado_pago&&o.jsx("span",{style:{marginLeft:"auto",fontSize:"0.6rem"},children:"‚úì"})]},n)})})]})]},e.id)})]})}),o.jsx("style",{children:"@keyframes spin { from{transform:rotate(0deg)} to{transform:rotate(360deg)} }"}),F&&o.jsx("div",{style:{position:"fixed",inset:0,zIndex:99},onClick:()=>b(null)})]})}function ae(){return o.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:200,color:"#9CA3AF",gap:8},children:[o.jsx(R,{size:18,style:{animation:"spin 1s linear infinite"}})," Cargando transacciones‚Ä¶"]})}function se({filtro:i}){var t;return o.jsxs("div",{style:{textAlign:"center",padding:"60px 0",color:"#9CA3AF"},children:[o.jsx(D,{size:44,style:{marginBottom:12,opacity:.25}}),o.jsx("p",{style:{fontSize:"1rem",fontWeight:600,margin:0,color:"#374151"},children:i?`No hay transacciones "${(t=T.find(h=>h.value===i))==null?void 0:t.label}"`:"No hay transacciones a√∫n"}),o.jsx("p",{style:{fontSize:"0.875rem",marginTop:6},children:"Los pagos aparecer√°n aqu√≠ cuando se creen pedidos"})]})}export{Ee as PagosView};
