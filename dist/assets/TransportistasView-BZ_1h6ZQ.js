import{s as A,r as a,j as o,T as g,i as z,f as L}from"./index-D8gJryvN.js";import{O as h}from"./OrangeHeader-CD_39fGA.js";import{L as P}from"./loader-circle-bsIAMbtG.js";import{U as $}from"./users-CbT3-Xxl.js";import{M as _}from"./map-pin-C0eCdOxB.js";import{P as O}from"./plus-B8VvAZH3.js";import{C as M}from"./clock-BzbHHJBD.js";import"./ConnectionStatusIcon-D1UUScUD.js";import"./zap-DVZ7QpUM.js";import"./lightbulb-Baf-YTXC.js";async function S(){const{data:s,error:r}=await A.from("transportistas").select("*").order("nombre");if(r)throw console.error("[transportistasApi] Error obteniendo transportistas:",r),new Error(r.message||"Error cargando transportistas");return s||[]}async function G(s){const{data:r,error:c}=await A.from("tramos").select("*").eq("transportista_id",s).order("origen");if(c)throw console.error("[transportistasApi] Error obteniendo tramos:",c),new Error(c.message||"Error cargando tramos");return r||[]}const l="#FF6835",B={local:{label:"Local",color:"#059669",bg:"#ECFDF5"},nacional:{label:"Nacional",color:"#2563EB",bg:"#EFF6FF"},intercity:{label:"Intercity",color:"#7C3AED",bg:"#F5F3FF"},internacional:{label:"Internacional",color:"#D97706",bg:"#FFFBEB"},propio:{label:"Propio",color:"#059669",bg:"#ECFDF5"},tercero:{label:"Tercero",color:"#2563EB",bg:"#EFF6FF"},courier:{label:"Courier",color:"#7C3AED",bg:"#F5F3FF"}};function K({n:s}){return o.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"2px"},children:[[1,2,3,4,5].map(r=>o.jsx(z,{size:11,color:r<=Math.round(s)?"#F59E0B":"#E5E7EB",fill:r<=Math.round(s)?"#F59E0B":"none"},r)),o.jsx("span",{style:{fontSize:"11px",color:"#6B7280",marginLeft:"3px"},children:s})]})}function ee({onNavigate:s}){const[r,c]=a.useState("transportistas"),[d,k]=a.useState(""),[f,w]=a.useState(null),[p,T]=a.useState([]),[u,R]=a.useState([]),[W,b]=a.useState(!1),[m,y]=a.useState(null);a.useEffect(()=>{v()},[]);const v=async()=>{b(!0),y(null);try{const[e,i]=await Promise.all([S(),Promise.all((await S()).map(t=>G(t.id))).then(t=>t.flat())]),n=e.map(t=>({id:t.id,nombre:t.nombre,tipo:t.tipo,logo:t.logo,contacto:t.contacto,email:t.email,telefono:t.telefono,rating:t.rating||0,enviosActivos:t.envios_activos||0,enviosTotales:t.envios_totales||0,activo:t.activo??t.estado==="activo",tiempoPromedio:t.tiempo_promedio,cobertura:Array.isArray(t.cobertura)?t.cobertura:[]})),x=new Map(e.map(t=>[t.id,t])),I=i.map(t=>{var E;return{id:t.id,carrierId:t.transportista_id,carrier:((E=x.get(t.transportista_id))==null?void 0:E.nombre)||"",origen:t.origen,destino:t.destino,tipo:t.tipo,tiempoEstimado:t.tiempo_estimado,tarifaBase:t.tarifa_base,tarifaKg:t.tarifa_kg,activo:t.activo??t.estado==="activo"}});T(n),R(I)}catch(e){y(e instanceof Error?e.message:"Error cargando datos"),console.error("Error cargando transportistas:",e)}finally{b(!1)}},j=p.filter(e=>e.activo).length,F=p.reduce((e,i)=>e+(i.enviosActivos||0),0),D=p.filter(e=>!d||e.nombre.toLowerCase().includes(d.toLowerCase())),C=u.filter(e=>!d||e.carrier.toLowerCase().includes(d.toLowerCase())||e.origen.toLowerCase().includes(d.toLowerCase())||e.destino.toLowerCase().includes(d.toLowerCase()));return W?o.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:[o.jsx(h,{icon:g,title:"Transportistas",subtitle:"Cargando...",actions:[{label:"â† LogÃ­stica",onClick:()=>s("logistica")}]}),o.jsx("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center"},children:o.jsx(P,{size:32,color:l,style:{animation:"spin 1s linear infinite"}})})]}):m?o.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:o.jsx(h,{icon:g,title:"Transportistas",subtitle:`Error: ${m}`,actions:[{label:"â† LogÃ­stica",onClick:()=>s("logistica")},{label:"â†» Reintentar",primary:!0,onClick:v}]})}):o.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:[o.jsx(h,{icon:g,title:"Transportistas",subtitle:`${j} carriers activos Â· ${F} envÃ­os en curso`,actions:[{label:"â† LogÃ­stica",onClick:()=>s("logistica")},{label:"+ Nuevo Carrier",primary:!0}]}),o.jsxs("div",{style:{flex:1,overflow:"hidden",display:"flex",flexDirection:"column",backgroundColor:"#F8F9FA"},children:[o.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:"12px",padding:"20px 20px 0"},children:[{label:"Carriers Activos",value:j,icon:$,color:l},{label:"EnvÃ­os en curso",value:F,icon:g,color:"#2563EB"},{label:"Tramos configurados",value:u.filter(e=>e.activo).length,icon:_,color:"#7C3AED"},{label:"Rating promedio",value:p.length>0?(p.reduce((e,i)=>e+(i.rating||0),0)/p.length).toFixed(1)+"â˜…":"0â˜…",icon:z,color:"#F59E0B"}].map(e=>{const i=e.icon;return o.jsxs("div",{style:{backgroundColor:"#fff",borderRadius:"12px",border:"1px solid #E5E7EB",padding:"16px",display:"flex",gap:"12px",alignItems:"center"},children:[o.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"10px",backgroundColor:`${e.color}15`,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:o.jsx(i,{size:18,color:e.color})}),o.jsxs("div",{children:[o.jsx("div",{style:{fontSize:"20px",fontWeight:800,color:"#111"},children:e.value}),o.jsx("div",{style:{fontSize:"11px",color:"#6B7280"},children:e.label})]})]},e.label)})}),o.jsxs("div",{style:{display:"flex",gap:"0",padding:"16px 20px 0",borderBottom:"1px solid #E5E7EB",backgroundColor:"#fff",marginTop:"16px"},children:[[["transportistas","Transportistas"],["tramos","Tramos & Zonas"],["tarifas","Simulador de Tarifas"]].map(([e,i])=>o.jsx("button",{onClick:()=>c(e),style:{padding:"10px 20px",border:"none",backgroundColor:"transparent",cursor:"pointer",fontSize:"13px",fontWeight:r===e?700:500,color:r===e?l:"#6B7280",borderBottom:r===e?`2px solid ${l}`:"2px solid transparent",transition:"all 0.15s"},children:i},e)),o.jsx("div",{style:{flex:1}}),o.jsxs("div",{style:{position:"relative",padding:"6px 0"},children:[o.jsx(L,{size:13,color:"#9CA3AF",style:{position:"absolute",left:"10px",top:"50%",transform:"translateY(-50%)"}}),o.jsx("input",{value:d,onChange:e=>k(e.target.value),placeholder:"Buscar...",style:{paddingLeft:"30px",paddingRight:"12px",paddingTop:"7px",paddingBottom:"7px",border:"1px solid #E5E7EB",borderRadius:"8px",fontSize:"12px",outline:"none",width:"180px"}})]})]}),o.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"16px 20px"},children:[r==="transportistas"&&o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(340px,1fr))",gap:"12px"},children:[D.map(e=>{const i=B[e.tipo]??{label:e.tipo,color:"#6B7280",bg:"#F3F4F6"},n=(f==null?void 0:f.id)===e.id;return o.jsxs("div",{onClick:()=>w(n?null:e),style:{backgroundColor:"#fff",borderRadius:"12px",border:`1.5px solid ${n?l:e.activo?"#E5E7EB":"#F3F4F6"}`,padding:"18px",cursor:"pointer",opacity:e.activo?1:.6,boxShadow:n?`0 0 0 3px ${l}22`:"0 1px 4px rgba(0,0,0,0.04)",transition:"all 0.15s"},children:[o.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px",marginBottom:"12px"},children:[o.jsx("div",{style:{width:"44px",height:"44px",borderRadius:"12px",backgroundColor:"#F3F4F6",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"22px",flexShrink:0},children:e.logo}),o.jsxs("div",{style:{flex:1,minWidth:0},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",flexWrap:"wrap"},children:[o.jsx("span",{style:{fontSize:"14px",fontWeight:800,color:"#111"},children:e.nombre}),o.jsx("span",{style:{fontSize:"10px",fontWeight:700,color:i.color,backgroundColor:i.bg,padding:"2px 7px",borderRadius:"10px"},children:i.label}),!e.activo&&o.jsx("span",{style:{fontSize:"10px",fontWeight:700,color:"#9CA3AF",backgroundColor:"#F3F4F6",padding:"2px 7px",borderRadius:"10px"},children:"Inactivo"})]}),o.jsx(K,{n:e.rating||0})]}),o.jsx("div",{style:{width:"36px",height:"20px",borderRadius:"10px",backgroundColor:e.activo?"#D1FAE5":"#F3F4F6",display:"flex",alignItems:"center",padding:"0 2px",cursor:"pointer",flexShrink:0,justifyContent:e.activo?"flex-end":"flex-start"},children:o.jsx("div",{style:{width:"16px",height:"16px",borderRadius:"50%",backgroundColor:e.activo?"#059669":"#9CA3AF"}})})]}),o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px",marginBottom:"12px"},children:[o.jsxs("div",{style:{fontSize:"11px",color:"#6B7280"},children:["â± ",e.tiempoPromedio||"â€”"]}),o.jsxs("div",{style:{fontSize:"11px",color:"#6B7280"},children:["ðŸ“¦ ",e.enviosActivos||0," activos"]}),o.jsxs("div",{style:{fontSize:"11px",color:"#6B7280"},children:["ðŸ“Š ",e.enviosTotales||0," totales"]}),o.jsxs("div",{style:{fontSize:"11px",color:"#6B7280"},children:["â˜Ž ",e.telefono||"â€”"]})]}),e.cobertura&&e.cobertura.length>0&&o.jsx("div",{style:{display:"flex",gap:"4px",flexWrap:"wrap"},children:e.cobertura.map(x=>o.jsx("span",{style:{fontSize:"10px",color:"#374151",backgroundColor:"#F3F4F6",padding:"2px 7px",borderRadius:"6px"},children:x},x))})]},e.id)}),o.jsxs("div",{style:{backgroundColor:"#FAFAFA",borderRadius:"12px",border:"2px dashed #E5E7EB",padding:"24px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"10px",cursor:"pointer",minHeight:"160px"},children:[o.jsx("div",{style:{width:"44px",height:"44px",borderRadius:"50%",backgroundColor:"#FFF4EC",display:"flex",alignItems:"center",justifyContent:"center"},children:o.jsx(O,{size:22,color:l})}),o.jsx("span",{style:{fontSize:"13px",fontWeight:700,color:l},children:"Agregar Carrier"}),o.jsx("span",{style:{fontSize:"11px",color:"#9CA3AF",textAlign:"center"},children:"Conectar nuevo transportista al sistema"})]})]}),r==="tramos"&&o.jsx("div",{style:{backgroundColor:"#fff",borderRadius:"12px",border:"1px solid #E5E7EB",overflow:"hidden"},children:o.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[o.jsx("thead",{children:o.jsx("tr",{style:{backgroundColor:"#F9FAFB"},children:["Carrier","Origen","Destino","Tipo","Tiempo Est.","Tarifa Base","$/Kg","Estado"].map(e=>o.jsx("th",{style:{padding:"12px 14px",textAlign:"left",fontSize:"11px",fontWeight:700,color:"#6B7280",textTransform:"uppercase",letterSpacing:"0.05em",borderBottom:"1px solid #E5E7EB"},children:e},e))})}),o.jsx("tbody",{children:C.map((e,i)=>{const n=B[e.tipo]??{label:e.tipo,color:"#6B7280",bg:"#F3F4F6"};return o.jsxs("tr",{style:{borderBottom:i<C.length-1?"1px solid #F3F4F6":"none"},children:[o.jsx("td",{style:{padding:"12px 14px",fontSize:"13px",fontWeight:600,color:"#374151"},children:e.carrier}),o.jsx("td",{style:{padding:"12px 14px",fontSize:"12px",color:"#6B7280"},children:e.origen}),o.jsx("td",{style:{padding:"12px 14px",fontSize:"12px",color:"#374151",fontWeight:500},children:e.destino}),o.jsx("td",{style:{padding:"12px 14px"},children:o.jsx("span",{style:{fontSize:"10px",fontWeight:700,color:n.color,backgroundColor:n.bg,padding:"3px 8px",borderRadius:"10px"},children:n.label})}),o.jsxs("td",{style:{padding:"12px 14px",fontSize:"12px",color:"#374151",display:"flex",alignItems:"center",gap:"4px"},children:[o.jsx(M,{size:11,color:"#9CA3AF"})," ",e.tiempoEstimado||"â€”"]}),o.jsxs("td",{style:{padding:"12px 14px",fontSize:"13px",fontWeight:700,color:"#111"},children:["$",(e.tarifaBase||0).toLocaleString("es-AR")]}),o.jsxs("td",{style:{padding:"12px 14px",fontSize:"12px",color:"#6B7280"},children:["$",e.tarifaKg||0,"/kg"]}),o.jsx("td",{style:{padding:"12px 14px"},children:o.jsx("span",{style:{fontSize:"10px",fontWeight:700,color:e.activo?"#059669":"#9CA3AF",backgroundColor:e.activo?"#ECFDF5":"#F3F4F6",padding:"3px 8px",borderRadius:"10px"},children:e.activo?"â— Activo":"â—‹ Inactivo"})})]},e.id)})})]})}),r==="tarifas"&&o.jsx("div",{style:{maxWidth:"560px"},children:o.jsxs("div",{style:{backgroundColor:"#fff",borderRadius:"12px",border:"1px solid #E5E7EB",padding:"24px"},children:[o.jsx("h3",{style:{margin:"0 0 20px",fontSize:"15px",fontWeight:800,color:"#111"},children:"Simulador de Tarifa de EnvÃ­o"}),o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"14px"},children:[[{label:"Peso (kg)",type:"number",placeholder:"Ej: 2.5"},{label:"Volumen (mÂ³)",type:"number",placeholder:"Ej: 0.02"},{label:"CÃ³digo Postal Origen",type:"text",placeholder:"Ej: C1001"},{label:"CÃ³digo Postal Destino",type:"text",placeholder:"Ej: 5000"}].map(e=>o.jsxs("div",{children:[o.jsx("label",{style:{display:"block",fontSize:"12px",fontWeight:700,color:"#374151",marginBottom:"6px"},children:e.label}),o.jsx("input",{type:e.type,placeholder:e.placeholder,style:{width:"100%",padding:"10px 12px",border:"1px solid #E5E7EB",borderRadius:"8px",fontSize:"13px",outline:"none",boxSizing:"border-box"}})]},e.label)),o.jsx("button",{style:{marginTop:"6px",padding:"12px",border:"none",borderRadius:"10px",backgroundColor:l,color:"#fff",fontSize:"14px",fontWeight:700,cursor:"pointer"},children:"Calcular tarifas disponibles"})]}),o.jsxs("div",{style:{marginTop:"20px",padding:"14px",backgroundColor:"#F9FAFB",borderRadius:"10px",border:"1px solid #E5E7EB"},children:[o.jsx("p",{style:{margin:"0 0 10px",fontSize:"12px",fontWeight:700,color:"#374151"},children:"Tarifas estimadas:"}),[{carrier:"Express Delivery GBA",tiempo:"Same day",precio:1400},{carrier:"OCA",tiempo:"24-48h",precio:1680},{carrier:"Correo Argentino",tiempo:"3-4 dÃ­as",precio:2450},{carrier:"Andreani",tiempo:"2-3 dÃ­as",precio:2750}].map(e=>o.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px 0",borderBottom:"1px solid #E5E7EB"},children:[o.jsxs("div",{children:[o.jsx("div",{style:{fontSize:"12px",fontWeight:600,color:"#111"},children:e.carrier}),o.jsx("div",{style:{fontSize:"11px",color:"#9CA3AF"},children:e.tiempo})]}),o.jsxs("div",{style:{fontSize:"14px",fontWeight:800,color:l},children:["$",e.precio.toLocaleString("es-AR")]})]},e.carrier))]})]})})]})]})]})}export{ee as TransportistasView};
