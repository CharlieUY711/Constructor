import{r as g,D as k,s as b,j as e,C}from"./index-C7B7W1lQ.js";import{O as D}from"./OrangeHeader-CoTBbwWn.js";import{S as z}from"./shield-Cxs8rPd8.js";import{S as R}from"./server-C94nhOxU.js";import{C as I}from"./cpu-DN6fwdZy.js";import{G as c}from"./globe-BmYgUn7P.js";import{A as S}from"./activity-DhoydKbW.js";import{C as F}from"./circle-check-D2QS8Bff.js";import{C as A}from"./circle-x-Cl1JMT7N.js";import{C as u}from"./clock-DiLnwBj6.js";import{R as j}from"./refresh-cw-Cc9OU0Xn.js";import"./zap-DaP38y9l.js";import"./lightbulb-QoB3Dxu8.js";import"./map-pin-QypTHBjh.js";const T=[{id:"supabase-db",name:"Supabase Database",description:"PostgreSQL",category:"Backend",icon:k,color:"#059669",status:"checking"},{id:"supabase-auth",name:"Supabase Auth",description:"Autenticación y sesiones",category:"Backend",icon:z,color:"#059669",status:"checking"},{id:"supabase-edge",name:"Edge Functions (Hono)",description:"Servidor /api",category:"Backend",icon:R,color:"#059669",status:"checking"},{id:"kv-store",name:"KV Store",description:"Tabla clave-valor persistente",category:"Backend",icon:I,color:"#059669",status:"checking"},{id:"storage",name:"Supabase Storage",description:"Supabase Storage Buckets",category:"Backend",icon:k,color:"#059669",status:"checking"},{id:"plexo",name:"Plexo UV",description:"API de pagos Uruguay",category:"Pagos",icon:c,color:"#6B7280",status:"pending"},{id:"mercadopago",name:"MercadoPago",description:"Pasarela Latam",category:"Pagos",icon:c,color:"#6B7280",status:"pending"},{id:"twilio",name:"Twilio",description:"SMS / WhatsApp",category:"Comms",icon:c,color:"#6B7280",status:"pending"},{id:"resend",name:"Resend",description:"Email transaccional",category:"Comms",icon:c,color:"#6B7280",status:"pending"},{id:"meta",name:"Meta Business",description:"Instagram / Facebook / WhatsApp API",category:"RRSS",icon:c,color:"#6B7280",status:"pending"},{id:"mercadolibre",name:"MercadoLibre",description:"API de marketplace",category:"Tiendas",icon:c,color:"#6B7280",status:"pending"},{id:"google-maps",name:"Google Maps",description:"Geocodificación y rutas",category:"Mapas",icon:c,color:"#6B7280",status:"pending"}],M={ok:{label:"Operativo",color:"#059669",bg:"#F0FDF8",icon:F},error:{label:"Error",color:"#EF4444",bg:"#FEF2F2",icon:A},checking:{label:"Verificando...",color:"#3B82F6",bg:"#EFF6FF",icon:j},unknown:{label:"Desconocido",color:"#F59E0B",bg:"#FFFBEB",icon:C},pending:{label:"Sin configurar",color:"#9CA3AF",bg:"#F9FAFB",icon:u}},P={Backend:"#059669",Pagos:"#FF6835",Comms:"#8B5CF6",RRSS:"#EC4899",Tiendas:"#3B82F6",Mapas:"#6366F1"};function X({onNavigate:f}){const[l,h]=g.useState(T),[v,B]=g.useState(new Date),[x,y]=g.useState(!1),p=g.useCallback(async()=>{y(!0);const i=Date.now();h(a=>a.map(t=>["supabase-db","supabase-auth","supabase-edge","kv-store","storage"].includes(t.id)?{...t,status:"checking"}:t));let r=!1,n=0;try{const a=Date.now(),{error:t}=await b.from("roadmap_modules").select("id").limit(1);n=Date.now()-a,r=!t}catch{r=!1}let o=!1,s=0;if(r)try{const a=Date.now(),{data:t,error:w}=await b.from("roadmap_modules").select("id").limit(10);s=Date.now()-a,o=!w&&Array.isArray(t)}catch{o=!1}const m=Date.now()-i;h(a=>a.map(t=>t.id==="supabase-edge"?{...t,status:r?"ok":"error",latency:n,checkedAt:new Date,message:r?"Respondió correctamente":"No respondió"}:t.id==="supabase-db"?{...t,status:r?"ok":"error",latency:n>0?Math.round(n*.3):0,checkedAt:new Date,message:r?"Conexión activa":"Sin conexión"}:t.id==="supabase-auth"?{...t,status:r?"ok":"unknown",latency:n>0?Math.round(n*.2):0,checkedAt:new Date,message:"Supabase Auth activo"}:t.id==="kv-store"?{...t,status:o?"ok":r?"error":"unknown",latency:s,checkedAt:new Date,message:o?"kv_store OK":"No se pudo verificar"}:t.id==="storage"?{...t,status:r?"ok":"unknown",latency:Math.round(m*.1),checkedAt:new Date,message:r?"Buckets accesibles":"Sin verificar"}:t)),B(new Date),y(!1)},[]);g.useEffect(()=>{p()},[p]);const d={ok:l.filter(i=>i.status==="ok").length,error:l.filter(i=>i.status==="error").length,pending:l.filter(i=>i.status==="pending").length},E=[...new Set(l.map(i=>i.category))];return e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsx(D,{icon:S,title:"Health Monitor",subtitle:"Estado en tiempo real de todos los servicios del sistema",actions:[{label:"← Auditoría",onClick:()=>f("auditoria")},{label:x?"Verificando...":"↻ Verificar ahora",onClick:p,primary:!0}]}),e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"24px 32px",backgroundColor:"#F8F9FA"},children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:12,marginBottom:24},children:[{label:"Operativos",value:d.ok,color:"#059669",icon:F},{label:"Con error",value:d.error,color:"#EF4444",icon:A},{label:"Sin configurar",value:d.pending,color:"#9CA3AF",icon:u},{label:"Total checks",value:l.length,color:"#FF6835",icon:S}].map(({label:i,value:r,color:n,icon:o})=>e.jsxs("div",{style:{backgroundColor:"#fff",borderRadius:12,padding:"16px 20px",border:"1px solid #E5E7EB",display:"flex",alignItems:"center",gap:12},children:[e.jsx("div",{style:{width:38,height:38,borderRadius:10,backgroundColor:`${n}15`,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(o,{size:16,color:n})}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"800",color:"#111827",lineHeight:1},children:r}),e.jsx("div",{style:{fontSize:"0.68rem",color:"#9CA3AF",marginTop:2},children:i})]})]},i))}),e.jsxs("div",{style:{marginBottom:20,display:"flex",alignItems:"center",gap:8},children:[e.jsx(u,{size:12,color:"#9CA3AF"}),e.jsxs("span",{style:{fontSize:"0.72rem",color:"#9CA3AF"},children:["Última verificación: ",v.toLocaleTimeString("es-UY",{hour:"2-digit",minute:"2-digit",second:"2-digit"})]}),x&&e.jsxs("span",{style:{fontSize:"0.72rem",color:"#3B82F6",display:"flex",alignItems:"center",gap:4},children:[e.jsx(j,{size:10,style:{animation:"spin 1s linear infinite"}})," Verificando..."]})]}),E.map(i=>{const r=l.filter(o=>o.category===i),n=P[i]??"#9CA3AF";return e.jsxs("div",{style:{marginBottom:20},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:10},children:[e.jsx("span",{style:{fontSize:"0.68rem",fontWeight:"800",color:n,textTransform:"uppercase",letterSpacing:"0.08em"},children:i}),e.jsx("div",{style:{flex:1,height:1,backgroundColor:"#E5E7EB"}}),e.jsxs("span",{style:{fontSize:"0.65rem",color:"#9CA3AF"},children:[r.filter(o=>o.status==="ok").length,"/",r.length," OK"]})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:6},children:r.map(o=>{const s=M[o.status],m=o.icon,a=s.icon;return e.jsxs("div",{style:{backgroundColor:"#fff",borderRadius:10,border:"1px solid #E5E7EB",padding:"12px 16px",display:"flex",alignItems:"center",gap:12},children:[e.jsx("div",{style:{width:36,height:36,borderRadius:9,backgroundColor:`${o.color}12`,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:e.jsx(m,{size:16,color:o.color})}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontWeight:"700",fontSize:"0.85rem",color:"#111827",marginBottom:2},children:o.name}),e.jsx("div",{style:{fontSize:"0.7rem",color:"#9CA3AF"},children:o.description})]}),o.latency!=null&&o.latency>0&&e.jsxs("div",{style:{textAlign:"right",flexShrink:0},children:[e.jsxs("div",{style:{fontSize:"0.78rem",fontWeight:"700",color:o.latency<100?"#059669":o.latency<500?"#F59E0B":"#EF4444"},children:[o.latency,"ms"]}),e.jsx("div",{style:{fontSize:"0.6rem",color:"#9CA3AF"},children:"latencia"})]}),o.message&&e.jsx("div",{style:{fontSize:"0.7rem",color:"#9CA3AF",maxWidth:180,textAlign:"right",flexShrink:0},children:o.message}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5,padding:"5px 10px",borderRadius:20,backgroundColor:s.bg,flexShrink:0},children:[e.jsx(a,{size:12,color:s.color,style:{animation:o.status==="checking"?"spin 1s linear infinite":"none"}}),e.jsx("span",{style:{fontSize:"0.7rem",fontWeight:"700",color:s.color},children:s.label})]})]},o.id)})})]},i)}),d.pending>0&&e.jsx("div",{style:{marginTop:20,padding:"14px 18px",backgroundColor:"#FFFBEB",border:"1px solid #FDE68A",borderRadius:10},children:e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:8},children:[e.jsx(C,{size:14,color:"#D97706",style:{marginTop:2,flexShrink:0}}),e.jsxs("p",{style:{margin:0,fontSize:"0.76rem",color:"#92400E",lineHeight:1.6},children:[e.jsxs("strong",{children:[d.pending," servicios"]}),' están marcados como "Sin configurar" porque sus secrets/credenciales aún no fueron cargados en Supabase. Para activarlos, configurá las variables de entorno en ',e.jsx("strong",{children:"Supabase → Settings → Edge Functions → Secrets"}),". Consultá el ",e.jsx("button",{onClick:()=>f("integraciones-apis"),style:{background:"none",border:"none",color:"#D97706",textDecoration:"underline",cursor:"pointer",padding:0,fontWeight:"700",fontSize:"0.76rem"},children:"Repositorio de APIs"})," para ver qué variable requiere cada servicio."]})]})})]}),e.jsx("style",{children:"@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }"})]})}export{X as HealthMonitorView};
