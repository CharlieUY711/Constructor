import{r as s,j as o,C as L}from"./index-iDsHFp5u.js";import{O as D}from"./OrangeHeader-DiDrEgeU.js";import{g as x,u as M,p as O,a as _}from"./integracionesApi-D3_gDAju.js";import{S as V}from"./store-CvRZ4n7X.js";import{Z as U}from"./zap-CPJ7bT-6.js";import{C as G}from"./clock-A5K15bJ7.js";import{C as H}from"./circle-check-BVal2DUR.js";import{S as K}from"./settings-2-CTVlR8b0.js";import{R as N}from"./refresh-cw-DQq2e4nG.js";import"./ConnectionStatusIcon-Jdy9-hf6.js";import"./lightbulb-BEmDgyfr.js";import"./map-pin-C2SMsNoE.js";const g="#FF6835",j={activo:{label:"Activo",color:"#10B981",bg:"#D1FAE5",Icon:H},inactivo:{label:"Inactivo",color:"#9CA3AF",bg:"#F3F4F6",Icon:G},error:{label:"Error",color:"#EF4444",bg:"#FEE2E2",Icon:L},configurando:{label:"Configurando",color:"#F59E0B",bg:"#FEF3C7",Icon:U}},Y={mercadolibre:[{key:"clientId",label:"Client ID",type:"text",placeholder:"..."},{key:"clientSecret",label:"Client Secret",type:"password",placeholder:"..."},{key:"accessToken",label:"Access Token",type:"password",placeholder:"..."},{key:"refreshToken",label:"Refresh Token",type:"password",placeholder:"..."}],mercadopago:[{key:"publicKey",label:"Public Key",type:"text",placeholder:"APP_USR-..."},{key:"accessToken",label:"Access Token",type:"password",placeholder:"APP_USR-..."},{key:"webhookSecret",label:"Webhook Secret",type:"password",placeholder:"..."}]};function se({onNavigate:k}){const[i,f]=s.useState([]),[p,S]=s.useState(!0),[F,y]=s.useState(null),[m,h]=s.useState({}),[d,u]=s.useState(null),[n,b]=s.useState(null),[I,A]=s.useState({});s.useEffect(()=>{(async()=>{try{const r=await x({tipo:"marketplace"});f(r);const l={};r.forEach(a=>{a.config&&typeof a.config=="object"&&(l[a.id]=a.config)}),h(l)}catch(r){console.error("Error cargando integraciones de marketplace:",r)}finally{S(!1)}})()},[]);const w=async e=>{try{const r=m[e.id]||{};await M(e.id,{config:r,estado:"configurando"});const l=await x({tipo:"marketplace"});f(l),y(null)}catch(r){console.error("Error guardando configuraci√≥n:",r),alert("Error al guardar la configuraci√≥n")}},B=async e=>{u(e.id);try{await O(e.id);const r=await x({tipo:"marketplace"});f(r),v(e.id)}catch(r){console.error("Error en ping:",r),alert("Error al probar la conexi√≥n")}finally{u(null)}},z=async e=>{b(e.id);try{await new Promise(r=>setTimeout(r,2e3)),alert("Sincronizaci√≥n iniciada"),v(e.id)}catch(r){console.error("Error en sincronizaci√≥n:",r),alert("Error al sincronizar")}finally{b(null)}},v=async e=>{try{const r=await _(e,10);A(l=>({...l,[e]:r}))}catch(r){console.error("Error cargando logs:",r)}},R=e=>Y[e]||[],T=i.filter(e=>e.estado==="activo").length;return o.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:[o.jsx(D,{icon:V,title:"Marketplace",subtitle:"Mercado Libre, MercadoPago ‚Äî Sincronizaci√≥n bidireccional de productos y pedidos",actions:[{label:"‚Üê Integraciones",onClick:()=>k("integraciones")}]}),o.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"24px 32px",backgroundColor:"#F8F9FA"},children:[o.jsx("div",{style:{display:"flex",gap:10,marginBottom:20},children:[{label:"Marketplaces",value:p?"...":i.length,color:"#111827"},{label:"Conectados",value:p?"...":T,color:"#10B981"},{label:"Inactivos",value:p?"...":i.filter(e=>e.estado==="inactivo").length,color:"#9CA3AF"}].map((e,r)=>o.jsxs("div",{style:{flex:1,backgroundColor:"#fff",borderRadius:10,padding:"12px 16px",border:"1px solid #E5E7EB",textAlign:"center"},children:[o.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"800",color:e.color},children:e.value}),o.jsx("div",{style:{fontSize:"0.7rem",color:"#9CA3AF",marginTop:2},children:e.label})]},r))}),o.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:14},children:i.map(e=>{const r=j[e.estado]||j.inactivo,l=r.Icon,a=F===e.id,W=R(e.nombre),P=m[e.id]||{},E=I[e.id]||[];return o.jsxs("div",{style:{backgroundColor:"#fff",borderRadius:14,border:"1px solid #E5E7EB",overflow:"hidden"},children:[o.jsx("div",{style:{height:3,backgroundColor:r.color}}),o.jsxs("div",{style:{padding:"16px 18px"},children:[o.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:12,marginBottom:10},children:[o.jsx("div",{style:{width:42,height:42,borderRadius:10,backgroundColor:"#F9FAFB",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.3rem",flexShrink:0},children:e.nombre==="mercadolibre"?"üè™":"üíô"}),o.jsxs("div",{style:{flex:1},children:[o.jsx("div",{style:{fontWeight:"800",color:"#111827",fontSize:"0.95rem",marginBottom:4},children:e.proveedor}),o.jsx("div",{style:{fontSize:"0.75rem",color:"#6B7280"},children:e.nombre})]})]}),o.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:10},children:[o.jsxs("span",{style:{display:"flex",alignItems:"center",gap:4,padding:"4px 9px",backgroundColor:r.bg,color:r.color,borderRadius:20,fontSize:"0.7rem",fontWeight:"700"},children:[o.jsx(l,{size:11})," ",r.label]}),o.jsx("div",{style:{display:"flex",gap:6},children:o.jsxs("button",{onClick:()=>y(a?null:e.id),style:{display:"flex",alignItems:"center",gap:4,padding:"5px 12px",borderRadius:7,border:"none",backgroundColor:g,color:"#fff",fontSize:"0.72rem",fontWeight:"700",cursor:"pointer"},children:[o.jsx(K,{size:11})," ",a?"Cerrar":"Configurar"]})})]}),a&&o.jsxs("div",{style:{marginTop:14,padding:"14px",backgroundColor:"#F9FAFB",borderRadius:10,border:"1px solid #E5E7EB"},children:[o.jsxs("p",{style:{margin:"0 0 10px",fontSize:"0.72rem",fontWeight:"700",color:"#374151"},children:["Credenciales OAuth ‚Äî ",e.proveedor]}),W.map(t=>o.jsxs("div",{style:{marginBottom:8},children:[o.jsx("label",{style:{fontSize:"0.68rem",fontWeight:"700",color:"#9CA3AF",display:"block",marginBottom:3,textTransform:"uppercase",letterSpacing:"0.05em"},children:t.label}),o.jsx("input",{type:t.type,value:P[t.key]||"",onChange:c=>h(C=>({...C,[e.id]:{...C[e.id]||{},[t.key]:c.target.value}})),placeholder:t.placeholder||`${t.label}...`,style:{width:"100%",padding:"7px 10px",border:"1.5px solid #E5E7EB",borderRadius:7,fontSize:"0.8rem",outline:"none",boxSizing:"border-box",backgroundColor:"#fff"},onFocus:c=>c.target.style.borderColor=g,onBlur:c=>c.target.style.borderColor="#E5E7EB"})]},t.key)),o.jsxs("div",{style:{display:"flex",gap:8,marginTop:10,flexWrap:"wrap"},children:[o.jsx("button",{onClick:()=>w(e),style:{flex:1,minWidth:120,padding:"8px",backgroundColor:g,color:"#fff",border:"none",borderRadius:7,fontSize:"0.78rem",fontWeight:"700",cursor:"pointer"},children:"Guardar"}),o.jsx("button",{onClick:()=>B(e),disabled:d===e.id,style:{flex:1,minWidth:120,padding:"8px",backgroundColor:d===e.id?"#E5E7EB":"#10B981",color:d===e.id?"#9CA3AF":"#fff",border:"none",borderRadius:7,fontSize:"0.78rem",fontWeight:"700",cursor:d===e.id?"not-allowed":"pointer"},children:d===e.id?"Probando...":"Test conexi√≥n"}),o.jsxs("button",{onClick:()=>z(e),disabled:n===e.id||e.estado!=="activo",style:{flex:1,minWidth:120,padding:"8px",backgroundColor:n===e.id||e.estado!=="activo"?"#E5E7EB":"#3B82F6",color:n===e.id||e.estado!=="activo"?"#9CA3AF":"#fff",border:"none",borderRadius:7,fontSize:"0.78rem",fontWeight:"700",cursor:n===e.id||e.estado!=="activo"?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:4},children:[o.jsx(N,{size:12,style:{opacity:n===e.id?.5:1}}),n===e.id?"Sincronizando...":"Sincronizar"]})]}),E.length>0&&o.jsxs("div",{style:{marginTop:14,padding:"10px",backgroundColor:"#fff",borderRadius:7,border:"1px solid #E5E7EB"},children:[o.jsx("p",{style:{margin:"0 0 8px",fontSize:"0.7rem",fontWeight:"700",color:"#374151"},children:"√öltimos eventos"}),o.jsx("div",{style:{maxHeight:120,overflowY:"auto"},children:E.map(t=>o.jsxs("div",{style:{padding:"4px 0",fontSize:"0.68rem",color:"#6B7280",borderBottom:"1px solid #F3F4F6"},children:[o.jsx("span",{style:{fontWeight:"600"},children:new Date(t.created_at).toLocaleString()})," ‚Äî ",o.jsx("span",{style:{color:t.nivel==="error"?"#EF4444":t.nivel==="warning"?"#F59E0B":"#6B7280"},children:t.mensaje})]},t.id))})]})]})]})]},e.id)})}),i.length===0&&!p&&o.jsxs("div",{style:{textAlign:"center",padding:"48px 0",color:"#9CA3AF"},children:[o.jsx("p",{style:{fontSize:"2rem",margin:"0 0 8px"},children:"üè™"}),o.jsx("p",{style:{fontWeight:"600"},children:"No hay integraciones de marketplace configuradas"})]})]})]})}export{se as IntegracionesMarketplaceView};
