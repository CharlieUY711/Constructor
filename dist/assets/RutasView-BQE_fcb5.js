import{r as c,j as e,f as A}from"./index-DufFdXmn.js";import{O as D}from"./OrangeHeader-KafCQxVY.js";import{p as $,a as W}from"./info-tCLo8W3J.js";import{M as I}from"./map-knmWz_sF.js";import{L}from"./layers-DJM0zl27.js";import{N as P}from"./navigation-CWJvkkNi.js";import"./ConnectionStatusIcon-BVSyzm9s.js";import"./zap-Dw_LsZ_j.js";import"./lightbulb-Bo6upu0R.js";import"./map-pin-BcVW-XRo.js";const v=`https://${$}.supabase.co/functions/v1/api/rutas`,F={"Content-Type":"application/json",Authorization:`Bearer ${W}`};async function T(l){try{const n=await fetch(`${v}${l}`,{headers:F}),i=await n.json();return n.ok?{ok:!0,data:i}:{ok:!1,error:i.error||"Error en la petici√≥n"}}catch(n){return console.error(`Rutas API GET ${l}:`,n),{ok:!1,error:String(n)}}}async function N(l){try{const n=await fetch(`${v}${l}`,{method:"DELETE",headers:F}),i=await n.json();return n.ok?{ok:!0}:{ok:!1,error:i.error||"Error en la petici√≥n"}}catch(n){return console.error(`Rutas API DELETE ${l}:`,n),{ok:!1,error:String(n)}}}async function G(l){const n=new URLSearchParams,i=await T(n.toString()?`?${n}`:"");return!i.ok||!i.data?[]:i.data.data||[]}async function O(l){return(await N(`/${l}`)).ok}const a="#FF6835",g={activa:{label:"Activa",color:"#059669",bg:"#ECFDF5"},pausada:{label:"Pausada",color:"#D97706",bg:"#FFFBEB"},planificada:{label:"Planificada",color:"#2563EB",bg:"#EFF6FF"},completada:{label:"Completada",color:"#6B7280",bg:"#F3F4F6"}};function X({onNavigate:l}){var E;const[n,i]=c.useState([]),[y,m]=c.useState(!0),[f,b]=c.useState(null),[p,C]=c.useState("todas"),[x,S]=c.useState(""),[r,h]=c.useState(null);c.useEffect(()=>{(async()=>{try{m(!0),b(null);const t=await G();i(t),t.length>0&&h(t[0])}catch(t){console.error("Error cargando rutas:",t),b(t instanceof Error?t.message:"Error cargando rutas")}finally{m(!1)}})()},[]);const j=n.filter(o=>!(p==="standard"&&o.tipo!=="standard"||p==="proyecto"&&o.tipo!=="proyecto"||x&&!o.nombre.toLowerCase().includes(x.toLowerCase())&&!o.zona.toLowerCase().includes(x.toLowerCase()))),k=n.filter(o=>o.estado==="activa").reduce((o,t)=>o+t.enviosTotales,0),B=async()=>{console.log("Crear nueva ruta")},R=async o=>{console.log("Editar ruta:",o)},w=async o=>{if(confirm("¬øEst√°s seguro de eliminar esta ruta?"))try{await O(o),i(n.filter(t=>t.id!==o)),(r==null?void 0:r.id)===o&&h(null)}catch(t){console.error("Error eliminando ruta:",t),alert("Error al eliminar la ruta")}};return e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsx(D,{icon:I,title:"Rutas de Distribuci√≥n",subtitle:y?"Cargando...":f?`Error: ${f}`:`${n.filter(o=>o.estado==="activa").length} rutas activas ¬∑ ${k} env√≠os planificados`,actions:[{label:"‚Üê Log√≠stica",onClick:()=>l("logistica")},{label:"+ Nueva Ruta",primary:!0,onClick:B}]}),e.jsxs("div",{style:{flex:1,display:"flex",overflow:"hidden",backgroundColor:"#F8F9FA"},children:[e.jsxs("div",{style:{width:"380px",flexShrink:0,display:"flex",flexDirection:"column",borderRight:"1px solid #E5E7EB",backgroundColor:"#fff"},children:[e.jsxs("div",{style:{padding:"14px 16px",borderBottom:"1px solid #E5E7EB"},children:[e.jsxs("div",{style:{position:"relative",marginBottom:"10px"},children:[e.jsx(A,{size:13,color:"#9CA3AF",style:{position:"absolute",left:"10px",top:"50%",transform:"translateY(-50%)"}}),e.jsx("input",{value:x,onChange:o=>S(o.target.value),placeholder:"Buscar ruta o zona...",style:{width:"100%",paddingLeft:"30px",paddingRight:"10px",paddingTop:"8px",paddingBottom:"8px",border:"1px solid #E5E7EB",borderRadius:"8px",fontSize:"12px",outline:"none",boxSizing:"border-box"}})]}),e.jsx("div",{style:{display:"flex",gap:"0",borderRadius:"8px",backgroundColor:"#F3F4F6",padding:"3px"},children:[["todas","Todas"],["standard","Standard"],["proyecto","Proyecto"]].map(([o,t])=>e.jsx("button",{onClick:()=>C(o),style:{flex:1,padding:"6px 4px",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"11px",fontWeight:700,backgroundColor:p===o?"#fff":"transparent",color:p===o?"#111":"#6B7280",boxShadow:p===o?"0 1px 4px rgba(0,0,0,0.08)":"none",transition:"all 0.15s"},children:t},o))})]}),e.jsx("div",{style:{flex:1,overflowY:"auto"},children:y?e.jsx("div",{style:{padding:"20px",textAlign:"center",color:"#6B7280",fontSize:"12px"},children:"Cargando rutas..."}):f?e.jsx("div",{style:{padding:"20px",textAlign:"center",color:"#DC2626",fontSize:"12px"},children:f}):j.length===0?e.jsxs("div",{style:{padding:"20px",textAlign:"center",color:"#6B7280",fontSize:"12px"},children:["No hay rutas ",x?"que coincidan con la b√∫squeda":""]}):j.map(o=>{const t=g[o.estado],s=(r==null?void 0:r.id)===o.id,d=o.paradas.filter(z=>z.estado==="entregado").length,u=Math.round(d/o.paradas.length*100);return e.jsxs("div",{onClick:()=>h(o),style:{padding:"14px 16px",borderBottom:"1px solid #F3F4F6",cursor:"pointer",backgroundColor:s?"#FFF4EC":"transparent",borderLeft:s?`3px solid ${a}`:"3px solid transparent",transition:"all 0.1s"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"10px",marginBottom:"8px"},children:[e.jsx("div",{style:{width:"32px",height:"32px",borderRadius:"8px",backgroundColor:o.tipo==="proyecto"?"#EFF6FF":"#FFF4EC",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:o.tipo==="proyecto"?e.jsx(L,{size:14,color:"#2563EB"}):e.jsx(P,{size:14,color:a})}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontSize:"12px",fontWeight:700,color:"#111",lineHeight:1.3,marginBottom:"3px"},children:o.nombre}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",flexWrap:"wrap"},children:[e.jsx("span",{style:{fontSize:"10px",fontWeight:700,color:t.color,backgroundColor:t.bg,padding:"1px 6px",borderRadius:"8px"},children:t.label}),e.jsx("span",{style:{fontSize:"10px",color:"#9CA3AF"},children:o.carrier})]})]})]}),e.jsxs("div",{style:{display:"flex",gap:"12px",fontSize:"11px",color:"#6B7280",marginBottom:"8px"},children:[e.jsxs("span",{children:["üìç ",o.paradas.length," paradas"]}),e.jsxs("span",{children:["üì¶ ",o.enviosTotales," env√≠os"]}),e.jsxs("span",{children:["üõ£ ",o.kmsEstimados," km"]})]}),e.jsx("div",{style:{width:"100%",height:"4px",backgroundColor:"#F3F4F6",borderRadius:"2px",overflow:"hidden"},children:e.jsx("div",{style:{width:`${u}%`,height:"100%",backgroundColor:u===100?"#059669":a,borderRadius:"2px",transition:"width 0.3s"}})}),e.jsxs("div",{style:{fontSize:"10px",color:"#9CA3AF",marginTop:"4px"},children:[d,"/",o.paradas.length," entregados (",u,"%)"]})]},o.id)})})]}),r?e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsx("div",{style:{backgroundColor:"#fff",padding:"20px 24px",borderBottom:"1px solid #E5E7EB",flexShrink:0},children:e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",gap:"12px"},children:[e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"6px"},children:[e.jsx("h2",{style:{margin:0,fontSize:"16px",fontWeight:800,color:"#111"},children:r.nombre}),e.jsx("span",{style:{fontSize:"10px",fontWeight:700,color:g[r.estado].color,backgroundColor:g[r.estado].bg,padding:"3px 8px",borderRadius:"10px"},children:g[r.estado].label}),e.jsx("span",{style:{fontSize:"10px",fontWeight:700,color:r.tipo==="proyecto"?"#2563EB":a,backgroundColor:r.tipo==="proyecto"?"#EFF6FF":"#FFF4EC",padding:"3px 8px",borderRadius:"10px"},children:r.tipo==="proyecto"?"üìã Proyecto":"üîÑ Standard"})]}),e.jsxs("div",{style:{display:"flex",gap:"20px",fontSize:"12px",color:"#6B7280",flexWrap:"wrap"},children:[e.jsxs("span",{children:["üöö ",r.carrier]}),e.jsxs("span",{children:["üìç ",r.zona]}),e.jsxs("span",{children:["üõ£ ",r.kmsEstimados," km"]}),e.jsxs("span",{children:["‚è± ",r.tiempoEstimado]}),r.frecuencia&&e.jsxs("span",{children:["üìÖ ",r.frecuencia]}),r.fechaProxima&&e.jsxs("span",{style:{color:a,fontWeight:700},children:["üìÜ Pr√≥xima: ",r.fechaProxima]})]}),r.observaciones&&e.jsxs("div",{style:{marginTop:"8px",padding:"8px 12px",backgroundColor:"#FFFBEB",borderRadius:"8px",fontSize:"12px",color:"#92400E",border:"1px solid #FDE68A"},children:["‚ö† ",r.observaciones]})]}),e.jsxs("div",{style:{display:"flex",gap:"8px",flexShrink:0},children:[e.jsx("button",{onClick:()=>R(r),style:{padding:"8px 16px",border:`1.5px solid ${a}`,borderRadius:"8px",backgroundColor:"transparent",color:a,fontSize:"12px",fontWeight:700,cursor:"pointer"},children:"Editar"}),e.jsx("button",{onClick:()=>w(r.id),style:{padding:"8px 16px",border:"none",borderRadius:"8px",backgroundColor:"#DC2626",color:"#fff",fontSize:"12px",fontWeight:700,cursor:"pointer"},children:"Eliminar"}),r.estado!=="activa"&&e.jsx("button",{style:{padding:"8px 16px",border:"none",borderRadius:"8px",backgroundColor:a,color:"#fff",fontSize:"12px",fontWeight:700,cursor:"pointer"},children:"‚ñ∂ Iniciar ruta"})]})]})}),e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"20px 24px"},children:[e.jsxs("h3",{style:{margin:"0 0 14px",fontSize:"13px",fontWeight:800,color:"#374151",textTransform:"uppercase",letterSpacing:"0.06em"},children:["Paradas (",((E=r.paradas)==null?void 0:E.length)||0,")"]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:r.paradas&&r.paradas.length>0?r.paradas.map((o,t)=>{const s=o.estado==="entregado",d=o.estado==="fallido";return e.jsxs("div",{style:{display:"flex",gap:"14px",alignItems:"flex-start"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",flexShrink:0},children:[e.jsx("div",{style:{width:"32px",height:"32px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",fontWeight:800,backgroundColor:s?"#D1FAE5":d?"#FEE2E2":`${a}18`,color:s?"#059669":d?"#DC2626":a,border:`2px solid ${s?"#A7F3D0":d?"#FCA5A5":`${a}40`}`},children:s?"‚úì":o.orden}),t<r.paradas.length-1&&e.jsx("div",{style:{width:"2px",height:"20px",backgroundColor:s?"#A7F3D0":"#E5E7EB",margin:"3px 0"}})]}),e.jsx("div",{style:{flex:1,padding:"12px 16px",borderRadius:"10px",border:"1px solid #E5E7EB",backgroundColor:s?"#F0FDF4":d?"#FFF5F5":"#fff",marginBottom:(t<r.paradas.length-1,"0")},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"13px",fontWeight:700,color:"#111",marginBottom:"3px"},children:o.direccion}),e.jsxs("div",{style:{fontSize:"11px",color:"#6B7280"},children:[o.localidad," ¬∑ ",o.envios," env√≠o",o.envios>1?"s":""]})]}),e.jsx("span",{style:{fontSize:"10px",fontWeight:700,padding:"3px 8px",borderRadius:"10px",color:s?"#059669":d?"#DC2626":"#D97706",backgroundColor:s?"#D1FAE5":d?"#FEE2E2":"#FFFBEB"},children:s?"‚úì Entregado":d?"‚úó Fallido":"‚è≥ Pendiente"})]})})]},o.id)}):e.jsx("div",{style:{padding:"20px",textAlign:"center",color:"#6B7280",fontSize:"12px"},children:"No hay paradas asignadas a esta ruta"})})]})]}):e.jsx("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",color:"#9CA3AF",fontSize:"14px"},children:"Seleccion√° una ruta para ver el detalle"})]})]})}export{X as RutasView};
