import{e as A,p as b,R as s,j as e,t as z}from"./index-v6XgiFCH.js";import{O as w}from"./OrangeHeader-B6pOaz2T.js";import{C as v}from"./circle-x-mTDy0RPx.js";import{C as B}from"./clock-BPmgSMOp.js";import{C as _}from"./circle-check-EGboc5pA.js";import{L as k}from"./loader-circle-DwKQh3Lv.js";import"./ConnectionStatusIcon-CQDd4n9w.js";import"./zap-CZ5J69Ph.js";import"./lightbulb-CD-WF-T3.js";import"./map-pin-HqaKhnQx.js";const L=`${A}/entregas`,R="oddy",T={"Content-Type":"application/json",Authorization:`Bearer ${b}`,apikey:b,"x-tenant-id":R};async function I(t,r){const l=await(await fetch(`${L}${t}`,{headers:T,...r})).json();if(l.error)throw new Error(l.error);return l}async function D(t){const r=new URLSearchParams;return t!=null&&t.estado&&r.set("estado",t.estado),t!=null&&t.desde&&r.set("desde",t.desde),t!=null&&t.hasta&&r.set("hasta",t.hasta),(await I(r.toString()?`?${r}`:"")).data||[]}const x="#FF6835",h={entregado:{label:"Entregado",color:"#059669",bg:"#ECFDF5",Icon:_},no_entregado:{label:"No entregado",color:"#EF4444",bg:"#FEF2F2",Icon:v},parcial:{label:"Parcial",color:"#D97706",bg:"#FFFBEB",Icon:B},devuelto:{label:"Devuelto",color:"#6B7280",bg:"#F3F4F6",Icon:v}};function Y({onNavigate:t}){const[r,g]=s.useState([]),[l,f]=s.useState(!0),[d,m]=s.useState(""),[c,F]=s.useState(""),[E,C]=s.useState(null),S=async()=>{f(!0);try{g(await D({estado:d||void 0}))}catch{z.error("Error")}finally{f(!1)}};s.useEffect(()=>{S()},[d]);const p=r.filter(o=>{var i,n;return!c||(((i=o.envios)==null?void 0:i.numero)||"").toLowerCase().includes(c.toLowerCase())||(((n=o.envios)==null?void 0:n.destinatario)||"").toLowerCase().includes(c.toLowerCase())});return e.jsxs("div",{style:{minHeight:"100vh",background:"#F8FAFC"},children:[e.jsx(w,{title:"Entregas",subtitle:"Confirmaciones y acuses de recibo",onBack:()=>t("logistica")}),e.jsxs("div",{style:{maxWidth:1100,margin:"0 auto",padding:"24px 16px"},children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:24},children:Object.entries(h).map(([o,i])=>{const{Icon:n}=i;return e.jsxs("button",{onClick:()=>m(d===o?"":o),style:{background:d===o?i.bg:"#fff",border:"2px solid "+(d===o?i.color:"#E5E7EB"),borderRadius:10,padding:14,textAlign:"center",cursor:"pointer"},children:[e.jsx(n,{size:20,style:{color:i.color,marginBottom:6}}),e.jsx("div",{style:{fontSize:22,fontWeight:700,color:i.color},children:r.filter(a=>a.estado===o).length}),e.jsx("div",{style:{fontSize:12,color:"#6B7280"},children:i.label})]},o)})}),e.jsx("input",{value:c,onChange:o=>F(o.target.value),placeholder:"Buscar envio o destinatario...",style:{width:"100%",padding:"9px 12px",border:"1px solid #E5E7EB",borderRadius:8,fontSize:14,marginBottom:16,boxSizing:"border-box"}}),l?e.jsx("div",{style:{textAlign:"center",padding:60},children:e.jsx(k,{size:32,style:{color:x}})}):p.length===0?e.jsx("div",{style:{textAlign:"center",padding:60,color:"#9CA3AF"},children:"No hay entregas."}):e.jsx("div",{style:{display:"grid",gap:10},children:p.map(o=>{var u,y,j;const i=h[o.estado]||h.entregado,{Icon:n}=i,a=E===o.id;return e.jsxs("div",{onClick:()=>C(a?null:o.id),style:{background:"#fff",border:"1px solid "+(a?x:"#E5E7EB"),borderRadius:10,padding:"16px 20px",cursor:"pointer"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:14},children:[e.jsx("div",{style:{width:40,height:40,borderRadius:10,background:i.bg,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:e.jsx(n,{size:18,style:{color:i.color}})}),e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{fontWeight:700},children:[((u=o.envios)==null?void 0:u.numero)||o.envio_id.slice(0,8),e.jsx("span",{style:{marginLeft:8,background:i.bg,color:i.color,fontSize:11,fontWeight:600,padding:"2px 8px",borderRadius:20},children:i.label})]}),e.jsxs("div",{style:{fontSize:13,color:"#6B7280"},children:[(y=o.envios)==null?void 0:y.destinatario,((j=o.envios)==null?void 0:j.destino)&&" - "+o.envios.destino]})]}),e.jsxs("div",{style:{textAlign:"right",fontSize:12,color:"#9CA3AF"},children:[e.jsx("div",{children:new Date(o.fecha_entrega).toLocaleDateString("es-UY")}),e.jsx("div",{children:new Date(o.fecha_entrega).toLocaleTimeString("es-UY",{hour:"2-digit",minute:"2-digit"})})]})]}),a&&e.jsxs("div",{style:{marginTop:14,paddingTop:14,borderTop:"1px solid #F3F4F6",display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(180px,1fr))",gap:12},children:[o.firmado_por&&e.jsxs("div",{children:[e.jsx("span",{style:{fontSize:11,color:"#9CA3AF",display:"block"},children:"Firmado por"}),e.jsx("strong",{children:o.firmado_por})]}),o.notas&&e.jsxs("div",{children:[e.jsx("span",{style:{fontSize:11,color:"#9CA3AF",display:"block"},children:"Notas"}),e.jsx("span",{style:{fontSize:13},children:o.notas})]}),o.motivo_no_entrega&&e.jsxs("div",{children:[e.jsx("span",{style:{fontSize:11,color:"#9CA3AF",display:"block"},children:"Motivo"}),e.jsx("span",{style:{fontSize:13,color:"#EF4444"},children:o.motivo_no_entrega})]}),o.foto_url&&e.jsxs("div",{children:[e.jsx("span",{style:{fontSize:11,color:"#9CA3AF",display:"block"},children:"Foto"}),e.jsx("a",{href:o.foto_url,target:"_blank",rel:"noopener noreferrer",style:{color:x,fontSize:13},children:"Ver foto"})]})]})]},o.id)})})]})]})}export{Y as EntregasView};
