import{c as O,s as y,r as a,j as e,S as g,C as $}from"./index-DpZjhHPo.js";import{O as b}from"./OrangeHeader-DclloVy3.js";import{L as I}from"./loader-circle-DHllBNxS.js";import{T as F}from"./triangle-alert-CKX9U7el.js";import{C as L}from"./chart-column-B1G_Ahc0.js";import{C as T}from"./circle-check-Bf3OLNcx.js";import{Z as M}from"./zap-DLTL4QpT.js";import{S as P}from"./settings-C2B_FFh8.js";import{R as N}from"./refresh-cw-DotlCOZk.js";import"./lightbulb-Eph2A-kA.js";import"./map-pin-CDgTiIOI.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]],K=O("trending-down",U);async function q(l){let s=y.from("abastecimiento_alertas").select("*");s=s.eq("activa",l);const{data:c,error:d}=await s.order("created_at",{ascending:!1});if(d)throw new Error(d.message);return c||[]}async function G(l){let s=y.from("abastecimiento_ordenes_compra").select("*");const{data:c,error:d}=await s.order("created_at",{ascending:!1});if(d)throw new Error(d.message);return c||[]}async function V(){const{data:l,error:s}=await y.from("abastecimiento_mrp").select("*").order("created_at",{ascending:!1});if(s)throw new Error(s.message);return l||[]}const n="#FF6835",Z={sugerida:{label:"Sugerida",color:"#D97706",bg:"#FFFBEB"},aprobada:{label:"Aprobada",color:"#2563EB",bg:"#EFF6FF"},enviada:{label:"Enviada",color:"#7C3AED",bg:"#F5F3FF"},recibida:{label:"Recibida",color:"#059669",bg:"#ECFDF5"},cancelada:{label:"Cancelada",color:"#DC2626",bg:"#FEF2F2"}};function le({onNavigate:l}){const[s,c]=a.useState("alertas"),[d,H]=a.useState(""),[R,A]=a.useState([]),[z,B]=a.useState([]),[D,w]=a.useState([]),[W,j]=a.useState(!1),[C,v]=a.useState(null);a.useEffect(()=>{S()},[]);const S=async()=>{j(!0),v(null);try{const[o,i,t]=await Promise.all([q(!0),G(),V()]),h=o.map(r=>({sku:r.sku||"",nombre:r.producto,categoria:r.categoria||"",stockActual:r.stock_actual||0,stockMinimo:r.stock_minimo||0,stockOptimo:r.stock_optimo||0,unidad:r.unidad||"u",proveedor:r.proveedor||"",tiempoReposicion:r.tiempo_reposicion||0,consumoPromDiario:r.consumo_prom_diario||0,diasRestantes:r.dias_restantes||0,nivel:r.nivel})),m=i.map(r=>({id:r.id,sku:r.sku||"",nombre:r.producto,proveedor:r.proveedor,cantidad:r.cantidad_sugerida||0,precioUnit:r.precio_unit||r.precio_estimado||0,total:r.total||(r.cantidad_sugerida||0)*(r.precio_unit||r.precio_estimado||0),motivoOC:r.motivo_oc||"",estado:r.estado,fechaSugerida:r.fecha_sugerida||r.created_at||""})),_=t.map(r=>({sku:r.sku||"",descripcion:r.componente,necesario:r.necesario||0,stockDisponible:r.stock_actual||0,aComprar:r.a_comprar||0,unidad:r.unidad||"u"}));A(h),B(m),w(_)}catch(o){console.error("Error cargando abastecimiento DETALLE:",JSON.stringify(o,null,2)),console.error("Error message:",o instanceof Error?o.message:String(o)),console.error("Error completo:",o),v(o instanceof Error?o.message:"Error cargando datos")}finally{j(!1)}},u=R,p=z,f=D,x=u.filter(o=>o.nivel==="critico").length,k=u.filter(o=>o.nivel==="bajo").length,E=p.filter(o=>o.estado==="sugerida").reduce((o,i)=>o+i.total,0);return W?e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsx(b,{icon:g,title:"Abastecimiento",subtitle:"Cargando...",actions:[{label:"‚Üê Log√≠stica",onClick:()=>l("logistica")}]}),e.jsx("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(I,{size:32,color:n,style:{animation:"spin 1s linear infinite"}})})]}):C?e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:e.jsx(b,{icon:g,title:"Abastecimiento",subtitle:`Error: ${C}`,actions:[{label:"‚Üê Log√≠stica",onClick:()=>l("logistica")},{label:"‚Üª Reintentar",primary:!0,onClick:S}]})}):e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsx(b,{icon:g,title:"Abastecimiento",subtitle:`${x} alertas cr√≠ticas ¬∑ ${k} alertas bajas ¬∑ OCs sugeridas: $${E.toLocaleString("es-AR")}`,actions:[{label:"‚Üê Log√≠stica",onClick:()=>l("logistica")},{label:"+ OC Manual",primary:!0}]}),e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",backgroundColor:"#F8F9FA"},children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:"12px",padding:"16px 20px 0"},children:[{label:"Alertas Cr√≠ticas",value:x,icon:F,color:"#DC2626"},{label:"Stock Bajo",value:k,icon:K,color:"#D97706"},{label:"OC Sugeridas",value:p.filter(o=>o.estado==="sugerida").length,icon:g,color:"#2563EB"},{label:"Valor a Reponer",value:`$${(E/1e3).toFixed(0)}K`,icon:L,color:n}].map(o=>{const i=o.icon;return e.jsxs("div",{style:{backgroundColor:"#fff",borderRadius:"12px",border:`1px solid ${o.color==="#DC2626"&&x>0?"#FCA5A5":"#E5E7EB"}`,padding:"16px",display:"flex",gap:"12px",alignItems:"center"},children:[e.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"10px",backgroundColor:`${o.color}15`,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:e.jsx(i,{size:18,color:o.color})}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"22px",fontWeight:800,color:"#111"},children:o.value}),e.jsx("div",{style:{fontSize:"11px",color:"#6B7280"},children:o.label})]})]},o.label)})}),e.jsx("div",{style:{display:"flex",padding:"12px 20px 0",backgroundColor:"#fff",borderBottom:"1px solid #E5E7EB",marginTop:"12px"},children:[["alertas","‚ö†Ô∏è Alertas de Stock"],["oc_sugeridas","üìã OC Sugeridas"],["mrp","‚öôÔ∏è MRP ‚Äî C√°lculo"]].map(([o,i])=>e.jsxs("button",{onClick:()=>c(o),style:{padding:"10px 20px",border:"none",backgroundColor:"transparent",cursor:"pointer",fontSize:"13px",fontWeight:s===o?700:500,color:s===o?n:"#6B7280",borderBottom:s===o?`2px solid ${n}`:"2px solid transparent"},children:[i,o==="alertas"&&x>0&&e.jsx("span",{style:{marginLeft:"6px",fontSize:"10px",fontWeight:800,color:"#DC2626",backgroundColor:"#FEE2E2",padding:"1px 6px",borderRadius:"10px"},children:x})]},o))}),e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"16px 20px"},children:[s==="alertas"&&e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:u.sort((o,i)=>o.nivel==="critico"?-1:i.nivel==="critico"?1:0).map(o=>{const i=Math.min(100,Math.round(o.stockActual/o.stockOptimo*100)),t=o.nivel==="critico"?"#DC2626":o.nivel==="bajo"?"#D97706":"#059669",h=o.nivel==="critico"?"#FFF5F5":o.nivel==="bajo"?"#FFFDF0":"#fff",m=o.nivel==="critico"?"#FCA5A5":o.nivel==="bajo"?"#FDE68A":"#E5E7EB";return e.jsx("div",{style:{backgroundColor:h,borderRadius:"12px",border:`1px solid ${m}`,padding:"16px 20px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"14px"},children:[e.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"10px",backgroundColor:`${t}15`,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:o.nivel==="critico"?e.jsx(F,{size:18,color:t}):o.nivel==="bajo"?e.jsx($,{size:18,color:t}):e.jsx(T,{size:18,color:t})}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"4px",flexWrap:"wrap"},children:[e.jsx("span",{style:{fontSize:"13px",fontWeight:800,color:"#111"},children:o.nombre}),e.jsx("span",{style:{fontSize:"10px",fontWeight:700,color:t,backgroundColor:`${t}18`,padding:"2px 8px",borderRadius:"10px",textTransform:"uppercase"},children:o.nivel}),e.jsxs("span",{style:{fontSize:"10px",color:"#9CA3AF"},children:["SKU: ",o.sku]})]}),e.jsxs("div",{style:{display:"flex",gap:"16px",fontSize:"11px",color:"#6B7280",marginBottom:"10px",flexWrap:"wrap"},children:[e.jsxs("span",{children:["üì¶ Stock actual: ",e.jsxs("strong",{style:{color:o.nivel==="critico"?"#DC2626":"#111"},children:[o.stockActual," ",o.unidad]})]}),e.jsxs("span",{children:["üéØ M√≠nimo: ",o.stockMinimo]}),e.jsxs("span",{children:["‚ö° √ìptimo: ",o.stockOptimo]}),e.jsxs("span",{children:["üè≠ Proveedor: ",o.proveedor]}),e.jsxs("span",{children:["üìÖ Reposici√≥n: ",o.tiempoReposicion," d√≠as"]}),o.diasRestantes<=o.tiempoReposicion&&e.jsxs("span",{style:{color:"#DC2626",fontWeight:700},children:["‚ö† ¬°Quedan ",o.diasRestantes," d√≠a",o.diasRestantes!==1?"s":"","!"]})]}),e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[e.jsx("span",{style:{fontSize:"10px",color:"#9CA3AF"},children:"Nivel de stock"}),e.jsxs("span",{style:{fontSize:"10px",fontWeight:700,color:t},children:[i,"%"]})]}),e.jsx("div",{style:{width:"100%",height:"6px",backgroundColor:"#F3F4F6",borderRadius:"3px",overflow:"hidden"},children:e.jsx("div",{style:{width:`${i}%`,height:"100%",backgroundColor:t,borderRadius:"3px",transition:"width 0.3s"}})})]})]}),e.jsx("div",{style:{display:"flex",gap:"8px",flexShrink:0},children:o.nivel!=="ok"&&e.jsx("button",{style:{padding:"8px 14px",border:"none",borderRadius:"8px",backgroundColor:o.nivel==="critico"?"#DC2626":n,color:"#fff",fontSize:"12px",fontWeight:700,cursor:"pointer"},children:o.nivel==="critico"?"üö® OC Urgente":"üìã Sugerir OC"})})]})},o.sku)})}),s==="oc_sugeridas"&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"4px"},children:[e.jsxs("span",{style:{fontSize:"13px",color:"#6B7280"},children:[p.length," √≥rdenes de compra ¬∑ Total: ",e.jsxs("strong",{style:{color:"#111"},children:["$",p.reduce((o,i)=>o+i.total,0).toLocaleString("es-AR")]})]}),e.jsxs("button",{style:{padding:"8px 16px",border:"none",borderRadius:"8px",backgroundColor:n,color:"#fff",fontSize:"12px",fontWeight:700,cursor:"pointer",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(M,{size:13})," Aprobar todas las sugeridas"]})]}),p.map(o=>{const i=Z[o.estado];return e.jsxs("div",{style:{backgroundColor:"#fff",borderRadius:"12px",border:"1px solid #E5E7EB",padding:"16px 20px",display:"flex",gap:"16px",alignItems:"center"},children:[e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"6px",flexWrap:"wrap"},children:[e.jsx("span",{style:{fontSize:"13px",fontWeight:800,color:"#111"},children:o.nombre}),e.jsx("span",{style:{fontSize:"10px",fontWeight:700,color:i.color,backgroundColor:i.bg,padding:"2px 8px",borderRadius:"10px"},children:i.label}),e.jsxs("span",{style:{fontSize:"10px",color:"#9CA3AF"},children:["SKU: ",o.sku]})]}),e.jsxs("div",{style:{display:"flex",gap:"16px",fontSize:"11px",color:"#6B7280",flexWrap:"wrap"},children:[e.jsxs("span",{children:["üè≠ ",o.proveedor]}),e.jsxs("span",{children:["üì¶ ",o.cantidad," u √ó $",o.precioUnit.toLocaleString("es-AR")]}),e.jsxs("span",{style:{color:"#111",fontWeight:700},children:["üí∞ Total: $",o.total.toLocaleString("es-AR")]}),e.jsxs("span",{children:["‚ö† ",o.motivoOC]}),e.jsxs("span",{children:["üìÖ ",o.fechaSugerida]})]})]}),e.jsxs("div",{style:{display:"flex",gap:"8px",flexShrink:0},children:[o.estado==="sugerida"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{style:{padding:"8px 14px",border:"1px solid #E5E7EB",borderRadius:"8px",backgroundColor:"#fff",color:"#DC2626",fontSize:"12px",fontWeight:700,cursor:"pointer"},children:"Rechazar"}),e.jsx("button",{style:{padding:"8px 14px",border:"none",borderRadius:"8px",backgroundColor:"#2563EB",color:"#fff",fontSize:"12px",fontWeight:700,cursor:"pointer"},children:"‚úì Aprobar"})]}),o.estado==="aprobada"&&e.jsx("button",{style:{padding:"8px 14px",border:"none",borderRadius:"8px",backgroundColor:n,color:"#fff",fontSize:"12px",fontWeight:700,cursor:"pointer"},children:"Enviar a Proveedor"})]})]},o.id)})]}),s==="mrp"&&e.jsx("div",{style:{maxWidth:"800px"},children:e.jsxs("div",{style:{backgroundColor:"#fff",borderRadius:"12px",border:"1px solid #E5E7EB",padding:"20px",marginBottom:"16px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"16px"},children:[e.jsx(P,{size:18,color:n}),e.jsx("h3",{style:{margin:0,fontSize:"14px",fontWeight:800,color:"#111"},children:"MRP ‚Äî C√°lculo de Requerimientos"}),e.jsx("div",{style:{flex:1}}),e.jsxs("button",{style:{padding:"8px 16px",border:"none",borderRadius:"8px",backgroundColor:n,color:"#fff",fontSize:"12px",fontWeight:700,cursor:"pointer",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(N,{size:13})," Recalcular"]})]}),e.jsxs("div",{style:{padding:"12px",backgroundColor:"#FFF4EC",borderRadius:"8px",border:"1px solid #FED7AA",marginBottom:"16px",fontSize:"12px",color:"#92400E"},children:["üìã Basado en: ",e.jsx("strong",{children:"OA-2024-001 ‚Äî 120 Canastas Navide√±as"})," ¬∑ Fecha de entrega: 20/12/2024"]}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{backgroundColor:"#F9FAFB"},children:["SKU","Componente","Necesario","Disponible","A Comprar","Estado"].map(o=>e.jsx("th",{style:{padding:"10px 12px",textAlign:"left",fontSize:"11px",fontWeight:700,color:"#6B7280",textTransform:"uppercase",letterSpacing:"0.05em",borderBottom:"1px solid #E5E7EB"},children:o},o))})}),e.jsx("tbody",{children:f.map((o,i)=>{const t=o.aComprar===0;return e.jsxs("tr",{style:{borderBottom:i<f.length-1?"1px solid #F3F4F6":"none",backgroundColor:t?"transparent":"#FFFBEB"},children:[e.jsx("td",{style:{padding:"10px 12px",fontSize:"11px",fontFamily:"monospace",color:"#6B7280"},children:o.sku}),e.jsx("td",{style:{padding:"10px 12px",fontSize:"13px",fontWeight:500,color:"#111"},children:o.descripcion}),e.jsxs("td",{style:{padding:"10px 12px",fontSize:"13px",fontWeight:700,color:"#374151"},children:[o.necesario," ",o.unidad]}),e.jsx("td",{style:{padding:"10px 12px",fontSize:"13px",color:o.stockDisponible>=o.necesario?"#059669":"#D97706",fontWeight:600},children:o.stockDisponible}),e.jsx("td",{style:{padding:"10px 12px",fontSize:"13px",fontWeight:800,color:o.aComprar>0?"#DC2626":"#059669"},children:o.aComprar>0?`${o.aComprar}`:"‚úì 0"}),e.jsx("td",{style:{padding:"10px 12px"},children:t?e.jsx("span",{style:{fontSize:"10px",fontWeight:700,color:"#059669",backgroundColor:"#ECFDF5",padding:"3px 8px",borderRadius:"10px"},children:"‚úì Stock OK"}):e.jsx("button",{style:{fontSize:"10px",fontWeight:700,color:"#fff",backgroundColor:n,padding:"3px 10px",borderRadius:"8px",border:"none",cursor:"pointer"},children:"Crear OC"})})]},o.sku)})})]}),e.jsxs("div",{style:{marginTop:"16px",padding:"14px",backgroundColor:"#F9FAFB",borderRadius:"10px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"12px",color:"#6B7280",marginBottom:"3px"},children:"Componentes a comprar"}),e.jsxs("div",{style:{fontSize:"18px",fontWeight:800,color:"#DC2626"},children:[f.filter(o=>o.aComprar>0).length," de ",f.length," necesitan OC"]})]}),e.jsx("button",{style:{padding:"10px 20px",border:"none",borderRadius:"10px",backgroundColor:n,color:"#fff",fontSize:"13px",fontWeight:700,cursor:"pointer"},children:"Generar todas las OC necesarias"})]})]})})]})]})]})}export{le as AbastecimientoView};
