import{r as n,j as o,C as W}from"./index-v6XgiFCH.js";import{O as L}from"./OrangeHeader-B6pOaz2T.js";import{g as x,a as D,u as P,p as N}from"./integracionesApi-DpT3k2C5.js";import{S as M}from"./smartphone-BZjTJrkS.js";import{Z as O}from"./zap-CZ5J69Ph.js";import{C as V}from"./clock-BPmgSMOp.js";import{C as _}from"./circle-check-EGboc5pA.js";import{S as G}from"./settings-2-DuNGkU7Y.js";import"./ConnectionStatusIcon-CQDd4n9w.js";import"./lightbulb-CD-WF-T3.js";import"./map-pin-HqaKhnQx.js";const m="#FF6835",E={activo:{label:"Activo",color:"#10B981",bg:"#D1FAE5",Icon:_},inactivo:{label:"Inactivo",color:"#9CA3AF",bg:"#F3F4F6",Icon:V},error:{label:"Error",color:"#EF4444",bg:"#FEE2E2",Icon:W},configurando:{label:"Configurando",color:"#F59E0B",bg:"#FEF3C7",Icon:O}},H={resend:[{key:"apiKey",label:"API Key",type:"password",placeholder:"re_..."},{key:"domain",label:"Dominio verificado",type:"text",placeholder:"ejemplo.com"}],whatsapp:[{key:"accountSid",label:"Account SID",type:"text",placeholder:"AC..."},{key:"authToken",label:"Auth Token",type:"password",placeholder:"..."},{key:"phoneNumber",label:"NÃºmero de WhatsApp",type:"text",placeholder:"+598..."}],twilio:[{key:"accountSid",label:"Account SID",type:"text",placeholder:"AC..."},{key:"authToken",label:"Auth Token",type:"password",placeholder:"..."},{key:"phoneNumber",label:"NÃºmero de telÃ©fono",type:"text",placeholder:"+598..."}],gmail:[{key:"host",label:"Host SMTP",type:"text",placeholder:"smtp.gmail.com"},{key:"port",label:"Puerto",type:"number",placeholder:"587"},{key:"user",label:"Usuario",type:"text",placeholder:"tu@email.com"},{key:"password",label:"ContraseÃ±a",type:"password",placeholder:"..."}],meta:[{key:"appId",label:"App ID",type:"text",placeholder:"..."},{key:"appSecret",label:"App Secret",type:"password",placeholder:"..."},{key:"accessToken",label:"Access Token",type:"password",placeholder:"..."}]};function te({onNavigate:S}){const[s,p]=n.useState([]),[c,k]=n.useState(!0),[A,g]=n.useState(null),[u,y]=n.useState({}),[i,h]=n.useState(null),[F,I]=n.useState({}),[K,b]=n.useState({});n.useEffect(()=>{(async()=>{try{const r=await x({tipo:"comunicacion"});p(r);const l={};r.forEach(a=>{a.config&&typeof a.config=="object"&&(l[a.id]=a.config)}),y(l)}catch(r){console.error("Error cargando integraciones de comunicaciÃ³n:",r)}finally{k(!1)}})()},[]);const w=async e=>{try{const r=u[e.id]||{};await P(e.id,{config:r,estado:"configurando"});const l=await x({tipo:"comunicacion"});p(l),g(null)}catch(r){console.error("Error guardando configuraciÃ³n:",r),alert("Error al guardar la configuraciÃ³n")}},B=async e=>{h(e.id);try{const r=await N(e.id),l=await x({tipo:"comunicacion"});p(l),v(e.id)}catch(r){console.error("Error en ping:",r),alert("Error al probar la conexiÃ³n")}finally{h(null)}},v=async e=>{b(r=>({...r,[e]:!0}));try{const r=await D(e,10);I(l=>({...l,[e]:r}))}catch(r){console.error("Error cargando logs:",r)}finally{b(r=>({...r,[e]:!1}))}},T=e=>H[e]||[],z=s.filter(e=>e.estado==="activo").length;return o.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:[o.jsx(L,{icon:M,title:"ComunicaciÃ³n",subtitle:"WhatsApp, Resend, Gmail/SMTP, Meta, Twilio SMS â€” EnvÃ­o de mensajes y notificaciones",actions:[{label:"â† Integraciones",onClick:()=>S("integraciones")}]}),o.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"24px 32px",backgroundColor:"#F8F9FA"},children:[o.jsx("div",{style:{display:"flex",gap:10,marginBottom:20},children:[{label:"Proveedores",value:c?"...":s.length,color:"#111827"},{label:"Activas",value:c?"...":z,color:"#10B981"},{label:"Inactivas",value:c?"...":s.filter(e=>e.estado==="inactivo").length,color:"#9CA3AF"}].map((e,r)=>o.jsxs("div",{style:{flex:1,backgroundColor:"#fff",borderRadius:10,padding:"12px 16px",border:"1px solid #E5E7EB",textAlign:"center"},children:[o.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"800",color:e.color},children:e.value}),o.jsx("div",{style:{fontSize:"0.7rem",color:"#9CA3AF",marginTop:2},children:e.label})]},r))}),o.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:14},children:s.map(e=>{const r=E[e.estado]||E.inactivo,l=r.Icon,a=A===e.id,j=T(e.nombre),R=u[e.id]||{},f=F[e.id]||[];return o.jsxs("div",{style:{backgroundColor:"#fff",borderRadius:14,border:"1px solid #E5E7EB",overflow:"hidden",transition:"box-shadow 0.15s"},children:[o.jsx("div",{style:{height:3,backgroundColor:r.color}}),o.jsxs("div",{style:{padding:"16px 18px"},children:[o.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:12,marginBottom:10},children:[o.jsx("div",{style:{width:42,height:42,borderRadius:10,backgroundColor:"#F9FAFB",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.3rem",flexShrink:0},children:e.nombre==="whatsapp"?"ðŸ’¬":e.nombre==="resend"?"ðŸ“§":e.nombre==="gmail"?"ðŸ“®":e.nombre==="meta"?"ðŸ“˜":"ðŸ“±"}),o.jsxs("div",{style:{flex:1},children:[o.jsx("div",{style:{fontWeight:"800",color:"#111827",fontSize:"0.95rem",marginBottom:4},children:e.proveedor}),o.jsx("div",{style:{fontSize:"0.75rem",color:"#6B7280"},children:e.nombre})]})]}),o.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:10},children:[o.jsxs("span",{style:{display:"flex",alignItems:"center",gap:4,padding:"4px 9px",backgroundColor:r.bg,color:r.color,borderRadius:20,fontSize:"0.7rem",fontWeight:"700"},children:[o.jsx(l,{size:11})," ",r.label]}),o.jsx("div",{style:{display:"flex",gap:6},children:o.jsxs("button",{onClick:()=>{a?g(null):(g(e.id),f.length===0&&v(e.id))},style:{display:"flex",alignItems:"center",gap:4,padding:"5px 12px",borderRadius:7,border:"none",backgroundColor:m,color:"#fff",fontSize:"0.72rem",fontWeight:"700",cursor:"pointer"},children:[o.jsx(G,{size:11})," ",a?"Cerrar":"Configurar"]})})]}),a&&o.jsxs("div",{style:{marginTop:14,padding:"14px",backgroundColor:"#F9FAFB",borderRadius:10,border:"1px solid #E5E7EB"},children:[o.jsxs("p",{style:{margin:"0 0 10px",fontSize:"0.72rem",fontWeight:"700",color:"#374151"},children:["ConfiguraciÃ³n â€” ",e.proveedor]}),j.length>0?j.map(t=>o.jsxs("div",{style:{marginBottom:8},children:[o.jsx("label",{style:{fontSize:"0.68rem",fontWeight:"700",color:"#9CA3AF",display:"block",marginBottom:3,textTransform:"uppercase",letterSpacing:"0.05em"},children:t.label}),o.jsx("input",{type:t.type,value:R[t.key]||"",onChange:d=>y(C=>({...C,[e.id]:{...C[e.id]||{},[t.key]:d.target.value}})),placeholder:t.placeholder||`${t.label}...`,style:{width:"100%",padding:"7px 10px",border:"1.5px solid #E5E7EB",borderRadius:7,fontSize:"0.8rem",outline:"none",boxSizing:"border-box",backgroundColor:"#fff"},onFocus:d=>d.target.style.borderColor=m,onBlur:d=>d.target.style.borderColor="#E5E7EB"})]},t.key)):o.jsx("p",{style:{fontSize:"0.72rem",color:"#6B7280",fontStyle:"italic"},children:"No se requieren credenciales adicionales para esta integraciÃ³n."}),o.jsxs("div",{style:{display:"flex",gap:8,marginTop:10},children:[o.jsx("button",{onClick:()=>w(e),style:{flex:1,padding:"8px",backgroundColor:m,color:"#fff",border:"none",borderRadius:7,fontSize:"0.78rem",fontWeight:"700",cursor:"pointer"},children:"Guardar"}),o.jsx("button",{onClick:()=>B(e),disabled:i===e.id,style:{padding:"8px 12px",backgroundColor:i===e.id?"#E5E7EB":"#10B981",color:i===e.id?"#9CA3AF":"#fff",border:"none",borderRadius:7,fontSize:"0.78rem",fontWeight:"700",cursor:i===e.id?"not-allowed":"pointer"},children:i===e.id?"Probando...":"Test conexiÃ³n"})]}),f.length>0&&o.jsxs("div",{style:{marginTop:14,padding:"10px",backgroundColor:"#fff",borderRadius:7,border:"1px solid #E5E7EB"},children:[o.jsx("p",{style:{margin:"0 0 8px",fontSize:"0.7rem",fontWeight:"700",color:"#374151"},children:"Ãšltimos eventos"}),o.jsx("div",{style:{maxHeight:120,overflowY:"auto"},children:f.map(t=>o.jsxs("div",{style:{padding:"4px 0",fontSize:"0.68rem",color:"#6B7280",borderBottom:"1px solid #F3F4F6"},children:[o.jsx("span",{style:{fontWeight:"600"},children:new Date(t.created_at).toLocaleString()})," â€” ",o.jsx("span",{style:{color:t.nivel==="error"?"#EF4444":t.nivel==="warning"?"#F59E0B":"#6B7280"},children:t.mensaje})]},t.id))})]})]})]})]},e.id)})}),s.length===0&&!c&&o.jsxs("div",{style:{textAlign:"center",padding:"48px 0",color:"#9CA3AF"},children:[o.jsx("p",{style:{fontSize:"2rem",margin:"0 0 8px"},children:"ðŸ“±"}),o.jsx("p",{style:{fontWeight:"600"},children:"No hay integraciones de comunicaciÃ³n configuradas"})]})]})]})}export{te as IntegracionesComunicacionView};
