import{c as $,r as a,j as e,P as b,C as F}from"./index-DReGUpL_.js";import{O as j}from"./OrangeHeader-CoYSG2gk.js";import{p as I,a as P}from"./info-tCLo8W3J.js";import{L as _}from"./loader-circle-BP-pNhIs.js";import{L as T}from"./layers-BJMsd7hb.js";import{C as M}from"./clock-CcLraqAT.js";import{P as L}from"./plus-DqeiUWpF.js";import"./ConnectionStatusIcon-vKyUMKDa.js";import"./index-yKjPlrCh.js";import"./zap-CPr5Ap6C.js";import"./lightbulb-CFHFOFDJ.js";import"./map-pin-Bu5paOmy.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=[["path",{d:"M2 20a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8l-7 5V8l-7 5V4a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",key:"159hny"}],["path",{d:"M17 18h1",key:"uldtlt"}],["path",{d:"M12 18h1",key:"s9uhes"}],["path",{d:"M7 18h1",key:"1neino"}]],H=$("factory",K),z=`https://${I}.supabase.co/functions/v1/api/produccion`,B={"Content-Type":"application/json",Authorization:`Bearer ${P}`};async function N(p){const d=`${z}/articulos?activo=${p}`,c=await(await fetch(d,{headers:B})).json();if(c.error)throw new Error(c.error);return c.data||[]}async function U(p){const d=`${z}/ordenes`,c=await(await fetch(d,{headers:B})).json();if(c.error)throw new Error(c.error);return c.data||[]}const n="#FF6835",V={pendiente:{label:"Pendiente",color:"#D97706",bg:"#FFFBEB"},en_proceso:{label:"En proceso",color:"#2563EB",bg:"#EFF6FF"},completada:{label:"Completada",color:"#059669",bg:"#ECFDF5"},cancelada:{label:"Cancelada",color:"#DC2626",bg:"#FEF2F2"}},u={kit:{label:"Kit",emoji:"ðŸŽ",color:"#7C3AED"},canasta:{label:"Canasta",emoji:"ðŸ§º",color:n},combo:{label:"Combo",emoji:"ðŸ“¦",color:"#2563EB"},pack:{label:"Pack",emoji:"ðŸ—‚ï¸",color:"#059669"}};function de({onNavigate:p}){const[d,f]=a.useState("ordenes"),[c,G]=a.useState(""),[l,g]=a.useState(null),[Y,Z]=a.useState(null),[w,R]=a.useState([]),[W,D]=a.useState([]),[O,C]=a.useState(!1),[S,k]=a.useState(null);a.useEffect(()=>{E()},[]);const E=async()=>{C(!0),k(null);try{const[o,i]=await Promise.all([N(!0),U()]),r=o.map(t=>({id:t.id,sku:t.sku,nombre:t.nombre,tipo:t.tipo,descripcion:t.descripcion,componentes:Array.isArray(t.componentes)?t.componentes:[],tiempoArmado:t.tiempo_armado||0,costoManoObra:t.costo_mano_obra||0,activo:t.activo??!0})),s=i.map(t=>({id:t.id,numero:t.numero||"",articuloId:t.articulo_id||"",articuloNombre:t.articulo_nombre||"",cantidad:t.cantidad,estado:t.estado,ruta:t.ruta,operario:t.operario,fechaPedido:t.fecha_pedido||"",fechaEntrega:t.fecha_entrega||"",prioridad:t.prioridad||"normal",notas:t.notas}));R(r),D(s),r.length>0&&g(r[0])}catch(o){k(o instanceof Error?o.message:"Error cargando datos"),console.error("Error cargando producciÃ³n:",o)}finally{C(!1)}},x=w,m=W,v=m.filter(o=>o.estado==="pendiente").length,A=m.filter(o=>o.estado==="en_proceso").length,h=x.flatMap(o=>o.componentes||[]).filter(o=>!o.disponible).length;return O?e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsx(j,{icon:b,title:"ProducciÃ³n / Armado",subtitle:"Cargando...",actions:[{label:"â† LogÃ­stica",onClick:()=>p("logistica")}]}),e.jsx("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(_,{size:32,color:n,style:{animation:"spin 1s linear infinite"}})})]}):S?e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:e.jsx(j,{icon:b,title:"ProducciÃ³n / Armado",subtitle:`Error: ${S}`,actions:[{label:"â† LogÃ­stica",onClick:()=>p("logistica")},{label:"â†» Reintentar",primary:!0,onClick:E}]})}):e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsx(j,{icon:b,title:"ProducciÃ³n / Armado",subtitle:`${v} Ã³rdenes pendientes Â· ${A} en proceso Â· ${h>0?`âš  ${h} componentes sin stock`:"Stock OK"}`,actions:[{label:"â† LogÃ­stica",onClick:()=>p("logistica")},{label:"+ Nueva OA",primary:!0}]}),e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",backgroundColor:"#F8F9FA"},children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:"12px",padding:"16px 20px 0"},children:[{label:"ArtÃ­culos Compuestos",value:x.filter(o=>o.activo).length,icon:T,color:"#7C3AED"},{label:"OA Pendientes",value:v,icon:M,color:"#D97706"},{label:"En Proceso",value:A,icon:H,color:"#2563EB"},{label:"Alertas de Stock",value:h,icon:F,color:h>0?"#DC2626":"#059669"}].map(o=>{const i=o.icon;return e.jsxs("div",{style:{backgroundColor:"#fff",borderRadius:"12px",border:"1px solid #E5E7EB",padding:"16px",display:"flex",gap:"12px",alignItems:"center"},children:[e.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"10px",backgroundColor:`${o.color}15`,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:e.jsx(i,{size:18,color:o.color})}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"22px",fontWeight:800,color:"#111"},children:o.value}),e.jsx("div",{style:{fontSize:"11px",color:"#6B7280"},children:o.label})]})]},o.label)})}),e.jsx("div",{style:{display:"flex",padding:"12px 20px 0",backgroundColor:"#fff",borderBottom:"1px solid #E5E7EB",marginTop:"12px"},children:[["ordenes","ðŸ“‹ Ã“rdenes de Armado"],["bom","ðŸ”© BOM â€” ArtÃ­culos"],["articulos","ðŸ“¦ CatÃ¡logo de Kits"]].map(([o,i])=>e.jsx("button",{onClick:()=>f(o),style:{padding:"10px 20px",border:"none",backgroundColor:"transparent",cursor:"pointer",fontSize:"13px",fontWeight:d===o?700:500,color:d===o?n:"#6B7280",borderBottom:d===o?`2px solid ${n}`:"2px solid transparent"},children:i},o))}),e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"16px 20px"},children:[d==="ordenes"&&e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:m.map(o=>{const i=V[o.estado],r=x.find(y=>y.id===o.articuloId),s=r?u[r.tipo]:null,t=r==null?void 0:r.componentes.some(y=>!y.disponible);return e.jsxs("div",{style:{backgroundColor:"#fff",borderRadius:"12px",border:`1px solid ${t&&o.estado==="pendiente"?"#FCA5A5":"#E5E7EB"}`,padding:"16px 20px",display:"flex",gap:"16px",alignItems:"center"},children:[e.jsx("div",{style:{width:"48px",height:"48px",borderRadius:"12px",backgroundColor:`${n}15`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"22px",flexShrink:0},children:(s==null?void 0:s.emoji)||"ðŸ“¦"}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",flexWrap:"wrap",marginBottom:"4px"},children:[e.jsx("span",{style:{fontSize:"13px",fontWeight:800,color:"#111",fontFamily:"monospace"},children:o.numero}),e.jsx("span",{style:{fontSize:"10px",fontWeight:700,color:i.color,backgroundColor:i.bg,padding:"2px 8px",borderRadius:"10px"},children:i.label}),t&&o.estado==="pendiente"&&e.jsx("span",{style:{fontSize:"10px",fontWeight:700,color:"#DC2626",backgroundColor:"#FEE2E2",padding:"2px 8px",borderRadius:"10px"},children:"âš  Sin stock"})]}),e.jsx("div",{style:{fontSize:"13px",fontWeight:600,color:"#374151",marginBottom:"4px"},children:o.articuloNombre}),e.jsxs("div",{style:{display:"flex",gap:"14px",fontSize:"11px",color:"#9CA3AF",flexWrap:"wrap"},children:[e.jsxs("span",{children:["ðŸ“¦ ",o.cantidad," unidades"]}),o.ruta&&e.jsxs("span",{children:["ðŸ—º ",o.ruta]}),o.operario&&e.jsxs("span",{children:["ðŸ‘¤ ",o.operario]}),e.jsxs("span",{children:["ðŸ“… Entrega: ",o.fechaEntrega]})]}),o.notas&&e.jsxs("div",{style:{marginTop:"6px",fontSize:"11px",color:"#92400E",backgroundColor:"#FFFBEB",padding:"4px 8px",borderRadius:"6px",display:"inline-block"},children:["âš  ",o.notas]})]}),e.jsxs("div",{style:{display:"flex",gap:"8px",flexShrink:0},children:[o.estado==="pendiente"&&e.jsx("button",{style:{padding:"8px 14px",border:"none",borderRadius:"8px",backgroundColor:t?"#F3F4F6":n,color:t?"#9CA3AF":"#fff",fontSize:"12px",fontWeight:700,cursor:t?"not-allowed":"pointer"},children:t?"âš  Sin stock":"â–¶ Iniciar"}),o.estado==="en_proceso"&&e.jsx("button",{style:{padding:"8px 14px",border:"none",borderRadius:"8px",backgroundColor:"#059669",color:"#fff",fontSize:"12px",fontWeight:700,cursor:"pointer"},children:"âœ“ Completar"})]})]},o.id)})}),d==="bom"&&e.jsxs("div",{style:{display:"flex",gap:"16px"},children:[e.jsx("div",{style:{width:"260px",flexShrink:0,display:"flex",flexDirection:"column",gap:"8px"},children:x.map(o=>{const i=u[o.tipo],r=o.componentes.some(t=>!t.disponible),s=(l==null?void 0:l.id)===o.id;return e.jsxs("div",{onClick:()=>g(o),style:{backgroundColor:"#fff",borderRadius:"10px",border:`1.5px solid ${s?n:"#E5E7EB"}`,padding:"12px 14px",cursor:"pointer",boxShadow:s?`0 0 0 3px ${n}22`:"none",transition:"all 0.15s"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"4px"},children:[e.jsx("span",{style:{fontSize:"20px"},children:i.emoji}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontSize:"12px",fontWeight:700,color:"#111",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:o.nombre}),e.jsxs("div",{style:{fontSize:"10px",color:"#9CA3AF"},children:["SKU: ",o.sku]})]}),r&&e.jsx(F,{size:14,color:"#DC2626"})]}),e.jsxs("div",{style:{fontSize:"10px",color:"#6B7280"},children:[o.componentes.length," componentes Â· â± ",o.tiempoArmado," min"]})]},o.id)})}),l&&e.jsx("div",{style:{flex:1},children:e.jsxs("div",{style:{backgroundColor:"#fff",borderRadius:"12px",border:"1px solid #E5E7EB",padding:"20px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"16px"},children:[e.jsx("span",{style:{fontSize:"28px"},children:u[l.tipo].emoji}),e.jsxs("div",{children:[e.jsx("h3",{style:{margin:0,fontSize:"15px",fontWeight:800,color:"#111"},children:l.nombre}),e.jsx("div",{style:{fontSize:"12px",color:"#6B7280"},children:l.descripcion}),e.jsxs("div",{style:{display:"flex",gap:"12px",fontSize:"11px",color:"#374151",marginTop:"4px"},children:[e.jsxs("span",{children:["â± ",l.tiempoArmado," min/u"]}),e.jsxs("span",{children:["ðŸ’° $",l.costoManoObra.toLocaleString("es-AR")," mano de obra"]})]})]})]}),e.jsx("h4",{style:{margin:"0 0 12px",fontSize:"12px",fontWeight:700,color:"#6B7280",textTransform:"uppercase",letterSpacing:"0.06em"},children:"Bill of Materials"}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{backgroundColor:"#F9FAFB"},children:["SKU","Componente","Cant.","Unidad","Stock actual","Estado"].map(o=>e.jsx("th",{style:{padding:"10px 12px",textAlign:"left",fontSize:"11px",fontWeight:700,color:"#6B7280",textTransform:"uppercase",letterSpacing:"0.04em",borderBottom:"1px solid #E5E7EB"},children:o},o))})}),e.jsx("tbody",{children:l.componentes.map((o,i)=>e.jsxs("tr",{style:{borderBottom:i<l.componentes.length-1?"1px solid #F3F4F6":"none"},children:[e.jsx("td",{style:{padding:"10px 12px",fontSize:"11px",fontFamily:"monospace",color:"#6B7280"},children:o.sku}),e.jsx("td",{style:{padding:"10px 12px",fontSize:"13px",fontWeight:500,color:"#111"},children:o.descripcion}),e.jsx("td",{style:{padding:"10px 12px",fontSize:"13px",fontWeight:700,color:"#374151"},children:o.cantidad}),e.jsx("td",{style:{padding:"10px 12px",fontSize:"12px",color:"#6B7280"},children:o.unidad}),e.jsx("td",{style:{padding:"10px 12px",fontSize:"12px",color:o.stockActual===0?"#DC2626":"#374151",fontWeight:o.stockActual<20?700:400},children:o.stockActual}),e.jsx("td",{style:{padding:"10px 12px"},children:e.jsx("span",{style:{fontSize:"10px",fontWeight:700,padding:"3px 8px",borderRadius:"10px",color:o.disponible?"#059669":"#DC2626",backgroundColor:o.disponible?"#ECFDF5":"#FEE2E2"},children:o.disponible?"âœ“ OK":"âš  Sin stock"})})]},o.sku))})]}),e.jsxs("div",{style:{marginTop:"16px",display:"flex",gap:"10px"},children:[e.jsx("button",{style:{padding:"10px 20px",border:`1.5px solid ${n}`,borderRadius:"8px",backgroundColor:"transparent",color:n,fontSize:"13px",fontWeight:700,cursor:"pointer"},children:"Editar BOM"}),e.jsx("button",{style:{padding:"10px 20px",border:"none",borderRadius:"8px",backgroundColor:n,color:"#fff",fontSize:"13px",fontWeight:700,cursor:"pointer"},children:"+ Crear Orden de Armado"})]})]})})]}),d==="articulos"&&e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(280px,1fr))",gap:"14px"},children:[x.map(o=>{const i=u[o.tipo],r=o.componentes.some(s=>!s.disponible);return e.jsxs("div",{style:{backgroundColor:"#fff",borderRadius:"12px",border:`1px solid ${r?"#FCA5A5":"#E5E7EB"}`,padding:"20px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px",marginBottom:"14px"},children:[e.jsx("div",{style:{width:"48px",height:"48px",borderRadius:"12px",backgroundColor:`${i.color}15`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"24px",flexShrink:0},children:i.emoji}),e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",flexWrap:"wrap",marginBottom:"3px"},children:[e.jsx("span",{style:{fontSize:"13px",fontWeight:800,color:"#111"},children:o.nombre}),e.jsx("span",{style:{fontSize:"10px",fontWeight:700,color:i.color,backgroundColor:`${i.color}18`,padding:"1px 7px",borderRadius:"10px"},children:i.label}),r&&e.jsx("span",{style:{fontSize:"10px",fontWeight:700,color:"#DC2626",backgroundColor:"#FEE2E2",padding:"1px 7px",borderRadius:"10px"},children:"âš  Stock"})]}),e.jsxs("div",{style:{fontSize:"10px",color:"#9CA3AF"},children:["SKU: ",o.sku]})]})]}),e.jsx("div",{style:{fontSize:"11px",color:"#6B7280",marginBottom:"10px",lineHeight:"1.5"},children:o.descripcion}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"6px",marginBottom:"12px"},children:[e.jsxs("div",{style:{fontSize:"11px",color:"#374151"},children:["ðŸ”© ",o.componentes.length," componentes"]}),e.jsxs("div",{style:{fontSize:"11px",color:"#374151"},children:["â± ",o.tiempoArmado," min/u"]}),e.jsxs("div",{style:{fontSize:"11px",color:"#374151"},children:["ðŸ’° $",o.costoManoObra.toLocaleString()]}),e.jsxs("div",{style:{fontSize:"11px",color:"#374151"},children:["âœ… ",o.componentes.filter(s=>s.disponible).length,"/",o.componentes.length," con stock"]})]}),e.jsx("button",{onClick:()=>{f("bom"),g(o)},style:{width:"100%",padding:"9px",border:`1.5px solid ${n}`,borderRadius:"8px",backgroundColor:"transparent",color:n,fontSize:"12px",fontWeight:700,cursor:"pointer"},children:"Ver BOM"})]},o.id)}),e.jsxs("div",{style:{backgroundColor:"#FAFAFA",borderRadius:"12px",border:"2px dashed #E5E7EB",padding:"24px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"10px",cursor:"pointer",minHeight:"200px"},children:[e.jsx("div",{style:{width:"44px",height:"44px",borderRadius:"50%",backgroundColor:"#FFF4EC",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(L,{size:22,color:n})}),e.jsx("span",{style:{fontSize:"13px",fontWeight:700,color:n},children:"Nuevo ArtÃ­culo Compuesto"}),e.jsx("span",{style:{fontSize:"11px",color:"#9CA3AF",textAlign:"center"},children:"Kit Â· Canasta Â· Combo Â· Pack"})]})]})]})]})]})}export{de as ProduccionView};
