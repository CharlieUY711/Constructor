import{e as A,p as E,r as l,j as e,g as D}from"./index-v6XgiFCH.js";import{O as W}from"./OrangeHeader-B6pOaz2T.js";import{M as $}from"./map-obp2w1w0.js";import{L as T}from"./layers-BS3u5n2k.js";import{N as L}from"./navigation-BhAgr1lI.js";import"./ConnectionStatusIcon-CQDd4n9w.js";import"./zap-CZ5J69Ph.js";import"./lightbulb-CD-WF-T3.js";import"./map-pin-HqaKhnQx.js";const I=`${A}/rutas`,P="oddy",N={"Content-Type":"application/json",Authorization:`Bearer ${E}`,apikey:E,"x-tenant-id":P};async function F(d,a){const c=await(await fetch(`${I}${d}`,{headers:N,...a})).json();if(c.error)throw new Error(c.error);return c}async function q(d){const a=new URLSearchParams;return(await F(a.toString()?`?${a}`:"")).data||[]}async function O(d){try{return await F(`/${d}`,{method:"DELETE"}),!0}catch{return!1}}const i="#FF6835",h={activa:{label:"Activa",color:"#059669",bg:"#ECFDF5"},pausada:{label:"Pausada",color:"#D97706",bg:"#FFFBEB"},planificada:{label:"Planificada",color:"#2563EB",bg:"#EFF6FF"},completada:{label:"Completada",color:"#6B7280",bg:"#F3F4F6"}};function Q({onNavigate:d}){var v;const[a,f]=l.useState([]),[c,b]=l.useState(!0),[g,m]=l.useState(null),[p,C]=l.useState("todas"),[x,S]=l.useState(""),[t,u]=l.useState(null);l.useEffect(()=>{(async()=>{try{b(!0),m(null);const r=await q();f(r),r.length>0&&u(r[0])}catch(r){console.error("Error cargando rutas:",r),m(r instanceof Error?r.message:"Error cargando rutas")}finally{b(!1)}})()},[]);const j=a.filter(o=>!(p==="standard"&&o.tipo!=="standard"||p==="proyecto"&&o.tipo!=="proyecto"||x&&!o.nombre.toLowerCase().includes(x.toLowerCase())&&!o.zona.toLowerCase().includes(x.toLowerCase()))),B=a.filter(o=>o.estado==="activa").reduce((o,r)=>o+r.enviosTotales,0),k=async()=>{console.log("Crear nueva ruta")},w=async o=>{console.log("Editar ruta:",o)},z=async o=>{if(confirm("¬øEst√°s seguro de eliminar esta ruta?"))try{await O(o),f(a.filter(r=>r.id!==o)),(t==null?void 0:t.id)===o&&u(null)}catch(r){console.error("Error eliminando ruta:",r),alert("Error al eliminar la ruta")}};return e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsx(W,{icon:$,title:"Rutas de Distribuci√≥n",subtitle:c?"Cargando...":g?`Error: ${g}`:`${a.filter(o=>o.estado==="activa").length} rutas activas ¬∑ ${B} env√≠os planificados`,actions:[{label:"‚Üê Log√≠stica",onClick:()=>d("logistica")},{label:"+ Nueva Ruta",primary:!0,onClick:k}]}),e.jsxs("div",{style:{flex:1,display:"flex",overflow:"hidden",backgroundColor:"#F8F9FA"},children:[e.jsxs("div",{style:{width:"380px",flexShrink:0,display:"flex",flexDirection:"column",borderRight:"1px solid #E5E7EB",backgroundColor:"#fff"},children:[e.jsxs("div",{style:{padding:"14px 16px",borderBottom:"1px solid #E5E7EB"},children:[e.jsxs("div",{style:{position:"relative",marginBottom:"10px"},children:[e.jsx(D,{size:13,color:"#9CA3AF",style:{position:"absolute",left:"10px",top:"50%",transform:"translateY(-50%)"}}),e.jsx("input",{value:x,onChange:o=>S(o.target.value),placeholder:"Buscar ruta o zona...",style:{width:"100%",paddingLeft:"30px",paddingRight:"10px",paddingTop:"8px",paddingBottom:"8px",border:"1px solid #E5E7EB",borderRadius:"8px",fontSize:"12px",outline:"none",boxSizing:"border-box"}})]}),e.jsx("div",{style:{display:"flex",gap:"0",borderRadius:"8px",backgroundColor:"#F3F4F6",padding:"3px"},children:[["todas","Todas"],["standard","Standard"],["proyecto","Proyecto"]].map(([o,r])=>e.jsx("button",{onClick:()=>C(o),style:{flex:1,padding:"6px 4px",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"11px",fontWeight:700,backgroundColor:p===o?"#fff":"transparent",color:p===o?"#111":"#6B7280",boxShadow:p===o?"0 1px 4px rgba(0,0,0,0.08)":"none",transition:"all 0.15s"},children:r},o))})]}),e.jsx("div",{style:{flex:1,overflowY:"auto"},children:c?e.jsx("div",{style:{padding:"20px",textAlign:"center",color:"#6B7280",fontSize:"12px"},children:"Cargando rutas..."}):g?e.jsx("div",{style:{padding:"20px",textAlign:"center",color:"#DC2626",fontSize:"12px"},children:g}):j.length===0?e.jsxs("div",{style:{padding:"20px",textAlign:"center",color:"#6B7280",fontSize:"12px"},children:["No hay rutas ",x?"que coincidan con la b√∫squeda":""]}):j.map(o=>{const r=h[o.estado],n=(t==null?void 0:t.id)===o.id,s=o.paradas.filter(R=>R.estado==="entregado").length,y=Math.round(s/o.paradas.length*100);return e.jsxs("div",{onClick:()=>u(o),style:{padding:"14px 16px",borderBottom:"1px solid #F3F4F6",cursor:"pointer",backgroundColor:n?"#FFF4EC":"transparent",borderLeft:n?`3px solid ${i}`:"3px solid transparent",transition:"all 0.1s"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"10px",marginBottom:"8px"},children:[e.jsx("div",{style:{width:"32px",height:"32px",borderRadius:"8px",backgroundColor:o.tipo==="proyecto"?"#EFF6FF":"#FFF4EC",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:o.tipo==="proyecto"?e.jsx(T,{size:14,color:"#2563EB"}):e.jsx(L,{size:14,color:i})}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontSize:"12px",fontWeight:700,color:"#111",lineHeight:1.3,marginBottom:"3px"},children:o.nombre}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",flexWrap:"wrap"},children:[e.jsx("span",{style:{fontSize:"10px",fontWeight:700,color:r.color,backgroundColor:r.bg,padding:"1px 6px",borderRadius:"8px"},children:r.label}),e.jsx("span",{style:{fontSize:"10px",color:"#9CA3AF"},children:o.carrier})]})]})]}),e.jsxs("div",{style:{display:"flex",gap:"12px",fontSize:"11px",color:"#6B7280",marginBottom:"8px"},children:[e.jsxs("span",{children:["üìç ",o.paradas.length," paradas"]}),e.jsxs("span",{children:["üì¶ ",o.enviosTotales," env√≠os"]}),e.jsxs("span",{children:["üõ£ ",o.kmsEstimados," km"]})]}),e.jsx("div",{style:{width:"100%",height:"4px",backgroundColor:"#F3F4F6",borderRadius:"2px",overflow:"hidden"},children:e.jsx("div",{style:{width:`${y}%`,height:"100%",backgroundColor:y===100?"#059669":i,borderRadius:"2px",transition:"width 0.3s"}})}),e.jsxs("div",{style:{fontSize:"10px",color:"#9CA3AF",marginTop:"4px"},children:[s,"/",o.paradas.length," entregados (",y,"%)"]})]},o.id)})})]}),t?e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsx("div",{style:{backgroundColor:"#fff",padding:"20px 24px",borderBottom:"1px solid #E5E7EB",flexShrink:0},children:e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",gap:"12px"},children:[e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"6px"},children:[e.jsx("h2",{style:{margin:0,fontSize:"16px",fontWeight:800,color:"#111"},children:t.nombre}),e.jsx("span",{style:{fontSize:"10px",fontWeight:700,color:h[t.estado].color,backgroundColor:h[t.estado].bg,padding:"3px 8px",borderRadius:"10px"},children:h[t.estado].label}),e.jsx("span",{style:{fontSize:"10px",fontWeight:700,color:t.tipo==="proyecto"?"#2563EB":i,backgroundColor:t.tipo==="proyecto"?"#EFF6FF":"#FFF4EC",padding:"3px 8px",borderRadius:"10px"},children:t.tipo==="proyecto"?"üìã Proyecto":"üîÑ Standard"})]}),e.jsxs("div",{style:{display:"flex",gap:"20px",fontSize:"12px",color:"#6B7280",flexWrap:"wrap"},children:[e.jsxs("span",{children:["üöö ",t.carrier]}),e.jsxs("span",{children:["üìç ",t.zona]}),e.jsxs("span",{children:["üõ£ ",t.kmsEstimados," km"]}),e.jsxs("span",{children:["‚è± ",t.tiempoEstimado]}),t.frecuencia&&e.jsxs("span",{children:["üìÖ ",t.frecuencia]}),t.fechaProxima&&e.jsxs("span",{style:{color:i,fontWeight:700},children:["üìÜ Pr√≥xima: ",t.fechaProxima]})]}),t.observaciones&&e.jsxs("div",{style:{marginTop:"8px",padding:"8px 12px",backgroundColor:"#FFFBEB",borderRadius:"8px",fontSize:"12px",color:"#92400E",border:"1px solid #FDE68A"},children:["‚ö† ",t.observaciones]})]}),e.jsxs("div",{style:{display:"flex",gap:"8px",flexShrink:0},children:[e.jsx("button",{onClick:()=>w(t),style:{padding:"8px 16px",border:`1.5px solid ${i}`,borderRadius:"8px",backgroundColor:"transparent",color:i,fontSize:"12px",fontWeight:700,cursor:"pointer"},children:"Editar"}),e.jsx("button",{onClick:()=>z(t.id),style:{padding:"8px 16px",border:"none",borderRadius:"8px",backgroundColor:"#DC2626",color:"#fff",fontSize:"12px",fontWeight:700,cursor:"pointer"},children:"Eliminar"}),t.estado!=="activa"&&e.jsx("button",{style:{padding:"8px 16px",border:"none",borderRadius:"8px",backgroundColor:i,color:"#fff",fontSize:"12px",fontWeight:700,cursor:"pointer"},children:"‚ñ∂ Iniciar ruta"})]})]})}),e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"20px 24px"},children:[e.jsxs("h3",{style:{margin:"0 0 14px",fontSize:"13px",fontWeight:800,color:"#374151",textTransform:"uppercase",letterSpacing:"0.06em"},children:["Paradas (",((v=t.paradas)==null?void 0:v.length)||0,")"]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:t.paradas&&t.paradas.length>0?t.paradas.map((o,r)=>{const n=o.estado==="entregado",s=o.estado==="fallido";return e.jsxs("div",{style:{display:"flex",gap:"14px",alignItems:"flex-start"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",flexShrink:0},children:[e.jsx("div",{style:{width:"32px",height:"32px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",fontWeight:800,backgroundColor:n?"#D1FAE5":s?"#FEE2E2":`${i}18`,color:n?"#059669":s?"#DC2626":i,border:`2px solid ${n?"#A7F3D0":s?"#FCA5A5":`${i}40`}`},children:n?"‚úì":o.orden}),r<t.paradas.length-1&&e.jsx("div",{style:{width:"2px",height:"20px",backgroundColor:n?"#A7F3D0":"#E5E7EB",margin:"3px 0"}})]}),e.jsx("div",{style:{flex:1,padding:"12px 16px",borderRadius:"10px",border:"1px solid #E5E7EB",backgroundColor:n?"#F0FDF4":s?"#FFF5F5":"#fff",marginBottom:(r<t.paradas.length-1,"0")},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"13px",fontWeight:700,color:"#111",marginBottom:"3px"},children:o.direccion}),e.jsxs("div",{style:{fontSize:"11px",color:"#6B7280"},children:[o.localidad," ¬∑ ",o.envios," env√≠o",o.envios>1?"s":""]})]}),e.jsx("span",{style:{fontSize:"10px",fontWeight:700,padding:"3px 8px",borderRadius:"10px",color:n?"#059669":s?"#DC2626":"#D97706",backgroundColor:n?"#D1FAE5":s?"#FEE2E2":"#FFFBEB"},children:n?"‚úì Entregado":s?"‚úó Fallido":"‚è≥ Pendiente"})]})})]},o.id)}):e.jsx("div",{style:{padding:"20px",textAlign:"center",color:"#6B7280",fontSize:"12px"},children:"No hay paradas asignadas a esta ruta"})})]})]}):e.jsx("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",color:"#9CA3AF",fontSize:"14px"},children:"Seleccion√° una ruta para ver el detalle"})]})]})}export{Q as RutasView};
