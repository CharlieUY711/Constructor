import{s as F,r as l,j as e,f as A}from"./index-DpZjhHPo.js";import{O as D}from"./OrangeHeader-DclloVy3.js";import{M as W}from"./map-CVdGOJfe.js";import{L as I}from"./layers-D_kJuqb4.js";import{N as T}from"./navigation-CBAqhnLj.js";import"./zap-DLTL4QpT.js";import"./lightbulb-Eph2A-kA.js";import"./map-pin-CDgTiIOI.js";const E="oddy";async function L(x){let a=F.from("routes").select("*, route_stops(*, envios(id, numero, destinatario, destino, estado)), transportistas(id, nombre), vehiculos(id, patente, tipo)").eq("tenant_id",E).order("date",{ascending:!1});const{data:f,error:d}=await a;if(d)throw console.error("[rutasApi] Error obteniendo rutas:",d),new Error(d.message||"Error cargando rutas");return f||[]}async function P(x){const{error:a}=await F.from("routes").delete().eq("id",x).eq("tenant_id",E);return a?(console.error("[rutasApi] Error eliminando ruta:",a),!1):!0}const i="#FF6835",u={activa:{label:"Activa",color:"#059669",bg:"#ECFDF5"},pausada:{label:"Pausada",color:"#D97706",bg:"#FFFBEB"},planificada:{label:"Planificada",color:"#2563EB",bg:"#EFF6FF"},completada:{label:"Completada",color:"#6B7280",bg:"#F3F4F6"}};function H({onNavigate:x}){var v;const[a,f]=l.useState([]),[d,m]=l.useState(!0),[g,b]=l.useState(null),[p,C]=l.useState("todas"),[c,S]=l.useState(""),[r,h]=l.useState(null);l.useEffect(()=>{(async()=>{try{m(!0),b(null);const t=await L();f(t),t.length>0&&h(t[0])}catch(t){console.error("Error cargando rutas:",t),b(t instanceof Error?t.message:"Error cargando rutas")}finally{m(!1)}})()},[]);const j=a.filter(o=>!(p==="standard"&&o.tipo!=="standard"||p==="proyecto"&&o.tipo!=="proyecto"||c&&!o.nombre.toLowerCase().includes(c.toLowerCase())&&!o.zona.toLowerCase().includes(c.toLowerCase()))),k=a.filter(o=>o.estado==="activa").reduce((o,t)=>o+t.enviosTotales,0),B=async()=>{console.log("Crear nueva ruta")},z=async o=>{console.log("Editar ruta:",o)},R=async o=>{if(confirm("¬øEst√°s seguro de eliminar esta ruta?"))try{await P(o),f(a.filter(t=>t.id!==o)),(r==null?void 0:r.id)===o&&h(null)}catch(t){console.error("Error eliminando ruta:",t),alert("Error al eliminar la ruta")}};return e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsx(D,{icon:W,title:"Rutas de Distribuci√≥n",subtitle:d?"Cargando...":g?`Error: ${g}`:`${a.filter(o=>o.estado==="activa").length} rutas activas ¬∑ ${k} env√≠os planificados`,actions:[{label:"‚Üê Log√≠stica",onClick:()=>x("logistica")},{label:"+ Nueva Ruta",primary:!0,onClick:B}]}),e.jsxs("div",{style:{flex:1,display:"flex",overflow:"hidden",backgroundColor:"#F8F9FA"},children:[e.jsxs("div",{style:{width:"380px",flexShrink:0,display:"flex",flexDirection:"column",borderRight:"1px solid #E5E7EB",backgroundColor:"#fff"},children:[e.jsxs("div",{style:{padding:"14px 16px",borderBottom:"1px solid #E5E7EB"},children:[e.jsxs("div",{style:{position:"relative",marginBottom:"10px"},children:[e.jsx(A,{size:13,color:"#9CA3AF",style:{position:"absolute",left:"10px",top:"50%",transform:"translateY(-50%)"}}),e.jsx("input",{value:c,onChange:o=>S(o.target.value),placeholder:"Buscar ruta o zona...",style:{width:"100%",paddingLeft:"30px",paddingRight:"10px",paddingTop:"8px",paddingBottom:"8px",border:"1px solid #E5E7EB",borderRadius:"8px",fontSize:"12px",outline:"none",boxSizing:"border-box"}})]}),e.jsx("div",{style:{display:"flex",gap:"0",borderRadius:"8px",backgroundColor:"#F3F4F6",padding:"3px"},children:[["todas","Todas"],["standard","Standard"],["proyecto","Proyecto"]].map(([o,t])=>e.jsx("button",{onClick:()=>C(o),style:{flex:1,padding:"6px 4px",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"11px",fontWeight:700,backgroundColor:p===o?"#fff":"transparent",color:p===o?"#111":"#6B7280",boxShadow:p===o?"0 1px 4px rgba(0,0,0,0.08)":"none",transition:"all 0.15s"},children:t},o))})]}),e.jsx("div",{style:{flex:1,overflowY:"auto"},children:d?e.jsx("div",{style:{padding:"20px",textAlign:"center",color:"#6B7280",fontSize:"12px"},children:"Cargando rutas..."}):g?e.jsx("div",{style:{padding:"20px",textAlign:"center",color:"#DC2626",fontSize:"12px"},children:g}):j.length===0?e.jsxs("div",{style:{padding:"20px",textAlign:"center",color:"#6B7280",fontSize:"12px"},children:["No hay rutas ",c?"que coincidan con la b√∫squeda":""]}):j.map(o=>{const t=u[o.estado],s=(r==null?void 0:r.id)===o.id,n=o.paradas.filter(w=>w.estado==="entregado").length,y=Math.round(n/o.paradas.length*100);return e.jsxs("div",{onClick:()=>h(o),style:{padding:"14px 16px",borderBottom:"1px solid #F3F4F6",cursor:"pointer",backgroundColor:s?"#FFF4EC":"transparent",borderLeft:s?`3px solid ${i}`:"3px solid transparent",transition:"all 0.1s"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"10px",marginBottom:"8px"},children:[e.jsx("div",{style:{width:"32px",height:"32px",borderRadius:"8px",backgroundColor:o.tipo==="proyecto"?"#EFF6FF":"#FFF4EC",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:o.tipo==="proyecto"?e.jsx(I,{size:14,color:"#2563EB"}):e.jsx(T,{size:14,color:i})}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontSize:"12px",fontWeight:700,color:"#111",lineHeight:1.3,marginBottom:"3px"},children:o.nombre}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",flexWrap:"wrap"},children:[e.jsx("span",{style:{fontSize:"10px",fontWeight:700,color:t.color,backgroundColor:t.bg,padding:"1px 6px",borderRadius:"8px"},children:t.label}),e.jsx("span",{style:{fontSize:"10px",color:"#9CA3AF"},children:o.carrier})]})]})]}),e.jsxs("div",{style:{display:"flex",gap:"12px",fontSize:"11px",color:"#6B7280",marginBottom:"8px"},children:[e.jsxs("span",{children:["üìç ",o.paradas.length," paradas"]}),e.jsxs("span",{children:["üì¶ ",o.enviosTotales," env√≠os"]}),e.jsxs("span",{children:["üõ£ ",o.kmsEstimados," km"]})]}),e.jsx("div",{style:{width:"100%",height:"4px",backgroundColor:"#F3F4F6",borderRadius:"2px",overflow:"hidden"},children:e.jsx("div",{style:{width:`${y}%`,height:"100%",backgroundColor:y===100?"#059669":i,borderRadius:"2px",transition:"width 0.3s"}})}),e.jsxs("div",{style:{fontSize:"10px",color:"#9CA3AF",marginTop:"4px"},children:[n,"/",o.paradas.length," entregados (",y,"%)"]})]},o.id)})})]}),r?e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsx("div",{style:{backgroundColor:"#fff",padding:"20px 24px",borderBottom:"1px solid #E5E7EB",flexShrink:0},children:e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",gap:"12px"},children:[e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"6px"},children:[e.jsx("h2",{style:{margin:0,fontSize:"16px",fontWeight:800,color:"#111"},children:r.nombre}),e.jsx("span",{style:{fontSize:"10px",fontWeight:700,color:u[r.estado].color,backgroundColor:u[r.estado].bg,padding:"3px 8px",borderRadius:"10px"},children:u[r.estado].label}),e.jsx("span",{style:{fontSize:"10px",fontWeight:700,color:r.tipo==="proyecto"?"#2563EB":i,backgroundColor:r.tipo==="proyecto"?"#EFF6FF":"#FFF4EC",padding:"3px 8px",borderRadius:"10px"},children:r.tipo==="proyecto"?"üìã Proyecto":"üîÑ Standard"})]}),e.jsxs("div",{style:{display:"flex",gap:"20px",fontSize:"12px",color:"#6B7280",flexWrap:"wrap"},children:[e.jsxs("span",{children:["üöö ",r.carrier]}),e.jsxs("span",{children:["üìç ",r.zona]}),e.jsxs("span",{children:["üõ£ ",r.kmsEstimados," km"]}),e.jsxs("span",{children:["‚è± ",r.tiempoEstimado]}),r.frecuencia&&e.jsxs("span",{children:["üìÖ ",r.frecuencia]}),r.fechaProxima&&e.jsxs("span",{style:{color:i,fontWeight:700},children:["üìÜ Pr√≥xima: ",r.fechaProxima]})]}),r.observaciones&&e.jsxs("div",{style:{marginTop:"8px",padding:"8px 12px",backgroundColor:"#FFFBEB",borderRadius:"8px",fontSize:"12px",color:"#92400E",border:"1px solid #FDE68A"},children:["‚ö† ",r.observaciones]})]}),e.jsxs("div",{style:{display:"flex",gap:"8px",flexShrink:0},children:[e.jsx("button",{onClick:()=>z(r),style:{padding:"8px 16px",border:`1.5px solid ${i}`,borderRadius:"8px",backgroundColor:"transparent",color:i,fontSize:"12px",fontWeight:700,cursor:"pointer"},children:"Editar"}),e.jsx("button",{onClick:()=>R(r.id),style:{padding:"8px 16px",border:"none",borderRadius:"8px",backgroundColor:"#DC2626",color:"#fff",fontSize:"12px",fontWeight:700,cursor:"pointer"},children:"Eliminar"}),r.estado!=="activa"&&e.jsx("button",{style:{padding:"8px 16px",border:"none",borderRadius:"8px",backgroundColor:i,color:"#fff",fontSize:"12px",fontWeight:700,cursor:"pointer"},children:"‚ñ∂ Iniciar ruta"})]})]})}),e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"20px 24px"},children:[e.jsxs("h3",{style:{margin:"0 0 14px",fontSize:"13px",fontWeight:800,color:"#374151",textTransform:"uppercase",letterSpacing:"0.06em"},children:["Paradas (",((v=r.paradas)==null?void 0:v.length)||0,")"]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:r.paradas&&r.paradas.length>0?r.paradas.map((o,t)=>{const s=o.estado==="entregado",n=o.estado==="fallido";return e.jsxs("div",{style:{display:"flex",gap:"14px",alignItems:"flex-start"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",flexShrink:0},children:[e.jsx("div",{style:{width:"32px",height:"32px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",fontWeight:800,backgroundColor:s?"#D1FAE5":n?"#FEE2E2":`${i}18`,color:s?"#059669":n?"#DC2626":i,border:`2px solid ${s?"#A7F3D0":n?"#FCA5A5":`${i}40`}`},children:s?"‚úì":o.orden}),t<r.paradas.length-1&&e.jsx("div",{style:{width:"2px",height:"20px",backgroundColor:s?"#A7F3D0":"#E5E7EB",margin:"3px 0"}})]}),e.jsx("div",{style:{flex:1,padding:"12px 16px",borderRadius:"10px",border:"1px solid #E5E7EB",backgroundColor:s?"#F0FDF4":n?"#FFF5F5":"#fff",marginBottom:(t<r.paradas.length-1,"0")},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"13px",fontWeight:700,color:"#111",marginBottom:"3px"},children:o.direccion}),e.jsxs("div",{style:{fontSize:"11px",color:"#6B7280"},children:[o.localidad," ¬∑ ",o.envios," env√≠o",o.envios>1?"s":""]})]}),e.jsx("span",{style:{fontSize:"10px",fontWeight:700,padding:"3px 8px",borderRadius:"10px",color:s?"#059669":n?"#DC2626":"#D97706",backgroundColor:s?"#D1FAE5":n?"#FEE2E2":"#FFFBEB"},children:s?"‚úì Entregado":n?"‚úó Fallido":"‚è≥ Pendiente"})]})})]},o.id)}):e.jsx("div",{style:{padding:"20px",textAlign:"center",color:"#6B7280",fontSize:"12px"},children:"No hay paradas asignadas a esta ruta"})})]})]}):e.jsx("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",color:"#9CA3AF",fontSize:"14px"},children:"Seleccion√° una ruta para ver el detalle"})]})]})}export{H as RutasView};
