import{s as k,r as d,t as f,j as e,S as T,T as pe,g as N,R as De,P as Pe,f as Re}from"./index-DnFAImgt.js";import{O as We}from"./OrangeHeader-DJJ7prMK.js";import{g as Te}from"./personasApi-X8waBNMK.js";import{g as Ie}from"./organizacionesApi-DBQG6vwM.js";import{g as $e}from"./metodosPagoApi-xbjV91ak.js";import{g as Le}from"./metodosEnvioApi-ZYwVwIaI.js";import{C as ge}from"./clock-BQBIX4Fm.js";import{D as Ne}from"./dollar-sign-BPkp_j86.js";import{R as Oe}from"./rotate-ccw-qEkLT94S.js";import{C as Ue}from"./circle-x-DzR_FMqc.js";import{C as Ye}from"./chevron-right-DsZY4Jnb.js";import{R as xe}from"./refresh-cw-D7tOdR_P.js";import{U as ie}from"./user-iFRSWdUX.js";import{B as Me}from"./building-2-BKUEcrmW.js";import{E as Ge}from"./eye-C4P8xx5L.js";import{X as ne}from"./x-CDf_6lBE.js";import{C as He}from"./credit-card-CHc_PaSi.js";import{M as qe}from"./map-pin-Cevzqbvu.js";import{F as Xe}from"./file-text-DlJgVlZs.js";import{P as Ke}from"./plus-g4SE1FaL.js";import{T as Ve}from"./trash-2-HVQG-INa.js";import{S as Je}from"./save-fljajWrO.js";import"./ConnectionStatusIcon-DptUcDR6.js";import"./zap-BhzBy_ra.js";import"./lightbulb-QtUPcbhG.js";async function Qe(l){let n=k.from("pedidos").select("*, cliente_persona:personas(id, nombre, apellido, email, telefono), cliente_org:organizaciones(id, nombre, tipo), metodo_pago:metodos_pago(id, nombre, tipo, proveedor), metodo_envio:metodos_envio(id, nombre, tipo, precio)");l!=null&&l.estado&&(n=n.eq("estado",l.estado)),l!=null&&l.estado_pago&&(n=n.eq("estado_pago",l.estado_pago)),l!=null&&l.search&&(n=n.or(`numero_pedido.ilike.%${l.search}%,notas.ilike.%${l.search}%`));const{data:c,error:p}=await n.order("created_at",{ascending:!1});if(p)throw console.error("[pedidosApi] Error obteniendo pedidos:",p),new Error(p.message||"Error cargando pedidos");return c||[]}async function Ze(l){const{data:n,error:c}=await k.from("pedidos").insert(l).select().single();if(c)throw console.error("[pedidosApi] Error creando pedido:",c),new Error(c.message||"Error creando pedido");return n}async function eo(l,n){const{data:c,error:p}=await k.from("pedidos").update({estado:n,updated_at:new Date().toISOString()}).eq("id",l).select().single();if(p)throw console.error("[pedidosApi] Error actualizando estado del pedido:",p),new Error(p.message||"Error actualizando estado del pedido");return c}async function oo(l,n){const{data:c,error:p}=await k.from("pedidos").update({estado_pago:n,updated_at:new Date().toISOString()}).eq("id",l).select().single();if(p)throw console.error("[pedidosApi] Error actualizando estado de pago:",p),new Error(p.message||"Error actualizando estado de pago");return c}const b="#FF6835",y={pendiente:{label:"Pendiente",color:"#D97706",bg:"#FEF3C7",icon:ge},confirmado:{label:"Confirmado",color:"#2563EB",bg:"#EFF6FF",icon:N},en_preparacion:{label:"En preparación",color:"#7C3AED",bg:"#F5F3FF",icon:Pe},enviado:{label:"Enviado",color:"#0891B2",bg:"#ECFEFF",icon:pe},entregado:{label:"Entregado",color:"#059669",bg:"#D1FAE5",icon:N},cancelado:{label:"Cancelado",color:"#DC2626",bg:"#FEE2E2",icon:Ue},devuelto:{label:"Devuelto",color:"#6B7280",bg:"#F3F4F6",icon:Oe}},j={pendiente:{label:"Pago pendiente",color:"#D97706",bg:"#FEF3C7"},pagado:{label:"Pagado",color:"#059669",bg:"#D1FAE5"},parcial:{label:"Parcial",color:"#7C3AED",bg:"#F5F3FF"},fallido:{label:"Fallido",color:"#DC2626",bg:"#FEE2E2"},reembolsado:{label:"Reembolsado",color:"#6B7280",bg:"#F3F4F6"}},le={pendiente:["confirmado","cancelado"],confirmado:["en_preparacion","cancelado"],en_preparacion:["enviado","cancelado"],enviado:["entregado","cancelado"],entregado:["devuelto"],cancelado:[],devuelto:[]},I=["pendiente","confirmado","en_preparacion","enviado","entregado"];function Po({onNavigate:l}){var X,K,V,J,Q,Z,ee,oe,te,re;const[n,c]=d.useState([]),[p,O]=d.useState(!0),[A,ue]=d.useState(""),[u,U]=d.useState(""),[D,he]=d.useState(""),[me,fe]=d.useState([]),[be,ye]=d.useState([]),[je,ve]=d.useState([]),[Ee,Ce]=d.useState([]),[r,C]=d.useState(null),[Se,S]=d.useState(!1),[P,Y]=d.useState(!1),M=()=>({cliente_persona_id:"",cliente_org_id:"",metodo_pago_id:"",metodo_envio_id:"",descuento:0,impuestos:0,notas:"",direccion_envio:{calle:"",ciudad:"",departamento:"",pais:"Uruguay",cp:""},items:[{nombre:"",cantidad:1,precio_unitario:0,subtotal:0}]}),[a,g]=d.useState(M()),E=d.useCallback(async()=>{O(!0);try{const o=await Qe({estado:u||void 0,estado_pago:D||void 0,search:A||void 0});c(o)}catch(o){console.error("Error cargando pedidos:",o),f.error("Error al cargar pedidos")}finally{O(!1)}},[u,D,A]),Fe=d.useCallback(async()=>{try{const[o,t,i,s]=await Promise.all([Te({activo:!0}),Ie({activo:!0}),$e({activo:!0}),Le({activo:!0})]);fe(o),ye(t),ve(i),Ce(s)}catch(o){console.error("Error cargando opciones:",o)}},[]);d.useEffect(()=>{E()},[E]);const F=d.useMemo(()=>{const o=n.length,t=n.filter(h=>h.estado==="pendiente").length,i=n.filter(h=>["confirmado","en_preparacion","enviado"].includes(h.estado)).length,s=n.filter(h=>h.estado==="entregado").length,x=n.reduce((h,_)=>h+(_.total??0),0);return{total:o,pendiente:t,enCurso:i,entregado:s,facturado:x}},[n]),_e=d.useMemo(()=>I.reduce((o,t)=>({...o,[t]:n.filter(i=>i.estado===t).length}),{}),[n]),R=(o,t,i)=>{g(s=>{const x=[...s.items];return x[o]={...x[o],[t]:i},(t==="cantidad"||t==="precio_unitario")&&(x[o].subtotal=x[o].cantidad*x[o].precio_unitario),{...s,items:x}})},we=()=>g(o=>({...o,items:[...o.items,{nombre:"",cantidad:1,precio_unitario:0,subtotal:0}]})),ze=o=>g(t=>({...t,items:t.items.filter((i,s)=>s!==o)})),G=a.items.reduce((o,t)=>o+t.subtotal,0),H=G-a.descuento+a.impuestos,Be=async()=>{if(!a.cliente_persona_id&&!a.cliente_org_id){f.error("Seleccioná un cliente");return}if(a.items.some(o=>!o.nombre)){f.error("Todos los ítems deben tener nombre");return}Y(!0);try{const o={...a,cliente_persona_id:a.cliente_persona_id||null,cliente_org_id:a.cliente_org_id||null,metodo_pago_id:a.metodo_pago_id||null,metodo_envio_id:a.metodo_envio_id||null,subtotal:G,total:H,items:a.items},t=await Ze(o);if(!t)throw new Error("No se pudo crear el pedido");f.success(`Pedido ${t.numero_pedido} creado`),S(!1),E()}catch(o){console.error("Error creando pedido:",o),f.error(`Error: ${o instanceof Error?o.message:o}`)}finally{Y(!1)}},ke=async(o,t)=>{var i;try{if(!await eo(o.id,t))throw new Error("No se pudo actualizar el estado");f.success(`Pedido → ${(i=y[t])==null?void 0:i.label}`),E(),(r==null?void 0:r.id)===o.id&&C({...r,estado:t})}catch(s){f.error(`Error: ${s instanceof Error?s.message:s}`)}},Ae=async(o,t)=>{var i;try{if(!await oo(o.id,t))throw new Error("No se pudo actualizar el estado de pago");f.success(`Pago → ${(i=j[t])==null?void 0:i.label}`),E(),(r==null?void 0:r.id)===o.id&&C({...r,estado_pago:t})}catch(s){f.error(`Error: ${s instanceof Error?s.message:s}`)}},q=o=>o.cliente_persona?`${o.cliente_persona.nombre} ${o.cliente_persona.apellido??""}`.trim():o.cliente_org?o.cliente_org.nombre:"—";return e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100vh",overflow:"hidden"},children:[e.jsx(We,{icon:T,title:"Pedidos",subtitle:"Gestión de órdenes, estados y pagos",actions:[{label:"+ Nuevo Pedido",primary:!0,onClick:()=>{Fe(),g(M()),S(!0)}}]}),e.jsx("div",{style:{padding:"14px 28px",backgroundColor:"#fff",borderBottom:"1px solid #E5E7EB",display:"flex",gap:12,flexWrap:"wrap"},children:[{label:"Total pedidos",value:F.total,icon:T,color:b},{label:"Pendientes",value:F.pendiente,icon:ge,color:"#D97706"},{label:"En curso",value:F.enCurso,icon:pe,color:"#2563EB"},{label:"Entregados",value:F.entregado,icon:N,color:"#059669"},{label:"Facturado",value:`$${F.facturado.toLocaleString("es-UY")}`,icon:Ne,color:"#7C3AED"}].map(o=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,padding:"8px 14px",backgroundColor:"#F9FAFB",borderRadius:10,border:"1px solid #E5E7EB"},children:[e.jsx("div",{style:{width:34,height:34,borderRadius:8,backgroundColor:o.color+"18",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(o.icon,{size:16,color:o.color})}),e.jsxs("div",{children:[e.jsx("p",{style:{margin:0,fontSize:"1.1rem",fontWeight:800,color:"#111827",lineHeight:1},children:o.value}),e.jsx("p",{style:{margin:0,fontSize:"0.7rem",color:"#6B7280"},children:o.label})]})]},o.label))}),e.jsxs("div",{style:{padding:"12px 28px",backgroundColor:"#FAFAFA",borderBottom:"1px solid #E5E7EB",display:"flex",gap:8,alignItems:"center",overflowX:"auto"},children:[I.map((o,t)=>{const i=y[o],s=_e[o]??0;return e.jsxs(De.Fragment,{children:[e.jsxs("button",{onClick:()=>U(u===o?"":o),style:{display:"flex",alignItems:"center",gap:7,padding:"6px 14px",borderRadius:20,border:"1.5px solid",borderColor:u===o?i.color:"#E5E7EB",backgroundColor:u===o?i.bg:"#fff",color:i.color,cursor:"pointer",whiteSpace:"nowrap",fontWeight:u===o?700:500,fontSize:"0.8rem",transition:"all 0.15s"},children:[e.jsx(i.icon,{size:13}),i.label,e.jsx("span",{style:{fontWeight:800,fontSize:"0.85rem"},children:s})]}),t<I.length-1&&e.jsx(Ye,{size:14,color:"#D1D5DB",style:{flexShrink:0}})]},o)}),e.jsx("div",{style:{width:1,height:24,backgroundColor:"#E5E7EB",margin:"0 4px"}}),["cancelado","devuelto"].map(o=>{const t=y[o],i=n.filter(s=>s.estado===o).length;return e.jsxs("button",{onClick:()=>U(u===o?"":o),style:{display:"flex",alignItems:"center",gap:7,padding:"6px 14px",borderRadius:20,border:"1.5px solid",borderColor:u===o?t.color:"#E5E7EB",backgroundColor:u===o?t.bg:"#fff",color:t.color,cursor:"pointer",whiteSpace:"nowrap",fontWeight:u===o?700:500,fontSize:"0.8rem"},children:[e.jsx(t.icon,{size:13}),t.label," ",i>0&&e.jsx("span",{style:{fontWeight:800},children:i})]},o)})]}),e.jsxs("div",{style:{padding:"10px 28px",backgroundColor:"#fff",borderBottom:"1px solid #E5E7EB",display:"flex",gap:10,alignItems:"center"},children:[e.jsxs("div",{style:{position:"relative",flex:1,minWidth:200},children:[e.jsx(Re,{size:14,style:{position:"absolute",left:10,top:"50%",transform:"translateY(-50%)",color:"#9CA3AF"}}),e.jsx("input",{value:A,onChange:o=>ue(o.target.value),onKeyDown:o=>o.key==="Enter"&&E(),placeholder:"Buscar por nº de pedido…",style:{width:"100%",paddingLeft:30,paddingRight:12,height:34,border:"1.5px solid #E5E7EB",borderRadius:8,fontSize:"0.84rem",outline:"none",boxSizing:"border-box"}})]}),e.jsxs("select",{value:D,onChange:o=>he(o.target.value),style:io,children:[e.jsx("option",{value:"",children:"Todos los pagos"}),Object.entries(j).map(([o,t])=>e.jsx("option",{value:o,children:t.label},o))]}),e.jsx("button",{onClick:E,style:{height:34,width:34,border:"1.5px solid #E5E7EB",borderRadius:8,background:"#fff",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(xe,{size:14,color:"#6B7280"})})]}),e.jsx("div",{style:{flex:1,overflow:"auto",padding:"20px 28px"},children:p?e.jsx(to,{text:"Cargando pedidos…"}):n.length===0?e.jsx(ro,{icon:T,title:"No hay pedidos aún",sub:'Creá el primero con "+ Nuevo Pedido"'}):e.jsx("div",{style:{backgroundColor:"#fff",borderRadius:12,border:"1px solid #E5E7EB",overflow:"hidden"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"0.875rem"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{backgroundColor:"#F9FAFB",borderBottom:"1px solid #E5E7EB"},children:["N° Pedido","Cliente","Items","Total","Estado","Pago","Fecha",""].map(o=>e.jsx("th",{style:{padding:"11px 14px",textAlign:"left",fontWeight:600,color:"#374151",whiteSpace:"nowrap",fontSize:"0.8rem"},children:o},o))})}),e.jsx("tbody",{children:n.map((o,t)=>{var x,h,_;const i=y[o.estado]??y.pendiente,s=j[o.estado_pago]??j.pendiente;return e.jsxs("tr",{style:{borderBottom:t<n.length-1?"1px solid #F3F4F6":"none",cursor:"pointer"},onMouseEnter:W=>W.currentTarget.style.backgroundColor="#FAFAFA",onMouseLeave:W=>W.currentTarget.style.backgroundColor="",onClick:()=>C(o),children:[e.jsx("td",{style:{padding:"12px 14px"},children:e.jsx("span",{style:{fontWeight:700,color:b,fontSize:"0.84rem",fontFamily:"monospace"},children:o.numero_pedido})}),e.jsx("td",{style:{padding:"12px 14px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("div",{style:{width:30,height:30,borderRadius:"50%",backgroundColor:o.cliente_persona?"#FFF7ED":"#EDE9FE",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:o.cliente_persona?e.jsx(ie,{size:14,color:b}):e.jsx(Me,{size:14,color:"#8B5CF6"})}),e.jsxs("div",{children:[e.jsx("p",{style:{margin:0,fontWeight:600,color:"#111827",fontSize:"0.84rem"},children:q(o)}),((x=o.cliente_persona)==null?void 0:x.email)&&e.jsx("p",{style:{margin:0,fontSize:"0.72rem",color:"#9CA3AF"},children:o.cliente_persona.email})]})]})}),e.jsxs("td",{style:{padding:"12px 14px",color:"#6B7280",fontSize:"0.8rem"},children:[((h=o.items)==null?void 0:h.length)??0," ítem",(((_=o.items)==null?void 0:_.length)??0)!==1?"s":""]}),e.jsx("td",{style:{padding:"12px 14px"},children:e.jsxs("span",{style:{fontWeight:700,color:"#111827",fontSize:"0.9rem"},children:["$",(o.total??0).toLocaleString("es-UY")]})}),e.jsx("td",{style:{padding:"12px 14px"},children:e.jsx("span",{style:{fontSize:"0.76rem",fontWeight:700,backgroundColor:i.bg,color:i.color,padding:"3px 10px",borderRadius:20,whiteSpace:"nowrap"},children:i.label})}),e.jsx("td",{style:{padding:"12px 14px"},children:e.jsx("span",{style:{fontSize:"0.76rem",fontWeight:600,backgroundColor:s.bg,color:s.color,padding:"3px 10px",borderRadius:20,whiteSpace:"nowrap"},children:s.label})}),e.jsx("td",{style:{padding:"12px 14px",color:"#9CA3AF",fontSize:"0.78rem",whiteSpace:"nowrap"},children:new Date(o.created_at).toLocaleDateString("es-UY")}),e.jsx("td",{style:{padding:"12px 14px"},children:e.jsx("div",{style:{width:28,height:28,borderRadius:6,backgroundColor:"#F3F4F6",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Ge,{size:13,color:"#6B7280"})})})]},o.id)})})]})})}),r&&e.jsx("div",{style:se,onClick:()=>C(null),children:e.jsxs("div",{style:{...ae,maxWidth:680},onClick:o=>o.stopPropagation(),children:[e.jsxs("div",{style:de,children:[e.jsxs("div",{children:[e.jsxs("h2",{style:{margin:0,fontSize:"1.05rem",fontWeight:700,color:"#111827"},children:["Pedido ",e.jsx("span",{style:{color:b,fontFamily:"monospace"},children:r.numero_pedido})]}),e.jsx("p",{style:{margin:"2px 0 0",fontSize:"0.76rem",color:"#9CA3AF"},children:new Date(r.created_at).toLocaleString("es-UY")})]}),e.jsx("button",{onClick:()=>C(null),style:ce,children:e.jsx(ne,{size:18})})]}),e.jsxs("div",{style:{padding:"20px 24px",overflowY:"auto",maxHeight:"calc(90vh - 140px)",display:"flex",flexDirection:"column",gap:20},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16},children:[e.jsxs("div",{style:{padding:14,backgroundColor:"#F9FAFB",borderRadius:10,border:"1px solid #E5E7EB"},children:[e.jsx("p",{style:$,children:"Estado del pedido"}),e.jsxs("div",{style:{display:"flex",gap:6,flexWrap:"wrap",marginTop:8},children:[(le[r.estado]??[]).map(o=>{const t=y[o];return e.jsxs("button",{onClick:()=>ke(r,o),style:{padding:"5px 12px",borderRadius:8,border:`1.5px solid ${t.color}`,backgroundColor:t.bg,color:t.color,cursor:"pointer",fontSize:"0.78rem",fontWeight:700},children:["→ ",t.label]},o)}),(le[r.estado]??[]).length===0&&e.jsx("span",{style:{fontSize:"0.78rem",color:"#9CA3AF"},children:"Sin transiciones disponibles"})]}),e.jsx("div",{style:{marginTop:8},children:e.jsxs("span",{style:{fontSize:"0.8rem",fontWeight:700,backgroundColor:(X=y[r.estado])==null?void 0:X.bg,color:(K=y[r.estado])==null?void 0:K.color,padding:"3px 10px",borderRadius:20},children:["Actual: ",(V=y[r.estado])==null?void 0:V.label]})})]}),e.jsxs("div",{style:{padding:14,backgroundColor:"#F9FAFB",borderRadius:10,border:"1px solid #E5E7EB"},children:[e.jsx("p",{style:$,children:"Estado de pago"}),e.jsx("div",{style:{display:"flex",gap:6,flexWrap:"wrap",marginTop:8},children:Object.keys(j).filter(o=>o!==r.estado_pago).map(o=>{const t=j[o];return e.jsx("button",{onClick:()=>Ae(r,o),style:{padding:"5px 12px",borderRadius:8,border:`1.5px solid ${t.color}`,backgroundColor:t.bg,color:t.color,cursor:"pointer",fontSize:"0.78rem",fontWeight:600},children:t.label},o)})}),e.jsx("div",{style:{marginTop:8},children:e.jsxs("span",{style:{fontSize:"0.8rem",fontWeight:700,backgroundColor:(J=j[r.estado_pago])==null?void 0:J.bg,color:(Q=j[r.estado_pago])==null?void 0:Q.color,padding:"3px 10px",borderRadius:20},children:["Actual: ",(Z=j[r.estado_pago])==null?void 0:Z.label]})})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16},children:[e.jsxs(w,{icon:ie,label:"Cliente",color:"#3B82F6",children:[e.jsx("p",{style:z,children:q(r)}),((ee=r.cliente_persona)==null?void 0:ee.email)&&e.jsx("p",{style:L,children:r.cliente_persona.email}),((oe=r.cliente_org)==null?void 0:oe.tipo)&&e.jsx("p",{style:L,children:r.cliente_org.tipo})]}),e.jsxs(w,{icon:He,label:"Pago / Envío",color:"#8B5CF6",children:[e.jsx("p",{style:z,children:((te=r.metodo_pago)==null?void 0:te.nombre)??e.jsx("span",{style:{color:"#D1D5DB"},children:"Sin método de pago"})}),e.jsx("p",{style:L,children:((re=r.metodo_envio)==null?void 0:re.nombre)??"Sin método de envío"})]})]}),r.direccion_envio&&Object.values(r.direccion_envio).some(o=>o)&&e.jsx(w,{icon:qe,label:"Dirección de envío",color:"#059669",children:e.jsx("p",{style:z,children:[r.direccion_envio.calle,r.direccion_envio.ciudad,r.direccion_envio.departamento,r.direccion_envio.pais].filter(Boolean).join(", ")})}),e.jsxs("div",{children:[e.jsx("p",{style:$,children:"Ítems del pedido"}),e.jsx("div",{style:{backgroundColor:"#F9FAFB",borderRadius:10,border:"1px solid #E5E7EB",overflow:"hidden",marginTop:8},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"0.84rem"},children:[e.jsx("thead",{children:e.jsx("tr",{style:{borderBottom:"1px solid #E5E7EB"},children:["Producto","Cant.","Precio unit.","Subtotal"].map(o=>e.jsx("th",{style:{padding:"8px 12px",textAlign:"left",fontWeight:600,color:"#374151",fontSize:"0.76rem"},children:o},o))})}),e.jsx("tbody",{children:(r.items??[]).map((o,t)=>{var i;return e.jsxs("tr",{style:{borderBottom:t<(((i=r.items)==null?void 0:i.length)??0)-1?"1px solid #F3F4F6":"none"},children:[e.jsx("td",{style:{padding:"8px 12px",color:"#111827",fontWeight:500},children:o.nombre}),e.jsx("td",{style:{padding:"8px 12px",color:"#6B7280"},children:o.cantidad}),e.jsxs("td",{style:{padding:"8px 12px",color:"#6B7280"},children:["$",(o.precio_unitario??0).toLocaleString("es-UY")]}),e.jsxs("td",{style:{padding:"8px 12px",fontWeight:700,color:"#111827"},children:["$",(o.subtotal??0).toLocaleString("es-UY")]})]},t)})})]})})]}),e.jsxs("div",{style:{backgroundColor:"#F9FAFB",borderRadius:10,border:"1px solid #E5E7EB",padding:"14px 16px"},children:[[{label:"Subtotal",value:r.subtotal??0,bold:!1},{label:"Descuento",value:-(r.descuento??0),bold:!1,color:"#059669"},{label:"Impuestos",value:r.impuestos??0,bold:!1}].map(o=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:6,fontSize:"0.84rem",color:o.color??"#6B7280"},children:[e.jsx("span",{children:o.label}),e.jsxs("span",{children:["$",o.value.toLocaleString("es-UY")]})]},o.label)),e.jsxs("div",{style:{borderTop:"1px solid #E5E7EB",paddingTop:8,marginTop:4,display:"flex",justifyContent:"space-between",fontWeight:800,fontSize:"1rem",color:"#111827"},children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{style:{color:b},children:["$",(r.total??0).toLocaleString("es-UY")]})]})]}),r.notas&&e.jsx(w,{icon:Xe,label:"Notas",color:"#6B7280",children:e.jsx("p",{style:z,children:r.notas})})]})]})}),Se&&e.jsx("div",{style:se,onClick:()=>S(!1),children:e.jsxs("div",{style:{...ae,maxWidth:660},onClick:o=>o.stopPropagation(),children:[e.jsxs("div",{style:de,children:[e.jsxs("div",{children:[e.jsx("h2",{style:{margin:0,fontSize:"1.05rem",fontWeight:700,color:"#111827"},children:"Nuevo Pedido"}),e.jsx("p",{style:{margin:"2px 0 0",fontSize:"0.76rem",color:"#9CA3AF"},children:"Completá los datos del pedido"})]}),e.jsx("button",{onClick:()=>S(!1),style:ce,children:e.jsx(ne,{size:18})})]}),e.jsxs("div",{style:{padding:"20px 24px",overflowY:"auto",maxHeight:"calc(90vh - 140px)",display:"flex",flexDirection:"column",gap:16},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[e.jsxs("div",{children:[e.jsx("label",{style:v,children:"Persona cliente"}),e.jsxs("select",{value:a.cliente_persona_id,onChange:o=>g(t=>({...t,cliente_persona_id:o.target.value})),style:B,children:[e.jsx("option",{value:"",children:"— Sin persona —"}),me.map(o=>e.jsxs("option",{value:o.id,children:[o.nombre," ",o.apellido??""]},o.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{style:v,children:"Organización cliente"}),e.jsxs("select",{value:a.cliente_org_id,onChange:o=>g(t=>({...t,cliente_org_id:o.target.value})),style:B,children:[e.jsx("option",{value:"",children:"— Sin organización —"}),be.map(o=>e.jsx("option",{value:o.id,children:o.nombre},o.id))]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[e.jsxs("div",{children:[e.jsx("label",{style:v,children:"Método de pago"}),e.jsxs("select",{value:a.metodo_pago_id,onChange:o=>g(t=>({...t,metodo_pago_id:o.target.value})),style:B,children:[e.jsx("option",{value:"",children:"— Sin método —"}),je.map(o=>e.jsx("option",{value:o.id,children:o.nombre},o.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{style:v,children:"Método de envío"}),e.jsxs("select",{value:a.metodo_envio_id,onChange:o=>g(t=>({...t,metodo_envio_id:o.target.value})),style:B,children:[e.jsx("option",{value:"",children:"— Sin envío —"}),Ee.map(o=>e.jsxs("option",{value:o.id,children:[o.nombre," ($",o.precio,")"]},o.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:v,children:"Dirección de envío"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr",gap:8},children:[e.jsx("input",{value:a.direccion_envio.calle,onChange:o=>g(t=>({...t,direccion_envio:{...t.direccion_envio,calle:o.target.value}})),style:m,placeholder:"Calle y número"}),e.jsx("input",{value:a.direccion_envio.cp,onChange:o=>g(t=>({...t,direccion_envio:{...t.direccion_envio,cp:o.target.value}})),style:m,placeholder:"CP"}),e.jsx("input",{value:a.direccion_envio.ciudad,onChange:o=>g(t=>({...t,direccion_envio:{...t.direccion_envio,ciudad:o.target.value}})),style:m,placeholder:"Ciudad"}),e.jsx("input",{value:a.direccion_envio.departamento,onChange:o=>g(t=>({...t,direccion_envio:{...t.direccion_envio,departamento:o.target.value}})),style:m,placeholder:"Departamento"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[e.jsx("label",{style:v,children:"Ítems del pedido *"}),e.jsxs("button",{onClick:we,style:{display:"flex",alignItems:"center",gap:4,padding:"4px 10px",borderRadius:6,border:`1.5px solid ${b}`,background:"#FFF7ED",color:b,cursor:"pointer",fontSize:"0.78rem",fontWeight:600},children:[e.jsx(Ke,{size:13})," Agregar ítem"]})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:a.items.map((o,t)=>e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr auto",gap:8,alignItems:"center"},children:[e.jsx("input",{value:o.nombre,onChange:i=>R(t,"nombre",i.target.value),style:m,placeholder:"Nombre del producto"}),e.jsx("input",{type:"number",value:o.cantidad,onChange:i=>R(t,"cantidad",parseFloat(i.target.value)||0),style:m,placeholder:"Cant.",min:1}),e.jsx("input",{type:"number",value:o.precio_unitario,onChange:i=>R(t,"precio_unitario",parseFloat(i.target.value)||0),style:m,placeholder:"Precio",min:0}),e.jsx("button",{onClick:()=>ze(t),style:{width:32,height:32,borderRadius:6,border:"1.5px solid #FEE2E2",background:"#FFF5F5",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Ve,{size:13,color:"#DC2626"})})]},t))})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[e.jsxs("div",{children:[e.jsx("label",{style:v,children:"Descuento ($)"}),e.jsx("input",{type:"number",value:a.descuento,onChange:o=>g(t=>({...t,descuento:parseFloat(o.target.value)||0})),style:m,min:0})]}),e.jsxs("div",{children:[e.jsx("label",{style:v,children:"Impuestos ($)"}),e.jsx("input",{type:"number",value:a.impuestos,onChange:o=>g(t=>({...t,impuestos:parseFloat(o.target.value)||0})),style:m,min:0})]})]}),e.jsxs("div",{style:{backgroundColor:"#FFF7ED",borderRadius:10,border:`1.5px solid ${b}30`,padding:"12px 16px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{style:{fontSize:"0.875rem",color:"#92400E",fontWeight:600},children:"Total del pedido"}),e.jsxs("span",{style:{fontSize:"1.25rem",fontWeight:900,color:b},children:["$",H.toLocaleString("es-UY")]})]}),e.jsxs("div",{children:[e.jsx("label",{style:v,children:"Notas internas"}),e.jsx("textarea",{value:a.notas,onChange:o=>g(t=>({...t,notas:o.target.value})),style:{...m,height:72,paddingTop:8,resize:"vertical"},placeholder:"Observaciones, instrucciones especiales…"})]})]}),e.jsxs("div",{style:{padding:"14px 24px",borderTop:"1px solid #E5E7EB",display:"flex",justifyContent:"flex-end",gap:10},children:[e.jsx("button",{onClick:()=>S(!1),style:no,children:"Cancelar"}),e.jsxs("button",{onClick:Be,disabled:P,style:{...lo,opacity:P?.7:1},children:[e.jsx(Je,{size:14})," ",P?"Guardando…":"Crear pedido"]})]})]})}),e.jsx("style",{children:"@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }"})]})}function to({text:l}){return e.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:200,color:"#9CA3AF"},children:[e.jsx(xe,{size:18,style:{animation:"spin 1s linear infinite",marginRight:8}})," ",l]})}function ro({icon:l,title:n,sub:c}){return e.jsxs("div",{style:{textAlign:"center",padding:"60px 0",color:"#9CA3AF"},children:[e.jsx(l,{size:44,style:{marginBottom:12,opacity:.25}}),e.jsx("p",{style:{fontSize:"1rem",fontWeight:600,margin:0},children:n}),e.jsx("p",{style:{fontSize:"0.875rem",marginTop:6},children:c})]})}function w({icon:l,label:n,color:c,children:p}){return e.jsxs("div",{style:{padding:14,backgroundColor:"#F9FAFB",borderRadius:10,border:"1px solid #E5E7EB"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,marginBottom:6},children:[e.jsx("div",{style:{width:22,height:22,borderRadius:5,backgroundColor:c+"20",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(l,{size:12,color:c})}),e.jsx("p",{style:{margin:0,fontSize:"0.72rem",fontWeight:700,color:"#9CA3AF",textTransform:"uppercase",letterSpacing:"0.06em"},children:n})]}),p]})}const se={position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center",padding:20},ae={backgroundColor:"#fff",borderRadius:16,width:"100%",boxShadow:"0 20px 60px rgba(0,0,0,0.25)",maxHeight:"90vh",display:"flex",flexDirection:"column"},de={padding:"18px 24px",borderBottom:"1px solid #E5E7EB",display:"flex",alignItems:"flex-start",justifyContent:"space-between",flexShrink:0},ce={background:"none",border:"none",cursor:"pointer",color:"#9CA3AF",padding:4},$={margin:0,fontSize:"0.72rem",fontWeight:700,color:"#9CA3AF",textTransform:"uppercase",letterSpacing:"0.06em"},z={margin:0,fontSize:"0.875rem",fontWeight:600,color:"#111827"},L={margin:"2px 0 0",fontSize:"0.76rem",color:"#6B7280"},v={display:"block",fontSize:"0.8rem",fontWeight:600,color:"#374151",marginBottom:5},m={width:"100%",height:36,border:"1.5px solid #E5E7EB",borderRadius:8,padding:"0 10px",fontSize:"0.84rem",color:"#111827",outline:"none",boxSizing:"border-box"},io={height:34,border:"1.5px solid #E5E7EB",borderRadius:8,padding:"0 10px",fontSize:"0.84rem",color:"#374151",cursor:"pointer",backgroundColor:"#fff"},B={width:"100%",height:36,border:"1.5px solid #E5E7EB",borderRadius:8,padding:"0 10px",fontSize:"0.84rem",color:"#374151",cursor:"pointer",outline:"none",boxSizing:"border-box"},no={padding:"9px 20px",borderRadius:8,border:"1.5px solid #E5E7EB",background:"#fff",cursor:"pointer",fontSize:"0.875rem",fontWeight:600,color:"#374151"},lo={padding:"9px 22px",borderRadius:8,border:"none",backgroundColor:"#FF6835",color:"#fff",cursor:"pointer",fontSize:"0.875rem",fontWeight:700,display:"flex",alignItems:"center",gap:6};export{Po as PedidosView};
