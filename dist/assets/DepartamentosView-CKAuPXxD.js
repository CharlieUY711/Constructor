import{c as X,s as B,r as i,j as e}from"./index-D8gJryvN.js";import{O as K}from"./OrangeHeader-CD_39fGA.js";import{F as Q}from"./folder-tree-CcvUjCXC.js";import{S as Z}from"./shield-check-BfPiZmN6.js";import{T as _}from"./triangle-alert-BhnVGdkY.js";import{P as G}from"./plus-B8VvAZH3.js";import{D as ee}from"./download-BCxAkLVc.js";import{R as oe}from"./refresh-cw-BBXjw0yc.js";import{L as D}from"./loader-circle-bsIAMbtG.js";import{X as L}from"./x-CLz9r_6i.js";import{C as O}from"./check-DEYrz3IC.js";import{C as q}from"./chevron-down-P8DIozcF.js";import{C as V}from"./chevron-right-CsAaBlXb.js";import{P as T}from"./pen-Cvt_fsHe.js";import{T as re}from"./trash-2-DSvNgW5p.js";import"./ConnectionStatusIcon-D1UUScUD.js";import"./zap-DVZ7QpUM.js";import"./lightbulb-Baf-YTXC.js";import"./map-pin-C0eCdOxB.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m21.7 16.4-.9-.3",key:"12j9ji"}],["path",{d:"m15.2 13.9-.9-.3",key:"1fdjdi"}],["path",{d:"m16.6 18.7.3-.9",key:"heedtr"}],["path",{d:"m19.1 12.2.3-.9",key:"1af3ki"}],["path",{d:"m19.6 18.7-.4-1",key:"1x9vze"}],["path",{d:"m16.8 12.3-.4-1",key:"vqeiwj"}],["path",{d:"m14.3 16.6 1-.4",key:"1qlj63"}],["path",{d:"m20.7 13.8 1-.4",key:"1v5t8k"}]],te=X("user-cog",ne);async function ie(){const{data:o,error:t}=await B.from("departamentos").select("*").order("orden",{ascending:!0,nullsFirst:!1});if(t)throw console.error("[departamentosApi] Error obteniendo departamentos:",t),new Error(t.message||"Error cargando departamentos");return o||[]}async function ae(o){const{data:t,error:a}=await B.from("departamentos").insert({...o,activo:o.activo??!0}).select().single();if(a)throw console.error("[departamentosApi] Error creando departamento:",a),new Error(a.message||"Error creando departamento");return t}async function $(o,t){const{data:a,error:s}=await B.from("departamentos").update({...t,updated_at:new Date().toISOString()}).eq("id",o).select().single();if(s)throw console.error("[departamentosApi] Error actualizando departamento:",s),new Error(s.message||"Error actualizando departamento");return a}async function se(o){let t=B.from("categorias").select("*");o!=null&&o.departamento_id&&(t=t.eq("departamento_id",o.departamento_id)),(o==null?void 0:o.activo)!==void 0&&(t=t.eq("activo",o.activo));const{data:a,error:s}=await t.order("orden",{ascending:!0,nullsFirst:!1});if(s)throw console.error("[categoriasApi] Error obteniendo categor√≠as:",s),new Error(s.message||"Error cargando categor√≠as");return a||[]}async function le(o){const{data:t,error:a}=await B.from("categorias").insert({...o,activo:o.activo??!0}).select().single();if(a)throw console.error("[categoriasApi] Error creando categor√≠a:",a),new Error(a.message||"Error creando categor√≠a");return t}async function de(o,t){const{data:a,error:s}=await B.from("categorias").update({...t,updated_at:new Date().toISOString()}).eq("id",o).select().single();if(s)throw console.error("[categoriasApi] Error actualizando categor√≠a:",s),new Error(s.message||"Error actualizando categor√≠a");return a}async function ce(o){const{error:t}=await B.from("categorias").delete().eq("id",o);if(t)throw console.error("[categoriasApi] Error eliminando categor√≠a:",t),new Error(t.message||"Error eliminando categor√≠a")}async function pe(o){const{data:t,error:a}=await B.from("subcategorias").insert({...o,activo:o.activo??!0}).select().single();if(a)throw console.error("[subcategoriasApi] Error creando subcategor√≠a:",a),new Error(a.message||"Error creando subcategor√≠a");return t}async function xe(o,t){const{data:a,error:s}=await B.from("subcategorias").update({...t,updated_at:new Date().toISOString()}).eq("id",o).select().single();if(s)throw console.error("[subcategoriasApi] Error actualizando subcategor√≠a:",s),new Error(s.message||"Error actualizando subcategor√≠a");return a}const y="#FF6835";function ge({dept:o,onClose:t,onSave:a}){const[s,u]=i.useState((o==null?void 0:o.nombre)??""),[E,j]=i.useState((o==null?void 0:o.icono)??""),[F,C]=i.useState((o==null?void 0:o.color)??"#FF6835"),[b,m]=i.useState(String((o==null?void 0:o.orden)??"")),[c,v]=i.useState((o==null?void 0:o.activo)??!0),[d,f]=i.useState((o==null?void 0:o.moneda)??"UYU"),[z,S]=i.useState((o==null?void 0:o.edad_minima)??"Todas"),[p,R]=i.useState((o==null?void 0:o.alcance)??"Local"),[k,W]=i.useState(!1),I=async()=>{if(s.trim()){W(!0);try{await a({nombre:s.trim(),icono:E.trim()||void 0,color:F||void 0,orden:b?parseInt(b):void 0,activo:c,moneda:d,edad_minima:z,alcance:p}),t()}finally{W(!1)}}};return e.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.45)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("div",{style:{backgroundColor:"#FFF",borderRadius:"14px",padding:"28px",width:"420px",boxShadow:"0 20px 60px rgba(0,0,0,0.2)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsx("h3",{style:{margin:0,fontWeight:"800",color:"#111827"},children:o?"Editar Departamento":"Nuevo Departamento"}),e.jsx("button",{onClick:t,style:{background:"none",border:"none",cursor:"pointer",color:"#9CA3AF"},children:e.jsx(L,{size:18})})]}),[{label:"Nombre *",value:s,onChange:u,placeholder:"Ej: Tecnolog√≠a"},{label:"Icono (emoji)",value:E,onChange:j,placeholder:"Ej: üíª"},{label:"Orden",value:b,onChange:m,placeholder:"Ej: 3",type:"number"}].map(l=>e.jsxs("div",{style:{marginBottom:"14px"},children:[e.jsx("label",{style:{display:"block",fontSize:"0.78rem",fontWeight:"700",color:"#374151",marginBottom:"5px"},children:l.label}),e.jsx("input",{type:l.type??"text",value:l.value,onChange:A=>l.onChange(A.target.value),placeholder:l.placeholder,style:{width:"100%",padding:"9px 12px",border:"1px solid #E5E7EB",borderRadius:"8px",fontSize:"0.875rem",outline:"none",boxSizing:"border-box"}})]},l.label)),e.jsxs("div",{style:{marginBottom:"14px"},children:[e.jsx("label",{style:{display:"block",fontSize:"0.78rem",fontWeight:"700",color:"#374151",marginBottom:"5px"},children:"Color"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx("input",{type:"color",value:F,onChange:l=>C(l.target.value),style:{width:"48px",height:"36px",border:"1px solid #E5E7EB",borderRadius:"6px",cursor:"pointer",padding:"2px"}}),e.jsx("span",{style:{fontSize:"0.78rem",color:"#6B7280"},children:F})]})]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",marginBottom:"14px",fontSize:"0.875rem",color:"#374151"},children:[e.jsx("input",{type:"checkbox",checked:c,onChange:l=>v(l.target.checked),style:{accentColor:y}}),"Activo (visible en la tienda)"]}),e.jsxs("div",{style:{marginBottom:"14px"},children:[e.jsx("label",{style:{display:"block",fontSize:"0.78rem",fontWeight:"700",color:"#374151",marginBottom:"5px"},children:"Moneda"}),e.jsxs("select",{value:d,onChange:l=>f(l.target.value),style:{width:"100%",padding:"9px 12px",border:"1px solid #E5E7EB",borderRadius:"8px",fontSize:"0.875rem",outline:"none",boxSizing:"border-box"},children:[e.jsx("option",{value:"UYU",children:"UYU"}),e.jsx("option",{value:"USD",children:"USD"}),e.jsx("option",{value:"EUR",children:"EUR"})]})]}),e.jsxs("div",{style:{marginBottom:"14px"},children:[e.jsx("label",{style:{display:"block",fontSize:"0.78rem",fontWeight:"700",color:"#374151",marginBottom:"5px"},children:"Edad M√≠nima"}),e.jsxs("select",{value:z,onChange:l=>S(l.target.value),style:{width:"100%",padding:"9px 12px",border:"1px solid #E5E7EB",borderRadius:"8px",fontSize:"0.875rem",outline:"none",boxSizing:"border-box"},children:[e.jsx("option",{value:"Todas",children:"Todas"}),e.jsx("option",{value:"+18",children:"+18"})]})]}),e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsx("label",{style:{display:"block",fontSize:"0.78rem",fontWeight:"700",color:"#374151",marginBottom:"5px"},children:"Alcance"}),e.jsxs("select",{value:p,onChange:l=>R(l.target.value),style:{width:"100%",padding:"9px 12px",border:"1px solid #E5E7EB",borderRadius:"8px",fontSize:"0.875rem",outline:"none",boxSizing:"border-box"},children:[e.jsx("option",{value:"Local",children:"Local"}),e.jsx("option",{value:"Nacional",children:"Nacional"}),e.jsx("option",{value:"Internacional",children:"Internacional"})]})]}),e.jsxs("div",{style:{display:"flex",gap:"10px",justifyContent:"flex-end"},children:[e.jsx("button",{onClick:t,style:{padding:"9px 18px",border:"1px solid #E5E7EB",backgroundColor:"#FFF",borderRadius:"8px",cursor:"pointer",fontWeight:"600",fontSize:"0.875rem"},children:"Cancelar"}),e.jsxs("button",{onClick:I,disabled:k||!s.trim(),style:{padding:"9px 20px",backgroundColor:y,color:"#FFF",border:"none",borderRadius:"8px",fontWeight:"700",cursor:k?"not-allowed":"pointer",fontSize:"0.875rem",display:"flex",alignItems:"center",gap:"6px",opacity:k?.7:1},children:[k?e.jsx(D,{size:14,className:"animate-spin"}):e.jsx(O,{size:14}),o?"Guardar cambios":"Crear departamento"]})]})]})})}function ue({categoria:o,departamentoId:t,onClose:a,onSave:s}){const[u,E]=i.useState((o==null?void 0:o.nombre)??""),[j,F]=i.useState((o==null?void 0:o.icono)??""),[C,b]=i.useState((o==null?void 0:o.color)??"#FF6835"),[m,c]=i.useState(String((o==null?void 0:o.orden)??"")),[v,d]=i.useState((o==null?void 0:o.activo)??!0),[f,z]=i.useState(!1),S=async()=>{if(u.trim()){z(!0);try{await s({departamento_id:t,nombre:u.trim(),icono:j.trim()||void 0,color:C||void 0,orden:m?parseInt(m):void 0,activo:v}),a()}finally{z(!1)}}};return e.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.45)",zIndex:1001,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("div",{style:{backgroundColor:"#FFF",borderRadius:"14px",padding:"28px",width:"420px",boxShadow:"0 20px 60px rgba(0,0,0,0.2)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsx("h3",{style:{margin:0,fontWeight:"800",color:"#111827"},children:o?"Editar Categor√≠a":"Nueva Categor√≠a"}),e.jsx("button",{onClick:a,style:{background:"none",border:"none",cursor:"pointer",color:"#9CA3AF"},children:e.jsx(L,{size:18})})]}),[{label:"Nombre *",value:u,onChange:E,placeholder:"Ej: Electr√≥nica"},{label:"Icono (emoji)",value:j,onChange:F,placeholder:"Ej: üì±"},{label:"Orden",value:m,onChange:c,placeholder:"Ej: 1",type:"number"}].map(p=>e.jsxs("div",{style:{marginBottom:"14px"},children:[e.jsx("label",{style:{display:"block",fontSize:"0.78rem",fontWeight:"700",color:"#374151",marginBottom:"5px"},children:p.label}),e.jsx("input",{type:p.type??"text",value:p.value,onChange:R=>p.onChange(R.target.value),placeholder:p.placeholder,style:{width:"100%",padding:"9px 12px",border:"1px solid #E5E7EB",borderRadius:"8px",fontSize:"0.875rem",outline:"none",boxSizing:"border-box"}})]},p.label)),e.jsxs("div",{style:{marginBottom:"14px"},children:[e.jsx("label",{style:{display:"block",fontSize:"0.78rem",fontWeight:"700",color:"#374151",marginBottom:"5px"},children:"Color"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx("input",{type:"color",value:C,onChange:p=>b(p.target.value),style:{width:"48px",height:"36px",border:"1px solid #E5E7EB",borderRadius:"6px",cursor:"pointer",padding:"2px"}}),e.jsx("span",{style:{fontSize:"0.78rem",color:"#6B7280"},children:C})]})]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",marginBottom:"20px",fontSize:"0.875rem",color:"#374151"},children:[e.jsx("input",{type:"checkbox",checked:v,onChange:p=>d(p.target.checked),style:{accentColor:y}}),"Activo"]}),e.jsxs("div",{style:{display:"flex",gap:"10px",justifyContent:"flex-end"},children:[e.jsx("button",{onClick:a,style:{padding:"9px 18px",border:"1px solid #E5E7EB",backgroundColor:"#FFF",borderRadius:"8px",cursor:"pointer",fontWeight:"600",fontSize:"0.875rem"},children:"Cancelar"}),e.jsxs("button",{onClick:S,disabled:f||!u.trim(),style:{padding:"9px 20px",backgroundColor:y,color:"#FFF",border:"none",borderRadius:"8px",fontWeight:"700",cursor:f?"not-allowed":"pointer",fontSize:"0.875rem",display:"flex",alignItems:"center",gap:"6px",opacity:f?.7:1},children:[f?e.jsx(D,{size:14,className:"animate-spin"}):e.jsx(O,{size:14}),o?"Guardar":"Crear"]})]})]})})}function me({subcategoria:o,categoriaId:t,onClose:a,onSave:s}){const[u,E]=i.useState((o==null?void 0:o.nombre)??""),[j,F]=i.useState(String((o==null?void 0:o.orden)??"")),[C,b]=i.useState((o==null?void 0:o.activo)??!0),[m,c]=i.useState(!1),v=async()=>{if(u.trim()){c(!0);try{await s({categoria_id:t,nombre:u.trim(),orden:j?parseInt(j):void 0,activo:C}),a()}finally{c(!1)}}};return e.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.45)",zIndex:1001,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("div",{style:{backgroundColor:"#FFF",borderRadius:"14px",padding:"28px",width:"420px",boxShadow:"0 20px 60px rgba(0,0,0,0.2)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsx("h3",{style:{margin:0,fontWeight:"800",color:"#111827"},children:o?"Editar Subcategor√≠a":"Nueva Subcategor√≠a"}),e.jsx("button",{onClick:a,style:{background:"none",border:"none",cursor:"pointer",color:"#9CA3AF"},children:e.jsx(L,{size:18})})]}),[{label:"Nombre *",value:u,onChange:E,placeholder:"Ej: Smartphones"},{label:"Orden",value:j,onChange:F,placeholder:"Ej: 1",type:"number"}].map(d=>e.jsxs("div",{style:{marginBottom:"14px"},children:[e.jsx("label",{style:{display:"block",fontSize:"0.78rem",fontWeight:"700",color:"#374151",marginBottom:"5px"},children:d.label}),e.jsx("input",{type:d.type??"text",value:d.value,onChange:f=>d.onChange(f.target.value),placeholder:d.placeholder,style:{width:"100%",padding:"9px 12px",border:"1px solid #E5E7EB",borderRadius:"8px",fontSize:"0.875rem",outline:"none",boxSizing:"border-box"}})]},d.label)),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",marginBottom:"20px",fontSize:"0.875rem",color:"#374151"},children:[e.jsx("input",{type:"checkbox",checked:C,onChange:d=>b(d.target.checked),style:{accentColor:y}}),"Activo"]}),e.jsxs("div",{style:{display:"flex",gap:"10px",justifyContent:"flex-end"},children:[e.jsx("button",{onClick:a,style:{padding:"9px 18px",border:"1px solid #E5E7EB",backgroundColor:"#FFF",borderRadius:"8px",cursor:"pointer",fontWeight:"600",fontSize:"0.875rem"},children:"Cancelar"}),e.jsxs("button",{onClick:v,disabled:m||!u.trim(),style:{padding:"9px 20px",backgroundColor:y,color:"#FFF",border:"none",borderRadius:"8px",fontWeight:"700",cursor:m?"not-allowed":"pointer",fontSize:"0.875rem",display:"flex",alignItems:"center",gap:"6px",opacity:m?.7:1},children:[m?e.jsx(D,{size:14,className:"animate-spin"}):e.jsx(O,{size:14}),o?"Guardar":"Crear"]})]})]})})}function he({dept:o,index:t,isExpanded:a,viewMode:s,onToggleExpand:u,onEdit:E,onToggleActivo:j,onLoadCategorias:F,onSaveCategoria:C,onSaveSubcategoria:b,onDeleteCategoria:m}){const c=s==="admin",[v,d]=i.useState([]),[f,z]=i.useState(!1),[S,p]=i.useState(new Set),[R,k]=i.useState(!1),[W,I]=i.useState(!1),[l,A]=i.useState(null),[r,x]=i.useState(null),[g,h]=i.useState(""),[M,U]=i.useState(null);i.useEffect(()=>{a&&v.length===0&&N()},[a]);const N=async()=>{z(!0);try{const n=await F(o.id);d(n)}catch(n){console.error("Error cargando categor√≠as:",n)}finally{z(!1)}},P=n=>{const w=new Set(S);w.has(n)?w.delete(n):w.add(n),p(w)},Y=async n=>{l?await de(l.id,n):await C(n),await N(),k(!1),A(null)},H=async n=>{if(m&&confirm("¬øEst√°s seguro de que quer√©s eliminar esta categor√≠a? Esto tambi√©n eliminar√° todas sus subcategor√≠as.")){U(n);try{await m(n),await N()}catch(w){console.error("Error eliminando categor√≠a:",w),alert("Error al eliminar la categor√≠a")}finally{U(null)}}},J=async n=>{r?await xe(r.id,n):await b(n),await N(),I(!1),x(null),h("")};return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"12px 16px",borderBottom:"1px solid #F3F4F6",backgroundColor:t%2===0?"#FFFFFF":"#FAFAFA",transition:"background-color 0.1s"},onMouseEnter:n=>n.currentTarget.style.backgroundColor="#FFF4EC",onMouseLeave:n=>n.currentTarget.style.backgroundColor=t%2===0?"#FFFFFF":"#FAFAFA",children:[e.jsx("button",{onClick:()=>u(o.id),style:{background:"none",border:"none",cursor:"pointer",color:"#9CA3AF",padding:"2px 6px",marginRight:"4px",flexShrink:0},children:a?e.jsx(q,{size:15}):e.jsx(V,{size:15})}),e.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"8px",backgroundColor:o.color?`${o.color}22`:"#F3F4F6",border:o.color?`1px solid ${o.color}44`:"none",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.2rem",flexShrink:0,marginRight:"12px"},children:o.icono||"üì¶"}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("span",{style:{fontWeight:"600",color:"#111827",fontSize:"0.875rem"},children:o.nombre}),!o.activo&&e.jsx("span",{style:{padding:"1px 7px",borderRadius:"12px",backgroundColor:"#F3F4F6",color:"#6B7280",fontSize:"0.65rem",fontWeight:"700"},children:"Inactivo"})]}),o.color&&e.jsxs("span",{style:{fontSize:"0.72rem",color:"#9CA3AF"},children:[o.color," ",o.orden!==void 0?`¬∑ orden ${o.orden}`:""]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"14px",flexShrink:0},children:[c&&e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"4px",cursor:"pointer",fontSize:"0.72rem",color:"#6B7280"},children:[e.jsx("input",{type:"checkbox",checked:o.activo,onChange:n=>j(o.id,n.target.checked),style:{accentColor:y}}),"Visible"]}),e.jsx("button",{onClick:()=>E(o),style:{background:"none",border:"none",cursor:"pointer",color:"#9CA3AF",padding:"3px"},children:e.jsx(T,{size:14})})]})]}),a&&e.jsxs("div",{style:{backgroundColor:"#F9FAFB",borderBottom:"1px solid #F3F4F6",padding:"12px 16px 12px 60px"},children:[R&&e.jsx(ue,{categoria:l,departamentoId:o.id,onClose:()=>{k(!1),A(null)},onSave:Y}),W&&e.jsx(me,{subcategoria:r,categoriaId:g,onClose:()=>{I(!1),x(null),h("")},onSave:J}),e.jsxs("div",{style:{marginBottom:"12px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("p",{style:{margin:0,fontSize:"0.72rem",fontWeight:"700",color:"#6B7280",textTransform:"uppercase",letterSpacing:"0.05em"},children:"Categor√≠as"}),c&&e.jsxs("button",{onClick:()=>{A(null),k(!0)},style:{padding:"4px 10px",backgroundColor:y,color:"#FFF",border:"none",borderRadius:"6px",fontWeight:"600",fontSize:"0.72rem",cursor:"pointer",display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(G,{size:12})," Agregar categor√≠a"]})]}),f?e.jsxs("div",{style:{padding:"20px",textAlign:"center",color:"#9CA3AF",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[e.jsx(D,{size:14,style:{animation:"spin 1s linear infinite"}}),e.jsx("span",{style:{fontSize:"0.75rem"},children:"Cargando categor√≠as..."})]}):v.length===0?e.jsxs("div",{style:{padding:"20px",textAlign:"center",color:"#9CA3AF",fontSize:"0.75rem"},children:["No hay categor√≠as. ",c&&"Agreg√° la primera."]}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:v.map(n=>e.jsxs("div",{style:{backgroundColor:"#FFFFFF",borderRadius:"8px",border:"1px solid #E5E7EB",overflow:"hidden"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"8px 12px",gap:"8px"},children:[e.jsx("button",{onClick:()=>P(n.id),style:{background:"none",border:"none",cursor:"pointer",color:"#9CA3AF",padding:"2px",flexShrink:0},children:S.has(n.id)?e.jsx(q,{size:12}):e.jsx(V,{size:12})}),e.jsx("div",{style:{width:"24px",height:"24px",borderRadius:"6px",backgroundColor:n.color?`${n.color}22`:"#F3F4F6",border:n.color?`1px solid ${n.color}44`:"none",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.9rem",flexShrink:0},children:n.icono||"üìÅ"}),e.jsx("span",{style:{flex:1,fontWeight:"600",color:"#111827",fontSize:"0.8rem"},children:n.nombre}),!n.activo&&e.jsx("span",{style:{padding:"1px 6px",borderRadius:"10px",backgroundColor:"#F3F4F6",color:"#6B7280",fontSize:"0.65rem",fontWeight:"700"},children:"Inactivo"}),c&&e.jsxs("div",{style:{display:"flex",gap:"6px",alignItems:"center"},children:[e.jsx("button",{onClick:()=>{A(n),k(!0)},style:{background:"none",border:"none",cursor:"pointer",color:"#9CA3AF",padding:"2px"},children:e.jsx(T,{size:12})}),m&&e.jsx("button",{onClick:()=>H(n.id),disabled:M===n.id,style:{background:"none",border:"none",cursor:M===n.id?"not-allowed":"pointer",color:M===n.id?"#D1D5DB":"#EF4444",padding:"2px",opacity:M===n.id?.5:1},children:M===n.id?e.jsx(D,{size:12,style:{animation:"spin 1s linear infinite"}}):e.jsx(re,{size:12})}),e.jsx("button",{onClick:()=>{h(n.id),x(null),I(!0)},style:{padding:"2px 6px",backgroundColor:"#F0F9FF",color:"#0284C7",border:"none",borderRadius:"4px",fontWeight:"600",fontSize:"0.65rem",cursor:"pointer"},children:"+ Sub"})]})]}),S.has(n.id)&&n.subcategorias&&n.subcategorias.length>0&&e.jsxs("div",{style:{padding:"8px 12px 8px 44px",backgroundColor:"#FAFAFA",borderTop:"1px solid #F3F4F6"},children:[e.jsx("p",{style:{margin:"0 0 6px",fontSize:"0.65rem",fontWeight:"700",color:"#9CA3AF",textTransform:"uppercase"},children:"Subcategor√≠as"}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:n.subcategorias.map(w=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"4px 8px",backgroundColor:"#FFFFFF",borderRadius:"4px",border:"1px solid #E5E7EB"},children:[e.jsx("span",{style:{flex:1,fontSize:"0.75rem",color:"#374151"},children:w.nombre}),!w.activo&&e.jsx("span",{style:{padding:"1px 5px",borderRadius:"8px",backgroundColor:"#F3F4F6",color:"#6B7280",fontSize:"0.6rem",fontWeight:"700"},children:"Inactivo"}),c&&e.jsx("button",{onClick:()=>{x(w),h(n.id),I(!0)},style:{background:"none",border:"none",cursor:"pointer",color:"#9CA3AF",padding:"2px"},children:e.jsx(T,{size:10})})]},w.id))})]})]},n.id))})]})]})}function Ne({onNavigate:o}){const[t,a]=i.useState([]),[s,u]=i.useState(!0),[E,j]=i.useState(null),[F,C]=i.useState(new Set),[b,m]=i.useState(""),[c,v]=i.useState("admin"),[d,f]=i.useState("new"),[z,S]=i.useState(!1),p=i.useCallback(async()=>{u(!0),j(null);try{const r=await ie();a(r)}catch(r){j(r.message??"Error cargando departamentos")}finally{u(!1)}},[]);i.useEffect(()=>{p()},[p]);const R=r=>{const x=new Set(F);x.has(r)?x.delete(r):x.add(r),C(x)},k=async(r,x)=>{a(g=>g.map(h=>h.id===r?{...h,activo:x}:h));try{await $(r,{activo:x})}catch{a(g=>g.map(h=>h.id===r?{...h,activo:!x}:h))}},W=async r=>{d&&d!=="new"&&d.id?await $(d.id,r):await ae({nombre:r.nombre,...r}),await p()},I=()=>{const r=JSON.stringify(t,null,2),x=new Blob([r],{type:"application/json"}),g=URL.createObjectURL(x),h=document.createElement("a");h.href=g,h.download="departamentos.json",h.click(),URL.revokeObjectURL(g)},l=c==="admin",A=t.filter(r=>r.nombre.toLowerCase().includes(b.toLowerCase()));return e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:[z&&e.jsx(ge,{dept:d==="new"?null:d,onClose:()=>S(!1),onSave:W}),e.jsx(K,{icon:Q,title:"Departamentos y Categor√≠as",subtitle:"Gesti√≥n de departamentos, categor√≠as y subcategor√≠as",actions:[{label:"‚Üê Volver",onClick:()=>o("gestion")}]}),e.jsxs("div",{style:{backgroundColor:"#FFFFFF",borderBottom:"1px solid #E5E7EB",padding:"0 28px",display:"flex",alignItems:"center",flexShrink:0},children:[[{key:"admin",icon:Z,label:"Vista Administrador",desc:"Acceso completo a todos los controles"},{key:"operador",icon:te,label:"Vista Operador",desc:"Sin visibilidad, moneda ni edad"}].map(r=>e.jsxs("button",{onClick:()=>v(r.key),style:{display:"flex",alignItems:"center",gap:"8px",padding:"14px 20px",border:"none",borderBottom:c===r.key?`3px solid ${y}`:"3px solid transparent",backgroundColor:"transparent",cursor:"pointer",color:c===r.key?y:"#6B7280",fontWeight:c===r.key?"700":"500",fontSize:"0.85rem",transition:"all 0.15s",whiteSpace:"nowrap"},children:[e.jsx(r.icon,{size:15}),r.label,e.jsx("span",{style:{marginLeft:"4px",padding:"2px 8px",borderRadius:"20px",backgroundColor:c===r.key?"#FFF4EC":"#F3F4F6",color:c===r.key?y:"#9CA3AF",fontSize:"0.68rem",fontWeight:"600"},children:r.desc})]},r.key)),!l&&e.jsxs("div",{style:{marginLeft:"auto",display:"flex",alignItems:"center",gap:"6px",padding:"6px 14px",backgroundColor:"#FEF3C7",borderRadius:"20px",border:"1px solid #FDE68A"},children:[e.jsx(_,{size:13,color:"#D97706"}),e.jsx("span",{style:{fontSize:"0.72rem",fontWeight:"700",color:"#92400E"},children:"Visibilidad ¬∑ Moneda ¬∑ Alcance ¬∑ Edad ‚Äì deshabilitados"})]})]}),e.jsxs("div",{style:{backgroundColor:"#FFFFFF",borderBottom:"1px solid #E5E7EB",padding:"12px 28px",flexShrink:0},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"2px"},children:[e.jsx("span",{style:{fontSize:"1.1rem"},children:"üè¨"}),e.jsx("h2",{style:{margin:0,fontWeight:"800",color:"#111827",fontSize:"1rem"},children:l?"Gesti√≥n Completa de Departamentos":"Departamentos ‚Äì Vista Restringida"}),e.jsx("span",{style:{padding:"2px 10px",borderRadius:"20px",backgroundColor:l?"#F0FFF4":"#FEF3C7",color:l?"#16A34A":"#D97706",fontSize:"0.72rem",fontWeight:"700",border:`1px solid ${l?"#BBF7D0":"#FDE68A"}`},children:l?"‚ö° Modo API":"üîí Acceso Limitado"})]}),e.jsx("p",{style:{margin:0,color:"#6B7280",fontSize:"0.75rem"},children:l?"Datos en tiempo real desde Supabase ¬∑ Cambios se guardan autom√°ticamente":"Solo pod√©s editar sincronizaci√≥n ML ¬∑ Visibilidad, moneda, alcance y edad son de gesti√≥n exclusiva del Admin"})]}),e.jsx("div",{style:{flex:1,overflowY:"auto",backgroundColor:"#F8F9FA"},children:e.jsxs("div",{style:{padding:"20px 28px",maxWidth:"1200px"},children:[E&&e.jsxs("div",{style:{backgroundColor:"#FEF2F2",border:"1px solid #FECACA",borderRadius:"10px",padding:"12px 16px",marginBottom:"20px",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx(_,{size:16,color:"#DC2626"}),e.jsx("span",{style:{fontWeight:"600",color:"#DC2626",fontSize:"0.85rem"},children:E})]}),e.jsx("button",{onClick:p,style:{padding:"6px 14px",backgroundColor:"#DC2626",color:"#FFF",border:"none",borderRadius:"7px",fontWeight:"700",cursor:"pointer",fontSize:"0.78rem"},children:"Reintentar"})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"12px",marginBottom:"20px"},children:[{value:s?"‚Ä¶":t.length,label:"Departamentos",color:y},{value:s?"‚Ä¶":t.filter(r=>r.activo).length,label:"Activos",color:"#10B981"},{value:s?"‚Ä¶":t.filter(r=>!r.activo).length,label:"Inactivos",color:"#6B7280"}].map((r,x)=>e.jsxs("div",{style:{backgroundColor:"#FFFFFF",borderRadius:"8px",border:`1px solid ${r.color}22`,padding:"12px 16px"},children:[e.jsx("p",{style:{margin:0,fontSize:"1.5rem",fontWeight:"900",color:r.color},children:r.value}),e.jsx("p",{style:{margin:"2px 0 0",fontSize:"0.72rem",color:"#6B7280"},children:r.label})]},x))}),e.jsxs("div",{style:{display:"flex",gap:"10px",marginBottom:"16px",alignItems:"center"},children:[e.jsx("div",{style:{position:"relative",flex:1,maxWidth:"320px"},children:e.jsx("input",{type:"text",placeholder:"Buscar departamento...",value:b,onChange:r=>m(r.target.value),style:{width:"100%",padding:"9px 12px",border:"1px solid #E5E7EB",borderRadius:"8px",fontSize:"0.875rem",outline:"none",boxSizing:"border-box"}})}),e.jsx("div",{style:{flex:1}}),l&&e.jsxs("button",{onClick:()=>{f("new"),S(!0)},style:{padding:"9px 16px",backgroundColor:y,color:"#FFF",border:"none",borderRadius:"8px",fontWeight:"700",fontSize:"0.82rem",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(G,{size:14})," Nuevo"]}),e.jsxs("button",{onClick:I,style:{padding:"9px 16px",backgroundColor:"#3B82F6",color:"#FFF",border:"none",borderRadius:"8px",fontWeight:"700",fontSize:"0.82rem",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(ee,{size:14})," Exportar"]}),e.jsxs("button",{onClick:p,style:{padding:"9px 16px",border:"1px solid #E5E7EB",backgroundColor:"#FFF",color:"#374151",borderRadius:"8px",fontWeight:"600",fontSize:"0.82rem",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(oe,{size:14})," Recargar"]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"6px 16px 6px 64px",marginBottom:"4px",gap:"14px"},children:[e.jsx("span",{style:{flex:1,fontSize:"0.68rem",fontWeight:"700",color:"#9CA3AF",textTransform:"uppercase",letterSpacing:"0.05em"},children:"Departamento"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"14px",flexShrink:0,fontSize:"0.68rem",fontWeight:"700",color:"#9CA3AF",textTransform:"uppercase",letterSpacing:"0.05em"},children:[l&&e.jsx("span",{style:{minWidth:"48px",textAlign:"center"},children:"Visible"}),e.jsx("span",{style:{minWidth:"24px"}})]})]}),e.jsx("div",{style:{backgroundColor:"#FFFFFF",borderRadius:"12px",border:"1px solid #E5E7EB",overflow:"hidden"},children:s?e.jsxs("div",{style:{padding:"40px",textAlign:"center",color:"#9CA3AF",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px"},children:[e.jsx(D,{size:18,style:{animation:"spin 1s linear infinite"}}),e.jsx("span",{children:"Cargando departamentos..."})]}):A.length===0?e.jsx("div",{style:{padding:"40px",textAlign:"center",color:"#9CA3AF"},children:b?`No se encontraron departamentos para "${b}"`:"No hay departamentos. Cre√° el primero."}):A.map((r,x)=>e.jsx(he,{dept:r,index:x,isExpanded:F.has(r.id),viewMode:c,onToggleExpand:R,onEdit:g=>{f(g),S(!0)},onToggleActivo:k,onLoadCategorias:async g=>await se({departamento_id:g}),onSaveCategoria:async g=>{await le(g)},onSaveSubcategoria:async g=>{await pe(g)},onDeleteCategoria:l?async g=>{await ce(g)}:void 0},r.id))}),l&&!s&&e.jsx("button",{onClick:()=>{f("new"),S(!0)},style:{marginTop:"14px",padding:"12px 20px",border:`2px dashed ${y}`,borderRadius:"10px",backgroundColor:"#FFF4EC",color:y,fontWeight:"700",cursor:"pointer",fontSize:"0.875rem",display:"flex",alignItems:"center",gap:"8px"},children:"üè¨ + Nuevo Departamento"})]})})]})}export{Ne as DepartamentosView};
