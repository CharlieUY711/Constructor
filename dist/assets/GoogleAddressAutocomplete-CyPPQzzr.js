import{r as l,j as o}from"./index-Q3JFmZuo.js";import{l as S,w as j,i as P}from"./loader-CAj64nxW.js";import{M as v}from"./map-pin-x8EonAdr.js";import{L}from"./loader-circle-DdcU2fbr.js";async function D(d,r){try{if(await S(),await j(),!P())throw new Error("Google Maps API no est치 disponible");const i=new window.google.maps.places.AutocompleteService;return new Promise((n,s)=>{const u={input:d,componentRestrictions:{country:"uy"},language:"es"};r!=null&&r.location,r!=null&&r.types&&r.types.length>0,i.getPlacePredictions(u,(g,m)=>{if(m==="OK"&&g){const f=g.map(a=>({place_id:a.place_id,description:a.description,structured_formatting:{main_text:a.structured_formatting.main_text,secondary_text:a.structured_formatting.secondary_text},types:a.types}));n(f)}else m==="ZERO_RESULTS"?n([]):s(new Error(`Error obteniendo predicciones: ${m}`))})})}catch(i){throw console.error("[places] Error obteniendo predicciones:",i),i}}async function I(d){try{if(await S(),await j(),!P())throw new Error("Google Maps API no est치 disponible");const r=new window.google.maps.places.PlacesService(document.createElement("div"));return new Promise((i,n)=>{r.getDetails({placeId:d,fields:["place_id","formatted_address","name","geometry","address_components","types","international_phone_number","website"],language:"es"},(s,u)=>{u==="OK"&&s?i({place_id:s.place_id,formatted_address:s.formatted_address,name:s.name,geometry:{location:{lat:s.geometry.location.lat(),lng:s.geometry.location.lng()}},address_components:s.address_components||[],types:s.types,international_phone_number:s.international_phone_number,website:s.website}):u==="ZERO_RESULTS"?i(null):n(new Error(`Error obteniendo detalles del lugar: ${u}`))})})}catch(r){throw console.error("[places] Error obteniendo detalles del lugar:",r),r}}function $({value:d="",placeholder:r="Ingres치 una direcci칩n...",onSelect:i,onChange:n,className:s="",disabled:u=!1,required:g=!1}){const[m,f]=l.useState(d),[a,w]=l.useState([]),[N,h]=l.useState(!1),[_,c]=l.useState(!1),[p,y]=l.useState(-1),R=l.useRef(null),x=l.useRef(null),b=l.useRef(null);l.useEffect(()=>{f(d)},[d]),l.useEffect(()=>{function t(e){x.current&&!x.current.contains(e.target)&&c(!1)}return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[]);const A=l.useCallback(async t=>{if(!t||t.length<3){w([]),c(!1);return}h(!0);try{const e=await D(t);w(e),c(e.length>0),y(-1)}catch(e){console.error("[GoogleAddressAutocomplete] Error buscando predicciones:",e),w([]),c(!1)}finally{h(!1)}},[]),k=t=>{const e=t.target.value;f(e),n==null||n(e),c(!1),b.current&&clearTimeout(b.current),b.current=setTimeout(()=>{A(e)},300)},E=async t=>{f(t.description),c(!1),w([]),n==null||n(t.description);try{const e=await I(t.place_id);e&&i&&i({address:t.description,lat:e.geometry.location.lat,lng:e.geometry.location.lng,place_id:t.place_id,formatted_address:e.formatted_address})}catch(e){console.error("[GoogleAddressAutocomplete] Error obteniendo detalles:",e)}},G=t=>{if(!(!_||a.length===0))switch(t.key){case"ArrowDown":t.preventDefault(),y(e=>e<a.length-1?e+1:e);break;case"ArrowUp":t.preventDefault(),y(e=>e>0?e-1:-1);break;case"Enter":t.preventDefault(),p>=0&&p<a.length&&E(a[p]);break;case"Escape":c(!1);break}};return o.jsxs("div",{ref:x,className:`relative ${s}`,children:[o.jsxs("div",{className:"relative",children:[o.jsx(v,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),o.jsx("input",{ref:R,type:"text",value:m,onChange:k,onKeyDown:G,onFocus:()=>{a.length>0&&c(!0)},placeholder:r,disabled:u,required:g,className:"w-full pl-10 pr-10 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed"}),N&&o.jsx(L,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400 animate-spin"})]}),_&&a.length>0&&o.jsx("div",{className:"absolute z-50 w-full mt-1 bg-white border border-gray-200 rounded-md shadow-lg max-h-60 overflow-auto",children:a.map((t,e)=>o.jsx("button",{type:"button",onClick:()=>E(t),className:`w-full text-left px-4 py-2 hover:bg-gray-50 focus:bg-gray-50 focus:outline-none ${e===p?"bg-gray-50":""}`,children:o.jsxs("div",{className:"flex items-start gap-2",children:[o.jsx(v,{className:"w-4 h-4 text-gray-400 mt-0.5 flex-shrink-0"}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsx("div",{className:"font-medium text-sm text-gray-900",children:t.structured_formatting.main_text}),o.jsx("div",{className:"text-xs text-gray-500 truncate",children:t.structured_formatting.secondary_text})]})]})},t.place_id))})]})}export{$ as G,I as g};
