<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Prueba</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      background: #cc0000;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-family: system-ui, sans-serif;
    }

    .input-wrap {
      display: flex;
      gap: 12px;
      margin-bottom: 60px;
    }

    input {
      padding: 16px 24px;
      font-size: 20px;
      border: none;
      border-radius: 12px;
      outline: none;
      width: 320px;
      background: white;
      color: #111;
    }

    button {
      padding: 16px 28px;
      font-size: 18px;
      font-weight: 700;
      border: none;
      border-radius: 12px;
      background: #800000;
      color: white;
      cursor: pointer;
    }

    button:hover { background: #600000; }
    button:disabled { opacity: 0.5; cursor: not-allowed; }

    .nombres {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      justify-content: center;
      max-width: 800px;
    }

    .nombre {
      font-size: 28px;
      font-weight: 800;
      color: white;
      animation: aparecer 0.3s ease;
    }

    .error {
      color: #ffcccc;
      font-size: 14px;
      margin-top: 12px;
    }

    @keyframes aparecer {
      from { opacity: 0; transform: translateY(10px); }
      to   { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>

  <div class="input-wrap">
    <input id="campo" type="text" placeholder="Tu nombre..." autofocus />
    <button id="btn" onclick="guardar()">Guardar</button>
  </div>

  <div class="nombres" id="lista"></div>
  <div class="error" id="error"></div>

  <script>
    const URL = 'https://qhnmxvexkizcsmivfuam.supabase.co';
    const KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFobm14dmV4a2l6Y3NtaXZmdWFtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEyMjEyODEsImV4cCI6MjA4Njc5NzI4MX0.Ifz4fJYldIGZFzhBK5PPxQeqdYzO2ZKNQ5uo8j2mYmM';

    const headers = {
      'apikey': KEY,
      'Authorization': `Bearer ${KEY}`,
      'Content-Type': 'application/json',
    };

    async function cargar() {
      const res = await fetch(`${URL}/rest/v1/transportistas?select=nombre&order=nombre`, { headers });
      const data = await res.json();
      const lista = document.getElementById('lista');
      lista.innerHTML = '';
      if (Array.isArray(data)) {
        data.forEach(r => {
          const div = document.createElement('div');
          div.className = 'nombre';
          div.textContent = r.nombre;
          lista.appendChild(div);
        });
      }
    }

    async function guardar() {
      const campo = document.getElementById('campo');
      const btn   = document.getElementById('btn');
      const err   = document.getElementById('error');
      const nombre = campo.value.trim();

      if (!nombre) return;

      btn.disabled = true;
      err.textContent = '';

      const res = await fetch(`${URL}/rest/v1/transportistas`, {
        method: 'POST',
        headers: { ...headers, 'Prefer': 'return=minimal' },
        body: JSON.stringify({ nombre, tipo: 'prueba', estado: 'activo' }),
      });

      if (res.ok) {
        campo.value = '';
        await cargar();
      } else {
        const e = await res.json();
        err.textContent = `Error: ${e.message ?? res.status}`;
      }

      btn.disabled = false;
      campo.focus();
    }

    // Enter para guardar
    document.getElementById('campo').addEventListener('keydown', e => {
      if (e.key === 'Enter') guardar();
    });

    // Cargar al inicio
    cargar();
  </script>

</body>
</html>
